# 普通网页资产提取流程

使用本项目MCP 和 Firecrawl MCP 提取页面地图、主题、数据模型与项目文档。

## 工具选择策略

**默认使用本项目MCP**（免费且复用鉴权）

**Firecrawl MCP 仅作为备份**，仅在以下情况使用：
-本项目MCP 调用失败或返回错误
- 链接发现不足（< 5 个）
- 结构化数据提取需求
- 用户明确要求

**页面加载等待**：遇到抓取错误或数据不完整时，添加等待参数（建议 2000-5000ms）：
-本项目MCP：`waitTime` 参数
- Firecrawl MCP：`waitFor` 参数

## 环境检测

1. 尝试调用本项目MCP 工具（如 `get_page_theme`），检测是否可用。
2. 检测 Firecrawl MCP 是否可用（用于批量操作和备份）。

要求：
- 至少安装一个 MCP（Axhub MCP 或 Firecrawl MCP）。
- 推荐全部安装以获得更好体验。

若两个 MCP 都未安装，提示用户至少安装一个 MCP 工具才能继续。

## 获取网页链接

用户未提供链接时，提示用户提供一个或多个网页 URL。无论提供单个还是多个链接，均使用 map 工具发现更多相关页面。

## 发现相关页面

使用 `get_page_map` 提取页面链接，链接不足时使用 `firecrawl_map` 作为备份。

合并和筛选链接，识别页面类型，建议用户选择 5-10 个核心页面进行深度分析。

## 明确用户需求

用户未明确需求时，提供默认建议：提取设计主题、数据模型、项目文档。根据用户反馈调整执行计划。

## 提取设计主题

### 选择核心页面

从发现的页面中选择 3-5 个核心页面用于主题提取：
- 优先选择首页、主要功能页
- 选择视觉元素丰富的页面
- 确保页面风格具有代表性

### 获取核心页面截图

为每个核心页面准备截图（首屏或关键模块）用于视觉分析：
- 优先使用 MCP 可用的截图能力；无法获取时请求用户提供
- 确保截图能覆盖关键组件、排版层级与色彩体系

### 提取并合并主题

使用 `get_page_theme` 提取主题数据（颜色、字体、间距、圆角、阴影等）。失效时使用 Firecrawl 的 `branding` 格式。

合并多页面主题：
- 统计出现频率，保留主要色系
- 识别主要字体族和字号
- 提取常用间距、圆角、阴影值

### 视觉语言分析与规范总结

基于多页面截图总结设计语言与规范要点：
- 品牌气质与视觉关键词
- 形状语言（圆角/直角/对比强弱）
- 排版节奏（字号层级、字重、行高）
- 组件风格（按钮/卡片/输入的常见形态与状态）

### 生成主题文件

生成符合 `theme-generation-guide.md` 规范的主题文件：

**输出位置**：`src/themes/<theme-key>/`
**必需文件**：
- `globals.css` 或 `designToken.json`（designToken.json 必须包含 `name` 字段，二选一，遵循规范）
- `DESIGN-SPEC.md`（基于多页面截图的设计规范文档）
- `index.tsx`：主题演示页（使用 `designToken.json` 时再通过 `ConfigProvider` 注入）

## 提取数据模型

### 识别数据密集型页面

从发现的页面中识别可能包含数据的页面：
- 列表页（产品列表、文章列表等）
- 详情页（产品详情、文章详情等）
- 表单页（注册、登录等）
- 表格页（数据表格、统计报表等）

### 提取页面内容

使用 `get_page_markdown` 提取页面内容。如需批量操作（> 5 个页面）或结构化提取，使用 Firecrawl 的 `batch_scrape` 或 `extract`。

### 分析数据结构

从提取的内容中识别数据结构：
- 表格列名 → 数据字段
- 列表项模式 → 数据模型
- 表单字段 → 数据字段

### 跨页面验证

多个页面涉及同一数据模型时：
- 合并字段列表
- 去重和规范化
- 识别字段类型和必填/可选属性

### 生成数据库文件

**输出位置**：`assets/database/`
**文件命名**：使用英文文件名，如 `products.json`、`articles.json`

**文件格式**：
```json
{
  "tableName": "表名（中文）",
  "records": [
    { "id": 1, "字段1": "值1", "字段2": "值2" }
  ]
}
```

**关键原则**：
- **文件名使用英文**：如 `products.json`、`orders.json`、`users.json`
- **tableName 使用中文**：如 "产品表"、"订单表"、"用户表"
- **字段名优先使用中文**，与网页显示一致
- **保持命名一致性**
- 从网页提取真实数据，不足时生成合理模拟数据
- 每个表生成 10-30 条记录
- 确保 id 字段唯一

## 生成项目文档

### 页面地图文档

将发现的页面转换为 Markdown 文档：
- 按页面类型分组
- 每个页面名称必须是可点击的链接
- 标注页面功能和用途

**输出位置**：`assets/docs/page-map.md`

### 项目简介文档

基于提取的信息生成项目概览：
- 基本信息（网站名称、页面数量、主要功能）
- 设计风格（主色调、字体、设计风格）
- 数据模型概览

**输出位置**：`assets/docs/project-overview.md`

## 业务文档生成指南（用户请求时）

- Domain Model（业务领域模型）
- Business Relationship Model（业务关系模型）
- Business Flow / Process（业务流程模型）
- State Machine / Lifecycle（状态与生命周期模型）
- Permission / Access Model（权限模型）

数据不足时明确说明原因。输出位置：`assets/docs/`

## 默认方案（用户未明确需求时）

1. 发现相关页面
2. 提取设计主题并生成设计规范文档
3. 识别数据模型
4. 生成项目文档

## 用户交互指南

### 初始对话

```
您好！我可以帮您从网页中提取资产（主题 / 数据模型 / 项目文档）。

请提供网页链接，我将：
1. 发现相关页面
2. 提取设计主题并生成设计规范文档
3. 识别数据模型
4. 生成项目文档

请提供网页 URL，或告诉我您的具体需求。
```

### 环境检测失败

```
⚠️ 检测到 MCP 工具未安装或配置有误。

至少需要安装以下一个 MCP 工具：
-本项目MCP（推荐，免费且复用鉴权）
- Firecrawl MCP（功能强大，用于批量操作）

💡 建议同时安装两个 MCP 以获得最佳体验。
```

### 需求确认

```
✓ 已发现 [X] 个相关页面。

默认方案：
- 从核心页面提取设计主题并生成设计规范文档
- 识别数据模型
- 生成项目文档

回复"接受"按默认方案执行，或告诉我您的具体需求。
```

### 进度通知

```
正在处理...
✓ 已发现相关页面
✓ 已提取主题数据
⏳ 正在分析数据模型...
```

### 完成总结

```
✅ 已完成！

生成的资产：
- 设计主题：src/themes/<theme-key>/
- 设计规范文档：src/themes/<theme-key>/DESIGN-SPEC.md
- 数据模型：assets/database/
- 项目文档：assets/docs/

后续建议：
💡 我还可以为您：
- 还原页面：告诉我需要还原的页面名称或 URL
- 生成业务文档：领域模型、业务流程等

需要吗？
```

### 关键原则

- 主动确认重要操作
- 及时反馈进度
- 清晰总结成果
- 提供选项而非强制
- 友好处理错误
- 引导后续操作

## 注意事项

- 工具默认使用本项目MCP；Firecrawl 仅在本项目出错或特殊情况时使用
- 使用 `get_page_map` 发现链接，不足时（< 5 个）使用 `firecrawl_map`
- 及时反馈进度，明确告知用户正在使用哪个工具
- 尊重网站版权，提取的资产仅用于学习和开发
