---
name: local-axure-workflow
description: 处理本地导出的 Axure 原型资源并生成主题、数据模型与页面还原的流程规范；在需要基于 sitemap.json 与本地页面资源进行分析与还原时使用。
---

# 本地 Axure 资源处理规范

处理本地导出的 Axure 原型资源，包括主题提取、数据模型识别和页面还原。

## 核心能力

1. **主题提取与合并**：从多个页面提取 design tokens，合并生成统一主题文件
2. **数据模型识别**：从页面内容识别数据结构，生成数据库文件
3. **页面还原**：基于截图、主题、内容的精确还原
4. **MCP 补充**：可选使用 MCP 工具获取在线资源（如 sitemap.json 包含 projectUrl）

## 本地资源目录结构

```
<project-dir>/
├── sitemap.json              # 站点地图
└── page-<index>-<name>/      # 页面目录
    ├── assets/
    │   ├── images/           # 图片资源
    │   └── fonts/            # 字体资源（如有）
    ├── doms.toon             # DOM 节点映射（TOON 格式）
    ├── styles.toon           # 样式池（TOON 格式）
    ├── theme.json            # 设计令牌（Top10）
    ├── content.md            # 页面内容（Markdown）
    └── screenshot.png        # 页面截图
```

### 关键文件说明

- **sitemap.json**：项目名称、页面列表、原型 URL（如有）
- **theme.json**：设计令牌（colors、typography、spacing、radius、shadow 等）
- **doms.toon**：DOM 节点映射（TOON 格式，仅在需要精确还原时使用）
- **styles.toon**：样式池（TOON 格式，仅在需要完整样式时使用）
- **content.md**：页面内容（Markdown 格式）
- **screenshot.png**：页面截图（还原主要依据）

## 工作流程

### 阶段 0：定位资源目录

用户未提供目录路径时，使用 `listDirectory` 工具查找 `apps/axhub-make/temp/` 下的项目目录（通常在二级目录下包含 sitemap.json）。找到后读取 sitemap.json 获取项目名称，询问用户是否处理该项目；如不是则请求提供正确路径。

### 阶段 1：识别资源

验证目录结构（检查 sitemap.json），解析站点地图，明确用户需求（默认：提取主题、识别数据、生成文档）。

### 阶段 2：提取设计主题

选择 3-5 个核心页面（首页、登录页、主要功能页），读取各页面的 `theme.json` 并结合 `screenshot.png` 分析视觉风格，合并主题数据（颜色、字体、间距、圆角、阴影），总结设计语言并生成设计规范。

**输出**：`src/themes/<theme-key>/`（包含 `globals.css` 或 `designToken.json`（designToken.json 必须包含 `name` 字段）、`DESIGN-SPEC.md`、`index.tsx`，符合 `theme-generation-guide.md` 规范）

### 阶段 3：识别数据模型

识别数据密集型页面（列表页、表单页、详情页），读取 `content.md` 提取文本内容，从表格列名、表单标签、重复模式中识别数据结构，跨页面验证并合并字段。

**输出**：`assets/database/<table-name>.json`
- 文件名使用英文（如 `users.json`）
- tableName 使用中文（如 "用户表"）
- 字段名优先使用中文，与原型页面一致
- 每个表生成 10-30 条记录，确保 id 唯一

### 阶段 4：生成项目文档

生成站点地图文档（保持层级结构，页面名称可点击）和项目简介文档（基本信息、设计风格、数据模型概览）。

**输出**：`assets/docs/`

## 页面还原指南

选择还原页面（用户指定或从站点地图选择 1-2 个核心页面）。

**数据获取**（本地优先）：
1. 截图（`screenshot.png`）- 最高优先级
2. 主题（`theme.json`）
3. 内容（`content.md`）
4. 节点（`doms.toon`）：默认不使用，只有用户明确要求精确结构/定位时才读取并用 `@toon-format/toon` 解码

**还原策略**：截图识别布局 → 应用主题 tokens → 填充文案内容 → 仅在用户要求时补充节点细节

**默认目标**：在用户未提出额外要求时，尽量 1:1 还原截图/原型的视觉与布局（不主动“改版”）。

**基础设计走查与修复**：页面还原完成后，按设计与前端规范检查明显问题并修复（如对齐/间距不一致、字号层级混乱、对比度不足、可点击态缺失、响应式断点明显错位等）；若修复会改变原设计意图，先向用户确认。

**可选优化**：如需我同时做“优化设计/交互”（信息结构调整、视觉升级、交互补全、可用性优化等），请在需求里明确说明；否则仅做还原与基础走查修复。

**输出**：符合 `development-standards.md` 规范的页面组件

## TOON 格式处理

TOON 是紧凑的结构化表示（类似 YAML）。使用 `@toon-format/toon` 解码，或手动解析。仅在需要精确还原节点结构或完整样式时使用，优先使用 theme.json 和 screenshot.png。

## MCP 工具补充

sitemap.json 包含 projectUrl 时，可使用 Axhub MCP 工具获取在线资源（本地资源优先，仅在不足或需要最新数据时使用）。

## 用户交互指南

### 初始对话

```
您好！我可以帮您处理本地 Axure 原型资源。

[如果找到 temp 目录下的资源]
检测到最近导出的项目：<项目名称>
位置：apps/axhub-make/temp/<目录名>/
是否处理此项目？如果不是，请提供正确的目录路径。

[如果未找到]
请提供资源目录路径，我将为您：
1. 提取设计主题并生成设计规范文档
2. 识别数据模型
3. 生成项目文档
```

### 目录验证失败

```
⚠️ 未找到有效的 Axure 资源目录。
请确认目录包含 sitemap.json 和页面目录。
```

### 需求确认

```
✓ 已识别资源目录，共 [X] 个页面。

默认方案：
- 从核心页面提取设计主题并生成设计规范文档
- 识别数据模型
- 生成项目文档

回复"接受"按默认方案执行，或告诉我您的具体需求。
```

### 进度通知

```
正在处理...
✓ 已解析站点地图
✓ 已提取主题数据
⏳ 正在分析数据模型...
```

### 完成总结

```
✅ 已完成！

生成的资产：
- 设计主题：src/themes/<theme-key>/
- 设计规范文档：src/themes/<theme-key>/DESIGN-SPEC.md
- 数据模型：assets/database/
- 项目文档：assets/docs/

后续建议：
💡 我还可以为您：
- 还原页面：告诉我需要还原的页面名称
- 生成业务文档：领域模型、业务流程等

需要吗？
```

### 关键原则

- 主动查找 temp 目录下的最新资源
- 主动确认重要操作
- 及时反馈进度
- 清晰总结成果
- 提供选项而非强制
- 友好处理错误
- 引导后续操作

## 注意事项

- TOON 数据量大，仅在必要时解析
- 主题提取使用 3-5 个页面，数据模型需跨页面验证
- 页面还原以截图为主要依据
- 尊重原型版权，资产仅用于学习和开发

## 参考

`theme-generation-guide.md` | `development-standards.md`
