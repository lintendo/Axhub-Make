import{P as st,a as Ze,b as hs,c as fs,d as ms,e as xs,f as gs,S as ys,A as ws,D as Mt,o as bs}from"./chunks/PromptActionButton.js";import{I as Be,T as Me,r as o,s as W,j as e,M as Et,ab as Zt,J as mt,u as we,F as vt,S as Xe,a3 as js,ac as eo,ad as Bt,ae as $e,af as Vt,b as Y,ag as It,ah as jt,t as ot,ai as to,l as Ss,aj as so,o as nt,ak as Ts,a1 as no,al as oo,L as xt,Q as ks,am as Gt,d as As,an as ro,ao as Kt,ap as Jt,P as ao,aq as Xt,D as Ct,O as io,H as Rs,N as lo,ar as co,as as uo,Z as ue,at as Ds,au as Ps,h as Ee,i as po,k as ho,m as $t,B as Ft,w as Qt,x as fo,e as qt,y as mo,z as xo,A as go,E as yo,p as Yt,_ as wo,av as bo,aw as jo,ax as vs,ay as So,az as vo,aA as Co,aB as Eo,aC as Io,aD as $o,aE as To,aF as ko,aG as Ns,aa as Ls,aH as Ao,U as Us,aI as Cs,aJ as Ro,aK as Do,R as Po,C as No,a as Es,aL as Lo,a8 as Uo,a9 as zo,G as Oo,aM as _o,g as Mo,aN as Bo}from"./chunks/vendor.js";import{g as Fo}from"./chunks/index.js";import{i as Wo}from"./chunks/bridge.js";import"./chunks/execute.js";const Tt=[{value:"cursor",label:"Cursor"},{value:"trae",label:"TRAE"},{value:"vscode",label:"Visual Studio Code"},{value:"trae_cn",label:"TRAE CN"},{value:"windsurf",label:"Windsurf"},{value:"kiro",label:"Kiro"},{value:"qoder",label:"Qoder"},{value:"antigravity",label:"Antigravity"}];Tt.map(h=>h.value);const zs=["vscode","cursor"],{TextArea:Ho}=Be,{Text:tt}=Me,Vo=({open:h,onClose:v,imageConfig:d,setImageConfig:b,onDimensionChange:T,onSwapDimensions:k,onDimensionBlur:j,isExporting:L,onExport:_,onCopyConfig:se,activeTab:X,itemName:P,preferredPromptClient:ne,preferredIDE:q})=>{const Z=X==="elements"?"å…ƒç´ ":"é¡µé¢",[r,D]=o.useState(null),[c,M]=o.useState(!1),[U,G]=o.useState(!1),[Q,ae]=W.useMessage(),[R,z]=o.useState("export"),[ie,ee]=o.useState(""),[A,V]=o.useState(""),[oe,F]=o.useState(!1);o.useEffect(()=>{(async()=>{if(A&&R==="copyConfig"){F(!0);try{if(!await l()){V(""),ee(""),F(!1);return}const te=await se(A);ee(te)}catch{Q.error("åŠ è½½é…ç½®å¤±è´¥"),ee("")}finally{F(!1)}}})()},[A,R,se,Q]),o.useEffect(()=>{h||(z("export"),V(""),ee(""))},[h]);const l=async()=>{if(!P)return!0;G(!0);try{const C=`${X}/${P}`,J=await Ze.reviewCode(C);return J.passed?!0:(D(J),M(!0),!1)}catch(C){return console.error("ä»£ç æ£€æŸ¥å¤±è´¥:",C),!0}finally{G(!1)}},w=async()=>{await l()&&_()},g=async()=>{if(!ie){Q.warning("è¯·å…ˆé€‰æ‹©å¯¼å‡ºå†…å®¹");return}try{await navigator.clipboard.writeText(ie),Q.success("é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{Q.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å‰ªè´´æ¿æƒé™")}},y=C=>{C.target.select()},S=async()=>{if(!r)throw new Error("æ²¡æœ‰å¯ç”¨çš„æ£€æŸ¥ç»“æžœ");const C=r.issues.filter(re=>re.type==="error"),J=r.issues.filter(re=>re.type==="warning");let te=`ä»£ç æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·å¸®æˆ‘ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š

`;return te+=`æ–‡ä»¶ï¼š${r.file}

`,C.length>0&&(te+=`âŒ é”™è¯¯ (${C.length} ä¸ª):
`,C.forEach((re,je)=>{te+=`
${je+1}. [${re.rule}] ${re.message}
`,re.suggestion&&(te+=`   å»ºè®®: ${re.suggestion}
`)})),J.length>0&&(te+=`
âš ï¸ è­¦å‘Š (${J.length} ä¸ª):
`,J.forEach((re,je)=>{te+=`
${je+1}. [${re.rule}] ${re.message}
`,re.suggestion&&(te+=`   å»ºè®®: ${re.suggestion}
`)})),te};return e.jsxs(e.Fragment,{children:[ae,e.jsx(Et,{title:"å¯¼å‡ºåˆ° Axure",open:h,onCancel:v,footer:R==="export"?[e.jsx(Y,{type:"primary",loading:L||U,onClick:w,children:"å¯¼å‡º"},"export")]:[e.jsx(Y,{type:"primary",disabled:!ie,onClick:g,children:"å¤åˆ¶é…ç½®"},"copy")],width:800,children:e.jsx(Zt,{activeKey:R,onChange:z,items:[{key:"export",label:"å¯¼å‡ºå›¾ç‰‡",children:e.jsxs("div",{style:{display:"flex",gap:"20px",height:"400px"},children:[e.jsx("div",{style:{flex:1,border:"1px solid #f0f0f0",borderRadius:"8px",overflow:"hidden",background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:d.previewUrl?e.jsx("img",{src:d.previewUrl,alt:"Preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}):e.jsx(mt,{tip:"æ­£åœ¨ç”Ÿæˆé¢„è§ˆ..."})}),e.jsxs("div",{style:{width:"240px",display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å¯¼å‡ºå°ºå¯¸",e.jsx(we,{title:"è¿”å›ž Axure åŒå‡»å…ƒç´ å°±å¯ä»¥æ›¿æ¢å›¾ç‰‡ï¼ŒåŒå‡»å›¾ç‰‡å·¦ä¸Šè§’æˆ–è€…åœ¨æ ·å¼é¢æ¿é‡Œç‚¹å‡»è‡ªé€‚åº”å›¾ç‰‡å³å¯æ›´æ–°å›¾ç‰‡å°ºå¯¸",children:e.jsx(vt,{style:{color:"#999",cursor:"help"}})})]}),e.jsxs(Xe,{children:[e.jsx(js,{value:d.width,onChange:C=>T("width",C),onBlur:j,placeholder:"å®½",style:{width:100},min:1}),e.jsx(eo,{onClick:k,style:{color:"#999",cursor:"pointer",fontSize:14}}),e.jsx(js,{value:d.height,onChange:C=>T("height",C),onBlur:j,placeholder:"é«˜",style:{width:100},min:1})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å›¾ç‰‡å†…å®¹",e.jsx(we,{title:"æ ‡é¢˜å°é¢ä¾¿äºŽåœ¨ Axure å†…æ›´æ”¹å°ºå¯¸",children:e.jsx(vt,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(Bt.Group,{value:d.contentType,onChange:C=>b(J=>({...J,contentType:C.target.value})),children:e.jsxs(Xe,{direction:"vertical",children:[e.jsxs(Bt,{value:"title",children:[Z,"æ ‡é¢˜"]}),e.jsxs(Bt,{value:"screenshot",children:[Z,"æˆªå›¾"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["åŒ…å«é…ç½®",e.jsx(we,{title:"è‹¥åŒ…å«é…ç½®ï¼Œä»…éœ€å¯¼å…¥å›¾ç‰‡åˆ° Axureï¼Œä¸€èˆ¬ä¸éœ€è¦å†å¤åˆ¶é…ç½®æˆ–è€…ä»£ç ",children:e.jsx(vt,{style:{color:"#999",cursor:"help"}})})]}),e.jsx($e,{value:d.includeConfig,onChange:C=>b(J=>({...J,includeConfig:C})),style:{width:"100%"},options:[{label:"æ— ",value:"none"},{label:"åŽŸåž‹",value:"code"},{label:"åŽŸåž‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŽŸåž‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]})]})]})},{key:"copyConfig",label:"å¤åˆ¶é…ç½®",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"400px"},children:[e.jsx(Vt,{message:"å¯¼å‡ºæœ¬åœ° html æˆ–è€…å‘å¸ƒåˆ° Axure Cloud æ—¶è‹¥å›¾ç‰‡å¤±æ•ˆå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½",type:"info",showIcon:!0}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"å¯¼å‡ºå†…å®¹"}),e.jsx($e,{value:A||void 0,onChange:V,placeholder:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",style:{width:"100%"},options:[{label:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",value:"",disabled:!0},{label:"åŽŸåž‹",value:"code"},{label:"åŽŸåž‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŽŸåž‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]}),A&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"é…ç½®å†…å®¹"}),oe?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #d9d9d9",borderRadius:"6px"},children:e.jsx(mt,{tip:"æ­£åœ¨åŠ è½½é…ç½®..."})}):e.jsx(Ho,{value:ie,readOnly:!0,onFocus:y,style:{flex:1,fontFamily:"monospace",fontSize:"12px"},placeholder:"é…ç½®å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"})]})]})}]})}),e.jsx(Et,{title:"ä»£ç æ£€æŸ¥æœªé€šè¿‡",open:c,onCancel:()=>M(!1),width:600,footer:[e.jsx(Y,{onClick:()=>M(!1),children:"å–æ¶ˆ"},"cancel"),e.jsx(st,{type:"primary",preferredClient:ne,preferredIDE:q,scene:`review-fix-${X}`,buildPrompt:S,getIdeTargetPath:()=>P?`src/${X}/${P}/index.tsx`:null,copySuccessMessage:"å¤åˆ¶æˆåŠŸ",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt",onAfterCopy:()=>M(!1)},"copy")],children:r&&e.jsxs("div",{style:{maxHeight:"500px",overflowY:"auto"},children:[e.jsx(Vt,{description:"ä»£ç ä¸ç¬¦åˆå¼€å‘è§„èŒƒï¼Œéœ€è¦ä¿®å¤åŽæ‰èƒ½å¯¼å‡º",type:"error",showIcon:!0,style:{marginBottom:"24px"}}),r.issues.filter(C=>C.type==="error").length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(It,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(tt,{type:"danger",children:"é”™è¯¯ (å¿…é¡»ä¿®å¤)"})}),e.jsx(jt,{size:"small",dataSource:r.issues.filter(C=>C.type==="error"),renderItem:C=>e.jsx(jt.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(tt,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(tt,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]}),r.issues.filter(C=>C.type==="warning").length>0&&e.jsxs("div",{children:[e.jsx(It,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(tt,{type:"warning",children:"è­¦å‘Š (å»ºè®®ä¿®å¤)"})}),e.jsx(jt,{size:"small",dataSource:r.issues.filter(C=>C.type==="warning"),renderItem:C=>e.jsx(jt.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(tt,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(tt,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]})]})})]})},{Text:Wt}=Me,{useToken:Go}=ot;function Ko({visible:h,onCancel:v,item:d,activeTab:b,preferredPromptClient:T,preferredIDE:k}){const{token:j}=Go(),[L,_]=o.useState([]),[se,X]=o.useState(!1),[P,ne]=o.useState(""),[q,Z]=o.useState(""),[r,D]=o.useState(!1),[c,M]=o.useState(!1),[U,G]=o.useState(null),[Q,ae]=o.useState(null),R=w=>{const g=w;let y="";if(g.filePath){const S=g.filePath.indexOf("src/");y=S>=0?g.filePath.substring(S):g.filePath}else y=`${b==="pages"?"src/pages":"src/elements"}/${w.name}`;return y=y.replace(/\/index\.(t|j)sx?$/i,""),y=y.replace(/^\/+/,""),y.startsWith("src/")&&(y=y.substring(4)),y},z=w=>{const g=new Date(w),y=S=>String(S).padStart(2,"0");return`${g.getFullYear()}/${y(g.getMonth()+1)}/${y(g.getDate())} ${y(g.getHours())}:${y(g.getMinutes())}:${y(g.getSeconds())}`},ie=w=>{const g=Math.floor((Date.now()-w)/1e3);let y=g/31536e3;return y>1?Math.floor(y)+" å¹´å‰":(y=g/2592e3,y>1?Math.floor(y)+" ä¸ªæœˆå‰":(y=g/86400,y>1?Math.floor(y)+" å¤©å‰":(y=g/3600,y>1?Math.floor(y)+" å°æ—¶å‰":(y=g/60,y>1?Math.floor(y)+" åˆ†é’Ÿå‰":"åˆšåˆš"))))},ee=async()=>{if(d){M(!0);try{const w=R(d);if(!w){W.error("æ— æ³•èŽ·å–æ–‡ä»¶è·¯å¾„"),M(!1);return}const g=await fetch(`/api/git/history?path=${encodeURIComponent(w)}`),y=await g.json();g.ok?(_(y.commits),X(y.hasUncommitted),ne(y.uncommittedFiles)):W.error(y.error||"åŠ è½½ç‰ˆæœ¬åŽ†å²å¤±è´¥")}catch{W.error("åŠ è½½ç‰ˆæœ¬åŽ†å²å¤±è´¥")}finally{M(!1)}}};o.useEffect(()=>{h&&d&&ee()},[h,d]);const A=async w=>{if(d)try{const g=R(d),y=await fetch("/api/git/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:g,commitHash:w})}),S=await y.json();y.ok?(W.success("ç‰ˆæœ¬æ¢å¤æˆåŠŸ"),ee()):W.error(S.error||"ç‰ˆæœ¬æ¢å¤å¤±è´¥")}catch{W.error("ç‰ˆæœ¬æ¢å¤å¤±è´¥")}},V=async()=>{if(!d||!q.trim()){W.warning("è¯·è¾“å…¥æäº¤ä¿¡æ¯");return}D(!0);try{const w=R(d),g=await fetch("/api/git/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:w,message:q})}),y=await g.json();g.ok?(W.success("æäº¤æˆåŠŸ"),Z(""),ee()):W.error(y.error||"æäº¤å¤±è´¥")}catch{W.error("æäº¤å¤±è´¥")}finally{D(!1)}},oe=async()=>{if(!d)throw new Error("è¯·é€‰æ‹©æ¡ç›®åŽå†æ‰§è¡Œ");const w=R(d);return`æˆ‘éœ€è¦æäº¤ä»¥ä¸‹ç›®å½•çš„æ›´æ”¹ï¼Œè¯·å¸®æˆ‘å¤„ç†ï¼š

ç›®æ ‡è·¯å¾„: src/${w}

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. ä½¿ç”¨ git status å’Œ git diff æŸ¥çœ‹è¯¥è·¯å¾„ä¸‹çš„å˜æ›´å†…å®¹ã€‚
2. åˆ†æžå˜æ›´ï¼Œç”Ÿæˆä¸€ä¸ªç®€æ´æ˜Žäº†çš„ä¸­æ–‡æäº¤ä¿¡æ¯ï¼ˆCommit Messageï¼‰ã€‚
3. å‘æˆ‘å±•ç¤ºå˜æ›´æ‘˜è¦å’Œå»ºè®®çš„æäº¤ä¿¡æ¯ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­ã€‚
4. èŽ·å¾—ç¡®è®¤åŽï¼Œæ‰§è¡Œï¼š
   git add src/${w}
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"

è¯·ç›´æŽ¥å¼€å§‹æ‰§è¡Œç¬¬ 1 æ­¥ã€‚`},F=async w=>{if(d){G(w);try{const g=R(d),y=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:g,commitHash:w})}),S=await y.json();y.ok&&S.hasSpec&&S.specUrl?window.open(S.specUrl,"_blank"):S.hasSpec?W.error(S.error||"æ— æ³•è®¿é—®è§„æ ¼æ–‡æ¡£"):W.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰è§„æ ¼æ–‡æ¡£")}catch{W.error("åŠ è½½è§„æ ¼æ–‡æ¡£å¤±è´¥")}finally{G(null)}}},l=async w=>{if(d){ae(w);try{const g=R(d),y=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:g,commitHash:w})}),S=await y.json();y.ok&&S.hasPrototype&&S.prototypeUrl?window.open(S.prototypeUrl,"_blank"):S.hasPrototype?W.error(S.error||"æ— æ³•è®¿é—®åŽŸåž‹"):W.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰åŽŸåž‹æ–‡ä»¶")}catch{W.error("åŠ è½½åŽŸåž‹å¤±è´¥")}finally{ae(null)}}};return e.jsx(Et,{title:`ç‰ˆæœ¬ç®¡ç† - ${d==null?void 0:d.displayName}`,open:h,onCancel:v,footer:null,width:700,centered:!0,className:"version-dialog",styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingTop:12,paddingBottom:12}},destroyOnClose:!0,children:e.jsx(mt,{spinning:c,children:L.length===0&&!se?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"æš‚æ— ç‰ˆæœ¬åŽ†å²"}):e.jsx(to,{mode:"left",items:[...se?[{children:e.jsx("div",{className:"commit-item uncommitted",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Wt,{strong:!0,style:{fontSize:14,marginRight:8},children:"æœªæäº¤çš„æ›´æ”¹"}),e.jsx(Ss,{color:"warning",children:"æœªä¿å­˜"})]})}),e.jsxs("div",{style:{background:j.colorFillAlter,padding:12,borderRadius:8,border:`1px solid ${j.colorBorderSecondary}`},children:[e.jsx(Be,{placeholder:"æ‰‹åŠ¨è¾“å…¥æäº¤ä¿¡æ¯...",value:q,onChange:w=>Z(w.target.value),onPressEnter:V,style:{marginBottom:12}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,color:j.colorTextSecondary},children:P?`${P.split(`
`).filter(Boolean).length} ä¸ªæ–‡ä»¶å˜æ›´`:"æœ‰æ–‡ä»¶å˜æ›´"}),e.jsxs(Xe,{children:[e.jsx(st,{type:"default",preferredClient:T,preferredIDE:k,scene:`version-commit-${b}`,buildPrompt:oe,getIdeTargetPath:()=>d?`src/${R(d)}`:null,copySuccessMessage:"AI æŒ‡ä»¤å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´ç»™åŠ©æ‰‹",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"}),e.jsx(Y,{type:"primary",size:"small",onClick:V,loading:r,disabled:!q.trim(),children:"æäº¤"})]})]})]})]})}),color:"orange",dot:e.jsx("div",{style:{width:10,height:10,background:j.colorWarning,borderRadius:"50%",border:`2px solid ${j.colorBgContainer}`}})}]:[],...L.map((w,g)=>{const y=g===0&&!se;return{children:e.jsx("div",{className:"commit-item",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{marginBottom:4,display:"flex",alignItems:"center"},children:[e.jsx(Wt,{strong:!0,style:{fontSize:14,marginRight:8},children:w.message}),y&&e.jsx(Ss,{color:"success",children:"å½“å‰ç‰ˆæœ¬"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:j.colorTextSecondary},children:[e.jsxs(Xe,{size:4,children:[e.jsx(so,{size:20,style:{backgroundColor:j.colorPrimary,fontSize:12},children:w.author?w.author[0].toUpperCase():"U"}),e.jsx("span",{children:w.author})]}),e.jsx("span",{style:{color:j.colorBorder},children:"|"}),e.jsx(we,{title:z(w.timestamp),children:e.jsx("span",{style:{cursor:"help"},children:ie(w.timestamp)})}),e.jsx("span",{style:{color:j.colorBorder},children:"|"}),e.jsx(Wt,{code:!0,style:{fontSize:12,margin:0},children:w.hash.substring(0,7)})]})]}),!y&&e.jsxs(Xe,{size:0,children:[e.jsx(we,{title:"æŸ¥çœ‹è§„æ ¼æ–‡æ¡£",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(nt,{}),style:{color:j.colorTextSecondary},onClick:()=>F(w.hash),loading:U===w.hash})}),e.jsx(we,{title:"æŸ¥çœ‹åŽŸåž‹",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Ts,{}),style:{color:j.colorTextSecondary},onClick:()=>l(w.hash),loading:Q===w.hash})}),e.jsx(no,{title:"ç¡®è®¤æ¢å¤",description:"ç¡®å®šè¦æ¢å¤åˆ°æ­¤ç‰ˆæœ¬å—ï¼Ÿå½“å‰æœªæäº¤çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚",onConfirm:()=>A(w.hash),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(we,{title:"æ¢å¤æ­¤ç‰ˆæœ¬",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(oo,{}),style:{color:j.colorTextSecondary}})})})]}),y&&e.jsx(Xe,{size:0})]})}),color:y?"green":"gray",dot:y?e.jsx("div",{style:{width:10,height:10,background:j.colorSuccess,borderRadius:"50%",border:`2px solid ${j.colorBgContainer}`}}):void 0}})]})})})}const{Sider:Jo}=xt,{useToken:Xo}=ot;function qo({collapsed:h,loading:v,activeTab:d,handleTabChange:b,data:T,searchText:k,setSearchText:j,filteredItems:L,selectedItem:_,handleMenuClick:se,handleDownloadItemSource:X,handleRenameItem:P,handleSetReference:ne,handleUnsetReference:q,handleDuplicateItem:Z,handleDeleteItem:r,handleCopyItemPath:D,setCreateDialogVisible:c,preferredPromptClient:M,preferredIDE:U}){const{token:G}=Xo(),[Q,ae]=o.useState(!1),[R,z]=o.useState(null),ie=A=>{z(A),ae(!0)},ee=o.useMemo(()=>L.map(A=>{const V=_&&_.name===A.name,oe=[{key:"rename",label:"é‡å‘½å",icon:e.jsx(ks,{})},{key:"duplicate",label:"åˆ›å»ºå‰¯æœ¬",icon:e.jsx(Gt,{})},{key:"copy-path",label:"å¤åˆ¶è·¯å¾„",icon:e.jsx(As,{})},{type:"divider"},{key:"version-management",label:"ç‰ˆæœ¬ç®¡ç†",icon:e.jsx(ro,{})},{key:"download-source",label:"å¯¼å‡º ZIP",icon:e.jsx(Kt,{})},{type:"divider"},...A.isReference?[{key:"unset-reference",label:"å–æ¶ˆå‚è€ƒ",icon:e.jsx(Jt,{})}]:[{key:"set-reference",label:"è®¾ç½®ä¸ºå‚è€ƒ",icon:e.jsx(Jt,{})}],{key:"delete",label:`åˆ é™¤${d==="elements"?"å…ƒç´ ":"é¡µé¢"}`,icon:e.jsx(ao,{}),danger:!0,disabled:A.isReference}];return{key:A.name,label:e.jsxs("div",{className:`menu-item-wrapper ${V?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:A.displayName})}),e.jsx(Ct,{trigger:["click"],menu:{items:oe,onClick:({key:F})=>{F==="download-source"?X(A):F==="rename"?P(A):F==="duplicate"?Z(A):F==="copy-path"?D(A):F==="version-management"?ie(A):F==="set-reference"?ne(A):F==="unset-reference"?q(A):F==="delete"&&r(A)}},children:e.jsx(Y,{type:"text",size:"small",className:"more-btn",icon:e.jsx(io,{}),onClick:F=>{F.stopPropagation()}})})]}),icon:d==="elements"?e.jsx(Xt,{}):e.jsx(nt,{})}}),[L,d,_,X,P,ne,q,r,D,Z]);return e.jsxs(Jo,{trigger:null,collapsible:!0,collapsed:h,width:240,collapsedWidth:0,style:{background:G.colorBgContainer,borderRight:`1px solid ${G.colorBorder}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:[e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!h&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{activeKey:d,size:"small",centered:!0,onChange:A=>b(A),items:[{key:"pages",label:`é¡µé¢ (${T.pages.length})`,icon:e.jsx(nt,{})},{key:"elements",label:`å…ƒç´  (${T.elements.length})`,icon:e.jsx(Xt,{})}]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Rs,{}),value:k,onChange:A=>j(A.target.value),allowClear:!0,style:{flex:1}})})]})}),v?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(mt,{tip:"åŠ è½½ä¸­..."})}):e.jsxs(e.Fragment,{children:[e.jsx(lo,{mode:"inline",selectedKeys:_?[_.name]:[],items:ee,onClick:se,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!h&&e.jsx(co,{icon:e.jsx(uo,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:()=>c(!0),tooltip:d==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢"})]}),e.jsx(Ko,{visible:Q,onCancel:()=>ae(!1),item:R,activeTab:d,preferredPromptClient:M,preferredIDE:U})]})}const{Title:Ht}=Me;function Yo({open:h,onClose:v,onSaved:d}){const[b]=ue.useForm(),[T,k]=o.useState(!1),[j,L]=o.useState([]),[_,se]=o.useState([]),[X,P]=o.useState(!1);o.useEffect(()=>{h&&(ne(),q())},[h]);const ne=async()=>{var r,D,c,M,U,G,Q,ae;try{const R=await fetch("/api/config");if(!R.ok)throw new Error("Failed to load config");const z=await R.json();b.setFieldsValue({host:z.server.host||"localhost",allowLAN:z.server.allowLAN!==!1,enableCommandAPI:z.server.enableCommandAPI||!1,projectName:((r=z.projectInfo)==null?void 0:r.name)||void 0,projectDescription:((D=z.projectInfo)==null?void 0:D.description)||void 0,defaultDoc:((c=z.projectDefaults)==null?void 0:c.defaultDoc)||void 0,defaultTheme:((M=z.projectDefaults)==null?void 0:M.defaultTheme)||void 0,defaultPromptClient:((U=z.automation)==null?void 0:U.defaultPromptClient)??"",defaultIDE:((G=z.automation)==null?void 0:G.defaultIDE)??"",assistantWebBaseUrl:((Q=z.assistant)==null?void 0:Q.webBaseUrl)??"",assistantApiBaseUrl:((ae=z.assistant)==null?void 0:ae.apiBaseUrl)??""})}catch(R){console.error("Error loading config:",R),W.error("åŠ è½½é…ç½®å¤±è´¥")}},q=async()=>{P(!0);try{const[r,D]=await Promise.all([fetch("/api/docs"),fetch("/api/themes")]);if(r.ok){const c=await r.json();L(Array.isArray(c)?c:[])}if(D.ok){const c=await D.json();se(Array.isArray(c)?c:[])}}catch(r){console.error("Error loading assets:",r)}finally{P(!1)}},Z=async()=>{try{const r=await b.validateFields();k(!0);const D=await fetch("/api/config"),c=D.ok?await D.json():{server:{host:"localhost",port:51720,allowLAN:!0}},M={server:{host:r.host,port:c.server.port||51720,allowLAN:r.allowLAN,enableCommandAPI:r.enableCommandAPI||!1},projectInfo:{name:r.projectName??null,description:r.projectDescription??null},projectDefaults:{defaultDoc:r.defaultDoc??null,defaultTheme:r.defaultTheme??null},automation:{defaultPromptClient:r.defaultPromptClient?r.defaultPromptClient:null,defaultIDE:r.defaultIDE?r.defaultIDE:null},assistant:{webBaseUrl:r.assistantWebBaseUrl?r.assistantWebBaseUrl:null,apiBaseUrl:r.assistantApiBaseUrl?r.assistantApiBaseUrl:null}},U=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!U.ok){const Q=await U.json();throw new Error(Q.error||"Failed to save config")}const G=await U.json();W.success(G.message||"é…ç½®å·²ä¿å­˜"),d==null||d(),v()}catch(r){console.error("Error saving config:",r),W.error(r.message||"ä¿å­˜é…ç½®å¤±è´¥")}finally{k(!1)}};return e.jsx(Ds,{title:"é¡¹ç›®è®¾ç½®",open:h,onClose:v,width:600,extra:e.jsxs(Xe,{children:[e.jsx(Y,{onClick:v,children:"å–æ¶ˆ"}),e.jsx(Y,{type:"primary",onClick:Z,loading:T,children:"ä¿å­˜"})]}),children:e.jsxs(ue,{form:b,layout:"vertical",initialValues:{host:"localhost",allowLAN:!0,enableCommandAPI:!1,projectName:void 0,projectDescription:void 0,defaultDoc:void 0,defaultTheme:void 0,defaultPromptClient:"",defaultIDE:"",assistantWebBaseUrl:"",assistantApiBaseUrl:""},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Ht,{level:5,style:{marginBottom:16},children:"é¡¹ç›®ç”Ÿæˆé…ç½®"}),e.jsx(Vt,{type:"info",showIcon:!0,message:"é¡¹ç›®ä¿¡æ¯å°†ä½œä¸º AI ç”Ÿæˆä¸Žå¯¹é½çš„å…³é”®å‚è€ƒï¼Œéœ€è¦é‡å¯ç¼–è¾‘å™¨æ‰ç”Ÿæ•ˆã€‚",style:{marginBottom:16}}),e.jsx(ue.Item,{label:"é¡¹ç›®åç§°",name:"projectName",tooltip:"ç”¨äºŽ AI ç†è§£é¡¹ç›®å®šä½ä¸Žäº§å‡ºé£Žæ ¼",children:e.jsx(Be,{placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°",maxLength:20})}),e.jsx(ue.Item,{label:"é¡¹ç›®ç®€ä»‹",name:"projectDescription",tooltip:"ç®€è¦æè¿°é¡¹ç›®èƒŒæ™¯ã€ç›®æ ‡ç”¨æˆ·ä¸Žæ ¸å¿ƒåœºæ™¯",children:e.jsx(Be.TextArea,{placeholder:"ä¾‹å¦‚ï¼šé¢å‘è¿è¥äººå‘˜çš„æ´»åŠ¨é…ç½®åŽå°ï¼Œå¼ºè°ƒé«˜æ•ˆé…ç½®ä¸Žç¨³å®šäº¤ä»˜",rows:2,maxLength:60,showCount:!0})}),e.jsx(ue.Item,{label:"é¡¹ç›®æ€»æ–‡æ¡£",name:"defaultDoc",tooltip:"ä»Žâ€œèµ„äº§ç®¡ç†-æ–‡æ¡£â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤å‚è€ƒæ–‡æ¡£",children:e.jsx($e,{allowClear:!0,loading:X,placeholder:"è¯·é€‰æ‹©é¡¹ç›®æ€»æ–‡æ¡£",options:j.map(r=>({value:r.name,label:r.displayName||r.name})),showSearch:!0,filterOption:(r,D)=>String((D==null?void 0:D.label)||"").toLowerCase().includes(r.toLowerCase())})}),e.jsx(ue.Item,{label:"é»˜è®¤ä¸»é¢˜",name:"defaultTheme",tooltip:"ä»Žâ€œèµ„äº§ç®¡ç†-ä¸»é¢˜â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤ä¸»é¢˜",children:e.jsx($e,{allowClear:!0,loading:X,placeholder:"è¯·é€‰æ‹©é»˜è®¤ä¸»é¢˜",options:_.map(r=>({value:r.name,label:r.displayName||r.name})),showSearch:!0,filterOption:(r,D)=>String((D==null?void 0:D.label)||"").toLowerCase().includes(r.toLowerCase())})})]}),e.jsx(It,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Ht,{level:5,style:{marginBottom:16},children:"è‡ªåŠ¨æ‰§è¡Œ"}),e.jsx(ue.Item,{label:"ä¼˜å…ˆä½¿ç”¨ Axhub Genie",name:"defaultPromptClient",tooltip:"å¯ä»¥åœ¨ç½‘é¡µä¸Šè§£å†³ä¸€äº›ç®€å•çš„é—®é¢˜",children:e.jsx($e,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"å¦"},{value:"claude",label:"ClaudeCode"},{value:"cursor",label:"Cursor"},{value:"codex",label:"Codex"}]})}),e.jsx(ue.Item,{label:"ä¸»è¦ IDE",name:"defaultIDE",tooltip:"é…ç½®åŽï¼Œç›¸å…³æ“ä½œä¼šå…ˆè‡ªåŠ¨æ‰“å¼€å¯¹åº” IDEã€‚",children:e.jsx($e,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"æ— "},...Tt]})})]}),e.jsx(It,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Ht,{level:5,style:{marginBottom:16},children:"æœåŠ¡å™¨é…ç½®"}),e.jsx(ue.Item,{label:"ä¸»æœºåœ°å€",name:"host",rules:[{required:!0,message:"è¯·è¾“å…¥ä¸»æœºåœ°å€"}],tooltip:"æœåŠ¡å™¨å¯åŠ¨çš„åŸŸåæˆ– IP åœ°å€",children:e.jsx(Be,{placeholder:"localhost"})}),e.jsx(ue.Item,{label:"å…è®¸å±€åŸŸç½‘è®¿é—®",name:"allowLAN",valuePropName:"checked",tooltip:"å¼€å¯åŽï¼Œå±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡å¯ä»¥è®¿é—®æ­¤æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šå¯èƒ½å­˜åœ¨å®‰å…¨é£Žé™©ï¼Œè¯·ç¡®ä¿åœ¨å¯ä¿¡ç½‘ç»œçŽ¯å¢ƒä¸­ä½¿ç”¨",children:e.jsx(Ps,{})})]})]})})}const{Header:Zo}=xt,{useToken:Qo}=ot,er=h=>e.jsx("span",{role:"img","aria-label":"figma",className:"anticon anticon-figma",...h,children:e.jsxs("svg",{fill:"currentColor",fillRule:"evenodd",height:"1em",width:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[e.jsx("title",{children:"Figma"}),e.jsx("path",{clipRule:"evenodd",d:"M6.082 8.241C4.83 7.441 4 6.057 4 4.483 4 2.007 6.05 0 8.578 0h7.844C18.95 0 21 2.007 21 4.483c0 1.574-.829 2.959-2.082 3.758C20.17 9.041 21 10.426 21 12c0 2.476-2.05 4.483-4.578 4.483h-.084A4.615 4.615 0 0113.24 15.3v4.176C13.24 21.98 11.145 24 8.599 24 6.076 24 4 21.998 4 19.517c0-1.574.829-2.959 2.082-3.758C4.829 14.959 4 13.574 4 12c0-1.574.829-2.959 2.082-3.759zM13.24 12c0 1.676 1.387 3.034 3.098 3.034h.084c1.711 0 3.099-1.358 3.099-3.034 0-1.676-1.388-3.034-3.1-3.034h-.083c-1.71 0-3.098 1.358-3.098 3.034zm-1.48-3.034H8.578C6.867 8.966 5.48 10.324 5.48 12c0 1.672 1.382 3.029 3.089 3.034H11.76V8.966zm-3.182 7.517h-.01c-1.707.005-3.089 1.362-3.089 3.034 0 1.67 1.403 3.034 3.12 3.034 1.74 0 3.161-1.381 3.161-3.075v-2.993H8.578zm3.182-8.966H8.578c-1.711 0-3.099-1.358-3.099-3.034 0-1.676 1.388-3.034 3.1-3.034h3.181v6.068zm4.662 0H13.24V1.45h3.182c1.711 0 3.099 1.358 3.099 3.034 0 1.676-1.388 3.034-3.1 3.034z"})]})});function tr({collapsed:h,setCollapsed:v,selectedItem:d,viewMode:b,setViewMode:T,activeTab:k,selectedDeviceId:j,setSelectedDeviceId:L,deviceSegmentOptions:_,handleOpenInspect:se,handleOpenWebEditor:X,handleExitWebEditor:P,handleSaveWebEditor:ne,handleEnableTextEdit:q,handleSaveTextEdit:Z,handleExitTextEdit:r,handleRefreshElement:D,handleCopyLocalLink:c,handleCopyLANLink:M,handleDownloadZip:U,getLANUrl:G,qrCodeVisible:Q,setQrCodeVisible:ae,wsClients:R,checkConnection:z,handlePushToFigma:ie,handleDownloadFigmaJson:ee,setIsExportModalOpen:A,handleOpenIdeFile:V,handleOpenProjectInIDE:oe,preferredIDE:F,onPreferredIDEChange:l,isDarkMode:w,setIsDarkMode:g,currentSpecDocKey:y="spec",textEditState:S,textEditAvailable:C,editorMode:J="none",handleRefreshEditorStatus:te,onSettingsSaved:re,assistantEnabled:je=!1,assistantVisible:Se=!1,onToggleAssistant:Te}){const[Fe,Qe]=Ee.useState(null),[ke,ce]=Ee.useState(!1),[Ae,be]=Ee.useState(!0),[De,he]=Ee.useState(!1),{token:de}=Qo(),K=J==="webEditorV2";Ee.useEffect(()=>{let f=!1;return fetch("/api/version").then($=>$.ok?$.json():Promise.reject(new Error("Request failed"))).then($=>{if(f)return;const B=typeof($==null?void 0:$.version)=="string"?$.version:null;Qe(B)}).catch(()=>{f||Qe(null)}),()=>{f=!0}},[]),Ee.useEffect(()=>{let f=!1;return fetch("/api/config").then($=>$.ok?$.json():Promise.reject(new Error("Request failed"))).then($=>{var B;f||be(((B=$==null?void 0:$.server)==null?void 0:B.allowLAN)!==!1)}).catch(()=>{f||be(!0)}),()=>{f=!0}},[]),R.some(f=>zs.includes(f.type));const Ue=F||Tt[0].value,xe=f=>f==="cursor"?e.jsx(vo,{size:16,color:de.colorText}):f==="trae"||f==="trae_cn"?e.jsx(Co,{size:16,color:de.colorText}):f==="windsurf"?e.jsx(Eo,{size:16,color:de.colorText}):f==="vscode"?e.jsx(Io,{size:16,color:de.colorText}):f==="antigravity"?e.jsx($o,{size:16,color:de.colorText}):f==="kiro"?e.jsx(To,{size:16,color:de.colorText}):f==="qoder"?e.jsx(ko,{size:16,color:de.colorText}):e.jsx(Ns,{}),qe=async f=>{var le,ve,pe;const $=await fetch("/api/config");if(!$.ok)throw new Error("åŠ è½½é…ç½®å¤±è´¥ï¼Œæ— æ³•ä¿å­˜ä¸»åŠ› IDE");const B=await $.json(),ge={...B,server:{host:((le=B==null?void 0:B.server)==null?void 0:le.host)||"localhost",allowLAN:((ve=B==null?void 0:B.server)==null?void 0:ve.allowLAN)!==!1,enableCommandAPI:((pe=B==null?void 0:B.server)==null?void 0:pe.enableCommandAPI)||!1},automation:{...(B==null?void 0:B.automation)||{},defaultIDE:f}},O=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ge)});if(!O.ok){const at=await O.json().catch(()=>({}));throw new Error((at==null?void 0:at.error)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥")}l==null||l(f)},We=async f=>{if(!De){he(!0);try{await qe(f)}catch($){W.warning(($==null?void 0:$.message)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥ï¼Œæœ¬æ¬¡ç»§ç»­æ‰“å¼€")}try{await Promise.resolve(oe(f))}finally{he(!1)}}},rt=[{type:"group",label:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:Tt.map(f=>({key:f.value,label:f.label,icon:xe(f.value)}))}],p=f=>e.jsx(we,{title:f,children:e.jsx(Ct.Button,{size:"small",type:"default",loading:De,menu:{items:rt,onClick:({key:$})=>{We($)}},onClick:()=>{We(Ue)},children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6},children:[xe(Ue),"æ‰“å¼€é¡¹ç›®"]})})});return e.jsxs(Zo,{hasSider:!0,style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:de.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${de.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[e.jsx(Y,{type:"text",icon:h?e.jsx(po,{}):e.jsx(ho,{}),onClick:()=>v(!h),style:{fontSize:"16px",height:40}}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:de.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx($t,{value:b,size:"small",style:{fontSize:"12px"},onChange:f=>T(f),options:[{label:"åŽŸåž‹",value:"demo",icon:e.jsx(Ts,{})},{label:"æ–‡æ¡£",value:"spec",icon:e.jsx(Jt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[p("æ‰“å¼€é¡¹ç›®"),je&&e.jsx(we,{title:Se?"å…³é—­ Axhub Genie":"æ‰“å¼€ Axhub Genie",children:e.jsx(Ft,{dot:!0,status:Se?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:Se?"inline-flex":"none"}},children:e.jsx(Y,{size:"small",type:"text",icon:e.jsx(Qt,{}),onClick:Te})})}),e.jsx(Ct,{menu:{items:[{key:"assets",label:"èµ„äº§ç®¡ç†",icon:e.jsx(nt,{}),onClick:()=>window.open(new URL("/assets.html",window.location.origin).toString(),"_blank")},{key:"settings",label:"é¡¹ç›®è®¾ç½®",icon:e.jsx(qt,{}),onClick:()=>ce(!0)},{key:"theme",label:w?"æµ…è‰²æ¨¡å¼":"æ·±è‰²æ¨¡å¼",icon:w?e.jsx(mo,{}):e.jsx(xo,{}),onClick:()=>g(!w)},{type:"divider"},{key:"help",label:"å¸®åŠ©ä¸­å¿ƒ",icon:e.jsx(go,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"åŸ¹è®­æœåŠ¡",icon:e.jsx(yo,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub å®˜ç½‘",icon:e.jsx(qt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"å½“å‰ç‰ˆæœ¬",icon:e.jsx(vt,{}),extra:e.jsx("span",{style:{fontSize:12,color:de.colorTextSecondary},children:Fe?`v${Fe}`:"-"})}]},placement:"bottomRight",children:e.jsx(Y,{size:"small",type:"text",icon:e.jsx(fo,{})})})]}),(d||b==="spec")&&e.jsx("div",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center"},children:e.jsx(Xe,{size:"small",children:b==="spec"?e.jsx(e.Fragment,{children:e.jsx(we,{title:`åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ${y==="prd"?"PRD":"SPEC"} æ–‡æ¡£`,children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Yt,{}),onClick:V})})}):d&&e.jsxs(e.Fragment,{children:[k==="pages"&&!K&&e.jsx($t,{value:j,size:"small",shape:"round",onChange:f=>L(f),options:_}),e.jsx(we,{title:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Yt,{}),onClick:V})}),e.jsx(we,{title:K?"é€€å‡ºå¿«é€Ÿç¼–è¾‘":"å¿«é€Ÿç¼–è¾‘",children:e.jsx(Ft,{dot:!0,status:K?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:K?"inline-flex":"none"}},children:e.jsx(Y,{type:"text",size:"small",disabled:!d,onClick:()=>K?P():X(),icon:e.jsx(ks,{})})})}),e.jsx(we,{title:"åˆ·æ–°",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(wo,{}),onClick:D})}),e.jsx(bo,{content:e.jsxs("div",{style:{width:160},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx(Y,{type:"text",icon:e.jsx(Gt,{}),onClick:c,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶æœ¬åœ°é“¾æŽ¥"}),Ae&&e.jsx(Y,{type:"text",icon:e.jsx(Gt,{}),onClick:M,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶å±€åŸŸç½‘é“¾æŽ¥"}),e.jsx(Y,{type:"text",icon:e.jsx(vs,{}),disabled:!0,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å‘å¸ƒåŽŸåž‹"})]}),Ae&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:1,background:de.colorBorder,margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 0px 4px"},children:[e.jsx(So,{value:G(),size:128,bordered:!1,style:{marginBottom:8}}),e.jsx(Me.Text,{type:"secondary",style:{fontSize:12,textAlign:"center"},children:"åŒ WiFi çš„æ‰‹æœºæ‰«ç é¢„è§ˆ"})]})]})]}),trigger:"click",placement:"bottomRight",open:Q,onOpenChange:ae,arrow:!1,children:e.jsx(we,{title:"åˆ†äº«",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(jo,{})})})}),e.jsx(Ct,{trigger:["click"],placement:"bottomCenter",onOpenChange:f=>{f&&z()},menu:{items:[{key:"push",label:"ä¸€é”®æŽ¨é€",extra:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Ft,{status:R.some(f=>f.type==="figma")?"success":"default"}),e.jsx("span",{style:{marginLeft:4},children:R.some(f=>f.type==="figma")?"å·²è¿žæŽ¥":"æœªè¿žæŽ¥"})]}),icon:e.jsx(vs,{}),disabled:!R.some(f=>f.type==="figma")},{type:"divider"},{key:"download-json",label:"ä¸‹è½½ JSON",icon:e.jsx(Kt,{})},{key:"download-axure",label:"ä¸‹è½½ JSON",extra:"é€‚é… Axure",icon:e.jsx(nt,{})}],onClick:({key:f})=>{f==="push"?ie():f==="download-json"?ee(!0):f==="download-axure"&&ee(!1)}},children:e.jsx(we,{trigger:["click","hover"],title:"å¯¼å‡ºåˆ° Figma",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(er,{})})})}),e.jsx(Y,{type:"primary",size:"small",style:{fontSize:"12px"},icon:e.jsx(Kt,{}),onClick:()=>{A(!0)},children:"å¯¼å‡ºåˆ° Axure"})]})})}),e.jsx(Yo,{open:ke,onClose:()=>ce(!1),onSaved:()=>{fetch("/api/config").then(f=>f.ok?f.json():Promise.reject(new Error("Request failed"))).then(f=>{var $;return be((($=f==null?void 0:f.server)==null?void 0:$.allowLAN)!==!1)}).catch(()=>{}),re==null||re()}})]})}const sr=({width:h,height:v,children:d,scale:b=1})=>e.jsx("div",{style:{position:"relative",padding:"12px",background:"#1f1f1f",borderRadius:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.2)",border:"4px solid #333",display:"flex",flexDirection:"column",transform:`scale(${b})`,transformOrigin:"center center"},children:e.jsx("div",{style:{width:h,height:v,background:"#fff",borderRadius:"32px",overflow:"hidden",position:"relative"},children:d})}),{Content:nr}=xt,{useToken:or}=ot;function rr({containerRef:h,previewIframeRef:v,selectedItem:d,activeTab:b,currentDevice:T,displaySize:k,scale:j,elementIframeKey:L,iframeUrl:_,elementIframeSize:se,setElementIframeSize:X,viewMode:P}){const{token:ne}=or();return e.jsx(nr,{ref:h,style:{background:ne.colorBgLayout,position:"relative",flex:1,minWidth:0,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:d?P==="spec"?e.jsx("iframe",{ref:v,src:_,style:{width:"100%",height:"100%",border:"none",display:"block"},title:d.displayName},L):b==="pages"&&T.id!=="desktop"?e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(sr,{width:k.width,height:k.height,scale:j,children:e.jsx("iframe",{ref:v,src:_,style:{width:"100%",height:"100%",border:"none"},title:d.displayName},L)})}):b==="elements"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:e.jsx("div",{style:{position:"relative",display:"inline-block"},children:e.jsx(Ls,{size:se,onResize:(q,Z,r)=>{if(r){const D=r.getBoundingClientRect();X({width:D.width,height:D.height})}},minWidth:50,minHeight:50,bounds:"window",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},handleStyles:{right:{width:"8px",right:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottom:{height:"8px",bottom:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottomRight:{width:"12px",height:"12px",right:"-6px",bottom:"-6px",background:"transparent",borderRadius:"0 0 6px 0",transition:"all 0.2s"}},handleClasses:{right:"resize-handle-right",bottom:"resize-handle-bottom",bottomRight:"resize-handle-bottomRight"},style:{border:`1px solid ${ne.colorBorder}`,borderRadius:6,overflow:"hidden",background:ne.colorBgContainer,boxShadow:ne.boxShadow,transition:"box-shadow 0.2s"},className:"ant-card-hoverable",children:e.jsx("iframe",{ref:v,src:_,style:{width:"100%",height:"100%",border:"none"},title:d.displayName},L)})})}):e.jsx("iframe",{ref:v,src:_,style:{width:"100%",height:"100%",border:"none",display:"block"},title:d.displayName},L):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:ne.colorTextSecondary},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Ao,{style:{fontSize:"64px",marginBottom:"16px"}}),e.jsxs("div",{style:{fontSize:"16px"},children:["è¯·ä»Žå·¦ä¾§é€‰æ‹©ä¸€ä¸ª",b==="elements"?"å…ƒç´ ":"é¡µé¢"]})]})})})}const{Dragger:ar}=Us,{Text:Is,Title:ir}=Me;function lr({visible:h,onClose:v,activeTab:d,createName:b,setCreateName:T,createReference:k,setCreateReference:j,createMode:L,setCreateMode:_,generateAxure:se,setGenerateAxure:X,referenceItems:P,selectedThemes:ne,setSelectedThemes:q,availableThemes:Z,selectedLibraries:r,setSelectedLibraries:D,availableLibraries:c,selectedDocs:M,setSelectedDocs:U,availableDocs:G,selectedDataAssets:Q,setSelectedDataAssets:ae,availableDataAssets:R,preferredPromptClient:z,preferredIDE:ie,buildCreatePrompt:ee,onAfterCreatePromptAction:A}){const{token:V}=ot.useToken(),[oe,F]=o.useState(!0),[l,w]=o.useState("create"),[g,y]=o.useState("make"),[S,C]=o.useState("zip"),[J,te]=o.useState([]),[re,je]=o.useState(!1),[Se,Te]=o.useState(null),Fe=o.useRef(null);o.useEffect(()=>{h&&(F(!0),w("create"),y("make"),C("zip"),te([]),je(!1),Te(null))},[h]);const Qe=p=>{y(p),C("zip"),te([]),Te(null)},ke=p=>["make","axhub","google_stitch"].includes(p),ce=p=>["axure_prototype","web_page"].includes(p),Ae=async p=>{const{file:f,onSuccess:$,onError:B}=p,ge=f instanceof File?f:f.originFileObj,O=new FormData;O.append("file",ge,ge.name),O.append("uploadType",g),O.append("targetType",d),O.append("uploadMode","zip"),console.log("[å‰ç«¯] customRequest ä¸Šä¼ å‚æ•°:",{uploadType:g,targetType:d,fileName:ge.name,fileSize:ge.size}),je(!0);try{const le=await fetch("/api/upload",{method:"POST",body:O}),ve=await le.json();console.log("[å‰ç«¯] æœåŠ¡å™¨å“åº”:",ve),le.ok&&ve.success?(Te(ve),$(null,f),ke(g)?(W.success(ve.message||"ä¸Šä¼ å¹¶è§£åŽ‹æˆåŠŸï¼"),setTimeout(()=>{v(),window.location.reload()},1500)):W.success("æ–‡ä»¶å·²è§£åŽ‹ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):(console.error("[å‰ç«¯] ä¸Šä¼ å¤±è´¥:",ve),W.error(ve.error||"ä¸Šä¼ å¤±è´¥"),B(new Error(ve.error||"ä¸Šä¼ å¤±è´¥")))}catch(le){console.error("[å‰ç«¯] ä¸Šä¼ é”™è¯¯:",le),W.error("ä¸Šä¼ å¤±è´¥: "+le.message),B(le)}finally{je(!1)}},be=p=>{Fe.current&&window.clearTimeout(Fe.current),Fe.current=window.setTimeout(()=>{De(p)},250)},De=async p=>{if(re)return;const f=p.map(O=>O.originFileObj).filter(O=>!!O);if(f.length===0){W.error("ä¸Šä¼ æ–‡ä»¶å¤¹ä¸ºç©º");return}const $=new FormData;$.append("uploadType",g),$.append("targetType",d),$.append("uploadMode","folder");const B=f[0].webkitRelativePath,ge=B?B.split("/")[0]:"";ge&&$.append("folderName",ge),f.forEach(O=>{const le=O.webkitRelativePath||O.name;$.append("files",O,le),$.append("relativePaths",le)}),je(!0);try{const O=await fetch("/api/upload",{method:"POST",body:$}),le=await O.json();O.ok&&le.success?(Te(le),ke(g)?(W.success(le.message||"ä¸Šä¼ æˆåŠŸï¼"),setTimeout(()=>{v(),window.location.reload()},1500)):W.success(le.message||"æ–‡ä»¶å·²ä¸Šä¼ ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):W.error(le.error||"ä¸Šä¼ å¤±è´¥")}catch(O){W.error("ä¸Šä¼ å¤±è´¥: "+O.message)}finally{je(!1)}},he=o.useCallback(()=>{const p=qe.find(B=>B.key===g),f=(p==null?void 0:p.docs)||[];let $="";if(ce(g)){const B=d==="elements"?"å…ƒç´ ":"é¡µé¢",ge=g==="axure_prototype"?"Axure åŽŸåž‹é“¾æŽ¥":"ç½‘é¡µé“¾æŽ¥";$=`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼ŒååŠ©ç”¨æˆ·ã€ŒåŸºäºŽ${ge}å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${B}ã€ã€‚

**ðŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼ˆå¿…é¡»é˜…è¯»ï¼‰**ï¼š
${f.map(O=>`- \`${O}\``).join(`
`)}

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œæˆ‘å°†åŸºäºŽ ${ge} å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${B}ã€‚

è¯·æŠŠé“¾æŽ¥å‘æˆ‘ï¼ˆURLï¼‰ï¼š
\`\`\``}else{if(!Se||!Se.prompt)throw new Error("æ²¡æœ‰å¯å¤åˆ¶çš„ Prompt");$=Se.prompt,f.length>0&&($+=`

ðŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼š
${f.map(B=>`- \`${B}\``).join(`
`)}`)}return $},[g,d,Se]),de={display:"inline-flex",alignItems:"center",gap:8},K=()=>{if(l==="create")return e.jsx("div",{style:de,children:e.jsx(st,{type:"primary",disabled:!1,preferredClient:z,preferredIDE:ie,scene:`create-${d}`,buildPrompt:()=>ee(),onAfterCopy:A,copySuccessMessage:"å¤åˆ¶æˆåŠŸï¼Œè¯·è¿”å›ž IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})});if(ke(g))return e.jsx("div",{style:de,children:e.jsx(Y,{onClick:v,children:"å–æ¶ˆ"})});const p=ce(g)||Se;return e.jsxs("div",{style:de,children:[e.jsx(Y,{onClick:v,children:"å…³é—­"}),e.jsx(st,{type:"primary",preferredClient:z,preferredIDE:ie,scene:`upload-${g}-${d}`,buildPrompt:he,copySuccessMessage:"Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´ç»™ AI å®Œæˆå¯¼å…¥",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt",disabled:!p})]})},Ue={name:S==="folder"?"files":"file",multiple:S==="folder",directory:S==="folder",fileList:J,customRequest:S==="zip"?Ae:void 0,beforeUpload:p=>{var $;return S==="folder"?!1:p.type==="application/zip"||p.type==="application/x-zip-compressed"||(($=p.name)==null?void 0:$.endsWith(".zip"))?!0:(W.error("è¯·ä¸Šä¼  ZIP æ ¼å¼çš„æ–‡ä»¶"),Us.LIST_IGNORE)},onChange:p=>{S==="folder"?(te(p.fileList),be(p.fileList)):te(p.fileList.slice(-1))},onRemove:()=>{te([]),Te(null)},accept:S==="zip"?".zip":void 0,disabled:re},xe="/skills",qe=[{key:"make",title:"Axbub Make",description:"æ”¯æŒè‡ªå·±æˆ–ä»–äººçš„ ZIP åŒ…",icon:e.jsx(Yt,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!0,docs:[`${xe}/local-axure-workflow/SKILL.md`]},{key:"axhub",title:"Axhub æ‰©å±•",description:"å¯å¯¼å‡ºä»»æ„ç½‘é¡µï¼ˆé™æ€ï¼‰",icon:e.jsx(Ns,{style:{fontSize:24,color:"#722ed1"}}),isDirect:!0,docs:[`${xe}/screenshot-page-workflow/SKILL.md`]},{key:"google_stitch",title:"Google Stitch",description:"AI é©±åŠ¨çš„ UI è®¾è®¡å·¥å…·ï¼ˆé™æ€ï¼‰",icon:e.jsx(Cs,{style:{fontSize:24,color:"#f5222d"}}),isDirect:!0,docs:[`${xe}/screenshot-page-workflow/SKILL.md`]},{key:"v0",title:"V0 App",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Qt,{style:{fontSize:24,color:"#52c41a"}}),isDirect:!1,docs:[`${xe}/v0-project-converter/SKILL.md`]},{key:"google_aistudio",title:"Google AIStudio",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Cs,{style:{fontSize:24,color:"#faad14"}}),isDirect:!1,docs:[`${xe}/ai-studio-project-converter/SKILL.md`]},{key:"axure_prototype",title:"Axure åŽŸåž‹é“¾æŽ¥",description:"æ”¯æŒåœ¨çº¿æˆ–æœ¬åœ°é¢„è§ˆçš„é“¾æŽ¥",icon:e.jsx(As,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!1,docs:[`${xe}/axure-prototype-workflow/SKILL.md`,`${xe}/axure-prototype-workflow/page-restoration.md`]},{key:"web_page",title:"ç½‘é¡µé“¾æŽ¥",description:"æ”¯æŒä»»æ„ç½‘é¡µé“¾æŽ¥",icon:e.jsx(qt,{style:{fontSize:24,color:"#13c2c2"}}),isDirect:!1,docs:[`${xe}/web-page-workflow/SKILL.md`,`${xe}/web-page-workflow/page-restoration.md`]}],We=()=>e.jsxs(ue,{requiredMark:!1,labelCol:{style:{width:"120px"}},wrapperCol:{style:{minWidth:0}},children:[e.jsx(ue.Item,{label:d==="elements"?"å…ƒç´ åç§°":"é¡µé¢åç§°",children:e.jsx(Be,{placeholder:"ç•™ç©ºåˆ™ç”± AI ç”Ÿæˆï¼Œæ‰¹é‡ç”Ÿæˆå»ºè®®ç•™ç©º",value:b,onChange:p=>T(p.target.value),maxLength:20,showCount:!0})}),P.length>0&&e.jsx(ue.Item,{label:"å‚è€ƒæ¡ˆä¾‹",tooltip:`å¯åœ¨${d==="elements"?"å…ƒç´ ":"é¡µé¢"}åˆ—è¡¨ä¸­å°†å…¶è®¾ä¸ºæˆ–å–æ¶ˆä¸ºå‚è€ƒæ¡ˆä¾‹`,children:e.jsx($e,{style:{width:"100%"},placeholder:"ä¸é€‰æ‹©å‚è€ƒæ¡ˆä¾‹",value:k||void 0,onChange:p=>j(p||""),allowClear:!0,options:P.map(p=>({value:p.name,label:p.displayName}))})}),e.jsx("div",{children:e.jsx(Y,{type:"link",onClick:()=>F(!oe),icon:oe?e.jsx(Ro,{}):e.jsx(Do,{}),style:{padding:0},children:oe?"æ›´å¤šé…ç½®":"æ”¶èµ·é…ç½®"})}),!oe&&e.jsxs(e.Fragment,{children:[Z.length>0&&e.jsx(ue.Item,{label:"ä¸»é¢˜",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰ä¸»é¢˜ç”ŸæˆåŽŸåž‹ï¼Œä¸»é¢˜å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©ä¸»é¢˜ï¼ˆå¯å¤šé€‰ï¼‰",value:ne,onChange:p=>q(p),allowClear:!0,options:Z.map(p=>({value:p.name,label:p.displayName}))})}),R.length>0&&e.jsx(ue.Item,{label:"å¼•ç”¨æ•°æ®",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ•°æ®ç”ŸæˆåŽŸåž‹ï¼Œæ•°æ®å¯åœ¨æ•°æ®ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ•°æ®ï¼ˆå¯å¤šé€‰ï¼‰",value:Q,onChange:p=>ae(p),allowClear:!0,options:R.map(p=>({value:p.name,label:p.displayName}))})}),c.length>0&&e.jsx(ue.Item,{label:"å‰ç«¯åº“",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰å‰ç«¯åº“ç”ŸæˆåŽŸåž‹ï¼Œå‰ç«¯åº“å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‰ç«¯åº“ï¼ˆå¯å¤šé€‰ï¼‰",value:r,onChange:p=>D(p),allowClear:!0,options:c.map(p=>({value:p.name,label:p.displayName}))})}),G.length>0&&e.jsx(ue.Item,{label:"å‚è€ƒæ–‡æ¡£",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ–‡æ¡£ç”ŸæˆåŽŸåž‹ï¼Œæ–‡æ¡£å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ–‡æ¡£ï¼ˆå¯å¤šé€‰ï¼‰",value:M,onChange:p=>U(p),options:G.map(p=>({value:p.name,label:p.displayName}))})}),e.jsx(ue.Item,{label:"ç”Ÿæˆæµç¨‹",children:e.jsx($e,{style:{width:"100%"},value:L,onChange:p=>_(p),options:[{value:"simultaneous",label:"åŒæ—¶ç”Ÿæˆè§„æ ¼æ–‡æ¡£å’ŒåŽŸåž‹"},{value:"specFirst",label:"æŒ‰ è§„æ ¼æ–‡æ¡£ > åŽŸåž‹ é¡ºåº"}]})}),e.jsx(ue.Item,{label:"Axure æ¨¡å¼",tooltip:"ä¸å½±å“å¯¼å‡º Axure ï¼Œå…³é—­åˆ™ä¸ç”Ÿæˆä¸Ž Axure åŽŸç”Ÿå…ƒç´ äº¤äº’çš„åŠŸèƒ½ï¼Œä½†å¯ä»¥æå‡ç”Ÿæˆé€Ÿåº¦",children:e.jsx(Ps,{checked:se,onChange:p=>X(p)})})]})]}),rt=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsx(ir,{level:5,style:{marginBottom:16},children:"é€‰æ‹©å¯¼å…¥æ¥æº"}),e.jsx(Po,{gutter:[16,16],children:qe.map(p=>e.jsx(No,{span:12,children:e.jsx(Es,{hoverable:!0,bodyStyle:{padding:16,height:"100%",display:"flex",alignItems:"center"},style:{height:"100%",borderColor:g===p.key?V.colorInfo:void 0,backgroundColor:g===p.key?V.colorFillAlter:void 0},onClick:()=>Qe(p.key),children:e.jsx(Es.Meta,{avatar:p.icon,title:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(Is,{ellipsis:!0,style:{fontSize:13,fontWeight:500},children:p.title})}),description:e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:p.description}),style:{width:"100%"}})})},p.key))})]}),!ce(g)&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(Is,{type:"secondary",style:{fontSize:12},children:"ä¸Šä¼ æ–¹å¼"}),e.jsx($t,{size:"small",value:S,onChange:p=>{C(p),te([]),Te(null)},options:[{label:"ZIP",value:"zip"},{label:"æ–‡ä»¶å¤¹",value:"folder"}]})]}),e.jsx("div",{style:{flex:1,minHeight:120},children:e.jsx(ar,{...Ue,style:{background:"#fafafa",border:"1px dashed #d9d9d9",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-drag-icon",style:{marginBottom:8},children:e.jsx(Lo,{style:{color:V.colorInfo,fontSize:36}})}),e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:S==="zip"?"ç‚¹å‡»æˆ–æ‹–æ‹½ ZIP æ–‡ä»¶ä¸Šä¼ ":"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶å¤¹ä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",style:{color:"#888",fontSize:12,padding:"0 16px"},children:ke(g)?"å¯¼å…¥åŽå¯é€šè¿‡ AI è¿›è¡Œç¼–è¾‘å’Œä¼˜åŒ–":"ä¸Šä¼ åŽéœ€è¦ AI è¾…åŠ©å¯¼å…¥"})]})})})]})]});return e.jsx(Ds,{placement:"left",destroyOnClose:!0,title:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx($t,{value:l,onChange:p=>w(p),options:[{label:d==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢",value:"create"},{label:d==="elements"?"å¯¼å…¥å…ƒç´ ":"å¯¼å…¥é¡µé¢",value:"upload"}],style:{fontWeight:500}})}),open:h,onClose:v,width:600,footer:K(),styles:{body:{padding:24,overflow:"auto"},header:{borderBottom:"1px solid #f0f0f0",padding:"16px 24px"},footer:{textAlign:"right"}},children:l==="create"?We():rt()})}const kt={simultaneous:{mode:"simultaneous",displayName:"ç›´æŽ¥ç”Ÿæˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!1]},specFirst:{mode:"specFirst",displayName:"è§„æ ¼ä¼˜å…ˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.mdï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰â†’ ç”Ÿæˆ index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ spec.mdï¼ˆç¡®è®¤ï¼‰â†’ index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!0,!1]}};function cr(h,v){const d=v==="elements"?"å…ƒç´ ":"é¡µé¢",b=v==="elements"?"elements":"pages",T=`src/${b}/${h.name}`,k=`src/${b}/ref-${h.name}`;return`å°† \`${T}\` è®¾ä¸ºå‚è€ƒæ¡ˆä¾‹ï¼š

1. ç§»åŠ¨åˆ° \`${k}\`
2. å‚è€ƒ \`/rules/development-standards.md\`
3. åœ¨ index.tsx é¡¶éƒ¨æ·»åŠ ï¼š
\`\`\`typescript
/**
 * @name ${h.displayName}
 * æœ¬æ–‡ä»¶æ˜¯æ¼”ç¤ºæ–‡ä»¶ï¼Œå±•ç¤ºæœ¬é¡¹ç›®${d}å¼€å‘è§„èŒƒ
 * å®žé™…å¼€å‘æ—¶åªéœ€ä¿ç•™ @name æ³¨é‡Šï¼Œä¸éœ€è¦è¯¦ç»†çš„è§„èŒƒè¯´æ˜Ž
 */
\`\`\`
4. åœ¨å…³é”®ä»£ç æ®µæ·»åŠ  \`// ã€è§„èŒƒè¯´æ˜Žã€‘\` æ³¨é‡Šï¼šå¯¼å…¥é¡ºåºã€Propså¤„ç†ã€Stateç®¡ç†ã€äº‹ä»¶å¤„ç†ã€useImperativeHandleã€JSXæ¸²æŸ“
5. æ³¨é‡Šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œéž"åšä»€ä¹ˆ"ï¼Œé‡ç‚¹è¯´æ˜Žæ˜“é”™ç‚¹å’Œæœ€ä½³å®žè·µ`}function dr(h){return Object.prototype.hasOwnProperty.call(kt,h)}function ur(h){const{hasName:v,displayName:d,itemType:b,hasReference:T,referenceDisplayName:k}=h,j=T&&k?`
å‚è€ƒæ¡ˆä¾‹ï¼š${k}`:"";return v?`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åŽï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›žå¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›žå¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®žçŽ°å†…å®¹

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º **${d}** ${b}ã€‚${j}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼š
\`\`\``:`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åŽï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›žå¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›žå¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®žçŽ°å†…å®¹

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º${b}ã€‚${j}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼ˆå¦‚éœ€åˆ›å»ºå¤šä¸ª${b}ï¼Œè¯·ä¸€å¹¶è¯´æ˜Žï¼‰ï¼š
\`\`\``}function pr(h){return h?`

**Axure API**ï¼šâœ… å·²å¯ç”¨
- éœ€è¦ä½¿ç”¨ Axure API å®žçŽ°ç»„ä»¶äº¤äº’åŠŸèƒ½
- **âš ï¸ å¿…é¡»å®Œæ•´é˜…è¯» \`/rules/axure-api-guide.md\`ï¼Œä¸è¦è·³è¿‡ï¼**
- è¯¥æ–‡æ¡£åŒ…å«å®Œæ•´çš„ Axure API æŽ¥å£è§„èŒƒã€ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ`:`

**Axure API**ï¼šâŒ æœªå¯ç”¨
- æœ¬æ¬¡ä½¿ç”¨æ ‡å‡† React ç»„ä»¶å³å¯ï¼Œä¸éœ€è¦ Axure API`}function $s(){return`   - æ–‡ä»¶ç»“æž„ã€ä¾èµ–å¼•ç”¨ã€æ ·å¼è§„èŒƒã€å¯¼å‡ºè§„èŒƒ
   - âš ï¸ **éªŒæ”¶æ ‡å‡†**ï¼šå®ŒæˆåŽå¿…é¡»å¯¹ç…§æ­¤æ–‡æ¡£æ£€æŸ¥å®žçŽ°`}function Os(h){const{createMode:v,modeConfig:d,generateAxure:b}=h;return v==="simultaneous"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${d.description}

**ðŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

2. **\`/rules/development-standards.md\`**
${$s()}

3. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${b?`

4. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æŽ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}`:v==="specFirst"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${d.description}

**ðŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/requirements-alignment.md\`** â­ï¸ éœ€æ±‚å¯¹é½ï¼ˆç¬¬ä¸€æ­¥ï¼‰
   - éœ€æ±‚ç¡®è®¤æ¸…å•ã€æ²Ÿé€šç­–ç•¥ã€å¯è§†åŒ–æµç¨‹

2. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼Œå¿…é¡»å®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

3. **\`/rules/development-standards.md\`**
${$s()}

4. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${b?`

5. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æŽ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}

**ç¡®è®¤æµç¨‹**ï¼š
- å®Œæˆ spec.md åŽï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼š"spec.md å·²å®Œæˆï¼Œè¯·ç¡®è®¤æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚ç¡®è®¤åŽå°†ç”Ÿæˆä»£ç å®žçŽ°ã€‚"
- ç­‰å¾…ç”¨æˆ·ç¡®è®¤åŽå†ç”Ÿæˆ index.tsx`:Os({createMode:"simultaneous",modeConfig:kt.simultaneous,generateAxure:b})}function hr(h){const{referencePath:v,referenceDisplayName:d}=h;return v?`

**ðŸ“ å‚è€ƒæ¡ˆä¾‹**ï¼ˆâ­ï¸ ä¼˜å…ˆå‚è€ƒï¼‰ï¼š
- è·¯å¾„ï¼š\`${v}\`
- åç§°ï¼š${d}
- **è¯·ä¼˜å…ˆå‚è€ƒæ­¤æ¡ˆä¾‹çš„ä»£ç ç»“æž„å’Œå®žçŽ°æ–¹å¼**
- å­¦ä¹ å…¶æ–‡ä»¶ç»„ç»‡ã€å‘½åè§„èŒƒã€ä»£ç é£Žæ ¼`:""}function St(h){const{title:v,selected:d,available:b,toLine:T}=h;return d.length===0?"":`

${v}${d.map(k=>{const j=b.find(L=>L.name===k);return`
${T(k,j)}`}).join("")}`}function fr(h,v,d,b,T,k=[],j=[],L=[],_=[],se=[],X=[],P=[],ne=[],q=!0){const Z=v==="elements",r=Z?"å…ƒç´ ":"é¡µé¢",D=Z?"elements":"pages",c=h.trim().length>0,M=h.trim(),U=b?T.find(l=>l.name===b):null,G=U?`src/${D}/${U.name}`:null,Q=dr(d)?kt[d]:kt.simultaneous,ae=c?`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼Œåˆ›å»º ${r}ã€Œ**${M}**ã€åŽŸåž‹`:`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª${r}åŽŸåž‹`,R=ur({hasName:c,displayName:M,itemType:r,hasReference:!!U,referenceDisplayName:U==null?void 0:U.displayName}),z=pr(q),ie=Os({createMode:d,modeConfig:Q,generateAxure:q}),ee=hr({referencePath:G,referenceDisplayName:U==null?void 0:U.displayName}),A=St({title:"**ðŸ“š å‚è€ƒæ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/docs/ï¼‰ï¼š",selected:k,available:j,toLine:(l,w)=>`- **\`/assets/docs/${l}\`** - ${(w==null?void 0:w.displayName)||l}`}),V=St({title:"**ðŸŽ¨ ä¸»é¢˜é…ç½®**ï¼ˆç›¸å¯¹è·¯å¾„ /src/themes/ï¼Œåªæä¾›è·¯å¾„ï¼Œä¸å±•å¼€æ–‡ä»¶å†…å®¹ï¼‰ï¼š",selected:L,available:_,toLine:(l,w)=>`- ${(w==null?void 0:w.displayName)||l}
  - \`/src/themes/${l}/DESIGN-SPEC.md\`ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  - \`/src/themes/${l}/designToken.json\`
  - \`/src/themes/${l}/globals.css\` æˆ– \`/src/themes/${l}/style.css\`ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  - \`/src/themes/${l}/index.tsx\``}),oe=St({title:"**ðŸ“¦ å‰ç«¯åº“æ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/libraries/ï¼‰ï¼š",selected:se,available:X,toLine:(l,w)=>`- **\`/assets/libraries/${l}\`** - ${(w==null?void 0:w.displayName)||l}`}),F=St({title:"**ðŸ“Š å‚è€ƒæ•°æ®**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/database/ï¼‰ï¼š",selected:P,available:ne,toLine:(l,w)=>`- **\`/assets/database/${l}\`** - ${(w==null?void 0:w.displayName)||l}`});return`${ae}

âš ï¸ **é‡è¦æç¤º**ï¼šè¯·åŠ¡å¿…å®Œæ•´é˜…è¯»ä»¥ä¸‹æ‰€æœ‰è§„èŒƒæ–‡æ¡£å’Œå‚è€ƒèµ„æ–™ï¼Œä¸è¦å·æ‡’ï¼è¿™äº›æ–‡æ¡£åŒ…å«äº†å…³é”®çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®žè·µã€‚
${ie}${ee}${V}${F}${oe}${A}${z}

${R}`}function mr(h,v,d,b){if(!h)return"";const T=window.location.origin+(v==="demo"?h.demoUrl:h.specUrl),k=new URL(T,window.location.origin);return v==="demo"&&d==="webEditorV2"?k.searchParams.set("editor","webEditorV2"):k.searchParams.delete("editor"),b!=null&&b.width&&Number.isFinite(b.width)?k.searchParams.set("width",String(Math.round(b.width))):k.searchParams.delete("width"),k.toString()}function xr(h,v){const[d,b]=o.useState(!1),[T,k]=o.useState(""),[j,L]=o.useState(()=>localStorage.getItem(hs)||""),[_,se]=o.useState(()=>localStorage.getItem(fs)||"simultaneous"),[X,P]=o.useState(()=>localStorage.getItem(ms)==="true"),[ne,q]=o.useState([]),[Z,r]=o.useState([]),[D,c]=o.useState([]),[M,U]=o.useState([]),[G,Q]=o.useState([]),[ae,R]=o.useState([]),[z,ie]=o.useState([]),[ee,A]=o.useState([]),[V,oe]=o.useState(!1);o.useEffect(()=>{localStorage.setItem(fs,_)},[_]),o.useEffect(()=>{localStorage.setItem(ms,String(X))},[X]),o.useEffect(()=>{localStorage.setItem(hs,j)},[j]);const F=o.useMemo(()=>(h==="elements"?v.elements:v.pages).filter(S=>S.isReference),[v,h]);return o.useEffect(()=>{if(!V)return;(async()=>{try{const S=await fetch("/api/docs");if(S.ok){const C=await S.json();R(C)}}catch(S){console.error("Failed to load docs:",S)}})()},[V]),o.useEffect(()=>{if(!V)return;(async()=>{try{const S=await fetch("/api/themes");if(S.ok){const C=await S.json();r(C)}}catch(S){console.error("Failed to load themes:",S)}})()},[V]),o.useEffect(()=>{if(!V)return;(async()=>{try{const S=await fetch("/api/libraries");if(S.ok){const C=await S.json();U(C);const J=C.find(te=>te.name==="tailwind-css.md"||te.name.startsWith("tailwind-css"));J&&D.length===0&&c([J.name])}}catch(S){console.error("Failed to load libraries:",S)}})()},[V]),o.useEffect(()=>{if(!V)return;(async()=>{try{const S=await fetch("/api/data/tables");if(S.ok){const J=(await S.json()).map(te=>({name:`${te.fileName}.json`,displayName:te.tableName}));A(J)}}catch(S){console.error("Failed to load data assets:",S)}})()},[V]),o.useEffect(()=>{d&&(j&&(F.some(S=>S.name===j)||L("")),oe(!0))},[d,F,j]),{createDialogVisible:d,createName:T,createReference:j,createMode:_,generateAxure:X,referenceItems:F,selectedThemes:ne,availableThemes:Z,selectedLibraries:D,availableLibraries:M,selectedDocs:G,availableDocs:ae,selectedDataAssets:z,availableDataAssets:ee,setCreateDialogVisible:b,setCreateName:k,setCreateReference:L,setCreateMode:se,setGenerateAxure:P,setSelectedThemes:q,setSelectedLibraries:c,setSelectedDocs:Q,setSelectedDataAssets:ie,buildPrompt:async()=>fr(T,h,_,j,F,G,ae,ne,Z,D,M,z,ee,X),clearCreateDialogState:()=>{b(!1),k(""),Q([]),q([]),c([]),ie([]),oe(!1),R([]),r([]),U([]),A([])},handleCreateCancel:()=>{b(!1),k(""),Q([]),q([]),c([]),ie([]),oe(!1),R([]),r([]),U([]),A([])}}}function gr(h,v){const d=Array.isArray(h)?h:[],b=Array.isArray(v)?v:[],T=[...d],k=new Set(T.map(j=>String((j==null?void 0:j.selector)||"").trim()).filter(Boolean));for(const j of b){const L=String((j==null?void 0:j.selector)||"").trim();!L||k.has(L)||(T.push(j),k.add(L))}return T}function yr(h){const v=Array.isArray(h)?h:[],d=[],b=new Set;for(const T of v){const k=String((T==null?void 0:T.tag)||"").trim(),j=String((T==null?void 0:T.selector)||"").trim(),L=String((T==null?void 0:T.label)||"").trim();if(!k||!j||!L)continue;const _=`${k}::${j}::${L}`;b.has(_)||(b.add(_),d.push({tag:k,selector:j,label:L}))}return d}function wr({isDarkMode:h,setIsDarkMode:v}){const d="http://localhost:32123",b=/mac/i.test(navigator.platform)?"sudo npm install -g @axhub/genie":"npm install -g @axhub/genie",T={webBaseUrl:d,apiBaseUrl:`${d}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"åŠ©æ‰‹è¿è¡Œæ—¶ä¸å¯ç”¨ï¼Œè¯·å…ˆå¯åŠ¨ Axhub Genieã€‚",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:b,start:"axhub-genie",status:"axhub-genie status"}}},k=320,j=320,L=640,{token:_}=ot.useToken(),[se,X]=o.useState(!0),[P,ne]=o.useState({elements:[],pages:[]}),[q,Z]=o.useState(!1),[r,D]=o.useState(()=>{const t=localStorage.getItem(gs);return t==="elements"||t==="pages"?t:"pages"}),[c,M]=o.useState(null),[U,G]=o.useState("desktop"),[Q,ae]=o.useState(1),R=Ee.useRef(null),z=Ee.useRef(null),[ie,ee]=o.useState(!1),A=Ee.useRef(null),V=Ee.useRef(null),[oe,F]=o.useState(""),[l,w]=W.useMessage(),[g,y]=Et.useModal(),[S,C]=o.useState({enabled:!1,editedCount:0}),[J,te]=o.useState({mode:"none",webEditor:{active:!1,undoCount:0,redoCount:0},textEdit:{enabled:!1,editedCount:0},inspecta:{enabled:!1}}),re=Ee.useRef(!1),[je,Se]=o.useState({width:600,height:400}),[Te,Fe]=o.useState(0),[Qe,ke]=o.useState(!1),[ce,Ae]=o.useState(null),[be,De]=o.useState(null),[he,de]=o.useState(!1),[K,Ue]=o.useState(null),[xe,qe]=o.useState(!1),[We,rt]=o.useState(()=>{const t=localStorage.getItem(ys),s=t?Number(t):NaN;return Number.isFinite(s)&&s>=j?Math.min(s,L):k}),p=o.useRef(null),[f,$]=o.useState(!1),[B,ge]=o.useState(null),[O,le]=o.useState(null),ve=o.useRef(!1),[pe,at]=o.useState("demo"),[it,At]=o.useState("spec"),He=Ee.useRef(null),{createDialogVisible:_s,createName:Ms,createReference:Bs,createMode:Fs,generateAxure:Ws,referenceItems:Hs,selectedThemes:Vs,availableThemes:Gs,selectedLibraries:Ks,availableLibraries:Js,selectedDocs:Xs,availableDocs:qs,selectedDataAssets:Ys,availableDataAssets:Zs,setCreateDialogVisible:Qs,setCreateName:en,setCreateReference:tn,setCreateMode:sn,setGenerateAxure:nn,setSelectedThemes:on,setSelectedLibraries:rn,setSelectedDocs:an,setSelectedDataAssets:ln,buildPrompt:cn,clearCreateDialogState:dn,handleCreateCancel:un}=xr(r,P);o.useEffect(()=>{let t=!1;return Ze.getConfig().then(s=>{var a,i;if(t)return;const n=(a=s==null?void 0:s.automation)==null?void 0:a.defaultPromptClient;Ae(n==="claude"||n==="cursor"||n==="codex"?n:null),De(((i=s==null?void 0:s.automation)==null?void 0:i.defaultIDE)||null)}).catch(()=>{t||(Ae(null),De(null))}),()=>{t=!0}},[]),o.useEffect(()=>{let t=!1;return Ze.getAssistantRuntime().then(s=>{t||Ue(s)}).catch(()=>{t||Ue(T)}),()=>{t=!0}},[]),o.useEffect(()=>{localStorage.setItem(ys,String(Math.round(We)))},[We]);const Rt=L,lt=o.useCallback((t,s)=>{try{const n=new URL(t,window.location.origin);return n.searchParams.set("context",JSON.stringify(s)),n.toString()}catch(n){return console.warn("Failed to serialize assistant context into URL:",n),t}},[]),ct=o.useMemo(()=>{const t=((K==null?void 0:K.webBaseUrl)||d).replace(/\/+$/g,""),s=new URL(`${t}/`),n=(K==null?void 0:K.projectPath)||"";return n&&s.searchParams.set("cwd",n),ce&&s.searchParams.set("provider",ce),s.toString()},[K,ce]),ze=B||ct;o.useEffect(()=>{$(!1)},[ze]),o.useEffect(()=>{ve.current=f},[f]);const Pe=o.useMemo(()=>{const t=c?pt(c):null,s=it==="prd"?"prd":"spec",a=t?pe==="spec"?`${t}/${s==="prd"?"prd.md":"spec.md"}`:`${t}/index.tsx`:null,u={version:"1",systemContext:"",currentFile:a||"",selectedElements:[],extensions:{source:"axhub-runtime",projectPath:(K==null?void 0:K.projectPath)||"",provider:ce,viewMode:pe,activeTab:r,currentSpecDocKey:s,selectedItem:c?{name:c.name,displayName:c.displayName,demoUrl:c.demoUrl,specUrl:c.specUrl}:null,paths:{itemSourcePath:t,currentFilePath:a,currentFileDirectory:t},updatedAt:new Date().toISOString()}};return O?{...u,systemContext:O.systemContext||u.systemContext,currentFile:O.currentFile||u.currentFile,selectedElements:Array.isArray(O.selectedElements)?O.selectedElements:u.selectedElements,extensions:{...u.extensions||{},...O.extensions||{}}}:u},[K==null?void 0:K.projectPath,ce,pe,r,it,c,O]),es=o.useCallback(()=>{const t=p.current;if(!t||!t.contentWindow)return;let s="*";try{s=new URL(ze).origin}catch{s="*"}const n={type:"update_context",context:Pe};t.contentWindow.postMessage(n,s)},[ze,Pe]);o.useEffect(()=>{!he||!f||es()},[he,f,es]),o.useEffect(()=>{he||($(!1),ge(null))},[he]);const gt=o.useCallback((t,s)=>{const n=t||ct;let a=n;try{const i=new URL(n,window.location.origin),u=(K==null?void 0:K.projectPath)||"";!i.searchParams.get("cwd")&&u&&i.searchParams.set("cwd",u),!i.searchParams.get("provider")&&ce&&i.searchParams.set("provider",ce),s&&!i.searchParams.get("targetPath")&&i.searchParams.set("targetPath",s),i.searchParams.get("context")?a=i.toString():a=lt(i.toString(),Pe)}catch{a=lt(n,Pe)}return a},[K==null?void 0:K.projectPath,ce,ct,Pe,lt]),ts=o.useCallback((t,s)=>{const n=gt(t,s);de(!0),$(!1),ge(n)},[gt]),ss=o.useCallback((t,s)=>{const n=gt(t,s);window.open(n,"_blank","noopener,noreferrer")},[gt]),dt=o.useCallback((t,s="replace")=>{const n=p.current;if(!n||!n.contentWindow)return!1;let a="*";try{a=new URL(ze).origin}catch{a="*"}const i={type:"update_context",mode:s,context:{version:t.version,systemContext:t.systemContext,currentFile:t.currentFile,selectedElements:t.selectedElements,extensions:t.extensions}};return n.contentWindow.postMessage(i,a),!0},[ze]),yt=o.useCallback((t,s="replace")=>{dt(t,s),s==="replace"&&(window.setTimeout(()=>dt(t,s),160),window.setTimeout(()=>dt(t,s),520))},[dt]),ns=o.useCallback((t,s)=>{const n=p.current;if(!n||!n.contentWindow)return!1;let a="*";try{a=new URL(ze).origin}catch{a="*"}const i={type:"update_prompt",prompt:t,autoSend:s};return n.contentWindow.postMessage(i,a),!0},[ze]),os=o.useCallback(async(t=8e3)=>{var n;const s=Date.now();for(;Date.now()-s<t;){if((n=p.current)!=null&&n.contentWindow&&ve.current)return!0;await new Promise(a=>setTimeout(a,120))}return!1},[]),Dt=o.useCallback((t,s,n,a,i="iframe")=>{const u=t.health.hints;g.confirm({title:"Axhub Genie æœªå°±ç»ª",content:e.jsxs("div",{children:[e.jsx("p",{children:t.health.message}),e.jsxs(Me.Paragraph,{style:{marginBottom:8},copyable:{text:u.installGlobal,tooltips:["å¤åˆ¶å‘½ä»¤","å·²å¤åˆ¶"],onCopy:()=>l.success("å…¨å±€å®‰è£…å‘½ä»¤å·²å¤åˆ¶")},children:["å®‰è£…ï¼š",e.jsx(Me.Text,{code:!0,children:u.installGlobal})]}),e.jsxs(Me.Paragraph,{style:{marginBottom:0},copyable:{text:u.start,tooltips:["å¤åˆ¶å‘½ä»¤","å·²å¤åˆ¶"],onCopy:()=>l.success("å¯åŠ¨å‘½ä»¤å·²å¤åˆ¶")},children:["å¯åŠ¨ï¼š",e.jsx(Me.Text,{code:!0,children:u.start})]})]}),cancelText:"å…³é—­",footer:(m,{CancelBtn:x})=>e.jsx(x,{})}),s==="event"&&l.warning("Genie æœªå°±ç»ªï¼Œå·²å›žé€€ä¸ºå®‰è£…å¼•å¯¼ã€‚")},[l,g]),Ye=o.useCallback(async(t,s,n,a="iframe")=>{if(xe)return!1;qe(!0);try{const i=await Ze.getAssistantRuntime();if(Ue(i),i.health.status==="ready")return a==="window"?ss(s,n):ts(s,n),!0;Dt(i,t,s,n,a)}catch(i){const u=K||T;Ue(u),l.error((i==null?void 0:i.message)||"æ£€æµ‹ Axhub Genie çŠ¶æ€å¤±è´¥"),Dt(u,t,s,n,a)}finally{qe(!1)}return!1},[xe,K,l,ts,ss,Dt]),rs=o.useCallback(async t=>{var N,me;const s=((N=t.targetPath)==null?void 0:N.trim())||void 0,n=t.context,a=String(t.prompt||"").trim(),i=t.mode==="selection_context",u=(()=>{if(!n)return O;const H=O??{systemContext:"",currentFile:"",selectedElements:[],extensions:{}},fe=gr(H.selectedElements,n.selectedElements);return{version:"1",systemContext:n.systemContext||H.systemContext,currentFile:n.currentFile||H.currentFile,selectedElements:yr(fe),extensions:{...H.extensions||{},...n.extensions||{}}}})();u&&le(u);let m=he&&f&&!!((me=p.current)!=null&&me.contentWindow),x=!1;if(!m){const H=i?n:u,fe=H?lt(ct,H):void 0;if(!await Ye("event",fe,s))return;if(x=!!H,m=await os(8e3),!m){l.warning("åŠ©æ‰‹é¢æ¿å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åŽå†è¯•ã€‚");return}}if(u){const H=i?"append":"replace",fe=i?n:u;fe&&!(i&&x)&&yt(fe,H)}if(i)return;if(!a){l.warning("ç¼ºå°‘å‘é€å†…å®¹");return}ns(a,!0)||l.error("å‘é€å¤±è´¥ï¼šæ— æ³•å†™å…¥åŠ©æ‰‹è¾“å…¥æ¡†")},[O,he,f,dt,yt,ns,Ye,os,l,lt,ct]),pn=o.useCallback(()=>{if(he){de(!1);return}Ye("button")},[he,Ye]);o.useEffect(()=>{const t=s=>{const n=s,a=n.detail,i=a==null?void 0:a.url;!i||typeof i!="string"||(Ye("event",i,a==null?void 0:a.targetPath),n.preventDefault())};return window.addEventListener(ws,t),()=>{window.removeEventListener(ws,t)}},[Ye]);const hn=()=>{const t=`${window.location.protocol}//${window.location.hostname}:${window.location.port}${(c==null?void 0:c.demoUrl)||""}`;navigator.clipboard.writeText(t).then(()=>{l.success("æœ¬åœ°é“¾æŽ¥å·²å¤åˆ¶")}).catch(s=>{l.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),ke(!1)},fn=()=>{const t=ds();navigator.clipboard.writeText(t).then(()=>{l.success("å±€åŸŸç½‘é“¾æŽ¥å·²å¤åˆ¶")}).catch(s=>{l.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),ke(!1)},mn=()=>{window.open("/api/download-dist","_blank"),ke(!1)},xn=async()=>{let t="",s="";const n=[...zs];if(c){const i=c;if(pe==="spec"){const u=it==="prd"?"prd.md":"spec.md";t=`src/${r}/${c.name}/${u}`,s=`[${c.displayName} - ${u==="prd.md"?"PRD":"SPEC"}](${pt(c)}/${u})`}else{if(i.filePath){const u=i.filePath.indexOf("src/");u>=0?t=i.filePath.substring(u):t=i.filePath}else t=`src/${r}/${c.name}/index.tsx`;s=`[${c.displayName}](${pt(c)})`}}else{l.warning("è¯·å…ˆé€‰æ‹©æ¡ç›®");return}const a=l.loading("æ­£åœ¨å‘é€åˆ° IDE...",0);try{s&&await navigator.clipboard.writeText(s),await bs({preferredIDE:be,targetPath:t});const i=await Ze.sendWsMessage({type:"handshake",payload:"prototype-admin",targetClientTypes:n});if(!(i!=null&&i.sent)){l.warning("ç¼–è¾‘å™¨æœªè¿žæŽ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}const u=await Ze.sendWsMessage({type:"open-file",payload:t,targetClientTypes:n});if(!(u!=null&&u.sent)){l.warning("ç¼–è¾‘å™¨æœªè¿žæŽ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}l.success("å·²åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œå¹¶å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ç¼–è¾‘")}catch(i){l.error((i==null?void 0:i.message)||"å‘é€å¤±è´¥")}finally{a()}},gn=async t=>{await bs({preferredIDE:t||be})},yn=async t=>{let s="";if(pe==="spec"){const n=it==="prd"?"prd.md":"spec.md";s=`[${t.displayName} - ${n==="prd.md"?"PRD":"SPEC"}](${pt(t)}/${n})`}else s=`[${t.displayName}](${pt(t)})`;if(!s){l.warning("æ— æ³•èŽ·å–è·¯å¾„");return}try{await navigator.clipboard.writeText(s),l.success("è·¯å¾„å·²å¤åˆ¶")}catch(n){console.error("Failed to copy: ",n),l.error("å¤åˆ¶å¤±è´¥")}},wn=o.useMemo(()=>[{value:"desktop",icon:e.jsx(_o,{})},{value:"mobile",icon:e.jsx(Mo,{})},{value:"tablet",icon:e.jsx(Bo,{})}],[]),[et,Pt]=o.useState(!1),[bn,Nt]=o.useState(!1),[I,Oe]=o.useState({width:1920,height:1080,includeConfig:"code",contentType:"title",rawScreenshotUrl:"",screenshotWidth:0,screenshotHeight:0,previewUrl:""});o.useEffect(()=>{ut()},[]),o.useEffect(()=>{const t=s=>{var i;const n=(i=V.current)==null?void 0:i.contentWindow;if(!n||s.source!==n)return;const a=ht();if(!(a!=="*"&&s.origin!==a))if(s.data&&s.data.type==="SCREENSHOT_CAPTURED")Oe(u=>({...u,rawScreenshotUrl:s.data.dataUrl,screenshotWidth:s.data.width,screenshotHeight:s.data.height}));else if(s.data&&s.data.type==="spec-doc-changed"){console.log("Spec document changed:",s.data.activeDocKey);const u=s.data.activeDocKey==="prd"?"prd":"spec";At(u)}else if(s.data&&s.data.type==="TEXT_EDIT_STATUS")C({enabled:!!s.data.enabled,editedCount:Number(s.data.editedCount||0)});else if(s.data&&s.data.type==="TEXT_EDIT_NOTICE"){const u=s.data.level||"info",m=s.data.message||"";m&&(l[u]||l.info)(m)}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_CONFIRM_REQUEST"){const u=Number(s.data.totalCount||0),m=Number(s.data.changedCount||0),x=!!s.data.exitAfterSave;g.confirm({title:"ç¡®è®¤ä¿å­˜æ–‡æœ¬æ›´æ”¹",content:e.jsxs("div",{children:[e.jsxs("div",{children:["æ£€æµ‹åˆ° ",m," å¤„æ–‡æœ¬æ›´æ”¹ã€‚"]}),e.jsxs("div",{children:["é¢„è®¡å°†æ›¿æ¢é¡¹ç›®ä¸­çš„ ",u," å¤„åŒ¹é…æ–‡æœ¬ã€‚"]}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"ä¿å­˜åŽå°†æ‰¹é‡ä¿®æ”¹ç›¸å…³æ–‡ä»¶å†…å®¹ã€‚"})]}),okText:"ç¡®è®¤ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{_e({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!0,exitAfterSave:x})},onCancel:()=>{_e({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!1,exitAfterSave:x})}})}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_RESULT"){const u=!!s.data.success;if(re.current&&(re.current=!1,u)){const m=Ve();m!=null&&m.disable&&(m.disable(),Ge())}}else if(s.data&&s.data.type==="TEXT_EDIT_CONFLICT"){const u=Array.isArray(s.data.conflicts)?s.data.conflicts:[];g.warning({title:"å­˜åœ¨å†²çªçš„æ–‡æœ¬ä¿®æ”¹",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"æ£€æµ‹åˆ°ç›¸åŒåŽŸæ–‡è¢«ä¿®æ”¹æˆä¸åŒå†…å®¹ï¼Œæ— æ³•æ‰¹é‡ä¿å­˜ã€‚"}),e.jsx("div",{style:{maxHeight:200,overflow:"auto",fontSize:12,color:"#555"},children:u.map((m,x)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{fontWeight:600},children:["åŽŸæ–‡ï¼š",m.original]}),e.jsxs("div",{children:["ä¿®æ”¹ä¸ºï¼š",(m.currents||[]).join(" / ")]})]},`${m.original}-${x}`))}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"è¯·ç¡®ä¿ç›¸åŒåŽŸæ–‡åªä¿®æ”¹ä¸ºä¸€ç§ç»“æžœï¼Œæˆ–åˆ†æ‰¹ä¿å­˜ã€‚"})]}),okText:"çŸ¥é“äº†"})}else Wo(s.data)&&rs(s.data.payload)};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[rs]),o.useEffect(()=>{C({enabled:!1,editedCount:0})},[c,pe,Te]),o.useEffect(()=>{if(!c)return;if(I.contentType==="screenshot"&&!I.rawScreenshotUrl){Oe(s=>({...s,previewUrl:""}));return}(async()=>{const s=r==="elements"?"å…ƒç´ ":"é¡µé¢",n=Lt(I.rawScreenshotUrl,I,c.displayName,s),a=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(a);Oe(u=>({...u,previewUrl:i}))})()},[I.rawScreenshotUrl,I.width,I.height,I.contentType,c,r]);const Lt=(t,s,n,a)=>{if(s.contentType==="title"){const i=s.width,u=s.height,m=i/2,x=u/2;return`<svg width="${i}" height="${u}" viewBox="0 0 ${i} ${u}" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect width="100%" height="100%" fill="transparent" />
              <g id="textGroup" transform="translate(${m},${x})">
                <!-- Main Title -->
                <text id="mainTitle"
                      x="0" y="-12"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="28"
                      font-weight="700"
                      fill="#333">
                  ${n}
                </text>

                <!-- Description -->
                <text id="description"
                      x="0" y="18"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="14"
                      font-weight="400"
                      fill="#999">
                  Axhub Runtime ${a}
                </text>
              </g>
            </svg>`}else return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${s.width}" height="${s.height}" viewBox="0 0 ${s.width} ${s.height}">
                <rect width="100%" height="100%" fill="transparent" />
                <image x="0" y="0" width="${s.width}" height="${s.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${t}"/>
            </svg>`},wt=Ee.useRef(!1);o.useEffect(()=>{if(wt.current=!1,I.contentType==="screenshot"){const t=r==="pages"?1920:500,s=r==="pages"?1080:300;Oe(n=>({...n,width:t,height:s,screenshotWidth:0,screenshotHeight:0,rawScreenshotUrl:""}))}else I.contentType==="title"&&Oe(t=>({...t,width:500,height:300}))},[r,I.contentType]),o.useEffect(()=>{wt.current||I.contentType==="screenshot"&&(!I.screenshotWidth||!I.screenshotHeight||Oe(t=>({...t,width:I.screenshotWidth,height:I.screenshotHeight})))},[I.screenshotWidth,I.screenshotHeight]);const jn=(t,s)=>{wt.current=!0,Oe(n=>({...n,[t]:s||0}))},Sn=()=>{I.contentType==="screenshot"&&et&&zt()},vn=()=>{wt.current=!0;const t=I.width,s=I.height;Oe(n=>({...n,width:s,height:t})),setTimeout(()=>{I.contentType==="screenshot"&&et&&zt(s,t)},0)};o.useEffect(()=>{localStorage.setItem(gs,r)},[r]),o.useEffect(()=>{if(!se&&P){const t=r==="elements"?P.elements:P.pages;t.length>0?(M(t[0]),r==="elements"&&Se({width:600,height:400})):M(null)}},[se,P,r]);async function ut(){var t,s;try{const n=await fetch("/api/entries.json");if(!n.ok)throw new Error("Failed to fetch data");const a=await n.json();console.log("Loaded data:",a),console.log("Reference elements:",(t=a.elements)==null?void 0:t.filter(i=>i.isReference)),console.log("Reference pages:",(s=a.pages)==null?void 0:s.filter(i=>i.isReference)),ne(a)}catch(n){l.error("åŠ è½½æ•°æ®å¤±è´¥: "+n.message)}finally{X(!1)}}function pt(t){const s=t;if(s.filePath){const a=s.filePath.indexOf("src/");if(a>=0){let i=s.filePath.substring(a);return i=i.replace(/\/index\.(t|j)sx?$/i,""),i}return s.filePath}return`${r==="pages"?"src/pages":"src/elements"}/${t.name}`}const Cn=t=>{const s=`${r}/${t.name}`,n=`/api/zip?path=${encodeURIComponent(s)}`;window.open(n,"_blank")},En=t=>{const s=cr(t,r);g.info({title:`è®¾ç½®ä¸ºå‚è€ƒ - ${t.displayName}`,okText:"å…³é—­",width:560,content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:12,color:"#8c8c8c"},children:"å¯ç›´æŽ¥å¤åˆ¶ Promptï¼Œæˆ–é€‰æ‹©å®¢æˆ·ç«¯è‡ªåŠ¨æ‰§è¡Œã€‚"}),e.jsx(st,{type:"primary",preferredClient:ce,preferredIDE:be,getIdeTargetPath:()=>`src/${r}/${t.name}`,scene:`set-reference-${r}`,buildPrompt:()=>s,copySuccessMessage:"è®¾ç½®ä¸ºå‚è€ƒçš„ Prompt å·²å¤åˆ¶ï¼Œè¯·è¿”å›ž IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})]})})},In=t=>{const s=r==="elements"?`elements/${t.name}`:`pages/${t.name}`;g.confirm({title:`ç¡®å®šè¦å–æ¶ˆ "${t.displayName}" çš„å‚è€ƒçŠ¶æ€å—ï¼Ÿ`,content:"å–æ¶ˆåŽè¯¥é¡¹ç›®å°†ä¸å†æ˜¯å‚è€ƒé¡¹ç›®ã€‚",okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const n=l.loading("æ­£åœ¨å–æ¶ˆå‚è€ƒ...",0);try{const a=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!a.ok){const i=await a.json();throw new Error(i.error||"å–æ¶ˆå‚è€ƒå¤±è´¥")}l.success("å·²å–æ¶ˆå‚è€ƒ"),M(null),ut()}catch(a){l.error(a.message||"å–æ¶ˆå‚è€ƒå¤±è´¥")}finally{n()}}})},$n=t=>{const s=r==="elements"?"å…ƒç´ ":"é¡µé¢",n=r==="elements"?`elements/${t.name}`:`pages/${t.name}`;let a=t.displayName;g.confirm({title:`é‡å‘½å${s}`,content:e.jsx("div",{children:e.jsx(Be,{autoFocus:!0,defaultValue:t.displayName,placeholder:"è¯·è¾“å…¥æ–°çš„æ˜¾ç¤ºåç§°ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰",onChange:i=>{a=i.target.value}})}),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const i=a.trim();if(!i)return l.error("è¯·è¾“å…¥æ–°çš„åç§°"),Promise.reject();if(i===t.displayName)return;const u=l.loading("æ­£åœ¨é‡å‘½å...",0);try{const m=await fetch("/api/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n,newName:i})});if(!m.ok){const x=await m.json().catch(()=>({}));throw new Error(x.error||"é‡å‘½åå¤±è´¥")}l.success("é‡å‘½åæˆåŠŸ"),M(null),ut()}catch(m){return l.error(m.message||"é‡å‘½åå¤±è´¥"),Promise.reject()}finally{u()}}})},Tn=async(t,s)=>{const n=await fetch("/api/items/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemType:t,itemName:s})});if(!n.ok){const a=await n.json().catch(()=>({}));throw new Error(a.error||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}return n.json()},kn=t=>{if(t.isReference){l.error("å‚è€ƒé¡¹ç›®æ— æ³•åˆ é™¤ï¼Œè¯·å…ˆå–æ¶ˆå‚è€ƒçŠ¶æ€");return}const s=r,n=r==="elements"?"å…ƒç´ ":"é¡µé¢",a=`${s}/${t.name}`,i=async()=>{const m=l.loading("æ­£åœ¨åˆ é™¤...",0);try{const x=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:a})});if(!x.ok){const E=await x.json();throw new Error(E.error||"åˆ é™¤å¤±è´¥")}l.success("åˆ é™¤æˆåŠŸ"),M(null),ut()}catch(x){l.error(x.message||"åˆ é™¤å¤±è´¥")}finally{m()}};(async()=>{const m=l.loading("æ­£åœ¨æ£€æŸ¥å¼•ç”¨...",0);try{const x=await Tn(s,t.name),E=Array.isArray(x==null?void 0:x.references)?x.references:[];if(E.length>0){const N=E.map(H=>`- ${H}`).join(`
`),me=`æˆ‘å¸Œæœ›åˆ é™¤${n} "${t.displayName}" (${t.name})ã€‚
è¯¥${n}ä½äºŽé¡¹ç›®ä¸­çš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š\`src/${s}/${t.name}\`

å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥${n}ï¼š
${N}

è¯·å¸®æˆ‘æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥å’Œæ“ä½œï¼š
1. æ ¸å¯¹ä¸Šè¿°å¼•ç”¨æ˜¯å¦å‡†ç¡®ï¼Œå¹¶è¡¥å……é—æ¼çš„å¼•ç”¨æ–‡ä»¶ï¼ˆä¼˜å…ˆæ£€æŸ¥ \`src/elements/\` ä¸Ž \`src/pages/\`ï¼‰ã€‚
2. å¦‚æžœç¡®è®¤ç»§ç»­åˆ é™¤ï¼Œè¯·ååŠ©æˆ‘å°†è¯¥${n}åœ¨å¼•ç”¨å¤„æ›¿æ¢ä¸ºåˆé€‚çš„å®žçŽ°ï¼Œå¹¶æ›´æ–°å¼•ç”¨è·¯å¾„ï¼Œä½¿è¿™äº›åŽŸåž‹ä¸å†ä¾èµ–è¯¥ç›®å½•ã€‚
3. å®Œæˆä¸Šè¿°è§£è€¦æ“ä½œåŽï¼Œå†å½»åº•åˆ é™¤ç›®å½• \`src/${s}/${t.name}\`ã€‚`;g.confirm({title:`æ£€æµ‹åˆ°${n}å¼•ç”¨`,width:720,okText:"å…³é—­",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:8},children:["å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥",n,"ï¼š"]}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:N}),e.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:e.jsx(st,{type:"primary",preferredClient:ce,preferredIDE:be,getIdeTargetPath:()=>`src/${s}/${t.name}`,scene:`delete-ref-fix-${s}`,buildPrompt:()=>me,copySuccessMessage:"å·²å¤åˆ¶å¤„ç†æç¤ºï¼Œè¯·è¿”å›žç¼–è¾‘å™¨è®© AI å¤„ç†ã€‚",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})})]})})}else g.confirm({title:`ç¡®å®šè¦åˆ é™¤${n} "${t.displayName}" å—ï¼Ÿ`,content:"æœªæ£€æµ‹åˆ°å¼•ç”¨æ–‡ä»¶ã€‚åˆ é™¤åŽæ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…Žæ“ä½œã€‚",okText:"ç¡®è®¤åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",onOk:i})}catch(x){l.error(x.message||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}finally{m()}})()},An=async t=>{const s=r==="elements"?"elements":"pages",n=`src/${s}/${t.name}`,a=(u,m)=>{let x=`${u}-copy`,E=1;for(;m.includes(x);)E++,x=`${u}-copy${E}`;return x},i=l.loading("æ­£åœ¨åˆ›å»ºå‰¯æœ¬...",0);try{const u=(r==="elements"?P.elements:P.pages).map(N=>N.name),m=a(t.name,u),x=`src/${s}/${m}`,E=await fetch("/api/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:n,targetPath:x})});if(!E.ok){const N=await E.json();throw new Error(N.error||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}l.success(`å‰¯æœ¬ "${m}" åˆ›å»ºæˆåŠŸ`),ut()}catch(u){l.error(u.message||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}finally{i()}},bt=o.useMemo(()=>{const t=r==="elements"?P.elements:P.pages;if(!oe)return t;const s=oe.toLowerCase();return t.filter(n=>n.displayName.toLowerCase().includes(s)||n.name.toLowerCase().includes(s))},[P,r,oe]),Rn=async({key:t})=>{J.mode==="webEditorV2"&&await is({restoreDevice:!1});const s=bt.find(n=>n.name===t);s&&(M(s),At("spec"),r==="elements"&&Se({width:600,height:400}))},as=t=>{D(t),F(""),M(null),At("spec")},Dn=()=>{Fe(t=>t+1)},Ve=t=>{var n,a;const s=t??Ke();return(a=(n=s==null?void 0:s.contentWindow)==null?void 0:n.DevTemplateBootstrap)==null?void 0:a.editors},Ge=()=>{var n;const t=Ve(),s=(n=t==null?void 0:t.getStatus)==null?void 0:n.call(t);s&&te(s)},Pn=()=>{if(!c)return"";const t=window.location.origin+c.demoUrl,s=new URL(t,window.location.origin);if(s.searchParams.set("editor","inspecta"),Ie.id!=="desktop"){const n=ft.width?Math.round(ft.width):Ie.width;n&&s.searchParams.set("width",String(n))}return s.toString()},Nn=()=>Ie.id==="desktop"?null:(ft.width?Math.round(ft.width):Ie.width)||null,Ln=()=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(pe==="spec"){l.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}const t=Pn();if(!t)return;const s=Ve();if(s!=null&&s.disable)try{s.disable(),J.mode==="webEditorV2"&&Ut(),Ge()}catch(n){console.error("[Axhub] é€€å‡ºå½“å‰ç¼–è¾‘æ¨¡å¼å¤±è´¥:",n)}window.open(t,"_blank")},Un=!!c&&pe!=="spec",Ke=()=>V.current,ht=t=>{const s=t??Ke();if(!s)return window.location.origin;const n=s.getAttribute("src")||s.src;if(!n)return window.location.origin;try{return new URL(n,window.location.origin).origin}catch{return window.location.origin}},zn=t=>{const s=Date.now(),n=(t==null?void 0:t.timeoutMs)??5e3,a=t==null?void 0:t.expectedEditor;return new Promise(i=>{const u=x=>{const E=x.getAttribute("src")||x.src;if(!E)return!1;try{return new URL(E,window.location.origin).searchParams.get("editor")===a}catch{return!1}},m=()=>{var N;const x=Ke();if(!x||!x.isConnected){if(Date.now()-s>=n){i(null);return}setTimeout(m,50);return}if(!u(x)){if(Date.now()-s>=n){i(null);return}setTimeout(m,50);return}const E=x.contentWindow;if((N=E==null?void 0:E.DevTemplateBootstrap)!=null&&N.editors){i(x);return}if(Date.now()-s>=n){i(null);return}setTimeout(m,50)};m()})},_e=(t,s)=>{const n=s??Ke();return!n||!n.contentWindow?(l.warning("æœªæ‰¾åˆ°å¯æ“ä½œçš„é¢„è§ˆçª—å£"),!1):(n.contentWindow.postMessage(t,ht(n)),!0)},Ut=o.useCallback(()=>{var t;le(s=>s&&{...s,selectedElements:[]}),he&&f&&((t=p.current)!=null&&t.contentWindow)&&yt({version:Pe.version,systemContext:Pe.systemContext,currentFile:Pe.currentFile,selectedElements:[],extensions:Pe.extensions},"replace")},[he,f,Pe,yt]),On=async()=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(pe==="spec"){l.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}try{const t=Ke(),s=Nn();z.current=s??null,ee(!0),Ie.id!=="desktop"&&(R.current=U,G("desktop"));const n=await zn({previousIframe:Ie.id!=="desktop"?t:null,expectedEditor:"webEditorV2"});if(!n){ee(!1),l.warning("é¢„è§ˆçª—å£å°šæœªå°±ç»ª");return}const a=Ve(n);if(!(a!=null&&a.enable)){ee(!1),l.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨");return}s&&_e({type:"WEB_EDITOR_SET_ROOT_SIZE",width:s},n),await Promise.resolve(a.enable("webEditorV2")),Ge(),He.current===null&&(He.current=q),Z(!0)}catch(t){console.error("[Axhub] å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥:",t),l.error("å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥")}},is=async t=>{const s=Ve();if(!(s!=null&&s.disable)){Ut(),l.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨"),ee(!1),He.current!==null&&(Z(He.current),He.current=null),z.current&&(_e({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),z.current=null),(t==null?void 0:t.restoreDevice)!==!1&&R.current&&G(R.current),R.current=null;return}try{await Promise.resolve(s.disable()),Ut(),Ge(),ee(!1),He.current!==null&&(Z(He.current),He.current=null),z.current&&(_e({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),z.current=null);const n=(t==null?void 0:t.restoreDevice)!==!1;n&&R.current&&G(R.current),R.current=null,n||(R.current=null)}catch(n){console.error("[Axhub] é€€å‡ºç¼–è¾‘å™¨å¤±è´¥:",n),l.error("é€€å‡ºç¼–è¾‘å™¨å¤±è´¥")}},_n=()=>{},Mn=()=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(pe==="spec"){l.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}const t=Ve();if(t!=null&&t.enable){try{t.enable("textEdit"),Ge()}catch(s){console.error("[Axhub] å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥:",s),l.error("å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥")}return}_e({type:"TEXT_EDIT_ENABLE"})},ls=(t=!1)=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(pe==="spec"){l.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}re.current=t,_e({type:"TEXT_EDIT_SAVE",exitAfterSave:t})},Bn=()=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(pe==="spec"){l.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}if(S.editedCount>0){g.confirm({title:"é€€å‡ºæ–‡æœ¬ç¼–è¾‘",content:`æ£€æµ‹åˆ° ${S.editedCount} å¤„æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦ä¿å­˜åŽé€€å‡ºï¼Ÿ`,okText:"ä¿å­˜å¹¶é€€å‡º",cancelText:"ä¸ä¿å­˜é€€å‡º",onOk:()=>ls(!0),onCancel:()=>{_e({type:"TEXT_EDIT_EXIT",discardChanges:!0});const s=Ve();s!=null&&s.disable&&(s.disable(),Ge())}});return}const t=Ve();if(t!=null&&t.disable){t.disable(),Ge();return}_e({type:"TEXT_EDIT_EXIT",discardChanges:!1})},cs=(t=!0)=>new Promise((s,n)=>{const a=Ke();if(!a||!a.contentWindow){n(new Error("æœªæ‰¾åˆ°å¯å¯¼å‡ºçš„é¢„è§ˆçª—å£"));return}const i=ht(a),u=window.setTimeout(()=>{window.removeEventListener("message",m),n(new Error("å¯¼å‡ºè¶…æ—¶ï¼Œè¯·é‡è¯•"))},15e3),m=x=>{if(x.source===a.contentWindow&&x.origin===i&&!(!x.data||x.data.type!=="FIGMA_JSON_READY"))if(window.removeEventListener("message",m),window.clearTimeout(u),x.data.success){const E=x.data.json??x.data.data??x.data.payload;if(E===void 0){n(new Error("å¯¼å‡ºæˆåŠŸä½†æœªè¿”å›žæ•°æ®ï¼ˆç¼ºå°‘ json/data/payload å­—æ®µï¼‰"));return}const N=Array.isArray(E)?E:E.layers||[];s({layers:N,widgetId:x.data.widgetId,pageId:x.data.pageId})}else n(new Error(x.data.error||"å¯¼å‡ºå¤±è´¥"))};window.addEventListener("message",m),a.contentWindow.postMessage({type:"EXPORT_FIGMA_JSON",rootName:(c==null?void 0:c.displayName)||(c==null?void 0:c.name),enableAutoLayout:t},i)}),Fn=async(t=!0)=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const s=l.loading("æ­£åœ¨ç”Ÿæˆ Figma JSON...",0);try{const{layers:n,widgetId:a,pageId:i}=await cs(t),u={layers:n,...a?{widgetId:a}:{},...i?{pageId:i}:{}},m=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),x=URL.createObjectURL(m),E=document.createElement("a");E.href=x,E.download=`${c.name}-${r}.json`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(x),l.success("JSON å·²ä¸‹è½½")}catch(n){l.error((n==null?void 0:n.message)||"å¯¼å‡ºå¤±è´¥")}finally{s()}},ds=()=>{if(!c)return"";const t=c.demoUrl,s=window.__LOCAL_IP__||"localhost",n=window.location.port||(window.location.protocol==="https:"?"443":"80");return`${window.location.protocol}//${s}:${n}${t}`},Ie=o.useMemo(()=>Mt.find(t=>t.id===U)||Mt[0],[U]);o.useEffect(()=>{Mt.some(s=>s.id===U)||G("desktop")},[U]);const[ft,us]=o.useState({width:0,height:0});o.useEffect(()=>{if(Ie.id==="desktop"||Ie.width===0||!A.current){us({width:0,height:0}),ae(1);return}const t=()=>{if(!A.current)return;const s=A.current.clientWidth*.9,n=A.current.clientHeight*.9,a=Ie.width,i=Ie.height,x=24+8,E=(s-x)/a,N=(n-x)/i,me=Math.min(E,N),H=a*me,fe=i*me;us({width:H,height:fe}),ae(1)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[Ie,q]);const zt=(t,s)=>{const n=t??I.width,a=s??I.height,i=Ke();if(i&&i.contentWindow){const u=ht(i);i.contentWindow.postMessage({type:"CAPTURE_SCREENSHOT",targetWidth:n,targetHeight:a},u)}};o.useEffect(()=>{if(et&&I.contentType==="screenshot"){const t=r==="pages"?1920:500,s=r==="pages"?1080:300;I.width===t&&I.height===s&&zt()}if(!et){const t=Ke();if(t&&t.contentWindow){const s=ht(t);t.contentWindow.postMessage({type:"RESET_SCREENSHOT_STYLES"},s)}}},[et,I.contentType,I.width,I.height]);const[Wn,Ot]=o.useState([]),Hn=window.location.port||(window.location.protocol==="https:"?"443":"80"),_t=async()=>{try{const t=await fetch("/api/ws/clients");if(t.ok){const n=(await t.json()).clients||[];return Ot(n),n}else return Ot([]),[]}catch(t){return console.error("Failed to check WS clients",t),Ot([]),[]}};o.useEffect(()=>{_t()},[]);const Vn=async()=>{if(!c){l.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const t=l.loading("æ­£åœ¨æ£€æŸ¥è¿žæŽ¥...",0),s=await _t();t(),s.length===0?g.confirm({title:"æœªæ£€æµ‹åˆ° Figma è¿žæŽ¥",content:e.jsxs("div",{children:[e.jsx("p",{children:"è¯·ç¡®ä¿ Figma æ’ä»¶å·²æ‰“å¼€å¹¶è¿žæŽ¥åˆ°å½“å‰æœåŠ¡ã€‚"}),e.jsxs("p",{style:{color:"#999",fontSize:12},children:["å½“å‰æœåŠ¡ç«¯å£: ",Hn]})]}),okText:"ä»è¦æŽ¨é€",cancelText:"å–æ¶ˆ",onOk:()=>ps()}):ps()},ps=async()=>{const t=l.loading("æ­£åœ¨èŽ·å–æ•°æ®...",0);try{const{layers:s,widgetId:n,pageId:a}=await cs();if(t(),!s||!Array.isArray(s)||s.length===0){l.error("å›¾å±‚æ•°æ®ä¸ºç©ºï¼Œæ— æ³•æŽ¨é€");return}let i;r==="elements"?(n||l.warning("å…ƒç´ ç¼ºå°‘ widgetIdï¼Œå¯èƒ½å¯¼è‡´åŒæ­¥å¤±è´¥"),i={type:"sync-widget-content",widgetId:n||`element-${(c==null?void 0:c.name)||"unknown"}-${Date.now()}`,data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}}):i={type:"sync-page-content",...a?{pageId:a}:{},data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}};const u=l.loading("æ­£åœ¨æŽ¨é€åˆ° Figma...",0);try{const m=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(m.ok)await m.json(),l.success("æŽ¨é€æˆåŠŸ");else{const x=await m.text();throw new Error(x||"å‘é€å¤±è´¥")}}catch(m){l.error("æŽ¨é€å¤±è´¥: "+m.message)}finally{u()}}catch(s){t(),l.error((s==null?void 0:s.message)||"èŽ·å–æ•°æ®å¤±è´¥")}},Gn=(t,s,n,a=2)=>new Promise((i,u)=>{const m=new Image,x=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),E=URL.createObjectURL(x);m.onload=()=>{const N=document.createElement("canvas");N.width=s*a,N.height=n*a;const me=N.getContext("2d");if(!me){u(new Error("Could not get canvas context"));return}me.drawImage(m,0,0,N.width,N.height),URL.revokeObjectURL(E),i(N.toDataURL("image/png"))},m.onerror=N=>{URL.revokeObjectURL(E),u(N)},m.src=E}),Kn=async()=>{if(c){Nt(!0);try{const t=window.location.origin+c.jsUrl,s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch code: ${s.statusText}`);const n=await s.text();let a="";if(c){const u=`${window.location.origin}/${r}/${c.name}/hack.css`;try{const m=await fetch(u);m.ok&&(a=await m.text())}catch(m){console.warn("fetch hack.css failed",m)}}const i=async(u=!1)=>{const m=`${window.location.origin}/${r}/${c.name}`,x=["spec","prd"],E={};for(const H of x){const fe=`${m}/${H}.md`;try{const Ce=await fetch(fe);if(Ce.ok){const Re=await Ce.text(),Ne={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};E[H]={name:Ne[H],content:Re}}}catch(Ce){console.warn(`Failed to fetch ${H}.md`,Ce)}}if(u){const H=`${r}/${c.name}`,fe=`${window.location.origin}/api/source?path=${encodeURIComponent(H)}`;try{const Ce=await fetch(fe);if(Ce.ok){const Ne=`\`\`\`tsx
${await Ce.text()}
\`\`\`
`;E.code={name:"å‚è€ƒä»£ç ",content:Ne}}}catch(Ce){console.warn("Failed to fetch source code",Ce)}}const N=Object.keys(E);return N.length>1?E:N.length===1?E[N[0]].content:null};if(I.contentType==="screenshot"&&!I.rawScreenshotUrl){l.warning("æ­£åœ¨ç”Ÿæˆæˆªå›¾ï¼Œè¯·ç¨å€™..."),Nt(!1);return}try{let u="",m="";if(I.includeConfig!=="none"&&(u=n,I.includeConfig==="codeAndDocs"||I.includeConfig==="codeAndDocsAndSource")){const Le=I.includeConfig==="codeAndDocsAndSource",Je=await i(Le);Je&&(m=Je)}const x=r==="elements"?"å…ƒç´ ":"é¡µé¢";let E="";if(I.contentType==="title"){const Le=Lt("",I,c.displayName,x),Je=await Gn(Le,I.width,I.height,2);E=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${I.width}" height="${I.height}" viewBox="0 0 ${I.width} ${I.height}">
                            <rect width="100%" height="100%" fill="transparent" />
                            <image x="0" y="0" width="${I.width}" height="${I.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${Je}"/>
                        </svg>`}else E=Lt(I.rawScreenshotUrl,I,c.displayName,x);const me=new DOMParser().parseFromString(E,"image/svg+xml"),H=me.querySelector("svg");if(!H)throw new Error("SVG generation failed");if(u||m){const Le={code:u,spec:m};H.setAttribute("AxExtraData",encodeURIComponent(JSON.stringify(Le)))}if(I.includeConfig!=="none"){const Le={time:Math.floor(Date.now()/1e3),config:{codeLink:t,...r==="pages"?{isFullScreen:!0}:{},...a?{hackCss:a}:{}}};H.setAttribute("AxData",encodeURIComponent(JSON.stringify(Le)))}const Ce=new XMLSerializer().serializeToString(me),Re=new Blob([Ce],{type:"image/svg+xml;charset=utf-8"}),Ne=URL.createObjectURL(Re),ye=document.createElement("a");ye.href=Ne,ye.download=`${c.name}.svg`,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),URL.revokeObjectURL(Ne),l.success("SVG å¯¼å‡ºæˆåŠŸ"),Pt(!1)}catch(u){console.error("Image export failed:",u),l.error("å›¾ç‰‡å¯¼å‡ºå¤±è´¥")}}catch(t){l.error(`å¯¼å‡ºå¤±è´¥: ${t.message}`),console.error("å¯¼å‡ºå¤±è´¥:",t)}finally{Nt(!1)}}},Jn=async t=>{if(!c)throw new Error("æœªé€‰æ‹©é¡¹ç›®");const s=window.location.origin+c.jsUrl,n=await fetch(s);if(!n.ok)throw new Error(`Failed to fetch code: ${n.statusText}`);const a=await n.text();let i="";const u=`${window.location.origin}/${r}/${c.name}/hack.css`;try{const E=await fetch(u);E.ok&&(i=await E.text())}catch{}const m=async(E=!1)=>{const N=`${window.location.origin}/${r}/${c.name}`,me=["spec","prd"],H={};for(const Re of me){const Ne=`${N}/${Re}.md`;try{const ye=await fetch(Ne);if(ye.ok){const Le=await ye.text(),Je={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};H[Re]={name:Je[Re],content:Le}}}catch(ye){console.warn(`Failed to fetch ${Re}.md`,ye)}}if(E){const Re=`${r}/${c.name}`,Ne=`${window.location.origin}/api/source?path=${encodeURIComponent(Re)}`;try{const ye=await fetch(Ne);if(ye.ok){const Je=`\`\`\`tsx
${await ye.text()}
\`\`\`
`;H.code={name:"å‚è€ƒä»£ç ",content:Je}}}catch(ye){console.warn("Failed to fetch source code",ye)}}const fe=Object.keys(H);return fe.length>1?H:fe.length===1?H[fe[0]].content:null},x={time:Math.floor(Date.now()/1e3),config:{code:a,...r==="pages"?{isFullScreen:!0}:{},...i?{hackCss:i}:{}}};if(t==="codeAndDocs"||t==="codeAndDocsAndSource"){const N=await m(t==="codeAndDocsAndSource");N&&(x.config.spec=N)}return JSON.stringify(x,null,2)},Xn=ie||J.mode==="webEditorV2"?"webEditorV2":J.mode,qn=ie||J.mode==="webEditorV2"?z.current??void 0:void 0,Yn=c?mr(c,pe,Xn,{width:qn}):"",Zn=t=>{const s=window.location.origin+t.demoUrl;window.open(s,"_blank")},Qn=()=>{Ye("button",ze,void 0,"window")};return e.jsxs(xt,{style:{minHeight:"100vh"},children:[w,e.jsx("style",{children:`
                .resize-handle-right {
                    cursor: ew-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-right::before {
                    content: '';
                    position: absolute;
                    right: 50%;
                    top: 50%;
                    transform: translate(50%, -50%);
                    width: 2px;
                    height: 40px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-right:hover::before,
                .resize-handle-right:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 3px;
                    height: 50px;
                }
                .resize-handle-bottom {
                    cursor: ns-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottom::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    bottom: 50%;
                    transform: translate(-50%, 50%);
                    width: 40px;
                    height: 2px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottom:hover::before,
                .resize-handle-bottom:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 50px;
                    height: 3px;
                }
                .resize-handle-bottomRight {
                    cursor: nwse-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottomRight::before {
                    content: '';
                    position: absolute;
                    right: 0;
                    bottom: 0;
                    width: 12px;
                    height: 12px;
                    background: var(--ant-color-border);
                    border-radius: 0 0 6px 0;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottomRight:hover::before,
                .resize-handle-bottomRight:active::before {
                    background: var(--ant-color-border-secondary);
                    width: 16px;
                    height: 16px;
                }
                /* å®¹å™¨æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹æŸ„ */
                .ant-card-hoverable:hover .resize-handle-right::before,
                .ant-card-hoverable:hover .resize-handle-bottom::before,
                .ant-card-hoverable:hover .resize-handle-bottomRight::before {
                    background: var(--ant-color-border-secondary);
                }

                /* èœå•é¡¹ hover æ—¶æ˜¾ç¤ºæ›´å¤šæŒ‰é’® */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }

                /* ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ */
                @media (max-width: 768px) {
                    /* éšè— PC ç«¯çš„å®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: none !important;
                    }
                    
                    /* æ˜¾ç¤ºç§»åŠ¨ç«¯ç®€åŒ–å¸ƒå±€ */
                    .mobile-layout {
                        display: block !important;
                    }
                }

                @media (min-width: 769px) {
                    /* PC ç«¯æ˜¾ç¤ºå®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: block !important;
                    }
                    
                    /* éšè—ç§»åŠ¨ç«¯å¸ƒå±€ */
                    .mobile-layout {
                        display: none !important;
                    }
                }

                /* ç§»åŠ¨ç«¯åˆ—è¡¨æ ·å¼ */
                .mobile-item-card {
                    background: ${h?"#1f1f1f":"#fff"};
                    border: 1px solid ${h?"#303030":"#f0f0f0"};
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 12px;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .mobile-item-card:hover {
                    border-color: ${h?"#177ddc":"#1890ff"};
                    box-shadow: 0 2px 8px ${h?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.1)"};
                }

                .mobile-item-card:active {
                    transform: scale(0.98);
                }

                .mobile-item-title {
                    font-size: 16px;
                    font-weight: 500;
                    color: ${h?"#fff":"#000"};
                    margin-bottom: 4px;
                }

                .mobile-item-name {
                    font-size: 12px;
                    color: ${h?"#8c8c8c":"#999"};
                }
            `}),e.jsxs("div",{className:"pc-layout",children:[e.jsx(tr,{collapsed:q,setCollapsed:Z,selectedItem:c,viewMode:pe,setViewMode:at,activeTab:r,selectedDeviceId:U,setSelectedDeviceId:G,deviceSegmentOptions:wn,handleOpenInspect:Ln,handleOpenWebEditor:On,handleExitWebEditor:is,handleSaveWebEditor:_n,handleEnableTextEdit:Mn,handleSaveTextEdit:()=>ls(!1),handleExitTextEdit:Bn,handleRefreshElement:Dn,handleCopyLocalLink:hn,handleCopyLANLink:fn,handleDownloadZip:mn,getLANUrl:ds,qrCodeVisible:Qe,setQrCodeVisible:ke,wsClients:Wn,checkConnection:_t,handlePushToFigma:Vn,handleDownloadFigmaJson:Fn,setIsExportModalOpen:Pt,handleOpenIdeFile:xn,handleOpenProjectInIDE:gn,preferredIDE:be,onPreferredIDEChange:De,isDarkMode:h,setIsDarkMode:v,currentSpecDocKey:it,textEditState:S,textEditAvailable:Un,editorMode:J.mode,handleRefreshEditorStatus:Ge,onSettingsSaved:()=>{Ze.getConfig().then(t=>{var n,a;const s=(n=t==null?void 0:t.automation)==null?void 0:n.defaultPromptClient;Ae(s==="claude"||s==="cursor"||s==="codex"?s:null),De(((a=t==null?void 0:t.automation)==null?void 0:a.defaultIDE)||null)}).catch(()=>{Ae(null),De(null)})},assistantEnabled:!0,assistantVisible:he,onToggleAssistant:pn}),e.jsxs(xt,{children:[e.jsx(qo,{collapsed:q,loading:se,activeTab:r,handleTabChange:as,data:P,searchText:oe,setSearchText:F,filteredItems:bt,selectedItem:c,handleMenuClick:Rn,handleDownloadItemSource:Cn,handleRenameItem:$n,handleSetReference:En,handleUnsetReference:In,handleDuplicateItem:An,handleDeleteItem:kn,handleCopyItemPath:yn,setCreateDialogVisible:Qs,preferredPromptClient:ce,preferredIDE:be}),e.jsxs("div",{style:{display:"flex",flex:1,minWidth:0},children:[e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(rr,{containerRef:A,previewIframeRef:V,selectedItem:c,activeTab:r,currentDevice:Ie,displaySize:ft,scale:Q,elementIframeKey:Te,iframeUrl:Yn,elementIframeSize:je,setElementIframeSize:Se,viewMode:pe})}),he&&e.jsx(Ls,{size:{width:Math.min(Math.max(We,j),Rt),height:"100%"},minWidth:j,maxWidth:Rt,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(t,s,n)=>{const a=Math.min(Math.max(n.getBoundingClientRect().width,j),Rt);rt(a)},style:{borderLeft:`1px solid ${_.colorBorderSecondary}`,background:_.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:p,src:ze,title:"Axhub Genie",onLoad:()=>$(!0),style:{border:"none",width:"100%",height:"100%"}})})]})]}),e.jsx(lr,{visible:_s,onClose:un,activeTab:r,createName:Ms,setCreateName:en,createReference:Bs,setCreateReference:tn,createMode:Fs,setCreateMode:sn,generateAxure:Ws,setGenerateAxure:nn,referenceItems:Hs,selectedDocs:Xs,setSelectedDocs:an,availableDocs:qs,selectedThemes:Vs,setSelectedThemes:on,availableThemes:Gs,selectedDataAssets:Ys,setSelectedDataAssets:ln,availableDataAssets:Zs,selectedLibraries:Ks,setSelectedLibraries:rn,availableLibraries:Js,preferredPromptClient:ce,preferredIDE:be,buildCreatePrompt:cn,onAfterCreatePromptAction:dn}),e.jsx(Vo,{open:et,onClose:()=>Pt(!1),imageConfig:I,setImageConfig:Oe,onDimensionChange:jn,onSwapDimensions:vn,onDimensionBlur:Sn,isExporting:bn,onExport:Kn,onCopyConfig:Jn,activeTab:r,itemName:c==null?void 0:c.name,preferredPromptClient:ce,preferredIDE:be})]}),e.jsx("div",{className:"mobile-layout",style:{display:"none"},children:e.jsxs("div",{style:{padding:"16px",minHeight:"100vh",background:h?"#141414":"#f5f5f5"},children:[e.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsxs("h1",{style:{margin:0,fontSize:"24px",fontWeight:600,color:h?"#fff":"#000"},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})}),e.jsx(Y,{type:"default",icon:e.jsx(Qt,{}),onClick:Qn,children:"ç½‘é¡µåŠ©æ‰‹"})]}),e.jsx(Zt,{activeKey:r,onChange:t=>as(t),style:{marginBottom:"16px"},items:[{key:"pages",label:`é¡µé¢ (${P.pages.length})`,icon:e.jsx(nt,{})},{key:"elements",label:`å…ƒç´  (${P.elements.length})`,icon:e.jsx(Xt,{})}]}),e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Rs,{}),value:oe,onChange:t=>F(t.target.value),allowClear:!0,style:{marginBottom:"16px"}}),se?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(mt,{tip:"åŠ è½½ä¸­..."})}):e.jsx("div",{children:bt.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:h?"#8c8c8c":"#999"},children:["æš‚æ— ",r==="elements"?"å…ƒç´ ":"é¡µé¢"]}):bt.map(t=>e.jsxs("div",{className:"mobile-item-card",onClick:()=>Zn(t),children:[e.jsx("div",{className:"mobile-item-title",children:t.displayName}),e.jsx("div",{className:"mobile-item-name",children:t.name})]},t.name))})]})}),w,y]})}function br(){const[h,v]=o.useState(()=>{try{return localStorage.getItem(xs)==="true"}catch{return!1}}),d=b=>{v(b);try{localStorage.setItem(xs,String(b))}catch(T){console.error("Failed to save dark mode preference:",T)}};return e.jsx(zo,{theme:Fo(h),children:e.jsx(Oo,{children:e.jsx(wr,{isDarkMode:h,setIsDarkMode:d})})})}const jr=Uo.createRoot(document.getElementById("root"));jr.render(e.jsx(br,{}));
