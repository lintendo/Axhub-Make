import{P as st,a as Me,b as ms,c as xs,d as gs,e as ys,f as ws,S as bs,A as js,D as Bt,o as Ss}from"./chunks/PromptActionButton.js";import{I as Be,T as ft,r as o,s as H,j as e,M as It,ab as Qt,J as ht,u as we,F as Ct,S as Xe,a3 as vs,ac as so,ad as Ft,ae as $e,af as Gt,b as X,ag as $t,ah as St,t as ot,ai as no,l as Cs,aj as oo,o as nt,ak as Ts,a1 as ro,al as ao,L as pt,Q as Rs,am as Kt,d as Ds,an as io,ao as Jt,ap as Xt,P as lo,aq as qt,D as Et,O as co,H as Ps,N as uo,ar as ho,as as po,Z as he,at as Ns,au as Ls,h as Ce,i as fo,k as mo,m as kt,B as Wt,w as es,x as xo,e as Yt,y as go,z as yo,A as wo,E as bo,p as Zt,_ as jo,av as So,aw as vo,ax as Es,ay as Co,az as Eo,aA as Io,aB as $o,aC as ko,aD as Ao,aE as To,aF as Ro,aG as Us,aa as zs,aH as Do,U as Os,aI as Is,aJ as Po,aK as No,R as Lo,C as Uo,a as $s,aL as zo,a8 as Oo,a9 as _o,G as Mo,aM as Bo,g as Fo,aN as Wo}from"./chunks/vendor.js";import{g as Ho}from"./chunks/index.js";import{i as Vo}from"./chunks/bridge.js";import"./chunks/execute.js";const At=[{value:"cursor",label:"Cursor"},{value:"trae",label:"TRAE"},{value:"vscode",label:"Visual Studio Code"},{value:"trae_cn",label:"TRAE CN"},{value:"windsurf",label:"Windsurf"},{value:"kiro",label:"Kiro"},{value:"qoder",label:"Qoder"},{value:"antigravity",label:"Antigravity"}];At.map(h=>h.value);const _s=["vscode","cursor"],{TextArea:Go}=Be,{Text:tt}=ft,Ko=({open:h,onClose:E,imageConfig:c,setImageConfig:b,onDimensionChange:T,onSwapDimensions:k,onDimensionBlur:v,isExporting:z,onExport:O,onCopyConfig:ce,activeTab:N,itemName:Q,preferredPromptClient:q,preferredIDE:Y})=>{const f=N==="elements"?"å…ƒç´ ":"é¡µé¢",[w,l]=o.useState(null),[U,F]=o.useState(!1),[_,ne]=o.useState(!1),[Z,K]=H.useMessage(),[P,V]=o.useState("export"),[oe,ee]=o.useState(""),[D,W]=o.useState(""),[ie,i]=o.useState(!1);o.useEffect(()=>{(async()=>{if(D&&P==="copyConfig"){i(!0);try{if(!await M()){W(""),ee(""),i(!1);return}const J=await ce(D);ee(J)}catch{Z.error("åŠ è½½é…ç½®å¤±è´¥"),ee("")}finally{i(!1)}}})()},[D,P,ce,Z]),o.useEffect(()=>{h||(V("export"),W(""),ee(""))},[h]);const M=async()=>{if(!Q)return!0;ne(!0);try{const C=`${N}/${Q}`,re=await Me.reviewCode(C);return re.passed?!0:(l(re),F(!0),!1)}catch(C){return console.error("ä»£ç æ£€æŸ¥å¤±è´¥:",C),!0}finally{ne(!1)}},p=async()=>{await M()&&O()},j=async()=>{if(!oe){Z.warning("è¯·å…ˆé€‰æ‹©å¯¼å‡ºå†…å®¹");return}try{await navigator.clipboard.writeText(oe),Z.success("é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{Z.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å‰ªè´´æ¿æƒé™")}},y=C=>{C.target.select()},S=async()=>{if(!w)throw new Error("æ²¡æœ‰å¯ç”¨çš„æ£€æŸ¥ç»“æžœ");const C=w.issues.filter(le=>le.type==="error"),re=w.issues.filter(le=>le.type==="warning");let J=`ä»£ç æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·å¸®æˆ‘ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š

`;return J+=`æ–‡ä»¶ï¼š${w.file}

`,C.length>0&&(J+=`âŒ é”™è¯¯ (${C.length} ä¸ª):
`,C.forEach((le,xe)=>{J+=`
${xe+1}. [${le.rule}] ${le.message}
`,le.suggestion&&(J+=`   å»ºè®®: ${le.suggestion}
`)})),re.length>0&&(J+=`
âš ï¸ è­¦å‘Š (${re.length} ä¸ª):
`,re.forEach((le,xe)=>{J+=`
${xe+1}. [${le.rule}] ${le.message}
`,le.suggestion&&(J+=`   å»ºè®®: ${le.suggestion}
`)})),J};return e.jsxs(e.Fragment,{children:[K,e.jsx(It,{title:"å¯¼å‡ºåˆ° Axure",open:h,onCancel:E,footer:P==="export"?[e.jsx(X,{type:"primary",loading:z||_,onClick:p,children:"å¯¼å‡º"},"export")]:[e.jsx(X,{type:"primary",disabled:!oe,onClick:j,children:"å¤åˆ¶é…ç½®"},"copy")],width:800,children:e.jsx(Qt,{activeKey:P,onChange:V,items:[{key:"export",label:"å¯¼å‡ºå›¾ç‰‡",children:e.jsxs("div",{style:{display:"flex",gap:"20px",height:"400px"},children:[e.jsx("div",{style:{flex:1,border:"1px solid #f0f0f0",borderRadius:"8px",overflow:"hidden",background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:c.previewUrl?e.jsx("img",{src:c.previewUrl,alt:"Preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}):e.jsx(ht,{tip:"æ­£åœ¨ç”Ÿæˆé¢„è§ˆ..."})}),e.jsxs("div",{style:{width:"240px",display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å¯¼å‡ºå°ºå¯¸",e.jsx(we,{title:"è¿”å›ž Axure åŒå‡»å…ƒç´ å°±å¯ä»¥æ›¿æ¢å›¾ç‰‡ï¼ŒåŒå‡»å›¾ç‰‡å·¦ä¸Šè§’æˆ–è€…åœ¨æ ·å¼é¢æ¿é‡Œç‚¹å‡»è‡ªé€‚åº”å›¾ç‰‡å³å¯æ›´æ–°å›¾ç‰‡å°ºå¯¸",children:e.jsx(Ct,{style:{color:"#999",cursor:"help"}})})]}),e.jsxs(Xe,{children:[e.jsx(vs,{value:c.width,onChange:C=>T("width",C),onBlur:v,placeholder:"å®½",style:{width:100},min:1}),e.jsx(so,{onClick:k,style:{color:"#999",cursor:"pointer",fontSize:14}}),e.jsx(vs,{value:c.height,onChange:C=>T("height",C),onBlur:v,placeholder:"é«˜",style:{width:100},min:1})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å›¾ç‰‡å†…å®¹",e.jsx(we,{title:"æ ‡é¢˜å°é¢ä¾¿äºŽåœ¨ Axure å†…æ›´æ”¹å°ºå¯¸",children:e.jsx(Ct,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(Ft.Group,{value:c.contentType,onChange:C=>b(re=>({...re,contentType:C.target.value})),children:e.jsxs(Xe,{direction:"vertical",children:[e.jsxs(Ft,{value:"title",children:[f,"æ ‡é¢˜"]}),e.jsxs(Ft,{value:"screenshot",children:[f,"æˆªå›¾"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["åŒ…å«é…ç½®",e.jsx(we,{title:"è‹¥åŒ…å«é…ç½®ï¼Œä»…éœ€å¯¼å…¥å›¾ç‰‡åˆ° Axureï¼Œä¸€èˆ¬ä¸éœ€è¦å†å¤åˆ¶é…ç½®æˆ–è€…ä»£ç ",children:e.jsx(Ct,{style:{color:"#999",cursor:"help"}})})]}),e.jsx($e,{value:c.includeConfig,onChange:C=>b(re=>({...re,includeConfig:C})),style:{width:"100%"},options:[{label:"æ— ",value:"none"},{label:"åŽŸåž‹",value:"code"},{label:"åŽŸåž‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŽŸåž‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]})]})]})},{key:"copyConfig",label:"å¤åˆ¶é…ç½®",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"400px"},children:[e.jsx(Gt,{message:"å¯¼å‡ºæœ¬åœ° html æˆ–è€…å‘å¸ƒåˆ° Axure Cloud æ—¶è‹¥å›¾ç‰‡å¤±æ•ˆå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½",type:"info",showIcon:!0}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"å¯¼å‡ºå†…å®¹"}),e.jsx($e,{value:D||void 0,onChange:W,placeholder:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",style:{width:"100%"},options:[{label:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",value:"",disabled:!0},{label:"åŽŸåž‹",value:"code"},{label:"åŽŸåž‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŽŸåž‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]}),D&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"é…ç½®å†…å®¹"}),ie?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #d9d9d9",borderRadius:"6px"},children:e.jsx(ht,{tip:"æ­£åœ¨åŠ è½½é…ç½®..."})}):e.jsx(Go,{value:oe,readOnly:!0,onFocus:y,style:{flex:1,fontFamily:"monospace",fontSize:"12px"},placeholder:"é…ç½®å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"})]})]})}]})}),e.jsx(It,{title:"ä»£ç æ£€æŸ¥æœªé€šè¿‡",open:U,onCancel:()=>F(!1),width:600,footer:[e.jsx(X,{onClick:()=>F(!1),children:"å–æ¶ˆ"},"cancel"),e.jsx(st,{type:"primary",preferredClient:q,preferredIDE:Y,scene:`review-fix-${N}`,buildPrompt:S,getIdeTargetPath:()=>Q?`src/${N}/${Q}/index.tsx`:null,copySuccessMessage:"å¤åˆ¶æˆåŠŸ",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt",onAfterCopy:()=>F(!1)},"copy")],children:w&&e.jsxs("div",{style:{maxHeight:"500px",overflowY:"auto"},children:[e.jsx(Gt,{description:"ä»£ç ä¸ç¬¦åˆå¼€å‘è§„èŒƒï¼Œéœ€è¦ä¿®å¤åŽæ‰èƒ½å¯¼å‡º",type:"error",showIcon:!0,style:{marginBottom:"24px"}}),w.issues.filter(C=>C.type==="error").length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx($t,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(tt,{type:"danger",children:"é”™è¯¯ (å¿…é¡»ä¿®å¤)"})}),e.jsx(St,{size:"small",dataSource:w.issues.filter(C=>C.type==="error"),renderItem:C=>e.jsx(St.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(tt,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(tt,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]}),w.issues.filter(C=>C.type==="warning").length>0&&e.jsxs("div",{children:[e.jsx($t,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(tt,{type:"warning",children:"è­¦å‘Š (å»ºè®®ä¿®å¤)"})}),e.jsx(St,{size:"small",dataSource:w.issues.filter(C=>C.type==="warning"),renderItem:C=>e.jsx(St.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(tt,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(tt,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]})]})})]})},{Text:Ht}=ft,{useToken:Jo}=ot;function Xo({visible:h,onCancel:E,item:c,activeTab:b,preferredPromptClient:T,preferredIDE:k}){const{token:v}=Jo(),[z,O]=o.useState([]),[ce,N]=o.useState(!1),[Q,q]=o.useState(""),[Y,f]=o.useState(""),[w,l]=o.useState(!1),[U,F]=o.useState(!1),[_,ne]=o.useState(null),[Z,K]=o.useState(null),P=p=>{const j=p;let y="";if(j.filePath){const S=j.filePath.indexOf("src/");y=S>=0?j.filePath.substring(S):j.filePath}else y=`${b==="pages"?"src/pages":"src/elements"}/${p.name}`;return y=y.replace(/\/index\.(t|j)sx?$/i,""),y=y.replace(/^\/+/,""),y.startsWith("src/")&&(y=y.substring(4)),y},V=p=>{const j=new Date(p),y=S=>String(S).padStart(2,"0");return`${j.getFullYear()}/${y(j.getMonth()+1)}/${y(j.getDate())} ${y(j.getHours())}:${y(j.getMinutes())}:${y(j.getSeconds())}`},oe=p=>{const j=Math.floor((Date.now()-p)/1e3);let y=j/31536e3;return y>1?Math.floor(y)+" å¹´å‰":(y=j/2592e3,y>1?Math.floor(y)+" ä¸ªæœˆå‰":(y=j/86400,y>1?Math.floor(y)+" å¤©å‰":(y=j/3600,y>1?Math.floor(y)+" å°æ—¶å‰":(y=j/60,y>1?Math.floor(y)+" åˆ†é’Ÿå‰":"åˆšåˆš"))))},ee=async()=>{if(c){F(!0);try{const p=P(c);if(!p){H.error("æ— æ³•èŽ·å–æ–‡ä»¶è·¯å¾„"),F(!1);return}const j=await fetch(`/api/git/history?path=${encodeURIComponent(p)}`),y=await j.json();j.ok?(O(y.commits),N(y.hasUncommitted),q(y.uncommittedFiles)):H.error(y.error||"åŠ è½½ç‰ˆæœ¬åŽ†å²å¤±è´¥")}catch{H.error("åŠ è½½ç‰ˆæœ¬åŽ†å²å¤±è´¥")}finally{F(!1)}}};o.useEffect(()=>{h&&c&&ee()},[h,c]);const D=async p=>{if(c)try{const j=P(c),y=await fetch("/api/git/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:j,commitHash:p})}),S=await y.json();y.ok?(H.success("ç‰ˆæœ¬æ¢å¤æˆåŠŸ"),ee()):H.error(S.error||"ç‰ˆæœ¬æ¢å¤å¤±è´¥")}catch{H.error("ç‰ˆæœ¬æ¢å¤å¤±è´¥")}},W=async()=>{if(!c||!Y.trim()){H.warning("è¯·è¾“å…¥æäº¤ä¿¡æ¯");return}l(!0);try{const p=P(c),j=await fetch("/api/git/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:p,message:Y})}),y=await j.json();j.ok?(H.success("æäº¤æˆåŠŸ"),f(""),ee()):H.error(y.error||"æäº¤å¤±è´¥")}catch{H.error("æäº¤å¤±è´¥")}finally{l(!1)}},ie=async()=>{if(!c)throw new Error("è¯·é€‰æ‹©æ¡ç›®åŽå†æ‰§è¡Œ");const p=P(c);return`æˆ‘éœ€è¦æäº¤ä»¥ä¸‹ç›®å½•çš„æ›´æ”¹ï¼Œè¯·å¸®æˆ‘å¤„ç†ï¼š

ç›®æ ‡è·¯å¾„: src/${p}

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. ä½¿ç”¨ git status å’Œ git diff æŸ¥çœ‹è¯¥è·¯å¾„ä¸‹çš„å˜æ›´å†…å®¹ã€‚
2. åˆ†æžå˜æ›´ï¼Œç”Ÿæˆä¸€ä¸ªç®€æ´æ˜Žäº†çš„ä¸­æ–‡æäº¤ä¿¡æ¯ï¼ˆCommit Messageï¼‰ã€‚
3. å‘æˆ‘å±•ç¤ºå˜æ›´æ‘˜è¦å’Œå»ºè®®çš„æäº¤ä¿¡æ¯ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­ã€‚
4. èŽ·å¾—ç¡®è®¤åŽï¼Œæ‰§è¡Œï¼š
   git add src/${p}
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"

è¯·ç›´æŽ¥å¼€å§‹æ‰§è¡Œç¬¬ 1 æ­¥ã€‚`},i=async p=>{if(c){ne(p);try{const j=P(c),y=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:j,commitHash:p})}),S=await y.json();y.ok&&S.hasSpec&&S.specUrl?window.open(S.specUrl,"_blank"):S.hasSpec?H.error(S.error||"æ— æ³•è®¿é—®è§„æ ¼æ–‡æ¡£"):H.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰è§„æ ¼æ–‡æ¡£")}catch{H.error("åŠ è½½è§„æ ¼æ–‡æ¡£å¤±è´¥")}finally{ne(null)}}},M=async p=>{if(c){K(p);try{const j=P(c),y=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:j,commitHash:p})}),S=await y.json();y.ok&&S.hasPrototype&&S.prototypeUrl?window.open(S.prototypeUrl,"_blank"):S.hasPrototype?H.error(S.error||"æ— æ³•è®¿é—®åŽŸåž‹"):H.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰åŽŸåž‹æ–‡ä»¶")}catch{H.error("åŠ è½½åŽŸåž‹å¤±è´¥")}finally{K(null)}}};return e.jsx(It,{title:`ç‰ˆæœ¬ç®¡ç† - ${c==null?void 0:c.displayName}`,open:h,onCancel:E,footer:null,width:700,centered:!0,className:"version-dialog",styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingTop:12,paddingBottom:12}},destroyOnClose:!0,children:e.jsx(ht,{spinning:U,children:z.length===0&&!ce?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"æš‚æ— ç‰ˆæœ¬åŽ†å²"}):e.jsx(no,{mode:"left",items:[...ce?[{children:e.jsx("div",{className:"commit-item uncommitted",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Ht,{strong:!0,style:{fontSize:14,marginRight:8},children:"æœªæäº¤çš„æ›´æ”¹"}),e.jsx(Cs,{color:"warning",children:"æœªä¿å­˜"})]})}),e.jsxs("div",{style:{background:v.colorFillAlter,padding:12,borderRadius:8,border:`1px solid ${v.colorBorderSecondary}`},children:[e.jsx(Be,{placeholder:"æ‰‹åŠ¨è¾“å…¥æäº¤ä¿¡æ¯...",value:Y,onChange:p=>f(p.target.value),onPressEnter:W,style:{marginBottom:12}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,color:v.colorTextSecondary},children:Q?`${Q.split(`
`).filter(Boolean).length} ä¸ªæ–‡ä»¶å˜æ›´`:"æœ‰æ–‡ä»¶å˜æ›´"}),e.jsxs(Xe,{children:[e.jsx(st,{type:"default",preferredClient:T,preferredIDE:k,scene:`version-commit-${b}`,buildPrompt:ie,getIdeTargetPath:()=>c?`src/${P(c)}`:null,copySuccessMessage:"AI æŒ‡ä»¤å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´ç»™åŠ©æ‰‹",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"}),e.jsx(X,{type:"primary",size:"small",onClick:W,loading:w,disabled:!Y.trim(),children:"æäº¤"})]})]})]})]})}),color:"orange",dot:e.jsx("div",{style:{width:10,height:10,background:v.colorWarning,borderRadius:"50%",border:`2px solid ${v.colorBgContainer}`}})}]:[],...z.map((p,j)=>{const y=j===0&&!ce;return{children:e.jsx("div",{className:"commit-item",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{marginBottom:4,display:"flex",alignItems:"center"},children:[e.jsx(Ht,{strong:!0,style:{fontSize:14,marginRight:8},children:p.message}),y&&e.jsx(Cs,{color:"success",children:"å½“å‰ç‰ˆæœ¬"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:v.colorTextSecondary},children:[e.jsxs(Xe,{size:4,children:[e.jsx(oo,{size:20,style:{backgroundColor:v.colorPrimary,fontSize:12},children:p.author?p.author[0].toUpperCase():"U"}),e.jsx("span",{children:p.author})]}),e.jsx("span",{style:{color:v.colorBorder},children:"|"}),e.jsx(we,{title:V(p.timestamp),children:e.jsx("span",{style:{cursor:"help"},children:oe(p.timestamp)})}),e.jsx("span",{style:{color:v.colorBorder},children:"|"}),e.jsx(Ht,{code:!0,style:{fontSize:12,margin:0},children:p.hash.substring(0,7)})]})]}),!y&&e.jsxs(Xe,{size:0,children:[e.jsx(we,{title:"æŸ¥çœ‹è§„æ ¼æ–‡æ¡£",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(nt,{}),style:{color:v.colorTextSecondary},onClick:()=>i(p.hash),loading:_===p.hash})}),e.jsx(we,{title:"æŸ¥çœ‹åŽŸåž‹",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(Ts,{}),style:{color:v.colorTextSecondary},onClick:()=>M(p.hash),loading:Z===p.hash})}),e.jsx(ro,{title:"ç¡®è®¤æ¢å¤",description:"ç¡®å®šè¦æ¢å¤åˆ°æ­¤ç‰ˆæœ¬å—ï¼Ÿå½“å‰æœªæäº¤çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚",onConfirm:()=>D(p.hash),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(we,{title:"æ¢å¤æ­¤ç‰ˆæœ¬",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(ao,{}),style:{color:v.colorTextSecondary}})})})]}),y&&e.jsx(Xe,{size:0})]})}),color:y?"green":"gray",dot:y?e.jsx("div",{style:{width:10,height:10,background:v.colorSuccess,borderRadius:"50%",border:`2px solid ${v.colorBgContainer}`}}):void 0}})]})})})}const{Sider:qo}=pt,{useToken:Yo}=ot;function Zo({collapsed:h,loading:E,activeTab:c,handleTabChange:b,data:T,searchText:k,setSearchText:v,filteredItems:z,selectedItem:O,handleMenuClick:ce,handleDownloadItemSource:N,handleRenameItem:Q,handleSetReference:q,handleUnsetReference:Y,handleDuplicateItem:f,handleDeleteItem:w,handleCopyItemPath:l,setCreateDialogVisible:U,preferredPromptClient:F,preferredIDE:_}){const{token:ne}=Yo(),[Z,K]=o.useState(!1),[P,V]=o.useState(null),oe=D=>{V(D),K(!0)},ee=o.useMemo(()=>z.map(D=>{const W=O&&O.name===D.name,ie=[{key:"rename",label:"é‡å‘½å",icon:e.jsx(Rs,{})},{key:"duplicate",label:"åˆ›å»ºå‰¯æœ¬",icon:e.jsx(Kt,{})},{key:"copy-path",label:"å¤åˆ¶è·¯å¾„",icon:e.jsx(Ds,{})},{type:"divider"},{key:"version-management",label:"ç‰ˆæœ¬ç®¡ç†",icon:e.jsx(io,{})},{key:"download-source",label:"å¯¼å‡º ZIP",icon:e.jsx(Jt,{})},{type:"divider"},...D.isReference?[{key:"unset-reference",label:"å–æ¶ˆå‚è€ƒ",icon:e.jsx(Xt,{})}]:[{key:"set-reference",label:"è®¾ç½®ä¸ºå‚è€ƒ",icon:e.jsx(Xt,{})}],{key:"delete",label:`åˆ é™¤${c==="elements"?"å…ƒç´ ":"é¡µé¢"}`,icon:e.jsx(lo,{}),danger:!0,disabled:D.isReference}];return{key:D.name,label:e.jsxs("div",{className:`menu-item-wrapper ${W?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.displayName})}),e.jsx(Et,{trigger:["click"],menu:{items:ie,onClick:({key:i})=>{i==="download-source"?N(D):i==="rename"?Q(D):i==="duplicate"?f(D):i==="copy-path"?l(D):i==="version-management"?oe(D):i==="set-reference"?q(D):i==="unset-reference"?Y(D):i==="delete"&&w(D)}},children:e.jsx(X,{type:"text",size:"small",className:"more-btn",icon:e.jsx(co,{}),onClick:i=>{i.stopPropagation()}})})]}),icon:c==="elements"?e.jsx(qt,{}):e.jsx(nt,{})}}),[z,c,O,N,Q,q,Y,w,l,f]);return e.jsxs(qo,{trigger:null,collapsible:!0,collapsed:h,width:240,collapsedWidth:0,style:{background:ne.colorBgContainer,borderRight:`1px solid ${ne.colorBorder}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:[e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!h&&e.jsxs(e.Fragment,{children:[e.jsx(Qt,{activeKey:c,size:"small",centered:!0,onChange:D=>b(D),items:[{key:"pages",label:`é¡µé¢ (${T.pages.length})`,icon:e.jsx(nt,{})},{key:"elements",label:`å…ƒç´  (${T.elements.length})`,icon:e.jsx(qt,{})}]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Ps,{}),value:k,onChange:D=>v(D.target.value),allowClear:!0,style:{flex:1}})})]})}),E?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(ht,{tip:"åŠ è½½ä¸­..."})}):e.jsxs(e.Fragment,{children:[e.jsx(uo,{mode:"inline",selectedKeys:O?[O.name]:[],items:ee,onClick:ce,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!h&&e.jsx(ho,{icon:e.jsx(po,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:()=>U(!0),tooltip:c==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢"})]}),e.jsx(Xo,{visible:Z,onCancel:()=>K(!1),item:P,activeTab:c,preferredPromptClient:F,preferredIDE:_})]})}const{Title:Vt}=ft;function Qo({open:h,onClose:E,onSaved:c}){const[b]=he.useForm(),[T,k]=o.useState(!1),[v,z]=o.useState([]),[O,ce]=o.useState([]),[N,Q]=o.useState(!1);o.useEffect(()=>{h&&(q(),Y())},[h]);const q=async()=>{var w,l,U,F,_,ne,Z,K;try{const P=await fetch("/api/config");if(!P.ok)throw new Error("Failed to load config");const V=await P.json();b.setFieldsValue({host:V.server.host||"localhost",allowLAN:V.server.allowLAN!==!1,enableCommandAPI:V.server.enableCommandAPI||!1,projectName:((w=V.projectInfo)==null?void 0:w.name)||void 0,projectDescription:((l=V.projectInfo)==null?void 0:l.description)||void 0,defaultDoc:((U=V.projectDefaults)==null?void 0:U.defaultDoc)||void 0,defaultTheme:((F=V.projectDefaults)==null?void 0:F.defaultTheme)||void 0,defaultPromptClient:((_=V.automation)==null?void 0:_.defaultPromptClient)??"",defaultIDE:((ne=V.automation)==null?void 0:ne.defaultIDE)??"",assistantWebBaseUrl:((Z=V.assistant)==null?void 0:Z.webBaseUrl)??"",assistantApiBaseUrl:((K=V.assistant)==null?void 0:K.apiBaseUrl)??""})}catch(P){console.error("Error loading config:",P),H.error("åŠ è½½é…ç½®å¤±è´¥")}},Y=async()=>{Q(!0);try{const[w,l]=await Promise.all([fetch("/api/docs"),fetch("/api/themes")]);if(w.ok){const U=await w.json();z(Array.isArray(U)?U:[])}if(l.ok){const U=await l.json();ce(Array.isArray(U)?U:[])}}catch(w){console.error("Error loading assets:",w)}finally{Q(!1)}},f=async()=>{try{const w=await b.validateFields();k(!0);const l=await fetch("/api/config"),U=l.ok?await l.json():{server:{host:"localhost",port:51720,allowLAN:!0}},F={server:{host:w.host,port:U.server.port||51720,allowLAN:w.allowLAN,enableCommandAPI:w.enableCommandAPI||!1},projectInfo:{name:w.projectName??null,description:w.projectDescription??null},projectDefaults:{defaultDoc:w.defaultDoc??null,defaultTheme:w.defaultTheme??null},automation:{defaultPromptClient:w.defaultPromptClient?w.defaultPromptClient:null,defaultIDE:w.defaultIDE?w.defaultIDE:null},assistant:{webBaseUrl:w.assistantWebBaseUrl?w.assistantWebBaseUrl:null,apiBaseUrl:w.assistantApiBaseUrl?w.assistantApiBaseUrl:null}},_=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});if(!_.ok){const Z=await _.json();throw new Error(Z.error||"Failed to save config")}const ne=await _.json();H.success(ne.message||"é…ç½®å·²ä¿å­˜"),c==null||c(),E()}catch(w){console.error("Error saving config:",w),H.error(w.message||"ä¿å­˜é…ç½®å¤±è´¥")}finally{k(!1)}};return e.jsx(Ns,{title:"é¡¹ç›®è®¾ç½®",open:h,onClose:E,width:600,extra:e.jsxs(Xe,{children:[e.jsx(X,{onClick:E,children:"å–æ¶ˆ"}),e.jsx(X,{type:"primary",onClick:f,loading:T,children:"ä¿å­˜"})]}),children:e.jsxs(he,{form:b,layout:"vertical",initialValues:{host:"localhost",allowLAN:!0,enableCommandAPI:!1,projectName:void 0,projectDescription:void 0,defaultDoc:void 0,defaultTheme:void 0,defaultPromptClient:"",defaultIDE:"",assistantWebBaseUrl:"",assistantApiBaseUrl:""},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Vt,{level:5,style:{marginBottom:16},children:"é¡¹ç›®ç”Ÿæˆé…ç½®"}),e.jsx(Gt,{type:"info",showIcon:!0,message:"é¡¹ç›®ä¿¡æ¯å°†ä½œä¸º AI ç”Ÿæˆä¸Žå¯¹é½çš„å…³é”®å‚è€ƒï¼Œéœ€è¦é‡å¯ç¼–è¾‘å™¨æ‰ç”Ÿæ•ˆã€‚",style:{marginBottom:16}}),e.jsx(he.Item,{label:"é¡¹ç›®åç§°",name:"projectName",tooltip:"ç”¨äºŽ AI ç†è§£é¡¹ç›®å®šä½ä¸Žäº§å‡ºé£Žæ ¼",children:e.jsx(Be,{placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°",maxLength:20})}),e.jsx(he.Item,{label:"é¡¹ç›®ç®€ä»‹",name:"projectDescription",tooltip:"ç®€è¦æè¿°é¡¹ç›®èƒŒæ™¯ã€ç›®æ ‡ç”¨æˆ·ä¸Žæ ¸å¿ƒåœºæ™¯",children:e.jsx(Be.TextArea,{placeholder:"ä¾‹å¦‚ï¼šé¢å‘è¿è¥äººå‘˜çš„æ´»åŠ¨é…ç½®åŽå°ï¼Œå¼ºè°ƒé«˜æ•ˆé…ç½®ä¸Žç¨³å®šäº¤ä»˜",rows:2,maxLength:60,showCount:!0})}),e.jsx(he.Item,{label:"é¡¹ç›®æ€»æ–‡æ¡£",name:"defaultDoc",tooltip:"ä»Žâ€œèµ„äº§ç®¡ç†-æ–‡æ¡£â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤å‚è€ƒæ–‡æ¡£",children:e.jsx($e,{allowClear:!0,loading:N,placeholder:"è¯·é€‰æ‹©é¡¹ç›®æ€»æ–‡æ¡£",options:v.map(w=>({value:w.name,label:w.displayName||w.name})),showSearch:!0,filterOption:(w,l)=>String((l==null?void 0:l.label)||"").toLowerCase().includes(w.toLowerCase())})}),e.jsx(he.Item,{label:"é»˜è®¤ä¸»é¢˜",name:"defaultTheme",tooltip:"ä»Žâ€œèµ„äº§ç®¡ç†-ä¸»é¢˜â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤ä¸»é¢˜",children:e.jsx($e,{allowClear:!0,loading:N,placeholder:"è¯·é€‰æ‹©é»˜è®¤ä¸»é¢˜",options:O.map(w=>({value:w.name,label:w.displayName||w.name})),showSearch:!0,filterOption:(w,l)=>String((l==null?void 0:l.label)||"").toLowerCase().includes(w.toLowerCase())})})]}),e.jsx($t,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Vt,{level:5,style:{marginBottom:16},children:"è‡ªåŠ¨æ‰§è¡Œ"}),e.jsx(he.Item,{label:"ä¼˜å…ˆä½¿ç”¨ Axhub Genie",name:"defaultPromptClient",tooltip:"å¯ä»¥åœ¨ç½‘é¡µä¸Šè§£å†³ä¸€äº›ç®€å•çš„é—®é¢˜",children:e.jsx($e,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"å¦"},{value:"claude",label:"ClaudeCode"},{value:"cursor",label:"Cursor"},{value:"codex",label:"Codex"}]})}),e.jsx(he.Item,{label:"ä¸»è¦ IDE",name:"defaultIDE",tooltip:"é…ç½®åŽï¼Œç›¸å…³æ“ä½œä¼šå…ˆè‡ªåŠ¨æ‰“å¼€å¯¹åº” IDEã€‚",children:e.jsx($e,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"æ— "},...At]})})]}),e.jsx($t,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Vt,{level:5,style:{marginBottom:16},children:"æœåŠ¡å™¨é…ç½®"}),e.jsx(he.Item,{label:"ä¸»æœºåœ°å€",name:"host",rules:[{required:!0,message:"è¯·è¾“å…¥ä¸»æœºåœ°å€"}],tooltip:"æœåŠ¡å™¨å¯åŠ¨çš„åŸŸåæˆ– IP åœ°å€",children:e.jsx(Be,{placeholder:"localhost"})}),e.jsx(he.Item,{label:"å…è®¸å±€åŸŸç½‘è®¿é—®",name:"allowLAN",valuePropName:"checked",tooltip:"å¼€å¯åŽï¼Œå±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡å¯ä»¥è®¿é—®æ­¤æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šå¯èƒ½å­˜åœ¨å®‰å…¨é£Žé™©ï¼Œè¯·ç¡®ä¿åœ¨å¯ä¿¡ç½‘ç»œçŽ¯å¢ƒä¸­ä½¿ç”¨",children:e.jsx(Ls,{})})]})]})})}const{Header:er}=pt,{useToken:tr}=ot,sr=h=>e.jsx("span",{role:"img","aria-label":"figma",className:"anticon anticon-figma",...h,children:e.jsxs("svg",{fill:"currentColor",fillRule:"evenodd",height:"1em",width:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[e.jsx("title",{children:"Figma"}),e.jsx("path",{clipRule:"evenodd",d:"M6.082 8.241C4.83 7.441 4 6.057 4 4.483 4 2.007 6.05 0 8.578 0h7.844C18.95 0 21 2.007 21 4.483c0 1.574-.829 2.959-2.082 3.758C20.17 9.041 21 10.426 21 12c0 2.476-2.05 4.483-4.578 4.483h-.084A4.615 4.615 0 0113.24 15.3v4.176C13.24 21.98 11.145 24 8.599 24 6.076 24 4 21.998 4 19.517c0-1.574.829-2.959 2.082-3.758C4.829 14.959 4 13.574 4 12c0-1.574.829-2.959 2.082-3.759zM13.24 12c0 1.676 1.387 3.034 3.098 3.034h.084c1.711 0 3.099-1.358 3.099-3.034 0-1.676-1.388-3.034-3.1-3.034h-.083c-1.71 0-3.098 1.358-3.098 3.034zm-1.48-3.034H8.578C6.867 8.966 5.48 10.324 5.48 12c0 1.672 1.382 3.029 3.089 3.034H11.76V8.966zm-3.182 7.517h-.01c-1.707.005-3.089 1.362-3.089 3.034 0 1.67 1.403 3.034 3.12 3.034 1.74 0 3.161-1.381 3.161-3.075v-2.993H8.578zm3.182-8.966H8.578c-1.711 0-3.099-1.358-3.099-3.034 0-1.676 1.388-3.034 3.1-3.034h3.181v6.068zm4.662 0H13.24V1.45h3.182c1.711 0 3.099 1.358 3.099 3.034 0 1.676-1.388 3.034-3.1 3.034z"})]})});function nr({collapsed:h,setCollapsed:E,selectedItem:c,viewMode:b,setViewMode:T,activeTab:k,selectedDeviceId:v,setSelectedDeviceId:z,deviceSegmentOptions:O,handleOpenInspect:ce,handleOpenWebEditor:N,handleExitWebEditor:Q,handleSaveWebEditor:q,handleEnableTextEdit:Y,handleSaveTextEdit:f,handleExitTextEdit:w,handleRefreshElement:l,handleCopyLocalLink:U,handleCopyLANLink:F,handleDownloadZip:_,getLANUrl:ne,qrCodeVisible:Z,setQrCodeVisible:K,wsClients:P,checkConnection:V,handlePushToFigma:oe,handleDownloadFigmaJson:ee,setIsExportModalOpen:D,handleOpenIdeFile:W,handleOpenProjectInIDE:ie,preferredIDE:i,onPreferredIDEChange:M,isDarkMode:p,setIsDarkMode:j,currentSpecDocKey:y="spec",textEditState:S,textEditAvailable:C,editorMode:re="none",handleRefreshEditorStatus:J,onSettingsSaved:le,assistantEnabled:xe=!1,assistantVisible:Ee=!1,onToggleAssistant:Re}){const[Fe,Le]=Ce.useState(null),[ue,je]=Ce.useState(!1),[Se,ke]=Ce.useState(!0),[pe,qe]=Ce.useState(!1),{token:L}=tr(),be=re==="webEditorV2";Ce.useEffect(()=>{let m=!1;return fetch("/api/version").then(R=>R.ok?R.json():Promise.reject(new Error("Request failed"))).then(R=>{if(m)return;const B=typeof(R==null?void 0:R.version)=="string"?R.version:null;Le(B)}).catch(()=>{m||Le(null)}),()=>{m=!0}},[]),Ce.useEffect(()=>{let m=!1;return fetch("/api/config").then(R=>R.ok?R.json():Promise.reject(new Error("Request failed"))).then(R=>{var B;m||ke(((B=R==null?void 0:R.server)==null?void 0:B.allowLAN)!==!1)}).catch(()=>{m||ke(!0)}),()=>{m=!0}},[]),P.some(m=>_s.includes(m.type));const Ye=i||At[0].value,ge=m=>m==="cursor"?e.jsx(Eo,{size:16,color:L.colorText}):m==="trae"||m==="trae_cn"?e.jsx(Io,{size:16,color:L.colorText}):m==="windsurf"?e.jsx($o,{size:16,color:L.colorText}):m==="vscode"?e.jsx(ko,{size:16,color:L.colorText}):m==="antigravity"?e.jsx(Ao,{size:16,color:L.colorText}):m==="kiro"?e.jsx(To,{size:16,color:L.colorText}):m==="qoder"?e.jsx(Ro,{size:16,color:L.colorText}):e.jsx(Us,{}),We=async m=>{var de,se,mt;const R=await fetch("/api/config");if(!R.ok)throw new Error("åŠ è½½é…ç½®å¤±è´¥ï¼Œæ— æ³•ä¿å­˜ä¸»åŠ› IDE");const B=await R.json(),ae={...B,server:{host:((de=B==null?void 0:B.server)==null?void 0:de.host)||"localhost",allowLAN:((se=B==null?void 0:B.server)==null?void 0:se.allowLAN)!==!1,enableCommandAPI:((mt=B==null?void 0:B.server)==null?void 0:mt.enableCommandAPI)||!1},automation:{...(B==null?void 0:B.automation)||{},defaultIDE:m}},te=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ae)});if(!te.ok){const Ue=await te.json().catch(()=>({}));throw new Error((Ue==null?void 0:Ue.error)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥")}M==null||M(m)},Qe=async m=>{if(!pe){qe(!0);try{await We(m)}catch(R){H.warning((R==null?void 0:R.message)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥ï¼Œæœ¬æ¬¡ç»§ç»­æ‰“å¼€")}try{await Promise.resolve(ie(m))}finally{qe(!1)}}},Ae=[{type:"group",label:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:At.map(m=>({key:m.value,label:m.label,icon:ge(m.value)}))}],u=m=>e.jsx(we,{title:m,children:e.jsx(Et.Button,{size:"small",type:"default",loading:pe,menu:{items:Ae,onClick:({key:R})=>{Qe(R)}},onClick:()=>{Qe(Ye)},children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6},children:[ge(Ye),"æ‰“å¼€é¡¹ç›®"]})})});return e.jsxs(er,{hasSider:!0,style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:L.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${L.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[e.jsx(X,{type:"text",icon:h?e.jsx(fo,{}):e.jsx(mo,{}),onClick:()=>E(!h),style:{fontSize:"16px",height:40}}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:L.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx(kt,{value:b,size:"small",style:{fontSize:"12px"},onChange:m=>T(m),options:[{label:"åŽŸåž‹",value:"demo",icon:e.jsx(Ts,{})},{label:"æ–‡æ¡£",value:"spec",icon:e.jsx(Xt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[u("æ‰“å¼€é¡¹ç›®"),xe&&e.jsx(we,{title:Ee?"å…³é—­ Axhub Genie":"æ‰“å¼€ Axhub Genie",children:e.jsx(Wt,{dot:!0,status:Ee?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:Ee?"inline-flex":"none"}},children:e.jsx(X,{size:"small",type:"text",icon:e.jsx(es,{}),onClick:Re})})}),e.jsx(Et,{menu:{items:[{key:"assets",label:"èµ„äº§ç®¡ç†",icon:e.jsx(nt,{}),onClick:()=>window.open(new URL("/assets.html",window.location.origin).toString(),"_blank")},{key:"settings",label:"é¡¹ç›®è®¾ç½®",icon:e.jsx(Yt,{}),onClick:()=>je(!0)},{key:"theme",label:p?"æµ…è‰²æ¨¡å¼":"æ·±è‰²æ¨¡å¼",icon:p?e.jsx(go,{}):e.jsx(yo,{}),onClick:()=>j(!p)},{type:"divider"},{key:"help",label:"å¸®åŠ©ä¸­å¿ƒ",icon:e.jsx(wo,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"åŸ¹è®­æœåŠ¡",icon:e.jsx(bo,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub å®˜ç½‘",icon:e.jsx(Yt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"å½“å‰ç‰ˆæœ¬",icon:e.jsx(Ct,{}),extra:e.jsx("span",{style:{fontSize:12,color:L.colorTextSecondary},children:Fe?`v${Fe}`:"-"})}]},placement:"bottomRight",children:e.jsx(X,{size:"small",type:"text",icon:e.jsx(xo,{})})})]}),(c||b==="spec")&&e.jsx("div",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center"},children:e.jsx(Xe,{size:"small",children:b==="spec"?e.jsx(e.Fragment,{children:e.jsx(we,{title:`åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ${y==="prd"?"PRD":"SPEC"} æ–‡æ¡£`,children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(Zt,{}),onClick:W})})}):c&&e.jsxs(e.Fragment,{children:[k==="pages"&&!be&&e.jsx(kt,{value:v,size:"small",shape:"round",onChange:m=>z(m),options:O}),e.jsx(we,{title:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(Zt,{}),onClick:W})}),e.jsx(we,{title:be?"é€€å‡ºå¿«é€Ÿç¼–è¾‘":"å¿«é€Ÿç¼–è¾‘",children:e.jsx(Wt,{dot:!0,status:be?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:be?"inline-flex":"none"}},children:e.jsx(X,{type:"text",size:"small",disabled:!c,onClick:()=>be?Q():N(),icon:e.jsx(Rs,{})})})}),e.jsx(we,{title:"åˆ·æ–°",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(jo,{}),onClick:l})}),e.jsx(So,{content:e.jsxs("div",{style:{width:160},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx(X,{type:"text",icon:e.jsx(Kt,{}),onClick:U,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶æœ¬åœ°é“¾æŽ¥"}),Se&&e.jsx(X,{type:"text",icon:e.jsx(Kt,{}),onClick:F,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶å±€åŸŸç½‘é“¾æŽ¥"}),e.jsx(X,{type:"text",icon:e.jsx(Es,{}),disabled:!0,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å‘å¸ƒåŽŸåž‹"})]}),Se&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:1,background:L.colorBorder,margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 0px 4px"},children:[e.jsx(Co,{value:ne(),size:128,bordered:!1,style:{marginBottom:8}}),e.jsx(ft.Text,{type:"secondary",style:{fontSize:12,textAlign:"center"},children:"åŒ WiFi çš„æ‰‹æœºæ‰«ç é¢„è§ˆ"})]})]})]}),trigger:"click",placement:"bottomRight",open:Z,onOpenChange:K,arrow:!1,children:e.jsx(we,{title:"åˆ†äº«",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(vo,{})})})}),e.jsx(Et,{trigger:["click"],placement:"bottomCenter",onOpenChange:m=>{m&&V()},menu:{items:[{key:"push",label:"ä¸€é”®æŽ¨é€",extra:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Wt,{status:P.some(m=>m.type==="figma")?"success":"default"}),e.jsx("span",{style:{marginLeft:4},children:P.some(m=>m.type==="figma")?"å·²è¿žæŽ¥":"æœªè¿žæŽ¥"})]}),icon:e.jsx(Es,{}),disabled:!P.some(m=>m.type==="figma")},{type:"divider"},{key:"download-json",label:"ä¸‹è½½ JSON",icon:e.jsx(Jt,{})},{key:"download-axure",label:"ä¸‹è½½ JSON",extra:"é€‚é… Axure",icon:e.jsx(nt,{})}],onClick:({key:m})=>{m==="push"?oe():m==="download-json"?ee(!0):m==="download-axure"&&ee(!1)}},children:e.jsx(we,{trigger:["click","hover"],title:"å¯¼å‡ºåˆ° Figma",children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(sr,{})})})}),e.jsx(X,{type:"primary",size:"small",style:{fontSize:"12px"},icon:e.jsx(Jt,{}),onClick:()=>{D(!0)},children:"å¯¼å‡ºåˆ° Axure"})]})})}),e.jsx(Qo,{open:ue,onClose:()=>je(!1),onSaved:()=>{fetch("/api/config").then(m=>m.ok?m.json():Promise.reject(new Error("Request failed"))).then(m=>{var R;return ke(((R=m==null?void 0:m.server)==null?void 0:R.allowLAN)!==!1)}).catch(()=>{}),le==null||le()}})]})}const or=({width:h,height:E,children:c,scale:b=1})=>e.jsx("div",{style:{position:"relative",padding:"12px",background:"#1f1f1f",borderRadius:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.2)",border:"4px solid #333",display:"flex",flexDirection:"column",transform:`scale(${b})`,transformOrigin:"center center"},children:e.jsx("div",{style:{width:h,height:E,background:"#fff",borderRadius:"32px",overflow:"hidden",position:"relative"},children:c})}),{Content:rr}=pt,{useToken:ar}=ot;function ir({containerRef:h,previewIframeRef:E,selectedItem:c,activeTab:b,currentDevice:T,displaySize:k,scale:v,elementIframeKey:z,iframeUrl:O,elementIframeSize:ce,setElementIframeSize:N,viewMode:Q}){const{token:q}=ar();return e.jsx(rr,{ref:h,style:{background:q.colorBgLayout,position:"relative",flex:1,minWidth:0,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:c?Q==="spec"?e.jsx("iframe",{ref:E,src:O,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},z):b==="pages"&&T.id!=="desktop"?e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(or,{width:k.width,height:k.height,scale:v,children:e.jsx("iframe",{ref:E,src:O,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},z)})}):b==="elements"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:e.jsx("div",{style:{position:"relative",display:"inline-block"},children:e.jsx(zs,{size:ce,onResize:(Y,f,w)=>{if(w){const l=w.getBoundingClientRect();N({width:l.width,height:l.height})}},minWidth:50,minHeight:50,bounds:"window",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},handleStyles:{right:{width:"8px",right:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottom:{height:"8px",bottom:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottomRight:{width:"12px",height:"12px",right:"-6px",bottom:"-6px",background:"transparent",borderRadius:"0 0 6px 0",transition:"all 0.2s"}},handleClasses:{right:"resize-handle-right",bottom:"resize-handle-bottom",bottomRight:"resize-handle-bottomRight"},style:{border:`1px solid ${q.colorBorder}`,borderRadius:6,overflow:"hidden",background:q.colorBgContainer,boxShadow:q.boxShadow,transition:"box-shadow 0.2s"},className:"ant-card-hoverable",children:e.jsx("iframe",{ref:E,src:O,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},z)})})}):e.jsx("iframe",{ref:E,src:O,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},z):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:q.colorTextSecondary},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Do,{style:{fontSize:"64px",marginBottom:"16px"}}),e.jsxs("div",{style:{fontSize:"16px"},children:["è¯·ä»Žå·¦ä¾§é€‰æ‹©ä¸€ä¸ª",b==="elements"?"å…ƒç´ ":"é¡µé¢"]})]})})})}const{Dragger:lr}=Os,{Text:ks,Title:cr}=ft;function dr({visible:h,onClose:E,activeTab:c,createName:b,setCreateName:T,createReference:k,setCreateReference:v,createMode:z,setCreateMode:O,generateAxure:ce,setGenerateAxure:N,referenceItems:Q,selectedThemes:q,setSelectedThemes:Y,availableThemes:f,selectedLibraries:w,setSelectedLibraries:l,availableLibraries:U,selectedDocs:F,setSelectedDocs:_,availableDocs:ne,selectedDataAssets:Z,setSelectedDataAssets:K,availableDataAssets:P,preferredPromptClient:V,preferredIDE:oe,buildCreatePrompt:ee,onAfterCreatePromptAction:D}){const{token:W}=ot.useToken(),[ie,i]=o.useState(!0),[M,p]=o.useState("create"),[j,y]=o.useState("make"),[S,C]=o.useState("zip"),[re,J]=o.useState([]),[le,xe]=o.useState(!1),[Ee,Re]=o.useState(null),Fe=o.useRef(null);o.useEffect(()=>{h&&(i(!0),p("create"),y("make"),C("zip"),J([]),xe(!1),Re(null))},[h]);const Le=u=>{y(u),C("zip"),J([]),Re(null)},ue=u=>["make","axhub","google_stitch"].includes(u),je=u=>["axure_prototype","web_page"].includes(u),Se=async u=>{const{file:m,onSuccess:R,onError:B}=u,ae=m instanceof File?m:m.originFileObj,te=new FormData;te.append("file",ae,ae.name),te.append("uploadType",j),te.append("targetType",c),te.append("uploadMode","zip"),console.log("[å‰ç«¯] customRequest ä¸Šä¼ å‚æ•°:",{uploadType:j,targetType:c,fileName:ae.name,fileSize:ae.size}),xe(!0);try{const de=await fetch("/api/upload",{method:"POST",body:te}),se=await de.json();console.log("[å‰ç«¯] æœåŠ¡å™¨å“åº”:",se),de.ok&&se.success?(Re(se),R(null,m),ue(j)?(H.success(se.message||"ä¸Šä¼ å¹¶è§£åŽ‹æˆåŠŸï¼"),setTimeout(()=>{E(),window.location.reload()},1500)):H.success("æ–‡ä»¶å·²è§£åŽ‹ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):(console.error("[å‰ç«¯] ä¸Šä¼ å¤±è´¥:",se),H.error(se.error||"ä¸Šä¼ å¤±è´¥"),B(new Error(se.error||"ä¸Šä¼ å¤±è´¥")))}catch(de){console.error("[å‰ç«¯] ä¸Šä¼ é”™è¯¯:",de),H.error("ä¸Šä¼ å¤±è´¥: "+de.message),B(de)}finally{xe(!1)}},ke=u=>{Fe.current&&window.clearTimeout(Fe.current),Fe.current=window.setTimeout(()=>{pe(u)},250)},pe=async u=>{if(le)return;const m=u.map(te=>te.originFileObj).filter(te=>!!te);if(m.length===0){H.error("ä¸Šä¼ æ–‡ä»¶å¤¹ä¸ºç©º");return}const R=new FormData;R.append("uploadType",j),R.append("targetType",c),R.append("uploadMode","folder");const B=m[0].webkitRelativePath,ae=B?B.split("/")[0]:"";ae&&R.append("folderName",ae),m.forEach(te=>{const de=te.webkitRelativePath||te.name;R.append("files",te,de),R.append("relativePaths",de)}),xe(!0);try{const te=await fetch("/api/upload",{method:"POST",body:R}),de=await te.json();te.ok&&de.success?(Re(de),ue(j)?(H.success(de.message||"ä¸Šä¼ æˆåŠŸï¼"),setTimeout(()=>{E(),window.location.reload()},1500)):H.success(de.message||"æ–‡ä»¶å·²ä¸Šä¼ ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):H.error(de.error||"ä¸Šä¼ å¤±è´¥")}catch(te){H.error("ä¸Šä¼ å¤±è´¥: "+te.message)}finally{xe(!1)}},qe=o.useCallback(()=>{const u=We.find(B=>B.key===j),m=(u==null?void 0:u.docs)||[];let R="";if(je(j)){const B=c==="elements"?"å…ƒç´ ":"é¡µé¢",ae=j==="axure_prototype"?"Axure åŽŸåž‹é“¾æŽ¥":"ç½‘é¡µé“¾æŽ¥";R=`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼ŒååŠ©ç”¨æˆ·ã€ŒåŸºäºŽ${ae}å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${B}ã€ã€‚

**ðŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼ˆå¿…é¡»é˜…è¯»ï¼‰**ï¼š
${m.map(te=>`- \`${te}\``).join(`
`)}

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œæˆ‘å°†åŸºäºŽ ${ae} å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${B}ã€‚

è¯·æŠŠé“¾æŽ¥å‘æˆ‘ï¼ˆURLï¼‰ï¼š
\`\`\``}else{if(!Ee||!Ee.prompt)throw new Error("æ²¡æœ‰å¯å¤åˆ¶çš„ Prompt");R=Ee.prompt,m.length>0&&(R+=`

ðŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼š
${m.map(B=>`- \`${B}\``).join(`
`)}`)}return R},[j,c,Ee]),L={display:"inline-flex",alignItems:"center",gap:8},be=()=>{if(M==="create")return e.jsx("div",{style:L,children:e.jsx(st,{type:"primary",disabled:!1,preferredClient:V,preferredIDE:oe,scene:`create-${c}`,buildPrompt:()=>ee(),onAfterCopy:D,copySuccessMessage:"å¤åˆ¶æˆåŠŸï¼Œè¯·è¿”å›ž IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})});if(ue(j))return e.jsx("div",{style:L,children:e.jsx(X,{onClick:E,children:"å–æ¶ˆ"})});const u=je(j)||Ee;return e.jsxs("div",{style:L,children:[e.jsx(X,{onClick:E,children:"å…³é—­"}),e.jsx(st,{type:"primary",preferredClient:V,preferredIDE:oe,scene:`upload-${j}-${c}`,buildPrompt:qe,copySuccessMessage:"Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´ç»™ AI å®Œæˆå¯¼å…¥",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt",disabled:!u})]})},Ye={name:S==="folder"?"files":"file",multiple:S==="folder",directory:S==="folder",fileList:re,customRequest:S==="zip"?Se:void 0,beforeUpload:u=>{var R;return S==="folder"?!1:u.type==="application/zip"||u.type==="application/x-zip-compressed"||((R=u.name)==null?void 0:R.endsWith(".zip"))?!0:(H.error("è¯·ä¸Šä¼  ZIP æ ¼å¼çš„æ–‡ä»¶"),Os.LIST_IGNORE)},onChange:u=>{S==="folder"?(J(u.fileList),ke(u.fileList)):J(u.fileList.slice(-1))},onRemove:()=>{J([]),Re(null)},accept:S==="zip"?".zip":void 0,disabled:le},ge="/skills",We=[{key:"make",title:"Axbub Make",description:"æ”¯æŒè‡ªå·±æˆ–ä»–äººçš„ ZIP åŒ…",icon:e.jsx(Zt,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!0,docs:[`${ge}/local-axure-workflow/SKILL.md`]},{key:"axhub",title:"Axhub æ‰©å±•",description:"å¯å¯¼å‡ºä»»æ„ç½‘é¡µï¼ˆé™æ€ï¼‰",icon:e.jsx(Us,{style:{fontSize:24,color:"#722ed1"}}),isDirect:!0,docs:[`${ge}/screenshot-page-workflow/SKILL.md`]},{key:"google_stitch",title:"Google Stitch",description:"AI é©±åŠ¨çš„ UI è®¾è®¡å·¥å…·ï¼ˆé™æ€ï¼‰",icon:e.jsx(Is,{style:{fontSize:24,color:"#f5222d"}}),isDirect:!0,docs:[`${ge}/screenshot-page-workflow/SKILL.md`]},{key:"v0",title:"V0 App",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(es,{style:{fontSize:24,color:"#52c41a"}}),isDirect:!1,docs:[`${ge}/v0-project-converter/SKILL.md`]},{key:"google_aistudio",title:"Google AIStudio",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Is,{style:{fontSize:24,color:"#faad14"}}),isDirect:!1,docs:[`${ge}/ai-studio-project-converter/SKILL.md`]},{key:"axure_prototype",title:"Axure åŽŸåž‹é“¾æŽ¥",description:"æ”¯æŒåœ¨çº¿æˆ–æœ¬åœ°é¢„è§ˆçš„é“¾æŽ¥",icon:e.jsx(Ds,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!1,docs:[`${ge}/axure-prototype-workflow/SKILL.md`,`${ge}/axure-prototype-workflow/page-restoration.md`]},{key:"web_page",title:"ç½‘é¡µé“¾æŽ¥",description:"æ”¯æŒä»»æ„ç½‘é¡µé“¾æŽ¥",icon:e.jsx(Yt,{style:{fontSize:24,color:"#13c2c2"}}),isDirect:!1,docs:[`${ge}/web-page-workflow/SKILL.md`,`${ge}/web-page-workflow/page-restoration.md`]}],Qe=()=>e.jsxs(he,{requiredMark:!1,labelCol:{style:{width:"120px"}},wrapperCol:{style:{minWidth:0}},children:[e.jsx(he.Item,{label:c==="elements"?"å…ƒç´ åç§°":"é¡µé¢åç§°",children:e.jsx(Be,{placeholder:"ç•™ç©ºåˆ™ç”± AI ç”Ÿæˆï¼Œæ‰¹é‡ç”Ÿæˆå»ºè®®ç•™ç©º",value:b,onChange:u=>T(u.target.value),maxLength:20,showCount:!0})}),Q.length>0&&e.jsx(he.Item,{label:"å‚è€ƒæ¡ˆä¾‹",tooltip:`å¯åœ¨${c==="elements"?"å…ƒç´ ":"é¡µé¢"}åˆ—è¡¨ä¸­å°†å…¶è®¾ä¸ºæˆ–å–æ¶ˆä¸ºå‚è€ƒæ¡ˆä¾‹`,children:e.jsx($e,{style:{width:"100%"},placeholder:"ä¸é€‰æ‹©å‚è€ƒæ¡ˆä¾‹",value:k||void 0,onChange:u=>v(u||""),allowClear:!0,options:Q.map(u=>({value:u.name,label:u.displayName}))})}),e.jsx("div",{children:e.jsx(X,{type:"link",onClick:()=>i(!ie),icon:ie?e.jsx(Po,{}):e.jsx(No,{}),style:{padding:0},children:ie?"æ›´å¤šé…ç½®":"æ”¶èµ·é…ç½®"})}),!ie&&e.jsxs(e.Fragment,{children:[f.length>0&&e.jsx(he.Item,{label:"ä¸»é¢˜",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰ä¸»é¢˜ç”ŸæˆåŽŸåž‹ï¼Œä¸»é¢˜å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©ä¸»é¢˜ï¼ˆå¯å¤šé€‰ï¼‰",value:q,onChange:u=>Y(u),allowClear:!0,options:f.map(u=>({value:u.name,label:u.displayName}))})}),P.length>0&&e.jsx(he.Item,{label:"å¼•ç”¨æ•°æ®",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ•°æ®ç”ŸæˆåŽŸåž‹ï¼Œæ•°æ®å¯åœ¨æ•°æ®ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ•°æ®ï¼ˆå¯å¤šé€‰ï¼‰",value:Z,onChange:u=>K(u),allowClear:!0,options:P.map(u=>({value:u.name,label:u.displayName}))})}),U.length>0&&e.jsx(he.Item,{label:"å‰ç«¯åº“",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰å‰ç«¯åº“ç”ŸæˆåŽŸåž‹ï¼Œå‰ç«¯åº“å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‰ç«¯åº“ï¼ˆå¯å¤šé€‰ï¼‰",value:w,onChange:u=>l(u),allowClear:!0,options:U.map(u=>({value:u.name,label:u.displayName}))})}),ne.length>0&&e.jsx(he.Item,{label:"å‚è€ƒæ–‡æ¡£",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ–‡æ¡£ç”ŸæˆåŽŸåž‹ï¼Œæ–‡æ¡£å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ–‡æ¡£ï¼ˆå¯å¤šé€‰ï¼‰",value:F,onChange:u=>_(u),options:ne.map(u=>({value:u.name,label:u.displayName}))})}),e.jsx(he.Item,{label:"ç”Ÿæˆæµç¨‹",children:e.jsx($e,{style:{width:"100%"},value:z,onChange:u=>O(u),options:[{value:"simultaneous",label:"åŒæ—¶ç”Ÿæˆè§„æ ¼æ–‡æ¡£å’ŒåŽŸåž‹"},{value:"specFirst",label:"æŒ‰ è§„æ ¼æ–‡æ¡£ > åŽŸåž‹ é¡ºåº"}]})}),e.jsx(he.Item,{label:"Axure æ¨¡å¼",tooltip:"ä¸å½±å“å¯¼å‡º Axure ï¼Œå…³é—­åˆ™ä¸ç”Ÿæˆä¸Ž Axure åŽŸç”Ÿå…ƒç´ äº¤äº’çš„åŠŸèƒ½ï¼Œä½†å¯ä»¥æå‡ç”Ÿæˆé€Ÿåº¦",children:e.jsx(Ls,{checked:ce,onChange:u=>N(u)})})]})]}),Ae=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsx(cr,{level:5,style:{marginBottom:16},children:"é€‰æ‹©å¯¼å…¥æ¥æº"}),e.jsx(Lo,{gutter:[16,16],children:We.map(u=>e.jsx(Uo,{span:12,children:e.jsx($s,{hoverable:!0,bodyStyle:{padding:16,height:"100%",display:"flex",alignItems:"center"},style:{height:"100%",borderColor:j===u.key?W.colorInfo:void 0,backgroundColor:j===u.key?W.colorFillAlter:void 0},onClick:()=>Le(u.key),children:e.jsx($s.Meta,{avatar:u.icon,title:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(ks,{ellipsis:!0,style:{fontSize:13,fontWeight:500},children:u.title})}),description:e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:u.description}),style:{width:"100%"}})})},u.key))})]}),!je(j)&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(ks,{type:"secondary",style:{fontSize:12},children:"ä¸Šä¼ æ–¹å¼"}),e.jsx(kt,{size:"small",value:S,onChange:u=>{C(u),J([]),Re(null)},options:[{label:"ZIP",value:"zip"},{label:"æ–‡ä»¶å¤¹",value:"folder"}]})]}),e.jsx("div",{style:{flex:1,minHeight:120},children:e.jsx(lr,{...Ye,style:{background:"#fafafa",border:"1px dashed #d9d9d9",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-drag-icon",style:{marginBottom:8},children:e.jsx(zo,{style:{color:W.colorInfo,fontSize:36}})}),e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:S==="zip"?"ç‚¹å‡»æˆ–æ‹–æ‹½ ZIP æ–‡ä»¶ä¸Šä¼ ":"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶å¤¹ä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",style:{color:"#888",fontSize:12,padding:"0 16px"},children:ue(j)?"å¯¼å…¥åŽå¯é€šè¿‡ AI è¿›è¡Œç¼–è¾‘å’Œä¼˜åŒ–":"ä¸Šä¼ åŽéœ€è¦ AI è¾…åŠ©å¯¼å…¥"})]})})})]})]});return e.jsx(Ns,{placement:"left",destroyOnClose:!0,title:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(kt,{value:M,onChange:u=>p(u),options:[{label:c==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢",value:"create"},{label:c==="elements"?"å¯¼å…¥å…ƒç´ ":"å¯¼å…¥é¡µé¢",value:"upload"}],style:{fontWeight:500}})}),open:h,onClose:E,width:600,footer:be(),styles:{body:{padding:24,overflow:"auto"},header:{borderBottom:"1px solid #f0f0f0",padding:"16px 24px"},footer:{textAlign:"right"}},children:M==="create"?Qe():Ae()})}const Tt={simultaneous:{mode:"simultaneous",displayName:"ç›´æŽ¥ç”Ÿæˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!1]},specFirst:{mode:"specFirst",displayName:"è§„æ ¼ä¼˜å…ˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.mdï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰â†’ ç”Ÿæˆ index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ spec.mdï¼ˆç¡®è®¤ï¼‰â†’ index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!0,!1]}};function ur(h,E){const c=E==="elements"?"å…ƒç´ ":"é¡µé¢",b=E==="elements"?"elements":"pages",T=`src/${b}/${h.name}`,k=`src/${b}/ref-${h.name}`;return`å°† \`${T}\` è®¾ä¸ºå‚è€ƒæ¡ˆä¾‹ï¼š

1. ç§»åŠ¨åˆ° \`${k}\`
2. å‚è€ƒ \`/rules/development-standards.md\`
3. åœ¨ index.tsx é¡¶éƒ¨æ·»åŠ ï¼š
\`\`\`typescript
/**
 * @name ${h.displayName}
 * æœ¬æ–‡ä»¶æ˜¯æ¼”ç¤ºæ–‡ä»¶ï¼Œå±•ç¤ºæœ¬é¡¹ç›®${c}å¼€å‘è§„èŒƒ
 * å®žé™…å¼€å‘æ—¶åªéœ€ä¿ç•™ @name æ³¨é‡Šï¼Œä¸éœ€è¦è¯¦ç»†çš„è§„èŒƒè¯´æ˜Ž
 */
\`\`\`
4. åœ¨å…³é”®ä»£ç æ®µæ·»åŠ  \`// ã€è§„èŒƒè¯´æ˜Žã€‘\` æ³¨é‡Šï¼šå¯¼å…¥é¡ºåºã€Propså¤„ç†ã€Stateç®¡ç†ã€äº‹ä»¶å¤„ç†ã€useImperativeHandleã€JSXæ¸²æŸ“
5. æ³¨é‡Šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œéž"åšä»€ä¹ˆ"ï¼Œé‡ç‚¹è¯´æ˜Žæ˜“é”™ç‚¹å’Œæœ€ä½³å®žè·µ`}function hr(h){return Object.prototype.hasOwnProperty.call(Tt,h)}function pr(h){const{hasName:E,displayName:c,itemType:b,hasReference:T,referenceDisplayName:k}=h,v=T&&k?`
å‚è€ƒæ¡ˆä¾‹ï¼š${k}`:"";return E?`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åŽï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›žå¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›žå¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®žçŽ°å†…å®¹

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º **${c}** ${b}ã€‚${v}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼š
\`\`\``:`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åŽï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›žå¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›žå¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®žçŽ°å†…å®¹

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º${b}ã€‚${v}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼ˆå¦‚éœ€åˆ›å»ºå¤šä¸ª${b}ï¼Œè¯·ä¸€å¹¶è¯´æ˜Žï¼‰ï¼š
\`\`\``}function fr(h){return h?`

**Axure API**ï¼šâœ… å·²å¯ç”¨
- éœ€è¦ä½¿ç”¨ Axure API å®žçŽ°ç»„ä»¶äº¤äº’åŠŸèƒ½
- **âš ï¸ å¿…é¡»å®Œæ•´é˜…è¯» \`/rules/axure-api-guide.md\`ï¼Œä¸è¦è·³è¿‡ï¼**
- è¯¥æ–‡æ¡£åŒ…å«å®Œæ•´çš„ Axure API æŽ¥å£è§„èŒƒã€ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ`:`

**Axure API**ï¼šâŒ æœªå¯ç”¨
- æœ¬æ¬¡ä½¿ç”¨æ ‡å‡† React ç»„ä»¶å³å¯ï¼Œä¸éœ€è¦ Axure API`}function As(){return`   - æ–‡ä»¶ç»“æž„ã€ä¾èµ–å¼•ç”¨ã€æ ·å¼è§„èŒƒã€å¯¼å‡ºè§„èŒƒ
   - âš ï¸ **éªŒæ”¶æ ‡å‡†**ï¼šå®ŒæˆåŽå¿…é¡»å¯¹ç…§æ­¤æ–‡æ¡£æ£€æŸ¥å®žçŽ°`}function Ms(h){const{createMode:E,modeConfig:c,generateAxure:b}=h;return E==="simultaneous"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${c.description}

**ðŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

2. **\`/rules/development-standards.md\`**
${As()}

3. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${b?`

4. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æŽ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}`:E==="specFirst"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${c.description}

**ðŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/requirements-alignment.md\`** â­ï¸ éœ€æ±‚å¯¹é½ï¼ˆç¬¬ä¸€æ­¥ï¼‰
   - éœ€æ±‚ç¡®è®¤æ¸…å•ã€æ²Ÿé€šç­–ç•¥ã€å¯è§†åŒ–æµç¨‹

2. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼Œå¿…é¡»å®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

3. **\`/rules/development-standards.md\`**
${As()}

4. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${b?`

5. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æŽ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}

**ç¡®è®¤æµç¨‹**ï¼š
- å®Œæˆ spec.md åŽï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼š"spec.md å·²å®Œæˆï¼Œè¯·ç¡®è®¤æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚ç¡®è®¤åŽå°†ç”Ÿæˆä»£ç å®žçŽ°ã€‚"
- ç­‰å¾…ç”¨æˆ·ç¡®è®¤åŽå†ç”Ÿæˆ index.tsx`:Ms({createMode:"simultaneous",modeConfig:Tt.simultaneous,generateAxure:b})}function mr(h){const{referencePath:E,referenceDisplayName:c}=h;return E?`

**ðŸ“ å‚è€ƒæ¡ˆä¾‹**ï¼ˆâ­ï¸ ä¼˜å…ˆå‚è€ƒï¼‰ï¼š
- è·¯å¾„ï¼š\`${E}\`
- åç§°ï¼š${c}
- **è¯·ä¼˜å…ˆå‚è€ƒæ­¤æ¡ˆä¾‹çš„ä»£ç ç»“æž„å’Œå®žçŽ°æ–¹å¼**
- å­¦ä¹ å…¶æ–‡ä»¶ç»„ç»‡ã€å‘½åè§„èŒƒã€ä»£ç é£Žæ ¼`:""}function vt(h){const{title:E,selected:c,available:b,toLine:T}=h;return c.length===0?"":`

${E}${c.map(k=>{const v=b.find(z=>z.name===k);return`
${T(k,v)}`}).join("")}`}function xr(h,E,c,b,T,k=[],v=[],z=[],O=[],ce=[],N=[],Q=[],q=[],Y=!0){const f=E==="elements",w=f?"å…ƒç´ ":"é¡µé¢",l=f?"elements":"pages",U=h.trim().length>0,F=h.trim(),_=b?T.find(M=>M.name===b):null,ne=_?`src/${l}/${_.name}`:null,Z=hr(c)?Tt[c]:Tt.simultaneous,K=U?`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼Œåˆ›å»º ${w}ã€Œ**${F}**ã€åŽŸåž‹`:`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª${w}åŽŸåž‹`,P=pr({hasName:U,displayName:F,itemType:w,hasReference:!!_,referenceDisplayName:_==null?void 0:_.displayName}),V=fr(Y),oe=Ms({createMode:c,modeConfig:Z,generateAxure:Y}),ee=mr({referencePath:ne,referenceDisplayName:_==null?void 0:_.displayName}),D=vt({title:"**ðŸ“š å‚è€ƒæ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/docs/ï¼‰ï¼š",selected:k,available:v,toLine:(M,p)=>`- **\`/assets/docs/${M}\`** - ${(p==null?void 0:p.displayName)||M}`}),W=vt({title:"**ðŸŽ¨ ä¸»é¢˜é…ç½®**ï¼ˆç›¸å¯¹è·¯å¾„ /src/themes/ï¼Œåªæä¾›è·¯å¾„ï¼Œä¸å±•å¼€æ–‡ä»¶å†…å®¹ï¼‰ï¼š",selected:z,available:O,toLine:(M,p)=>`- ${(p==null?void 0:p.displayName)||M}
  - \`/src/themes/${M}/DESIGN-SPEC.md\`ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  - \`/src/themes/${M}/designToken.json\`
  - \`/src/themes/${M}/globals.css\` æˆ– \`/src/themes/${M}/style.css\`ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  - \`/src/themes/${M}/index.tsx\``}),ie=vt({title:"**ðŸ“¦ å‰ç«¯åº“æ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/libraries/ï¼‰ï¼š",selected:ce,available:N,toLine:(M,p)=>`- **\`/assets/libraries/${M}\`** - ${(p==null?void 0:p.displayName)||M}`}),i=vt({title:"**ðŸ“Š å‚è€ƒæ•°æ®**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/database/ï¼‰ï¼š",selected:Q,available:q,toLine:(M,p)=>`- **\`/assets/database/${M}\`** - ${(p==null?void 0:p.displayName)||M}`});return`${K}

âš ï¸ **é‡è¦æç¤º**ï¼šè¯·åŠ¡å¿…å®Œæ•´é˜…è¯»ä»¥ä¸‹æ‰€æœ‰è§„èŒƒæ–‡æ¡£å’Œå‚è€ƒèµ„æ–™ï¼Œä¸è¦å·æ‡’ï¼è¿™äº›æ–‡æ¡£åŒ…å«äº†å…³é”®çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®žè·µã€‚
${oe}${ee}${W}${i}${ie}${D}${V}

${P}`}function gr(h,E,c,b){if(!h)return"";const T=window.location.origin+(E==="demo"?h.demoUrl:h.specUrl),k=new URL(T,window.location.origin);return E==="demo"&&c==="webEditorV2"?k.searchParams.set("editor","webEditorV2"):k.searchParams.delete("editor"),b!=null&&b.width&&Number.isFinite(b.width)?k.searchParams.set("width",String(Math.round(b.width))):k.searchParams.delete("width"),k.toString()}function yr(h,E){const[c,b]=o.useState(!1),[T,k]=o.useState(""),[v,z]=o.useState(()=>localStorage.getItem(ms)||""),[O,ce]=o.useState(()=>localStorage.getItem(xs)||"simultaneous"),[N,Q]=o.useState(()=>localStorage.getItem(gs)==="true"),[q,Y]=o.useState([]),[f,w]=o.useState([]),[l,U]=o.useState([]),[F,_]=o.useState([]),[ne,Z]=o.useState([]),[K,P]=o.useState([]),[V,oe]=o.useState([]),[ee,D]=o.useState([]),[W,ie]=o.useState(!1);o.useEffect(()=>{localStorage.setItem(xs,O)},[O]),o.useEffect(()=>{localStorage.setItem(gs,String(N))},[N]),o.useEffect(()=>{localStorage.setItem(ms,v)},[v]);const i=o.useMemo(()=>(h==="elements"?E.elements:E.pages).filter(S=>S.isReference),[E,h]);return o.useEffect(()=>{if(!W)return;(async()=>{try{const S=await fetch("/api/docs");if(S.ok){const C=await S.json();P(C)}}catch(S){console.error("Failed to load docs:",S)}})()},[W]),o.useEffect(()=>{if(!W)return;(async()=>{try{const S=await fetch("/api/themes");if(S.ok){const C=await S.json();w(C)}}catch(S){console.error("Failed to load themes:",S)}})()},[W]),o.useEffect(()=>{if(!W)return;(async()=>{try{const S=await fetch("/api/libraries");if(S.ok){const C=await S.json();_(C);const re=C.find(J=>J.name==="tailwind-css.md"||J.name.startsWith("tailwind-css"));re&&l.length===0&&U([re.name])}}catch(S){console.error("Failed to load libraries:",S)}})()},[W]),o.useEffect(()=>{if(!W)return;(async()=>{try{const S=await fetch("/api/data/tables");if(S.ok){const re=(await S.json()).map(J=>({name:`${J.fileName}.json`,displayName:J.tableName}));D(re)}}catch(S){console.error("Failed to load data assets:",S)}})()},[W]),o.useEffect(()=>{c&&(v&&(i.some(S=>S.name===v)||z("")),ie(!0))},[c,i,v]),{createDialogVisible:c,createName:T,createReference:v,createMode:O,generateAxure:N,referenceItems:i,selectedThemes:q,availableThemes:f,selectedLibraries:l,availableLibraries:F,selectedDocs:ne,availableDocs:K,selectedDataAssets:V,availableDataAssets:ee,setCreateDialogVisible:b,setCreateName:k,setCreateReference:z,setCreateMode:ce,setGenerateAxure:Q,setSelectedThemes:Y,setSelectedLibraries:U,setSelectedDocs:Z,setSelectedDataAssets:oe,buildPrompt:async()=>xr(T,h,O,v,i,ne,K,q,f,l,F,V,ee,N),clearCreateDialogState:()=>{b(!1),k(""),Z([]),Y([]),U([]),oe([]),ie(!1),P([]),w([]),_([]),D([])},handleCreateCancel:()=>{b(!1),k(""),Z([]),Y([]),U([]),oe([]),ie(!1),P([]),w([]),_([]),D([])}}}function wr(h,E){const c=Array.isArray(h)?h:[],b=Array.isArray(E)?E:[],T=[...c],k=new Set(T.map(v=>String((v==null?void 0:v.selector)||"").trim()).filter(Boolean));for(const v of b){const z=String((v==null?void 0:v.selector)||"").trim();!z||k.has(z)||(T.push(v),k.add(z))}return T}function br(h){const E=Array.isArray(h)?h:[],c=[],b=new Set;for(const T of E){const k=String((T==null?void 0:T.tag)||"").trim(),v=String((T==null?void 0:T.selector)||"").trim(),z=String((T==null?void 0:T.label)||"").trim();if(!k||!v||!z)continue;const O=`${k}::${v}::${z}`;b.has(O)||(b.add(O),c.push({tag:k,selector:v,label:z}))}return c}function jr({isDarkMode:h,setIsDarkMode:E}){const c="http://localhost:32123",b={webBaseUrl:c,apiBaseUrl:`${c}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"åŠ©æ‰‹è¿è¡Œæ—¶ä¸å¯ç”¨ï¼Œè¯·å…ˆå¯åŠ¨ Axhub Genieã€‚",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:"npm install -g @axhub/genie",start:"axhub-genie",status:"axhub-genie status"}}},T=320,k=320,v=640,{token:z}=ot.useToken(),[O,ce]=o.useState(!0),[N,Q]=o.useState({elements:[],pages:[]}),[q,Y]=o.useState(!1),[f,w]=o.useState(()=>{const t=localStorage.getItem(ws);return t==="elements"||t==="pages"?t:"pages"}),[l,U]=o.useState(null),[F,_]=o.useState("desktop"),[ne,Z]=o.useState(1),K=Ce.useRef(null),P=Ce.useRef(null),[V,oe]=o.useState(!1),ee=Ce.useRef(null),D=Ce.useRef(null),[W,ie]=o.useState(""),[i,M]=H.useMessage(),[p,j]=It.useModal(),[y,S]=o.useState({enabled:!1,editedCount:0}),[C,re]=o.useState({mode:"none",webEditor:{active:!1,undoCount:0,redoCount:0},textEdit:{enabled:!1,editedCount:0},inspecta:{enabled:!1}}),J=Ce.useRef(!1),[le,xe]=o.useState({width:600,height:400}),[Ee,Re]=o.useState(0),[Fe,Le]=o.useState(!1),[ue,je]=o.useState(null),[Se,ke]=o.useState(null),[pe,qe]=o.useState(!1),[L,be]=o.useState(null),[Ye,ge]=o.useState(!1),[We,Qe]=o.useState(()=>{const t=localStorage.getItem(bs),s=t?Number(t):NaN;return Number.isFinite(s)&&s>=k?Math.min(s,v):T}),Ae=o.useRef(null),[u,m]=o.useState(!1),[R,B]=o.useState(null),[ae,te]=o.useState(null),de=o.useRef(!1),[se,mt]=o.useState("demo"),[Ue,Rt]=o.useState("spec"),He=Ce.useRef(null),{createDialogVisible:Bs,createName:Fs,createReference:Ws,createMode:Hs,generateAxure:Vs,referenceItems:Gs,selectedThemes:Ks,availableThemes:Js,selectedLibraries:Xs,availableLibraries:qs,selectedDocs:Ys,availableDocs:Zs,selectedDataAssets:Qs,availableDataAssets:en,setCreateDialogVisible:tn,setCreateName:sn,setCreateReference:nn,setCreateMode:on,setGenerateAxure:rn,setSelectedThemes:an,setSelectedLibraries:ln,setSelectedDocs:cn,setSelectedDataAssets:dn,buildPrompt:un,clearCreateDialogState:hn,handleCreateCancel:pn}=yr(f,N);o.useEffect(()=>{let t=!1;return Me.getConfig().then(s=>{var r,a;if(t)return;const n=(r=s==null?void 0:s.automation)==null?void 0:r.defaultPromptClient;je(n==="claude"||n==="cursor"||n==="codex"?n:null),ke(((a=s==null?void 0:s.automation)==null?void 0:a.defaultIDE)||null)}).catch(()=>{t||(je(null),ke(null))}),()=>{t=!0}},[]),o.useEffect(()=>{let t=!1;return Me.getAssistantRuntime().then(s=>{t||be(s)}).catch(()=>{t||be(b)}),()=>{t=!0}},[]),o.useEffect(()=>{localStorage.setItem(bs,String(Math.round(We)))},[We]);const Dt=v,rt=o.useCallback((t,s)=>{try{const n=new URL(t,window.location.origin);return n.searchParams.set("context",JSON.stringify(s)),n.toString()}catch(n){return console.warn("Failed to serialize assistant context into URL:",n),t}},[]),at=o.useMemo(()=>{const t=((L==null?void 0:L.webBaseUrl)||c).replace(/\/+$/g,""),s=new URL(`${t}/`),n=(L==null?void 0:L.projectPath)||"";return n&&s.searchParams.set("cwd",n),ue&&s.searchParams.set("provider",ue),s.toString()},[L,ue]),ze=R||at;o.useEffect(()=>{m(!1)},[ze]),o.useEffect(()=>{de.current=u},[u]);const De=o.useMemo(()=>{const t=l?ct(l):null,s=Ue==="prd"?"prd":"spec",r=t?se==="spec"?`${t}/${s==="prd"?"prd.md":"spec.md"}`:`${t}/index.tsx`:null,d={version:"1",systemContext:"",currentFile:r||"",selectedElements:[],extensions:{source:"axhub-runtime",projectPath:(L==null?void 0:L.projectPath)||"",provider:ue,viewMode:se,activeTab:f,currentSpecDocKey:s,selectedItem:l?{name:l.name,displayName:l.displayName,demoUrl:l.demoUrl,specUrl:l.specUrl}:null,paths:{itemSourcePath:t,currentFilePath:r,currentFileDirectory:t},updatedAt:new Date().toISOString()}};return ae?{...d,systemContext:ae.systemContext||d.systemContext,currentFile:ae.currentFile||d.currentFile,selectedElements:Array.isArray(ae.selectedElements)?ae.selectedElements:d.selectedElements,extensions:{...d.extensions||{},...ae.extensions||{}}}:d},[L==null?void 0:L.projectPath,ue,se,f,Ue,l,ae]),ts=o.useCallback(()=>{const t=Ae.current;if(!t||!t.contentWindow)return;let s="*";try{s=new URL(ze).origin}catch{s="*"}const n={type:"update_context",context:De};t.contentWindow.postMessage(n,s)},[ze,De]);o.useEffect(()=>{!pe||!u||ts()},[pe,u,ts]),o.useEffect(()=>{pe||(m(!1),B(null))},[pe]);const xt=o.useCallback((t,s)=>{const n=t||at;let r=n;try{const a=new URL(n,window.location.origin),d=(L==null?void 0:L.projectPath)||"";!a.searchParams.get("cwd")&&d&&a.searchParams.set("cwd",d),!a.searchParams.get("provider")&&ue&&a.searchParams.set("provider",ue),s&&!a.searchParams.get("targetPath")&&a.searchParams.set("targetPath",s),a.searchParams.get("context")?r=a.toString():r=rt(a.toString(),De)}catch{r=rt(n,De)}return r},[L==null?void 0:L.projectPath,ue,at,De,rt]),gt=o.useCallback((t,s)=>{const n=xt(t,s);qe(!0),m(!1),B(n)},[xt]),yt=o.useCallback((t,s)=>{const n=xt(t,s);window.open(n,"_blank","noopener,noreferrer")},[xt]),it=o.useCallback((t,s="replace")=>{const n=Ae.current;if(!n||!n.contentWindow)return!1;let r="*";try{r=new URL(ze).origin}catch{r="*"}const a={type:"update_context",mode:s,context:{version:t.version,systemContext:t.systemContext,currentFile:t.currentFile,selectedElements:t.selectedElements,extensions:t.extensions}};return n.contentWindow.postMessage(a,r),!0},[ze]),wt=o.useCallback((t,s="replace")=>{it(t,s),s==="replace"&&(window.setTimeout(()=>it(t,s),160),window.setTimeout(()=>it(t,s),520))},[it]),ss=o.useCallback((t,s)=>{const n=Ae.current;if(!n||!n.contentWindow)return!1;let r="*";try{r=new URL(ze).origin}catch{r="*"}const a={type:"update_prompt",prompt:t,autoSend:s};return n.contentWindow.postMessage(a,r),!0},[ze]),ns=o.useCallback(async(t=8e3)=>{var n;const s=Date.now();for(;Date.now()-s<t;){if((n=Ae.current)!=null&&n.contentWindow&&de.current)return!0;await new Promise(r=>setTimeout(r,120))}return!1},[]),os=o.useCallback(async t=>{const s=t.health.hints,n=[t.health.message,s.installGlobal,s.start,s.status];await navigator.clipboard.writeText(n.join(`
`))},[]),rs=o.useCallback(async(t=15e3)=>{const s=Date.now();for(;Date.now()-s<t;){try{const n=await Me.getAssistantRuntime();if(be(n),n.health.status==="ready")return n}catch{}await new Promise(n=>setTimeout(n,1e3))}return null},[]),as=o.useCallback(async t=>{const s=await Me.bootstrapAssistant({mode:t}),n=(s==null?void 0:s.runtime)||b;return be(n),n},[]),Pt=o.useCallback((t,s,n,r,a="iframe")=>{const d=t.health.hints,x=async g=>{const I=i.loading("æ­£åœ¨å¯åŠ¨ Axhub Genie...",0);try{await as(g);const A=await rs(15e3);(A==null?void 0:A.health.status)==="ready"?(i.success("Axhub Genie å·²å°±ç»ªï¼Œæ­£åœ¨æ‰“å¼€ã€‚"),a==="window"?yt(n,r):gt(n,r)):i.warning("å°šæœªå°±ç»ªï¼Œè¯·ç¨åŽé‡è¯•ï¼Œæˆ–æ‰‹åŠ¨æ‰§è¡Œæç¤ºå‘½ä»¤ã€‚")}catch(A){i.error((A==null?void 0:A.message)||"è‡ªåŠ¨å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ã€‚")}finally{I()}};p.confirm({title:"Axhub Genie æœªå°±ç»ª",content:e.jsxs("div",{children:[e.jsx("p",{children:t.health.message}),e.jsx("p",{style:{marginBottom:6},children:"æŽ¨èå‘½ä»¤ï¼š"}),e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:d.installGlobal})]}),okText:"è‡ªåŠ¨å®‰è£…å¹¶å¯åŠ¨",cancelText:"å…³é—­",onOk:()=>x("install_global"),footer:(g,{OkBtn:I,CancelBtn:A})=>e.jsxs(e.Fragment,{children:[e.jsx(X,{onClick:async()=>{try{await os(t),i.success("å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{i.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}},children:"å¤åˆ¶å‘½ä»¤"}),e.jsx(A,{}),e.jsx(I,{})]})})},[i,p,as,rs,gt,yt,os]),Ze=o.useCallback(async(t,s,n,r="iframe")=>{if(Ye)return!1;ge(!0);try{const a=await Me.getAssistantRuntime();if(be(a),a.health.status==="ready")return r==="window"?yt(s,n):gt(s,n),!0;Pt(a,t,s,n,r)}catch(a){const d=L||b;be(d),i.error((a==null?void 0:a.message)||"æ£€æµ‹ Axhub Genie çŠ¶æ€å¤±è´¥"),Pt(d,t,s,n,r)}finally{ge(!1)}return!1},[Ye,L,i,gt,yt,Pt]),is=o.useCallback(async t=>{var A,me;const s=((A=t.targetPath)==null?void 0:A.trim())||void 0,n=t.context,r=String(t.prompt||"").trim(),a=t.mode==="selection_context",d=(()=>{if(!n)return ae;const G=ae??{systemContext:"",currentFile:"",selectedElements:[],extensions:{}},fe=wr(G.selectedElements,n.selectedElements);return{version:"1",systemContext:n.systemContext||G.systemContext,currentFile:n.currentFile||G.currentFile,selectedElements:br(fe),extensions:{...G.extensions||{},...n.extensions||{}}}})();d&&te(d);let x=pe&&u&&!!((me=Ae.current)!=null&&me.contentWindow),g=!1;if(!x){const G=a?n:d,fe=G?rt(at,G):void 0;if(!await Ze("event",fe,s))return;if(g=!!G,x=await ns(8e3),!x){i.warning("åŠ©æ‰‹é¢æ¿å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åŽå†è¯•ã€‚");return}}if(d){const G=a?"append":"replace",fe=a?n:d;fe&&!(a&&g)&&wt(fe,G)}if(a)return;if(!r){i.warning("ç¼ºå°‘å‘é€å†…å®¹");return}ss(r,!0)||i.error("å‘é€å¤±è´¥ï¼šæ— æ³•å†™å…¥åŠ©æ‰‹è¾“å…¥æ¡†")},[ae,pe,u,it,wt,ss,Ze,ns,i,rt,at]),fn=o.useCallback(()=>{if(pe){qe(!1);return}Ze("button")},[pe,Ze]);o.useEffect(()=>{const t=s=>{const n=s,r=n.detail,a=r==null?void 0:r.url;!a||typeof a!="string"||(Ze("event",a,r==null?void 0:r.targetPath),n.preventDefault())};return window.addEventListener(js,t),()=>{window.removeEventListener(js,t)}},[Ze]);const mn=()=>{const t=`${window.location.protocol}//${window.location.hostname}:${window.location.port}${(l==null?void 0:l.demoUrl)||""}`;navigator.clipboard.writeText(t).then(()=>{i.success("æœ¬åœ°é“¾æŽ¥å·²å¤åˆ¶")}).catch(s=>{i.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),Le(!1)},xn=()=>{const t=hs();navigator.clipboard.writeText(t).then(()=>{i.success("å±€åŸŸç½‘é“¾æŽ¥å·²å¤åˆ¶")}).catch(s=>{i.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),Le(!1)},gn=()=>{window.open("/api/download-dist","_blank"),Le(!1)},yn=async()=>{let t="",s="";const n=[..._s];if(l){const a=l;if(se==="spec"){const d=Ue==="prd"?"prd.md":"spec.md";t=`src/${f}/${l.name}/${d}`,s=`[${l.displayName} - ${d==="prd.md"?"PRD":"SPEC"}](${ct(l)}/${d})`}else{if(a.filePath){const d=a.filePath.indexOf("src/");d>=0?t=a.filePath.substring(d):t=a.filePath}else t=`src/${f}/${l.name}/index.tsx`;s=`[${l.displayName}](${ct(l)})`}}else{i.warning("è¯·å…ˆé€‰æ‹©æ¡ç›®");return}const r=i.loading("æ­£åœ¨å‘é€åˆ° IDE...",0);try{s&&await navigator.clipboard.writeText(s),await Ss({preferredIDE:Se,targetPath:t});const a=await Me.sendWsMessage({type:"handshake",payload:"prototype-admin",targetClientTypes:n});if(!(a!=null&&a.sent)){i.warning("ç¼–è¾‘å™¨æœªè¿žæŽ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}const d=await Me.sendWsMessage({type:"open-file",payload:t,targetClientTypes:n});if(!(d!=null&&d.sent)){i.warning("ç¼–è¾‘å™¨æœªè¿žæŽ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}i.success("å·²åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œå¹¶å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ç¼–è¾‘")}catch(a){i.error((a==null?void 0:a.message)||"å‘é€å¤±è´¥")}finally{r()}},wn=async t=>{await Ss({preferredIDE:t||Se})},bn=async t=>{let s="";if(se==="spec"){const n=Ue==="prd"?"prd.md":"spec.md";s=`[${t.displayName} - ${n==="prd.md"?"PRD":"SPEC"}](${ct(t)}/${n})`}else s=`[${t.displayName}](${ct(t)})`;if(!s){i.warning("æ— æ³•èŽ·å–è·¯å¾„");return}try{await navigator.clipboard.writeText(s),i.success("è·¯å¾„å·²å¤åˆ¶")}catch(n){console.error("Failed to copy: ",n),i.error("å¤åˆ¶å¤±è´¥")}},jn=o.useMemo(()=>[{value:"desktop",icon:e.jsx(Bo,{})},{value:"mobile",icon:e.jsx(Fo,{})},{value:"tablet",icon:e.jsx(Wo,{})}],[]),[et,Nt]=o.useState(!1),[Sn,Lt]=o.useState(!1),[$,Oe]=o.useState({width:1920,height:1080,includeConfig:"code",contentType:"title",rawScreenshotUrl:"",screenshotWidth:0,screenshotHeight:0,previewUrl:""});o.useEffect(()=>{lt()},[]),o.useEffect(()=>{const t=s=>{var a;const n=(a=D.current)==null?void 0:a.contentWindow;if(!n||s.source!==n)return;const r=dt();if(!(r!=="*"&&s.origin!==r))if(s.data&&s.data.type==="SCREENSHOT_CAPTURED")Oe(d=>({...d,rawScreenshotUrl:s.data.dataUrl,screenshotWidth:s.data.width,screenshotHeight:s.data.height}));else if(s.data&&s.data.type==="spec-doc-changed"){console.log("Spec document changed:",s.data.activeDocKey);const d=s.data.activeDocKey==="prd"?"prd":"spec";Rt(d)}else if(s.data&&s.data.type==="TEXT_EDIT_STATUS")S({enabled:!!s.data.enabled,editedCount:Number(s.data.editedCount||0)});else if(s.data&&s.data.type==="TEXT_EDIT_NOTICE"){const d=s.data.level||"info",x=s.data.message||"";x&&(i[d]||i.info)(x)}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_CONFIRM_REQUEST"){const d=Number(s.data.totalCount||0),x=Number(s.data.changedCount||0),g=!!s.data.exitAfterSave;p.confirm({title:"ç¡®è®¤ä¿å­˜æ–‡æœ¬æ›´æ”¹",content:e.jsxs("div",{children:[e.jsxs("div",{children:["æ£€æµ‹åˆ° ",x," å¤„æ–‡æœ¬æ›´æ”¹ã€‚"]}),e.jsxs("div",{children:["é¢„è®¡å°†æ›¿æ¢é¡¹ç›®ä¸­çš„ ",d," å¤„åŒ¹é…æ–‡æœ¬ã€‚"]}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"ä¿å­˜åŽå°†æ‰¹é‡ä¿®æ”¹ç›¸å…³æ–‡ä»¶å†…å®¹ã€‚"})]}),okText:"ç¡®è®¤ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{_e({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!0,exitAfterSave:g})},onCancel:()=>{_e({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!1,exitAfterSave:g})}})}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_RESULT"){const d=!!s.data.success;if(J.current&&(J.current=!1,d)){const x=Ve();x!=null&&x.disable&&(x.disable(),Ge())}}else if(s.data&&s.data.type==="TEXT_EDIT_CONFLICT"){const d=Array.isArray(s.data.conflicts)?s.data.conflicts:[];p.warning({title:"å­˜åœ¨å†²çªçš„æ–‡æœ¬ä¿®æ”¹",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"æ£€æµ‹åˆ°ç›¸åŒåŽŸæ–‡è¢«ä¿®æ”¹æˆä¸åŒå†…å®¹ï¼Œæ— æ³•æ‰¹é‡ä¿å­˜ã€‚"}),e.jsx("div",{style:{maxHeight:200,overflow:"auto",fontSize:12,color:"#555"},children:d.map((x,g)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{fontWeight:600},children:["åŽŸæ–‡ï¼š",x.original]}),e.jsxs("div",{children:["ä¿®æ”¹ä¸ºï¼š",(x.currents||[]).join(" / ")]})]},`${x.original}-${g}`))}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"è¯·ç¡®ä¿ç›¸åŒåŽŸæ–‡åªä¿®æ”¹ä¸ºä¸€ç§ç»“æžœï¼Œæˆ–åˆ†æ‰¹ä¿å­˜ã€‚"})]}),okText:"çŸ¥é“äº†"})}else Vo(s.data)&&is(s.data.payload)};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[is]),o.useEffect(()=>{S({enabled:!1,editedCount:0})},[l,se,Ee]),o.useEffect(()=>{if(!l)return;if($.contentType==="screenshot"&&!$.rawScreenshotUrl){Oe(s=>({...s,previewUrl:""}));return}(async()=>{const s=f==="elements"?"å…ƒç´ ":"é¡µé¢",n=Ut($.rawScreenshotUrl,$,l.displayName,s),r=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(r);Oe(d=>({...d,previewUrl:a}))})()},[$.rawScreenshotUrl,$.width,$.height,$.contentType,l,f]);const Ut=(t,s,n,r)=>{if(s.contentType==="title"){const a=s.width,d=s.height,x=a/2,g=d/2;return`<svg width="${a}" height="${d}" viewBox="0 0 ${a} ${d}" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect width="100%" height="100%" fill="transparent" />
              <g id="textGroup" transform="translate(${x},${g})">
                <!-- Main Title -->
                <text id="mainTitle"
                      x="0" y="-12"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="28"
                      font-weight="700"
                      fill="#333">
                  ${n}
                </text>

                <!-- Description -->
                <text id="description"
                      x="0" y="18"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="14"
                      font-weight="400"
                      fill="#999">
                  Axhub Runtime ${r}
                </text>
              </g>
            </svg>`}else return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${s.width}" height="${s.height}" viewBox="0 0 ${s.width} ${s.height}">
                <rect width="100%" height="100%" fill="transparent" />
                <image x="0" y="0" width="${s.width}" height="${s.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${t}"/>
            </svg>`},bt=Ce.useRef(!1);o.useEffect(()=>{if(bt.current=!1,$.contentType==="screenshot"){const t=f==="pages"?1920:500,s=f==="pages"?1080:300;Oe(n=>({...n,width:t,height:s,screenshotWidth:0,screenshotHeight:0,rawScreenshotUrl:""}))}else $.contentType==="title"&&Oe(t=>({...t,width:500,height:300}))},[f,$.contentType]),o.useEffect(()=>{bt.current||$.contentType==="screenshot"&&(!$.screenshotWidth||!$.screenshotHeight||Oe(t=>({...t,width:$.screenshotWidth,height:$.screenshotHeight})))},[$.screenshotWidth,$.screenshotHeight]);const vn=(t,s)=>{bt.current=!0,Oe(n=>({...n,[t]:s||0}))},Cn=()=>{$.contentType==="screenshot"&&et&&Ot()},En=()=>{bt.current=!0;const t=$.width,s=$.height;Oe(n=>({...n,width:s,height:t})),setTimeout(()=>{$.contentType==="screenshot"&&et&&Ot(s,t)},0)};o.useEffect(()=>{localStorage.setItem(ws,f)},[f]),o.useEffect(()=>{if(!O&&N){const t=f==="elements"?N.elements:N.pages;t.length>0?(U(t[0]),f==="elements"&&xe({width:600,height:400})):U(null)}},[O,N,f]);async function lt(){var t,s;try{const n=await fetch("/api/entries.json");if(!n.ok)throw new Error("Failed to fetch data");const r=await n.json();console.log("Loaded data:",r),console.log("Reference elements:",(t=r.elements)==null?void 0:t.filter(a=>a.isReference)),console.log("Reference pages:",(s=r.pages)==null?void 0:s.filter(a=>a.isReference)),Q(r)}catch(n){i.error("åŠ è½½æ•°æ®å¤±è´¥: "+n.message)}finally{ce(!1)}}function ct(t){const s=t;if(s.filePath){const r=s.filePath.indexOf("src/");if(r>=0){let a=s.filePath.substring(r);return a=a.replace(/\/index\.(t|j)sx?$/i,""),a}return s.filePath}return`${f==="pages"?"src/pages":"src/elements"}/${t.name}`}const In=t=>{const s=`${f}/${t.name}`,n=`/api/zip?path=${encodeURIComponent(s)}`;window.open(n,"_blank")},$n=t=>{const s=ur(t,f);p.info({title:`è®¾ç½®ä¸ºå‚è€ƒ - ${t.displayName}`,okText:"å…³é—­",width:560,content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:12,color:"#8c8c8c"},children:"å¯ç›´æŽ¥å¤åˆ¶ Promptï¼Œæˆ–é€‰æ‹©å®¢æˆ·ç«¯è‡ªåŠ¨æ‰§è¡Œã€‚"}),e.jsx(st,{type:"primary",preferredClient:ue,preferredIDE:Se,getIdeTargetPath:()=>`src/${f}/${t.name}`,scene:`set-reference-${f}`,buildPrompt:()=>s,copySuccessMessage:"è®¾ç½®ä¸ºå‚è€ƒçš„ Prompt å·²å¤åˆ¶ï¼Œè¯·è¿”å›ž IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})]})})},kn=t=>{const s=f==="elements"?`elements/${t.name}`:`pages/${t.name}`;p.confirm({title:`ç¡®å®šè¦å–æ¶ˆ "${t.displayName}" çš„å‚è€ƒçŠ¶æ€å—ï¼Ÿ`,content:"å–æ¶ˆåŽè¯¥é¡¹ç›®å°†ä¸å†æ˜¯å‚è€ƒé¡¹ç›®ã€‚",okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const n=i.loading("æ­£åœ¨å–æ¶ˆå‚è€ƒ...",0);try{const r=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!r.ok){const a=await r.json();throw new Error(a.error||"å–æ¶ˆå‚è€ƒå¤±è´¥")}i.success("å·²å–æ¶ˆå‚è€ƒ"),U(null),lt()}catch(r){i.error(r.message||"å–æ¶ˆå‚è€ƒå¤±è´¥")}finally{n()}}})},An=t=>{const s=f==="elements"?"å…ƒç´ ":"é¡µé¢",n=f==="elements"?`elements/${t.name}`:`pages/${t.name}`;let r=t.displayName;p.confirm({title:`é‡å‘½å${s}`,content:e.jsx("div",{children:e.jsx(Be,{autoFocus:!0,defaultValue:t.displayName,placeholder:"è¯·è¾“å…¥æ–°çš„æ˜¾ç¤ºåç§°ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰",onChange:a=>{r=a.target.value}})}),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const a=r.trim();if(!a)return i.error("è¯·è¾“å…¥æ–°çš„åç§°"),Promise.reject();if(a===t.displayName)return;const d=i.loading("æ­£åœ¨é‡å‘½å...",0);try{const x=await fetch("/api/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n,newName:a})});if(!x.ok){const g=await x.json().catch(()=>({}));throw new Error(g.error||"é‡å‘½åå¤±è´¥")}i.success("é‡å‘½åæˆåŠŸ"),U(null),lt()}catch(x){return i.error(x.message||"é‡å‘½åå¤±è´¥"),Promise.reject()}finally{d()}}})},Tn=async(t,s)=>{const n=await fetch("/api/items/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemType:t,itemName:s})});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.error||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}return n.json()},Rn=t=>{if(t.isReference){i.error("å‚è€ƒé¡¹ç›®æ— æ³•åˆ é™¤ï¼Œè¯·å…ˆå–æ¶ˆå‚è€ƒçŠ¶æ€");return}const s=f,n=f==="elements"?"å…ƒç´ ":"é¡µé¢",r=`${s}/${t.name}`,a=async()=>{const x=i.loading("æ­£åœ¨åˆ é™¤...",0);try{const g=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:r})});if(!g.ok){const I=await g.json();throw new Error(I.error||"åˆ é™¤å¤±è´¥")}i.success("åˆ é™¤æˆåŠŸ"),U(null),lt()}catch(g){i.error(g.message||"åˆ é™¤å¤±è´¥")}finally{x()}};(async()=>{const x=i.loading("æ­£åœ¨æ£€æŸ¥å¼•ç”¨...",0);try{const g=await Tn(s,t.name),I=Array.isArray(g==null?void 0:g.references)?g.references:[];if(I.length>0){const A=I.map(G=>`- ${G}`).join(`
`),me=`æˆ‘å¸Œæœ›åˆ é™¤${n} "${t.displayName}" (${t.name})ã€‚
è¯¥${n}ä½äºŽé¡¹ç›®ä¸­çš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š\`src/${s}/${t.name}\`

å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥${n}ï¼š
${A}

è¯·å¸®æˆ‘æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥å’Œæ“ä½œï¼š
1. æ ¸å¯¹ä¸Šè¿°å¼•ç”¨æ˜¯å¦å‡†ç¡®ï¼Œå¹¶è¡¥å……é—æ¼çš„å¼•ç”¨æ–‡ä»¶ï¼ˆä¼˜å…ˆæ£€æŸ¥ \`src/elements/\` ä¸Ž \`src/pages/\`ï¼‰ã€‚
2. å¦‚æžœç¡®è®¤ç»§ç»­åˆ é™¤ï¼Œè¯·ååŠ©æˆ‘å°†è¯¥${n}åœ¨å¼•ç”¨å¤„æ›¿æ¢ä¸ºåˆé€‚çš„å®žçŽ°ï¼Œå¹¶æ›´æ–°å¼•ç”¨è·¯å¾„ï¼Œä½¿è¿™äº›åŽŸåž‹ä¸å†ä¾èµ–è¯¥ç›®å½•ã€‚
3. å®Œæˆä¸Šè¿°è§£è€¦æ“ä½œåŽï¼Œå†å½»åº•åˆ é™¤ç›®å½• \`src/${s}/${t.name}\`ã€‚`;p.confirm({title:`æ£€æµ‹åˆ°${n}å¼•ç”¨`,width:720,okText:"å…³é—­",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:8},children:["å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥",n,"ï¼š"]}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:A}),e.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:e.jsx(st,{type:"primary",preferredClient:ue,preferredIDE:Se,getIdeTargetPath:()=>`src/${s}/${t.name}`,scene:`delete-ref-fix-${s}`,buildPrompt:()=>me,copySuccessMessage:"å·²å¤åˆ¶å¤„ç†æç¤ºï¼Œè¯·è¿”å›žç¼–è¾‘å™¨è®© AI å¤„ç†ã€‚",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})})]})})}else p.confirm({title:`ç¡®å®šè¦åˆ é™¤${n} "${t.displayName}" å—ï¼Ÿ`,content:"æœªæ£€æµ‹åˆ°å¼•ç”¨æ–‡ä»¶ã€‚åˆ é™¤åŽæ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…Žæ“ä½œã€‚",okText:"ç¡®è®¤åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",onOk:a})}catch(g){i.error(g.message||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}finally{x()}})()},Dn=async t=>{const s=f==="elements"?"elements":"pages",n=`src/${s}/${t.name}`,r=(d,x)=>{let g=`${d}-copy`,I=1;for(;x.includes(g);)I++,g=`${d}-copy${I}`;return g},a=i.loading("æ­£åœ¨åˆ›å»ºå‰¯æœ¬...",0);try{const d=(f==="elements"?N.elements:N.pages).map(A=>A.name),x=r(t.name,d),g=`src/${s}/${x}`,I=await fetch("/api/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:n,targetPath:g})});if(!I.ok){const A=await I.json();throw new Error(A.error||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}i.success(`å‰¯æœ¬ "${x}" åˆ›å»ºæˆåŠŸ`),lt()}catch(d){i.error(d.message||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}finally{a()}},jt=o.useMemo(()=>{const t=f==="elements"?N.elements:N.pages;if(!W)return t;const s=W.toLowerCase();return t.filter(n=>n.displayName.toLowerCase().includes(s)||n.name.toLowerCase().includes(s))},[N,f,W]),Pn=async({key:t})=>{C.mode==="webEditorV2"&&await cs({restoreDevice:!1});const s=jt.find(n=>n.name===t);s&&(U(s),Rt("spec"),f==="elements"&&xe({width:600,height:400}))},ls=t=>{w(t),ie(""),U(null),Rt("spec")},Nn=()=>{Re(t=>t+1)},Ve=t=>{var n,r;const s=t??Ke();return(r=(n=s==null?void 0:s.contentWindow)==null?void 0:n.DevTemplateBootstrap)==null?void 0:r.editors},Ge=()=>{var n;const t=Ve(),s=(n=t==null?void 0:t.getStatus)==null?void 0:n.call(t);s&&re(s)},Ln=()=>{if(!l)return"";const t=window.location.origin+l.demoUrl,s=new URL(t,window.location.origin);if(s.searchParams.set("editor","inspecta"),Ie.id!=="desktop"){const n=ut.width?Math.round(ut.width):Ie.width;n&&s.searchParams.set("width",String(n))}return s.toString()},Un=()=>Ie.id==="desktop"?null:(ut.width?Math.round(ut.width):Ie.width)||null,zn=()=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(se==="spec"){i.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}const t=Ln();if(!t)return;const s=Ve();if(s!=null&&s.disable)try{s.disable(),C.mode==="webEditorV2"&&zt(),Ge()}catch(n){console.error("[Axhub] é€€å‡ºå½“å‰ç¼–è¾‘æ¨¡å¼å¤±è´¥:",n)}window.open(t,"_blank")},On=!!l&&se!=="spec",Ke=()=>D.current,dt=t=>{const s=t??Ke();if(!s)return window.location.origin;const n=s.getAttribute("src")||s.src;if(!n)return window.location.origin;try{return new URL(n,window.location.origin).origin}catch{return window.location.origin}},_n=t=>{const s=Date.now(),n=(t==null?void 0:t.timeoutMs)??5e3,r=t==null?void 0:t.expectedEditor;return new Promise(a=>{const d=g=>{const I=g.getAttribute("src")||g.src;if(!I)return!1;try{return new URL(I,window.location.origin).searchParams.get("editor")===r}catch{return!1}},x=()=>{var A;const g=Ke();if(!g||!g.isConnected){if(Date.now()-s>=n){a(null);return}setTimeout(x,50);return}if(!d(g)){if(Date.now()-s>=n){a(null);return}setTimeout(x,50);return}const I=g.contentWindow;if((A=I==null?void 0:I.DevTemplateBootstrap)!=null&&A.editors){a(g);return}if(Date.now()-s>=n){a(null);return}setTimeout(x,50)};x()})},_e=(t,s)=>{const n=s??Ke();return!n||!n.contentWindow?(i.warning("æœªæ‰¾åˆ°å¯æ“ä½œçš„é¢„è§ˆçª—å£"),!1):(n.contentWindow.postMessage(t,dt(n)),!0)},zt=o.useCallback(()=>{var t;te(s=>s&&{...s,selectedElements:[]}),pe&&u&&((t=Ae.current)!=null&&t.contentWindow)&&wt({version:De.version,systemContext:De.systemContext,currentFile:De.currentFile,selectedElements:[],extensions:De.extensions},"replace")},[pe,u,De,wt]),Mn=async()=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(se==="spec"){i.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}try{const t=Ke(),s=Un();P.current=s??null,oe(!0),Ie.id!=="desktop"&&(K.current=F,_("desktop"));const n=await _n({previousIframe:Ie.id!=="desktop"?t:null,expectedEditor:"webEditorV2"});if(!n){oe(!1),i.warning("é¢„è§ˆçª—å£å°šæœªå°±ç»ª");return}const r=Ve(n);if(!(r!=null&&r.enable)){oe(!1),i.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨");return}s&&_e({type:"WEB_EDITOR_SET_ROOT_SIZE",width:s},n),await Promise.resolve(r.enable("webEditorV2")),Ge(),He.current===null&&(He.current=q),Y(!0)}catch(t){console.error("[Axhub] å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥:",t),i.error("å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥")}},cs=async t=>{const s=Ve();if(!(s!=null&&s.disable)){zt(),i.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨"),oe(!1),He.current!==null&&(Y(He.current),He.current=null),P.current&&(_e({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),P.current=null),(t==null?void 0:t.restoreDevice)!==!1&&K.current&&_(K.current),K.current=null;return}try{await Promise.resolve(s.disable()),zt(),Ge(),oe(!1),He.current!==null&&(Y(He.current),He.current=null),P.current&&(_e({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),P.current=null);const n=(t==null?void 0:t.restoreDevice)!==!1;n&&K.current&&_(K.current),K.current=null,n||(K.current=null)}catch(n){console.error("[Axhub] é€€å‡ºç¼–è¾‘å™¨å¤±è´¥:",n),i.error("é€€å‡ºç¼–è¾‘å™¨å¤±è´¥")}},Bn=()=>{},Fn=()=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(se==="spec"){i.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}const t=Ve();if(t!=null&&t.enable){try{t.enable("textEdit"),Ge()}catch(s){console.error("[Axhub] å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥:",s),i.error("å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥")}return}_e({type:"TEXT_EDIT_ENABLE"})},ds=(t=!1)=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(se==="spec"){i.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}J.current=t,_e({type:"TEXT_EDIT_SAVE",exitAfterSave:t})},Wn=()=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(se==="spec"){i.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}if(y.editedCount>0){p.confirm({title:"é€€å‡ºæ–‡æœ¬ç¼–è¾‘",content:`æ£€æµ‹åˆ° ${y.editedCount} å¤„æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦ä¿å­˜åŽé€€å‡ºï¼Ÿ`,okText:"ä¿å­˜å¹¶é€€å‡º",cancelText:"ä¸ä¿å­˜é€€å‡º",onOk:()=>ds(!0),onCancel:()=>{_e({type:"TEXT_EDIT_EXIT",discardChanges:!0});const s=Ve();s!=null&&s.disable&&(s.disable(),Ge())}});return}const t=Ve();if(t!=null&&t.disable){t.disable(),Ge();return}_e({type:"TEXT_EDIT_EXIT",discardChanges:!1})},us=(t=!0)=>new Promise((s,n)=>{const r=Ke();if(!r||!r.contentWindow){n(new Error("æœªæ‰¾åˆ°å¯å¯¼å‡ºçš„é¢„è§ˆçª—å£"));return}const a=dt(r),d=window.setTimeout(()=>{window.removeEventListener("message",x),n(new Error("å¯¼å‡ºè¶…æ—¶ï¼Œè¯·é‡è¯•"))},15e3),x=g=>{if(g.source===r.contentWindow&&g.origin===a&&!(!g.data||g.data.type!=="FIGMA_JSON_READY"))if(window.removeEventListener("message",x),window.clearTimeout(d),g.data.success){const I=g.data.json??g.data.data??g.data.payload;if(I===void 0){n(new Error("å¯¼å‡ºæˆåŠŸä½†æœªè¿”å›žæ•°æ®ï¼ˆç¼ºå°‘ json/data/payload å­—æ®µï¼‰"));return}const A=Array.isArray(I)?I:I.layers||[];s({layers:A,widgetId:g.data.widgetId,pageId:g.data.pageId})}else n(new Error(g.data.error||"å¯¼å‡ºå¤±è´¥"))};window.addEventListener("message",x),r.contentWindow.postMessage({type:"EXPORT_FIGMA_JSON",rootName:(l==null?void 0:l.displayName)||(l==null?void 0:l.name),enableAutoLayout:t},a)}),Hn=async(t=!0)=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const s=i.loading("æ­£åœ¨ç”Ÿæˆ Figma JSON...",0);try{const{layers:n,widgetId:r,pageId:a}=await us(t),d={layers:n,...r?{widgetId:r}:{},...a?{pageId:a}:{}},x=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),g=URL.createObjectURL(x),I=document.createElement("a");I.href=g,I.download=`${l.name}-${f}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(g),i.success("JSON å·²ä¸‹è½½")}catch(n){i.error((n==null?void 0:n.message)||"å¯¼å‡ºå¤±è´¥")}finally{s()}},hs=()=>{if(!l)return"";const t=l.demoUrl,s=window.__LOCAL_IP__||"localhost",n=window.location.port||(window.location.protocol==="https:"?"443":"80");return`${window.location.protocol}//${s}:${n}${t}`},Ie=o.useMemo(()=>Bt.find(t=>t.id===F)||Bt[0],[F]);o.useEffect(()=>{Bt.some(s=>s.id===F)||_("desktop")},[F]);const[ut,ps]=o.useState({width:0,height:0});o.useEffect(()=>{if(Ie.id==="desktop"||Ie.width===0||!ee.current){ps({width:0,height:0}),Z(1);return}const t=()=>{if(!ee.current)return;const s=ee.current.clientWidth*.9,n=ee.current.clientHeight*.9,r=Ie.width,a=Ie.height,g=24+8,I=(s-g)/r,A=(n-g)/a,me=Math.min(I,A),G=r*me,fe=a*me;ps({width:G,height:fe}),Z(1)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[Ie,q]);const Ot=(t,s)=>{const n=t??$.width,r=s??$.height,a=Ke();if(a&&a.contentWindow){const d=dt(a);a.contentWindow.postMessage({type:"CAPTURE_SCREENSHOT",targetWidth:n,targetHeight:r},d)}};o.useEffect(()=>{if(et&&$.contentType==="screenshot"){const t=f==="pages"?1920:500,s=f==="pages"?1080:300;$.width===t&&$.height===s&&Ot()}if(!et){const t=Ke();if(t&&t.contentWindow){const s=dt(t);t.contentWindow.postMessage({type:"RESET_SCREENSHOT_STYLES"},s)}}},[et,$.contentType,$.width,$.height]);const[Vn,_t]=o.useState([]),Gn=window.location.port||(window.location.protocol==="https:"?"443":"80"),Mt=async()=>{try{const t=await fetch("/api/ws/clients");if(t.ok){const n=(await t.json()).clients||[];return _t(n),n}else return _t([]),[]}catch(t){return console.error("Failed to check WS clients",t),_t([]),[]}};o.useEffect(()=>{Mt()},[]);const Kn=async()=>{if(!l){i.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const t=i.loading("æ­£åœ¨æ£€æŸ¥è¿žæŽ¥...",0),s=await Mt();t(),s.length===0?p.confirm({title:"æœªæ£€æµ‹åˆ° Figma è¿žæŽ¥",content:e.jsxs("div",{children:[e.jsx("p",{children:"è¯·ç¡®ä¿ Figma æ’ä»¶å·²æ‰“å¼€å¹¶è¿žæŽ¥åˆ°å½“å‰æœåŠ¡ã€‚"}),e.jsxs("p",{style:{color:"#999",fontSize:12},children:["å½“å‰æœåŠ¡ç«¯å£: ",Gn]})]}),okText:"ä»è¦æŽ¨é€",cancelText:"å–æ¶ˆ",onOk:()=>fs()}):fs()},fs=async()=>{const t=i.loading("æ­£åœ¨èŽ·å–æ•°æ®...",0);try{const{layers:s,widgetId:n,pageId:r}=await us();if(t(),!s||!Array.isArray(s)||s.length===0){i.error("å›¾å±‚æ•°æ®ä¸ºç©ºï¼Œæ— æ³•æŽ¨é€");return}let a;f==="elements"?(n||i.warning("å…ƒç´ ç¼ºå°‘ widgetIdï¼Œå¯èƒ½å¯¼è‡´åŒæ­¥å¤±è´¥"),a={type:"sync-widget-content",widgetId:n||`element-${(l==null?void 0:l.name)||"unknown"}-${Date.now()}`,data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}}):a={type:"sync-page-content",...r?{pageId:r}:{},data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}};const d=i.loading("æ­£åœ¨æŽ¨é€åˆ° Figma...",0);try{const x=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(x.ok)await x.json(),i.success("æŽ¨é€æˆåŠŸ");else{const g=await x.text();throw new Error(g||"å‘é€å¤±è´¥")}}catch(x){i.error("æŽ¨é€å¤±è´¥: "+x.message)}finally{d()}}catch(s){t(),i.error((s==null?void 0:s.message)||"èŽ·å–æ•°æ®å¤±è´¥")}},Jn=(t,s,n,r=2)=>new Promise((a,d)=>{const x=new Image,g=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),I=URL.createObjectURL(g);x.onload=()=>{const A=document.createElement("canvas");A.width=s*r,A.height=n*r;const me=A.getContext("2d");if(!me){d(new Error("Could not get canvas context"));return}me.drawImage(x,0,0,A.width,A.height),URL.revokeObjectURL(I),a(A.toDataURL("image/png"))},x.onerror=A=>{URL.revokeObjectURL(I),d(A)},x.src=I}),Xn=async()=>{if(l){Lt(!0);try{const t=window.location.origin+l.jsUrl,s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch code: ${s.statusText}`);const n=await s.text();let r="";if(l){const d=`${window.location.origin}/${f}/${l.name}/hack.css`;try{const x=await fetch(d);x.ok&&(r=await x.text())}catch(x){console.warn("fetch hack.css failed",x)}}const a=async(d=!1)=>{const x=`${window.location.origin}/${f}/${l.name}`,g=["spec","prd"],I={};for(const G of g){const fe=`${x}/${G}.md`;try{const ve=await fetch(fe);if(ve.ok){const Te=await ve.text(),Pe={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};I[G]={name:Pe[G],content:Te}}}catch(ve){console.warn(`Failed to fetch ${G}.md`,ve)}}if(d){const G=`${f}/${l.name}`,fe=`${window.location.origin}/api/source?path=${encodeURIComponent(G)}`;try{const ve=await fetch(fe);if(ve.ok){const Pe=`\`\`\`tsx
${await ve.text()}
\`\`\`
`;I.code={name:"å‚è€ƒä»£ç ",content:Pe}}}catch(ve){console.warn("Failed to fetch source code",ve)}}const A=Object.keys(I);return A.length>1?I:A.length===1?I[A[0]].content:null};if($.contentType==="screenshot"&&!$.rawScreenshotUrl){i.warning("æ­£åœ¨ç”Ÿæˆæˆªå›¾ï¼Œè¯·ç¨å€™..."),Lt(!1);return}try{let d="",x="";if($.includeConfig!=="none"&&(d=n,$.includeConfig==="codeAndDocs"||$.includeConfig==="codeAndDocsAndSource")){const Ne=$.includeConfig==="codeAndDocsAndSource",Je=await a(Ne);Je&&(x=Je)}const g=f==="elements"?"å…ƒç´ ":"é¡µé¢";let I="";if($.contentType==="title"){const Ne=Ut("",$,l.displayName,g),Je=await Jn(Ne,$.width,$.height,2);I=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${$.width}" height="${$.height}" viewBox="0 0 ${$.width} ${$.height}">
                            <rect width="100%" height="100%" fill="transparent" />
                            <image x="0" y="0" width="${$.width}" height="${$.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${Je}"/>
                        </svg>`}else I=Ut($.rawScreenshotUrl,$,l.displayName,g);const me=new DOMParser().parseFromString(I,"image/svg+xml"),G=me.querySelector("svg");if(!G)throw new Error("SVG generation failed");if(d||x){const Ne={code:d,spec:x};G.setAttribute("AxExtraData",encodeURIComponent(JSON.stringify(Ne)))}if($.includeConfig!=="none"){const Ne={time:Math.floor(Date.now()/1e3),config:{codeLink:t,...f==="pages"?{isFullScreen:!0}:{},...r?{hackCss:r}:{}}};G.setAttribute("AxData",encodeURIComponent(JSON.stringify(Ne)))}const ve=new XMLSerializer().serializeToString(me),Te=new Blob([ve],{type:"image/svg+xml;charset=utf-8"}),Pe=URL.createObjectURL(Te),ye=document.createElement("a");ye.href=Pe,ye.download=`${l.name}.svg`,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),URL.revokeObjectURL(Pe),i.success("SVG å¯¼å‡ºæˆåŠŸ"),Nt(!1)}catch(d){console.error("Image export failed:",d),i.error("å›¾ç‰‡å¯¼å‡ºå¤±è´¥")}}catch(t){i.error(`å¯¼å‡ºå¤±è´¥: ${t.message}`),console.error("å¯¼å‡ºå¤±è´¥:",t)}finally{Lt(!1)}}},qn=async t=>{if(!l)throw new Error("æœªé€‰æ‹©é¡¹ç›®");const s=window.location.origin+l.jsUrl,n=await fetch(s);if(!n.ok)throw new Error(`Failed to fetch code: ${n.statusText}`);const r=await n.text();let a="";const d=`${window.location.origin}/${f}/${l.name}/hack.css`;try{const I=await fetch(d);I.ok&&(a=await I.text())}catch{}const x=async(I=!1)=>{const A=`${window.location.origin}/${f}/${l.name}`,me=["spec","prd"],G={};for(const Te of me){const Pe=`${A}/${Te}.md`;try{const ye=await fetch(Pe);if(ye.ok){const Ne=await ye.text(),Je={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};G[Te]={name:Je[Te],content:Ne}}}catch(ye){console.warn(`Failed to fetch ${Te}.md`,ye)}}if(I){const Te=`${f}/${l.name}`,Pe=`${window.location.origin}/api/source?path=${encodeURIComponent(Te)}`;try{const ye=await fetch(Pe);if(ye.ok){const Je=`\`\`\`tsx
${await ye.text()}
\`\`\`
`;G.code={name:"å‚è€ƒä»£ç ",content:Je}}}catch(ye){console.warn("Failed to fetch source code",ye)}}const fe=Object.keys(G);return fe.length>1?G:fe.length===1?G[fe[0]].content:null},g={time:Math.floor(Date.now()/1e3),config:{code:r,...f==="pages"?{isFullScreen:!0}:{},...a?{hackCss:a}:{}}};if(t==="codeAndDocs"||t==="codeAndDocsAndSource"){const A=await x(t==="codeAndDocsAndSource");A&&(g.config.spec=A)}return JSON.stringify(g,null,2)},Yn=V||C.mode==="webEditorV2"?"webEditorV2":C.mode,Zn=V||C.mode==="webEditorV2"?P.current??void 0:void 0,Qn=l?gr(l,se,Yn,{width:Zn}):"",eo=t=>{const s=window.location.origin+t.demoUrl;window.open(s,"_blank")},to=()=>{Ze("button",ze,void 0,"window")};return e.jsxs(pt,{style:{minHeight:"100vh"},children:[M,e.jsx("style",{children:`
                .resize-handle-right {
                    cursor: ew-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-right::before {
                    content: '';
                    position: absolute;
                    right: 50%;
                    top: 50%;
                    transform: translate(50%, -50%);
                    width: 2px;
                    height: 40px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-right:hover::before,
                .resize-handle-right:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 3px;
                    height: 50px;
                }
                .resize-handle-bottom {
                    cursor: ns-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottom::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    bottom: 50%;
                    transform: translate(-50%, 50%);
                    width: 40px;
                    height: 2px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottom:hover::before,
                .resize-handle-bottom:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 50px;
                    height: 3px;
                }
                .resize-handle-bottomRight {
                    cursor: nwse-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottomRight::before {
                    content: '';
                    position: absolute;
                    right: 0;
                    bottom: 0;
                    width: 12px;
                    height: 12px;
                    background: var(--ant-color-border);
                    border-radius: 0 0 6px 0;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottomRight:hover::before,
                .resize-handle-bottomRight:active::before {
                    background: var(--ant-color-border-secondary);
                    width: 16px;
                    height: 16px;
                }
                /* å®¹å™¨æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹æŸ„ */
                .ant-card-hoverable:hover .resize-handle-right::before,
                .ant-card-hoverable:hover .resize-handle-bottom::before,
                .ant-card-hoverable:hover .resize-handle-bottomRight::before {
                    background: var(--ant-color-border-secondary);
                }

                /* èœå•é¡¹ hover æ—¶æ˜¾ç¤ºæ›´å¤šæŒ‰é’® */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }

                /* ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ */
                @media (max-width: 768px) {
                    /* éšè— PC ç«¯çš„å®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: none !important;
                    }
                    
                    /* æ˜¾ç¤ºç§»åŠ¨ç«¯ç®€åŒ–å¸ƒå±€ */
                    .mobile-layout {
                        display: block !important;
                    }
                }

                @media (min-width: 769px) {
                    /* PC ç«¯æ˜¾ç¤ºå®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: block !important;
                    }
                    
                    /* éšè—ç§»åŠ¨ç«¯å¸ƒå±€ */
                    .mobile-layout {
                        display: none !important;
                    }
                }

                /* ç§»åŠ¨ç«¯åˆ—è¡¨æ ·å¼ */
                .mobile-item-card {
                    background: ${h?"#1f1f1f":"#fff"};
                    border: 1px solid ${h?"#303030":"#f0f0f0"};
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 12px;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .mobile-item-card:hover {
                    border-color: ${h?"#177ddc":"#1890ff"};
                    box-shadow: 0 2px 8px ${h?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.1)"};
                }

                .mobile-item-card:active {
                    transform: scale(0.98);
                }

                .mobile-item-title {
                    font-size: 16px;
                    font-weight: 500;
                    color: ${h?"#fff":"#000"};
                    margin-bottom: 4px;
                }

                .mobile-item-name {
                    font-size: 12px;
                    color: ${h?"#8c8c8c":"#999"};
                }
            `}),e.jsxs("div",{className:"pc-layout",children:[e.jsx(nr,{collapsed:q,setCollapsed:Y,selectedItem:l,viewMode:se,setViewMode:mt,activeTab:f,selectedDeviceId:F,setSelectedDeviceId:_,deviceSegmentOptions:jn,handleOpenInspect:zn,handleOpenWebEditor:Mn,handleExitWebEditor:cs,handleSaveWebEditor:Bn,handleEnableTextEdit:Fn,handleSaveTextEdit:()=>ds(!1),handleExitTextEdit:Wn,handleRefreshElement:Nn,handleCopyLocalLink:mn,handleCopyLANLink:xn,handleDownloadZip:gn,getLANUrl:hs,qrCodeVisible:Fe,setQrCodeVisible:Le,wsClients:Vn,checkConnection:Mt,handlePushToFigma:Kn,handleDownloadFigmaJson:Hn,setIsExportModalOpen:Nt,handleOpenIdeFile:yn,handleOpenProjectInIDE:wn,preferredIDE:Se,onPreferredIDEChange:ke,isDarkMode:h,setIsDarkMode:E,currentSpecDocKey:Ue,textEditState:y,textEditAvailable:On,editorMode:C.mode,handleRefreshEditorStatus:Ge,onSettingsSaved:()=>{Me.getConfig().then(t=>{var n,r;const s=(n=t==null?void 0:t.automation)==null?void 0:n.defaultPromptClient;je(s==="claude"||s==="cursor"||s==="codex"?s:null),ke(((r=t==null?void 0:t.automation)==null?void 0:r.defaultIDE)||null)}).catch(()=>{je(null),ke(null)})},assistantEnabled:!0,assistantVisible:pe,onToggleAssistant:fn}),e.jsxs(pt,{children:[e.jsx(Zo,{collapsed:q,loading:O,activeTab:f,handleTabChange:ls,data:N,searchText:W,setSearchText:ie,filteredItems:jt,selectedItem:l,handleMenuClick:Pn,handleDownloadItemSource:In,handleRenameItem:An,handleSetReference:$n,handleUnsetReference:kn,handleDuplicateItem:Dn,handleDeleteItem:Rn,handleCopyItemPath:bn,setCreateDialogVisible:tn,preferredPromptClient:ue,preferredIDE:Se}),e.jsxs("div",{style:{display:"flex",flex:1,minWidth:0},children:[e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(ir,{containerRef:ee,previewIframeRef:D,selectedItem:l,activeTab:f,currentDevice:Ie,displaySize:ut,scale:ne,elementIframeKey:Ee,iframeUrl:Qn,elementIframeSize:le,setElementIframeSize:xe,viewMode:se})}),pe&&e.jsx(zs,{size:{width:Math.min(Math.max(We,k),Dt),height:"100%"},minWidth:k,maxWidth:Dt,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(t,s,n)=>{const r=Math.min(Math.max(n.getBoundingClientRect().width,k),Dt);Qe(r)},style:{borderLeft:`1px solid ${z.colorBorderSecondary}`,background:z.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:Ae,src:ze,title:"Axhub Genie",onLoad:()=>m(!0),style:{border:"none",width:"100%",height:"100%"}})})]})]}),e.jsx(dr,{visible:Bs,onClose:pn,activeTab:f,createName:Fs,setCreateName:sn,createReference:Ws,setCreateReference:nn,createMode:Hs,setCreateMode:on,generateAxure:Vs,setGenerateAxure:rn,referenceItems:Gs,selectedDocs:Ys,setSelectedDocs:cn,availableDocs:Zs,selectedThemes:Ks,setSelectedThemes:an,availableThemes:Js,selectedDataAssets:Qs,setSelectedDataAssets:dn,availableDataAssets:en,selectedLibraries:Xs,setSelectedLibraries:ln,availableLibraries:qs,preferredPromptClient:ue,preferredIDE:Se,buildCreatePrompt:un,onAfterCreatePromptAction:hn}),e.jsx(Ko,{open:et,onClose:()=>Nt(!1),imageConfig:$,setImageConfig:Oe,onDimensionChange:vn,onSwapDimensions:En,onDimensionBlur:Cn,isExporting:Sn,onExport:Xn,onCopyConfig:qn,activeTab:f,itemName:l==null?void 0:l.name,preferredPromptClient:ue,preferredIDE:Se})]}),e.jsx("div",{className:"mobile-layout",style:{display:"none"},children:e.jsxs("div",{style:{padding:"16px",minHeight:"100vh",background:h?"#141414":"#f5f5f5"},children:[e.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsxs("h1",{style:{margin:0,fontSize:"24px",fontWeight:600,color:h?"#fff":"#000"},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})}),e.jsx(X,{type:"default",icon:e.jsx(es,{}),onClick:to,children:"ç½‘é¡µåŠ©æ‰‹"})]}),e.jsx(Qt,{activeKey:f,onChange:t=>ls(t),style:{marginBottom:"16px"},items:[{key:"pages",label:`é¡µé¢ (${N.pages.length})`,icon:e.jsx(nt,{})},{key:"elements",label:`å…ƒç´  (${N.elements.length})`,icon:e.jsx(qt,{})}]}),e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Ps,{}),value:W,onChange:t=>ie(t.target.value),allowClear:!0,style:{marginBottom:"16px"}}),O?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(ht,{tip:"åŠ è½½ä¸­..."})}):e.jsx("div",{children:jt.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:h?"#8c8c8c":"#999"},children:["æš‚æ— ",f==="elements"?"å…ƒç´ ":"é¡µé¢"]}):jt.map(t=>e.jsxs("div",{className:"mobile-item-card",onClick:()=>eo(t),children:[e.jsx("div",{className:"mobile-item-title",children:t.displayName}),e.jsx("div",{className:"mobile-item-name",children:t.name})]},t.name))})]})}),M,j]})}function Sr(){const[h,E]=o.useState(()=>{try{return localStorage.getItem(ys)==="true"}catch{return!1}}),c=b=>{E(b);try{localStorage.setItem(ys,String(b))}catch(T){console.error("Failed to save dark mode preference:",T)}};return e.jsx(_o,{theme:Ho(h),children:e.jsx(Mo,{children:e.jsx(jr,{isDarkMode:h,setIsDarkMode:c})})})}const vr=Oo.createRoot(document.getElementById("root"));vr.render(e.jsx(Sr,{}));
