import{P as nt,a as Qe,M as Ht,W as Ts,b as ps,c as fs,d as ms,e as xs,f as gs,S as ys,A as ws,D as _t,o as bs}from"./chunks/PromptActionButton.js";import{I as Be,T as Me,r,s as W,j as e,M as Et,ab as Zt,J as mt,u as ye,F as vt,S as Je,a3 as js,ac as to,ad as Mt,ae as $e,af as Vt,b as Y,ag as It,ah as jt,t as rt,ai as so,l as Ss,aj as no,o as ot,ak as ks,a1 as oo,al as ro,L as xt,Q as As,am as Gt,d as Rs,an as ao,ao as Kt,ap as Jt,P as io,aq as Xt,D as Ct,O as lo,H as Ps,N as co,ar as uo,as as ho,Z as he,at as Ds,au as Ns,h as ve,i as po,k as fo,m as $t,B as Bt,w as Qt,x as mo,e as qt,y as xo,z as go,A as yo,E as wo,p as Yt,_ as bo,av as jo,aw as So,ax as vs,ay as vo,az as Co,aA as Eo,aB as Io,aC as $o,aD as To,aE as ko,aF as Ao,aG as Ls,aa as Us,aH as Ro,U as zs,aI as Cs,aJ as Po,aK as Do,R as No,C as Lo,a as Es,aL as Uo,a8 as zo,a9 as Oo,G as _o,aM as Mo,g as Bo,aN as Fo}from"./chunks/vendor.js";import{g as Wo}from"./chunks/index.js";import{i as Ho}from"./chunks/bridge.js";import"./chunks/execute.js";const{TextArea:Vo}=Be,{Text:st}=Me,Go=({open:f,onClose:v,imageConfig:c,setImageConfig:w,onDimensionChange:T,onSwapDimensions:k,onDimensionBlur:S,isExporting:D,onExport:B,onCopyConfig:ie,activeTab:G,itemName:Z,preferredPromptClient:U,preferredIDE:ne})=>{const Q=G==="elements"?"å…ƒç´ ":"é¡µé¢",[g,u]=r.useState(null),[H,d]=r.useState(!1),[N,K]=r.useState(!1),[J,de]=W.useMessage(),[z,L]=r.useState("export"),[ee,ae]=r.useState(""),[R,F]=r.useState(""),[le,M]=r.useState(!1);r.useEffect(()=>{(async()=>{if(R&&z==="copyConfig"){M(!0);try{if(!await O()){F(""),ae(""),M(!1);return}const V=await ie(R);ae(V)}catch{J.error("åŠ è½½é…ç½®å¤±è´¥"),ae("")}finally{M(!1)}}})()},[R,z,ie,J]),r.useEffect(()=>{f||(L("export"),F(""),ae(""))},[f]);const O=async()=>{if(!Z)return!0;K(!0);try{const C=`${G}/${Z}`,oe=await Qe.reviewCode(C);return oe.passed?!0:(u(oe),d(!0),!1)}catch(C){return console.error("ä»£ç æ£€æŸ¥å¤±è´¥:",C),!0}finally{K(!1)}},o=async()=>{await O()&&B()},b=async()=>{if(!ee){J.warning("è¯·å…ˆé€‰æ‹©å¯¼å‡ºå†…å®¹");return}try{await navigator.clipboard.writeText(ee),J.success("é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{J.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å‰ªè´´æ¿æƒé™")}},h=C=>{C.target.select()},j=async()=>{if(!g)throw new Error("æ²¡æœ‰å¯ç”¨çš„æ£€æŸ¥ç»“æœ");const C=g.issues.filter(ce=>ce.type==="error"),oe=g.issues.filter(ce=>ce.type==="warning");let V=`ä»£ç æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·å¸®æˆ‘ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š

`;return V+=`æ–‡ä»¶ï¼š${g.file}

`,C.length>0&&(V+=`âŒ é”™è¯¯ (${C.length} ä¸ª):
`,C.forEach((ce,xe)=>{V+=`
${xe+1}. [${ce.rule}] ${ce.message}
`,ce.suggestion&&(V+=`   å»ºè®®: ${ce.suggestion}
`)})),oe.length>0&&(V+=`
âš ï¸ è­¦å‘Š (${oe.length} ä¸ª):
`,oe.forEach((ce,xe)=>{V+=`
${xe+1}. [${ce.rule}] ${ce.message}
`,ce.suggestion&&(V+=`   å»ºè®®: ${ce.suggestion}
`)})),V};return e.jsxs(e.Fragment,{children:[de,e.jsx(Et,{title:"å¯¼å‡ºåˆ° Axure",open:f,onCancel:v,footer:z==="export"?[e.jsx(Y,{type:"primary",loading:D||N,onClick:o,children:"å¯¼å‡º"},"export")]:[e.jsx(Y,{type:"primary",disabled:!ee,onClick:b,children:"å¤åˆ¶é…ç½®"},"copy")],width:800,children:e.jsx(Zt,{activeKey:z,onChange:L,items:[{key:"export",label:"å¯¼å‡ºå›¾ç‰‡",children:e.jsxs("div",{style:{display:"flex",gap:"20px",height:"400px"},children:[e.jsx("div",{style:{flex:1,border:"1px solid #f0f0f0",borderRadius:"8px",overflow:"hidden",background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:c.previewUrl?e.jsx("img",{src:c.previewUrl,alt:"Preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}):e.jsx(mt,{tip:"æ­£åœ¨ç”Ÿæˆé¢„è§ˆ..."})}),e.jsxs("div",{style:{width:"240px",display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å¯¼å‡ºå°ºå¯¸",e.jsx(ye,{title:"è¿”å› Axure åŒå‡»å…ƒç´ å°±å¯ä»¥æ›¿æ¢å›¾ç‰‡ï¼ŒåŒå‡»å›¾ç‰‡å·¦ä¸Šè§’æˆ–è€…åœ¨æ ·å¼é¢æ¿é‡Œç‚¹å‡»è‡ªé€‚åº”å›¾ç‰‡å³å¯æ›´æ–°å›¾ç‰‡å°ºå¯¸",children:e.jsx(vt,{style:{color:"#999",cursor:"help"}})})]}),e.jsxs(Je,{children:[e.jsx(js,{value:c.width,onChange:C=>T("width",C),onBlur:S,placeholder:"å®½",style:{width:100},min:1}),e.jsx(to,{onClick:k,style:{color:"#999",cursor:"pointer",fontSize:14}}),e.jsx(js,{value:c.height,onChange:C=>T("height",C),onBlur:S,placeholder:"é«˜",style:{width:100},min:1})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å›¾ç‰‡å†…å®¹",e.jsx(ye,{title:"æ ‡é¢˜å°é¢ä¾¿äºåœ¨ Axure å†…æ›´æ”¹å°ºå¯¸",children:e.jsx(vt,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(Mt.Group,{value:c.contentType,onChange:C=>w(oe=>({...oe,contentType:C.target.value})),children:e.jsxs(Je,{direction:"vertical",children:[e.jsxs(Mt,{value:"title",children:[Q,"æ ‡é¢˜"]}),e.jsxs(Mt,{value:"screenshot",children:[Q,"æˆªå›¾"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["åŒ…å«é…ç½®",e.jsx(ye,{title:"è‹¥åŒ…å«é…ç½®ï¼Œä»…éœ€å¯¼å…¥å›¾ç‰‡åˆ° Axureï¼Œä¸€èˆ¬ä¸éœ€è¦å†å¤åˆ¶é…ç½®æˆ–è€…ä»£ç ",children:e.jsx(vt,{style:{color:"#999",cursor:"help"}})})]}),e.jsx($e,{value:c.includeConfig,onChange:C=>w(oe=>({...oe,includeConfig:C})),style:{width:"100%"},options:[{label:"æ— ",value:"none"},{label:"åŸå‹",value:"code"},{label:"åŸå‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŸå‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]})]})]})},{key:"copyConfig",label:"å¤åˆ¶é…ç½®",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"400px"},children:[e.jsx(Vt,{message:"å¯¼å‡ºæœ¬åœ° html æˆ–è€…å‘å¸ƒåˆ° Axure Cloud æ—¶è‹¥å›¾ç‰‡å¤±æ•ˆå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½",type:"info",showIcon:!0}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"å¯¼å‡ºå†…å®¹"}),e.jsx($e,{value:R||void 0,onChange:F,placeholder:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",style:{width:"100%"},options:[{label:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",value:"",disabled:!0},{label:"åŸå‹",value:"code"},{label:"åŸå‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŸå‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]}),R&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"é…ç½®å†…å®¹"}),le?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #d9d9d9",borderRadius:"6px"},children:e.jsx(mt,{tip:"æ­£åœ¨åŠ è½½é…ç½®..."})}):e.jsx(Vo,{value:ee,readOnly:!0,onFocus:h,style:{flex:1,fontFamily:"monospace",fontSize:"12px"},placeholder:"é…ç½®å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"})]})]})}]})}),e.jsx(Et,{title:"ä»£ç æ£€æŸ¥æœªé€šè¿‡",open:H,onCancel:()=>d(!1),width:600,footer:[e.jsx(Y,{onClick:()=>d(!1),children:"å–æ¶ˆ"},"cancel"),e.jsx(nt,{type:"primary",preferredClient:U,preferredIDE:ne,scene:`review-fix-${G}`,buildPrompt:j,getIdeTargetPath:()=>Z?`src/${G}/${Z}/index.tsx`:null,copySuccessMessage:"å¤åˆ¶æˆåŠŸ",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›é€€ä¸ºå¤åˆ¶ Prompt",onAfterCopy:()=>d(!1)},"copy")],children:g&&e.jsxs("div",{style:{maxHeight:"500px",overflowY:"auto"},children:[e.jsx(Vt,{description:"ä»£ç ä¸ç¬¦åˆå¼€å‘è§„èŒƒï¼Œéœ€è¦ä¿®å¤åæ‰èƒ½å¯¼å‡º",type:"error",showIcon:!0,style:{marginBottom:"24px"}}),g.issues.filter(C=>C.type==="error").length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(It,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(st,{type:"danger",children:"é”™è¯¯ (å¿…é¡»ä¿®å¤)"})}),e.jsx(jt,{size:"small",dataSource:g.issues.filter(C=>C.type==="error"),renderItem:C=>e.jsx(jt.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(st,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(st,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]}),g.issues.filter(C=>C.type==="warning").length>0&&e.jsxs("div",{children:[e.jsx(It,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(st,{type:"warning",children:"è­¦å‘Š (å»ºè®®ä¿®å¤)"})}),e.jsx(jt,{size:"small",dataSource:g.issues.filter(C=>C.type==="warning"),renderItem:C=>e.jsx(jt.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(st,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(st,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]})]})})]})},{Text:Ft}=Me,{useToken:Ko}=rt;function Jo({visible:f,onCancel:v,item:c,activeTab:w,preferredPromptClient:T,preferredIDE:k}){const{token:S}=Ko(),[D,B]=r.useState([]),[ie,G]=r.useState(!1),[Z,U]=r.useState(""),[ne,Q]=r.useState(""),[g,u]=r.useState(!1),[H,d]=r.useState(!1),[N,K]=r.useState(null),[J,de]=r.useState(null),z=o=>{const b=o;let h="";if(b.filePath){const j=b.filePath.indexOf("src/");h=j>=0?b.filePath.substring(j):b.filePath}else h=`${w==="pages"?"src/pages":"src/elements"}/${o.name}`;return h=h.replace(/\/index\.(t|j)sx?$/i,""),h=h.replace(/^\/+/,""),h.startsWith("src/")&&(h=h.substring(4)),h},L=o=>{const b=new Date(o),h=j=>String(j).padStart(2,"0");return`${b.getFullYear()}/${h(b.getMonth()+1)}/${h(b.getDate())} ${h(b.getHours())}:${h(b.getMinutes())}:${h(b.getSeconds())}`},ee=o=>{const b=Math.floor((Date.now()-o)/1e3);let h=b/31536e3;return h>1?Math.floor(h)+" å¹´å‰":(h=b/2592e3,h>1?Math.floor(h)+" ä¸ªæœˆå‰":(h=b/86400,h>1?Math.floor(h)+" å¤©å‰":(h=b/3600,h>1?Math.floor(h)+" å°æ—¶å‰":(h=b/60,h>1?Math.floor(h)+" åˆ†é’Ÿå‰":"åˆšåˆš"))))},ae=async()=>{if(c){d(!0);try{const o=z(c);if(!o){W.error("æ— æ³•è·å–æ–‡ä»¶è·¯å¾„"),d(!1);return}const b=await fetch(`/api/git/history?path=${encodeURIComponent(o)}`),h=await b.json();b.ok?(B(h.commits),G(h.hasUncommitted),U(h.uncommittedFiles)):W.error(h.error||"åŠ è½½ç‰ˆæœ¬å†å²å¤±è´¥")}catch{W.error("åŠ è½½ç‰ˆæœ¬å†å²å¤±è´¥")}finally{d(!1)}}};r.useEffect(()=>{f&&c&&ae()},[f,c]);const R=async o=>{if(c)try{const b=z(c),h=await fetch("/api/git/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b,commitHash:o})}),j=await h.json();h.ok?(W.success("ç‰ˆæœ¬æ¢å¤æˆåŠŸ"),ae()):W.error(j.error||"ç‰ˆæœ¬æ¢å¤å¤±è´¥")}catch{W.error("ç‰ˆæœ¬æ¢å¤å¤±è´¥")}},F=async()=>{if(!c||!ne.trim()){W.warning("è¯·è¾“å…¥æäº¤ä¿¡æ¯");return}u(!0);try{const o=z(c),b=await fetch("/api/git/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:o,message:ne})}),h=await b.json();b.ok?(W.success("æäº¤æˆåŠŸ"),Q(""),ae()):W.error(h.error||"æäº¤å¤±è´¥")}catch{W.error("æäº¤å¤±è´¥")}finally{u(!1)}},le=async()=>{if(!c)throw new Error("è¯·é€‰æ‹©æ¡ç›®åå†æ‰§è¡Œ");const o=z(c);return`æˆ‘éœ€è¦æäº¤ä»¥ä¸‹ç›®å½•çš„æ›´æ”¹ï¼Œè¯·å¸®æˆ‘å¤„ç†ï¼š

ç›®æ ‡è·¯å¾„: src/${o}

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. ä½¿ç”¨ git status å’Œ git diff æŸ¥çœ‹è¯¥è·¯å¾„ä¸‹çš„å˜æ›´å†…å®¹ã€‚
2. åˆ†æå˜æ›´ï¼Œç”Ÿæˆä¸€ä¸ªç®€æ´æ˜äº†çš„ä¸­æ–‡æäº¤ä¿¡æ¯ï¼ˆCommit Messageï¼‰ã€‚
3. å‘æˆ‘å±•ç¤ºå˜æ›´æ‘˜è¦å’Œå»ºè®®çš„æäº¤ä¿¡æ¯ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­ã€‚
4. è·å¾—ç¡®è®¤åï¼Œæ‰§è¡Œï¼š
   git add src/${o}
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"

è¯·ç›´æ¥å¼€å§‹æ‰§è¡Œç¬¬ 1 æ­¥ã€‚`},M=async o=>{if(c){K(o);try{const b=z(c),h=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b,commitHash:o})}),j=await h.json();h.ok&&j.hasSpec&&j.specUrl?window.open(j.specUrl,"_blank"):j.hasSpec?W.error(j.error||"æ— æ³•è®¿é—®è§„æ ¼æ–‡æ¡£"):W.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰è§„æ ¼æ–‡æ¡£")}catch{W.error("åŠ è½½è§„æ ¼æ–‡æ¡£å¤±è´¥")}finally{K(null)}}},O=async o=>{if(c){de(o);try{const b=z(c),h=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b,commitHash:o})}),j=await h.json();h.ok&&j.hasPrototype&&j.prototypeUrl?window.open(j.prototypeUrl,"_blank"):j.hasPrototype?W.error(j.error||"æ— æ³•è®¿é—®åŸå‹"):W.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰åŸå‹æ–‡ä»¶")}catch{W.error("åŠ è½½åŸå‹å¤±è´¥")}finally{de(null)}}};return e.jsx(Et,{title:`ç‰ˆæœ¬ç®¡ç† - ${c==null?void 0:c.displayName}`,open:f,onCancel:v,footer:null,width:700,centered:!0,className:"version-dialog",styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingTop:12,paddingBottom:12}},destroyOnClose:!0,children:e.jsx(mt,{spinning:H,children:D.length===0&&!ie?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"æš‚æ— ç‰ˆæœ¬å†å²"}):e.jsx(so,{mode:"left",items:[...ie?[{children:e.jsx("div",{className:"commit-item uncommitted",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Ft,{strong:!0,style:{fontSize:14,marginRight:8},children:"æœªæäº¤çš„æ›´æ”¹"}),e.jsx(Ss,{color:"warning",children:"æœªä¿å­˜"})]})}),e.jsxs("div",{style:{background:S.colorFillAlter,padding:12,borderRadius:8,border:`1px solid ${S.colorBorderSecondary}`},children:[e.jsx(Be,{placeholder:"æ‰‹åŠ¨è¾“å…¥æäº¤ä¿¡æ¯...",value:ne,onChange:o=>Q(o.target.value),onPressEnter:F,style:{marginBottom:12}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,color:S.colorTextSecondary},children:Z?`${Z.split(`
`).filter(Boolean).length} ä¸ªæ–‡ä»¶å˜æ›´`:"æœ‰æ–‡ä»¶å˜æ›´"}),e.jsxs(Je,{children:[e.jsx(nt,{type:"default",preferredClient:T,preferredIDE:k,scene:`version-commit-${w}`,buildPrompt:le,getIdeTargetPath:()=>c?`src/${z(c)}`:null,copySuccessMessage:"AI æŒ‡ä»¤å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´ç»™åŠ©æ‰‹",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›é€€ä¸ºå¤åˆ¶ Prompt"}),e.jsx(Y,{type:"primary",size:"small",onClick:F,loading:g,disabled:!ne.trim(),children:"æäº¤"})]})]})]})]})}),color:"orange",dot:e.jsx("div",{style:{width:10,height:10,background:S.colorWarning,borderRadius:"50%",border:`2px solid ${S.colorBgContainer}`}})}]:[],...D.map((o,b)=>{const h=b===0&&!ie;return{children:e.jsx("div",{className:"commit-item",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{marginBottom:4,display:"flex",alignItems:"center"},children:[e.jsx(Ft,{strong:!0,style:{fontSize:14,marginRight:8},children:o.message}),h&&e.jsx(Ss,{color:"success",children:"å½“å‰ç‰ˆæœ¬"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:S.colorTextSecondary},children:[e.jsxs(Je,{size:4,children:[e.jsx(no,{size:20,style:{backgroundColor:S.colorPrimary,fontSize:12},children:o.author?o.author[0].toUpperCase():"U"}),e.jsx("span",{children:o.author})]}),e.jsx("span",{style:{color:S.colorBorder},children:"|"}),e.jsx(ye,{title:L(o.timestamp),children:e.jsx("span",{style:{cursor:"help"},children:ee(o.timestamp)})}),e.jsx("span",{style:{color:S.colorBorder},children:"|"}),e.jsx(Ft,{code:!0,style:{fontSize:12,margin:0},children:o.hash.substring(0,7)})]})]}),!h&&e.jsxs(Je,{size:0,children:[e.jsx(ye,{title:"æŸ¥çœ‹è§„æ ¼æ–‡æ¡£",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(ot,{}),style:{color:S.colorTextSecondary},onClick:()=>M(o.hash),loading:N===o.hash})}),e.jsx(ye,{title:"æŸ¥çœ‹åŸå‹",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(ks,{}),style:{color:S.colorTextSecondary},onClick:()=>O(o.hash),loading:J===o.hash})}),e.jsx(oo,{title:"ç¡®è®¤æ¢å¤",description:"ç¡®å®šè¦æ¢å¤åˆ°æ­¤ç‰ˆæœ¬å—ï¼Ÿå½“å‰æœªæäº¤çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚",onConfirm:()=>R(o.hash),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(ye,{title:"æ¢å¤æ­¤ç‰ˆæœ¬",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(ro,{}),style:{color:S.colorTextSecondary}})})})]}),h&&e.jsx(Je,{size:0})]})}),color:h?"green":"gray",dot:h?e.jsx("div",{style:{width:10,height:10,background:S.colorSuccess,borderRadius:"50%",border:`2px solid ${S.colorBgContainer}`}}):void 0}})]})})})}const{Sider:Xo}=xt,{useToken:qo}=rt;function Yo({collapsed:f,loading:v,activeTab:c,handleTabChange:w,data:T,searchText:k,setSearchText:S,filteredItems:D,selectedItem:B,handleMenuClick:ie,handleDownloadItemSource:G,handleRenameItem:Z,handleSetReference:U,handleUnsetReference:ne,handleDuplicateItem:Q,handleDeleteItem:g,handleCopyItemPath:u,setCreateDialogVisible:H,preferredPromptClient:d,preferredIDE:N}){const{token:K}=qo(),[J,de]=r.useState(!1),[z,L]=r.useState(null),ee=R=>{L(R),de(!0)},ae=r.useMemo(()=>D.map(R=>{const F=B&&B.name===R.name,le=[{key:"rename",label:"é‡å‘½å",icon:e.jsx(As,{})},{key:"duplicate",label:"åˆ›å»ºå‰¯æœ¬",icon:e.jsx(Gt,{})},{key:"copy-path",label:"å¤åˆ¶è·¯å¾„",icon:e.jsx(Rs,{})},{type:"divider"},{key:"version-management",label:"ç‰ˆæœ¬ç®¡ç†",icon:e.jsx(ao,{})},{key:"download-source",label:"å¯¼å‡º ZIP",icon:e.jsx(Kt,{})},{type:"divider"},...R.isReference?[{key:"unset-reference",label:"å–æ¶ˆå‚è€ƒ",icon:e.jsx(Jt,{})}]:[{key:"set-reference",label:"è®¾ç½®ä¸ºå‚è€ƒ",icon:e.jsx(Jt,{})}],{key:"delete",label:`åˆ é™¤${c==="elements"?"å…ƒç´ ":"é¡µé¢"}`,icon:e.jsx(io,{}),danger:!0,disabled:R.isReference}];return{key:R.name,label:e.jsxs("div",{className:`menu-item-wrapper ${F?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:R.displayName})}),e.jsx(Ct,{trigger:["click"],menu:{items:le,onClick:({key:M})=>{M==="download-source"?G(R):M==="rename"?Z(R):M==="duplicate"?Q(R):M==="copy-path"?u(R):M==="version-management"?ee(R):M==="set-reference"?U(R):M==="unset-reference"?ne(R):M==="delete"&&g(R)}},children:e.jsx(Y,{type:"text",size:"small",className:"more-btn",icon:e.jsx(lo,{}),onClick:M=>{M.stopPropagation()}})})]}),icon:c==="elements"?e.jsx(Xt,{}):e.jsx(ot,{})}}),[D,c,B,G,Z,U,ne,g,u,Q]);return e.jsxs(Xo,{trigger:null,collapsible:!0,collapsed:f,width:240,collapsedWidth:0,style:{background:K.colorBgContainer,borderRight:`1px solid ${K.colorBorder}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:[e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!f&&e.jsxs(e.Fragment,{children:[e.jsx(Zt,{activeKey:c,size:"small",centered:!0,onChange:R=>w(R),items:[{key:"pages",label:`é¡µé¢ (${T.pages.length})`,icon:e.jsx(ot,{})},{key:"elements",label:`å…ƒç´  (${T.elements.length})`,icon:e.jsx(Xt,{})}]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Ps,{}),value:k,onChange:R=>S(R.target.value),allowClear:!0,style:{flex:1}})})]})}),v?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(mt,{tip:"åŠ è½½ä¸­..."})}):e.jsxs(e.Fragment,{children:[e.jsx(co,{mode:"inline",selectedKeys:B?[B.name]:[],items:ae,onClick:ie,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!f&&e.jsx(uo,{icon:e.jsx(ho,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:()=>H(!0),tooltip:c==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢"})]}),e.jsx(Jo,{visible:J,onCancel:()=>de(!1),item:z,activeTab:c,preferredPromptClient:d,preferredIDE:N})]})}const{Title:Wt}=Me;function Zo({open:f,onClose:v,onSaved:c}){const[w]=he.useForm(),[T,k]=r.useState(!1),[S,D]=r.useState([]),[B,ie]=r.useState([]),[G,Z]=r.useState(!1);r.useEffect(()=>{f&&(U(),ne())},[f]);const U=async()=>{var g,u,H,d,N,K,J,de;try{const z=await fetch("/api/config");if(!z.ok)throw new Error("Failed to load config");const L=await z.json();w.setFieldsValue({host:L.server.host||"localhost",allowLAN:L.server.allowLAN!==!1,enableCommandAPI:L.server.enableCommandAPI||!1,projectName:((g=L.projectInfo)==null?void 0:g.name)||void 0,projectDescription:((u=L.projectInfo)==null?void 0:u.description)||void 0,defaultDoc:((H=L.projectDefaults)==null?void 0:H.defaultDoc)||void 0,defaultTheme:((d=L.projectDefaults)==null?void 0:d.defaultTheme)||void 0,defaultPromptClient:((N=L.automation)==null?void 0:N.defaultPromptClient)??"",defaultIDE:((K=L.automation)==null?void 0:K.defaultIDE)??"",assistantWebBaseUrl:((J=L.assistant)==null?void 0:J.webBaseUrl)??"",assistantApiBaseUrl:((de=L.assistant)==null?void 0:de.apiBaseUrl)??""})}catch(z){console.error("Error loading config:",z),W.error("åŠ è½½é…ç½®å¤±è´¥")}},ne=async()=>{Z(!0);try{const[g,u]=await Promise.all([fetch("/api/docs"),fetch("/api/themes")]);if(g.ok){const H=await g.json();D(Array.isArray(H)?H:[])}if(u.ok){const H=await u.json();ie(Array.isArray(H)?H:[])}}catch(g){console.error("Error loading assets:",g)}finally{Z(!1)}},Q=async()=>{try{const g=await w.validateFields();k(!0);const u=await fetch("/api/config"),H=u.ok?await u.json():{server:{host:"localhost",port:51720,allowLAN:!0}},d={server:{host:g.host,port:H.server.port||51720,allowLAN:g.allowLAN,enableCommandAPI:g.enableCommandAPI||!1},projectInfo:{name:g.projectName??null,description:g.projectDescription??null},projectDefaults:{defaultDoc:g.defaultDoc??null,defaultTheme:g.defaultTheme??null},automation:{defaultPromptClient:g.defaultPromptClient?g.defaultPromptClient:null,defaultIDE:g.defaultIDE?g.defaultIDE:null},assistant:{webBaseUrl:g.assistantWebBaseUrl?g.assistantWebBaseUrl:null,apiBaseUrl:g.assistantApiBaseUrl?g.assistantApiBaseUrl:null}},N=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!N.ok){const J=await N.json();throw new Error(J.error||"Failed to save config")}const K=await N.json();W.success(K.message||"é…ç½®å·²ä¿å­˜"),c==null||c(),v()}catch(g){console.error("Error saving config:",g),W.error(g.message||"ä¿å­˜é…ç½®å¤±è´¥")}finally{k(!1)}};return e.jsx(Ds,{title:"é¡¹ç›®è®¾ç½®",open:f,onClose:v,width:600,extra:e.jsxs(Je,{children:[e.jsx(Y,{onClick:v,children:"å–æ¶ˆ"}),e.jsx(Y,{type:"primary",onClick:Q,loading:T,children:"ä¿å­˜"})]}),children:e.jsxs(he,{form:w,layout:"vertical",initialValues:{host:"localhost",allowLAN:!0,enableCommandAPI:!1,projectName:void 0,projectDescription:void 0,defaultDoc:void 0,defaultTheme:void 0,defaultPromptClient:"",defaultIDE:"",assistantWebBaseUrl:"",assistantApiBaseUrl:""},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Wt,{level:5,style:{marginBottom:16},children:"é¡¹ç›®ç”Ÿæˆé…ç½®"}),e.jsx(Vt,{type:"info",showIcon:!0,message:"é¡¹ç›®ä¿¡æ¯å°†ä½œä¸º AI ç”Ÿæˆä¸å¯¹é½çš„å…³é”®å‚è€ƒï¼Œéœ€è¦é‡å¯ç¼–è¾‘å™¨æ‰ç”Ÿæ•ˆã€‚",style:{marginBottom:16}}),e.jsx(he.Item,{label:"é¡¹ç›®åç§°",name:"projectName",tooltip:"ç”¨äº AI ç†è§£é¡¹ç›®å®šä½ä¸äº§å‡ºé£æ ¼",children:e.jsx(Be,{placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°",maxLength:20})}),e.jsx(he.Item,{label:"é¡¹ç›®ç®€ä»‹",name:"projectDescription",tooltip:"ç®€è¦æè¿°é¡¹ç›®èƒŒæ™¯ã€ç›®æ ‡ç”¨æˆ·ä¸æ ¸å¿ƒåœºæ™¯",children:e.jsx(Be.TextArea,{placeholder:"ä¾‹å¦‚ï¼šé¢å‘è¿è¥äººå‘˜çš„æ´»åŠ¨é…ç½®åå°ï¼Œå¼ºè°ƒé«˜æ•ˆé…ç½®ä¸ç¨³å®šäº¤ä»˜",rows:2,maxLength:60,showCount:!0})}),e.jsx(he.Item,{label:"é¡¹ç›®æ€»æ–‡æ¡£",name:"defaultDoc",tooltip:"ä»â€œèµ„äº§ç®¡ç†-æ–‡æ¡£â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤å‚è€ƒæ–‡æ¡£",children:e.jsx($e,{allowClear:!0,loading:G,placeholder:"è¯·é€‰æ‹©é¡¹ç›®æ€»æ–‡æ¡£",options:S.map(g=>({value:g.name,label:g.displayName||g.name})),showSearch:!0,filterOption:(g,u)=>String((u==null?void 0:u.label)||"").toLowerCase().includes(g.toLowerCase())})}),e.jsx(he.Item,{label:"é»˜è®¤ä¸»é¢˜",name:"defaultTheme",tooltip:"ä»â€œèµ„äº§ç®¡ç†-ä¸»é¢˜â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤ä¸»é¢˜",children:e.jsx($e,{allowClear:!0,loading:G,placeholder:"è¯·é€‰æ‹©é»˜è®¤ä¸»é¢˜",options:B.map(g=>({value:g.name,label:g.displayName||g.name})),showSearch:!0,filterOption:(g,u)=>String((u==null?void 0:u.label)||"").toLowerCase().includes(g.toLowerCase())})})]}),e.jsx(It,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Wt,{level:5,style:{marginBottom:16},children:"è‡ªåŠ¨æ‰§è¡Œ"}),e.jsx(he.Item,{label:"ä¼˜å…ˆä½¿ç”¨ Axhub Genie",name:"defaultPromptClient",tooltip:"å¯ä»¥åœ¨ç½‘é¡µä¸Šè§£å†³ä¸€äº›ç®€å•çš„é—®é¢˜",children:e.jsx($e,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"å¦"},{value:"claude",label:"ClaudeCode"},{value:"cursor",label:"Cursor"},{value:"codex",label:"Codex"}]})}),e.jsx(he.Item,{label:"ä¸»è¦ IDE",name:"defaultIDE",tooltip:"é…ç½®åï¼Œç›¸å…³æ“ä½œä¼šå…ˆè‡ªåŠ¨æ‰“å¼€å¯¹åº” IDEã€‚",children:e.jsx($e,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"æ— "},...Ht]})})]}),e.jsx(It,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Wt,{level:5,style:{marginBottom:16},children:"æœåŠ¡å™¨é…ç½®"}),e.jsx(he.Item,{label:"ä¸»æœºåœ°å€",name:"host",rules:[{required:!0,message:"è¯·è¾“å…¥ä¸»æœºåœ°å€"}],tooltip:"æœåŠ¡å™¨å¯åŠ¨çš„åŸŸåæˆ– IP åœ°å€",children:e.jsx(Be,{placeholder:"localhost"})}),e.jsx(he.Item,{label:"å…è®¸å±€åŸŸç½‘è®¿é—®",name:"allowLAN",valuePropName:"checked",tooltip:"å¼€å¯åï¼Œå±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡å¯ä»¥è®¿é—®æ­¤æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼Œè¯·ç¡®ä¿åœ¨å¯ä¿¡ç½‘ç»œç¯å¢ƒä¸­ä½¿ç”¨",children:e.jsx(Ns,{})})]})]})})}const{Header:Qo}=xt,{useToken:er}=rt,tr=f=>e.jsx("span",{role:"img","aria-label":"figma",className:"anticon anticon-figma",...f,children:e.jsxs("svg",{fill:"currentColor",fillRule:"evenodd",height:"1em",width:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[e.jsx("title",{children:"Figma"}),e.jsx("path",{clipRule:"evenodd",d:"M6.082 8.241C4.83 7.441 4 6.057 4 4.483 4 2.007 6.05 0 8.578 0h7.844C18.95 0 21 2.007 21 4.483c0 1.574-.829 2.959-2.082 3.758C20.17 9.041 21 10.426 21 12c0 2.476-2.05 4.483-4.578 4.483h-.084A4.615 4.615 0 0113.24 15.3v4.176C13.24 21.98 11.145 24 8.599 24 6.076 24 4 21.998 4 19.517c0-1.574.829-2.959 2.082-3.758C4.829 14.959 4 13.574 4 12c0-1.574.829-2.959 2.082-3.759zM13.24 12c0 1.676 1.387 3.034 3.098 3.034h.084c1.711 0 3.099-1.358 3.099-3.034 0-1.676-1.388-3.034-3.1-3.034h-.083c-1.71 0-3.098 1.358-3.098 3.034zm-1.48-3.034H8.578C6.867 8.966 5.48 10.324 5.48 12c0 1.672 1.382 3.029 3.089 3.034H11.76V8.966zm-3.182 7.517h-.01c-1.707.005-3.089 1.362-3.089 3.034 0 1.67 1.403 3.034 3.12 3.034 1.74 0 3.161-1.381 3.161-3.075v-2.993H8.578zm3.182-8.966H8.578c-1.711 0-3.099-1.358-3.099-3.034 0-1.676 1.388-3.034 3.1-3.034h3.181v6.068zm4.662 0H13.24V1.45h3.182c1.711 0 3.099 1.358 3.099 3.034 0 1.676-1.388 3.034-3.1 3.034z"})]})});function sr({collapsed:f,setCollapsed:v,selectedItem:c,viewMode:w,setViewMode:T,activeTab:k,selectedDeviceId:S,setSelectedDeviceId:D,deviceSegmentOptions:B,handleOpenInspect:ie,handleOpenWebEditor:G,handleExitWebEditor:Z,handleSaveWebEditor:U,handleEnableTextEdit:ne,handleSaveTextEdit:Q,handleExitTextEdit:g,handleRefreshElement:u,handleCopyLocalLink:H,handleCopyLANLink:d,handleDownloadZip:N,getLANUrl:K,qrCodeVisible:J,setQrCodeVisible:de,wsClients:z,checkConnection:L,handlePushToFigma:ee,handleDownloadFigmaJson:ae,setIsExportModalOpen:R,handleOpenIdeFile:F,handleOpenProjectInIDE:le,preferredIDE:M,onPreferredIDEChange:O,isDarkMode:o,setIsDarkMode:b,currentSpecDocKey:h="spec",textEditState:j,textEditAvailable:C,editorMode:oe="none",handleRefreshEditorStatus:V,onSettingsSaved:ce,assistantEnabled:xe=!1,assistantVisible:Te=!1,onToggleAssistant:Ce}){const[Ue,et]=ve.useState(null),[Fe,ke]=ve.useState(!1),[pe,Ee]=ve.useState(!0),[be,Re]=ve.useState(!1),{token:X}=er(),Pe=oe==="webEditorV2";ve.useEffect(()=>{let m=!1;return fetch("/api/version").then(I=>I.ok?I.json():Promise.reject(new Error("Request failed"))).then(I=>{if(m)return;const P=typeof(I==null?void 0:I.version)=="string"?I.version:null;et(P)}).catch(()=>{m||et(null)}),()=>{m=!0}},[]),ve.useEffect(()=>{let m=!1;return fetch("/api/config").then(I=>I.ok?I.json():Promise.reject(new Error("Request failed"))).then(I=>{var P;m||Ee(((P=I==null?void 0:I.server)==null?void 0:P.allowLAN)!==!1)}).catch(()=>{m||Ee(!0)}),()=>{m=!0}},[]),z.some(m=>Ts.includes(m.type));const te=M||Ht[0].value,fe=m=>m==="cursor"?e.jsx(Co,{size:16,color:X.colorText}):m==="trae"||m==="trae_cn"?e.jsx(Eo,{size:16,color:X.colorText}):m==="windsurf"?e.jsx(Io,{size:16,color:X.colorText}):m==="vscode"?e.jsx($o,{size:16,color:X.colorText}):m==="antigravity"?e.jsx(To,{size:16,color:X.colorText}):m==="kiro"?e.jsx(ko,{size:16,color:X.colorText}):m==="qoder"?e.jsx(Ao,{size:16,color:X.colorText}):e.jsx(Ls,{}),Xe=async m=>{var q,je,at;const I=await fetch("/api/config");if(!I.ok)throw new Error("åŠ è½½é…ç½®å¤±è´¥ï¼Œæ— æ³•ä¿å­˜ä¸»åŠ› IDE");const P=await I.json(),we={...P,server:{host:((q=P==null?void 0:P.server)==null?void 0:q.host)||"localhost",allowLAN:((je=P==null?void 0:P.server)==null?void 0:je.allowLAN)!==!1,enableCommandAPI:((at=P==null?void 0:P.server)==null?void 0:at.enableCommandAPI)||!1},automation:{...(P==null?void 0:P.automation)||{},defaultIDE:m}},se=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(we)});if(!se.ok){const ue=await se.json().catch(()=>({}));throw new Error((ue==null?void 0:ue.error)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥")}O==null||O(m)},qe=async m=>{if(!be){Re(!0);try{if(!await Promise.resolve(le(m)))return;try{await Xe(m)}catch(P){W.warning((P==null?void 0:P.message)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥")}}finally{Re(!1)}}},Ye=[{type:"group",label:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:Ht.map(m=>({key:m.value,label:m.label,icon:fe(m.value)}))}],y=m=>e.jsx(ye,{title:m,children:e.jsx(Ct.Button,{size:"small",type:"default",loading:be,menu:{items:Ye,onClick:({key:I})=>{qe(I)}},onClick:()=>{qe(te)},children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6},children:[fe(te),"æ‰“å¼€é¡¹ç›®"]})})});return e.jsxs(Qo,{hasSider:!0,style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:X.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${X.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[e.jsx(Y,{type:"text",icon:f?e.jsx(po,{}):e.jsx(fo,{}),onClick:()=>v(!f),style:{fontSize:"16px",height:40}}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:X.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx($t,{value:w,size:"small",style:{fontSize:"12px"},onChange:m=>T(m),options:[{label:"åŸå‹",value:"demo",icon:e.jsx(ks,{})},{label:"æ–‡æ¡£",value:"spec",icon:e.jsx(Jt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[y("æ‰“å¼€é¡¹ç›®"),xe&&e.jsx(ye,{title:Te?"å…³é—­ Axhub Genie":"æ‰“å¼€ Axhub Genie",children:e.jsx(Bt,{dot:!0,status:Te?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:Te?"inline-flex":"none"}},children:e.jsx(Y,{size:"small",type:"text",icon:e.jsx(Qt,{}),onClick:Ce})})}),e.jsx(Ct,{menu:{items:[{key:"assets",label:"èµ„äº§ç®¡ç†",icon:e.jsx(ot,{}),onClick:()=>window.open(new URL("/assets.html",window.location.origin).toString(),"_blank")},{key:"settings",label:"é¡¹ç›®è®¾ç½®",icon:e.jsx(qt,{}),onClick:()=>ke(!0)},{key:"theme",label:o?"æµ…è‰²æ¨¡å¼":"æ·±è‰²æ¨¡å¼",icon:o?e.jsx(xo,{}):e.jsx(go,{}),onClick:()=>b(!o)},{type:"divider"},{key:"help",label:"å¸®åŠ©ä¸­å¿ƒ",icon:e.jsx(yo,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"åŸ¹è®­æœåŠ¡",icon:e.jsx(wo,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub å®˜ç½‘",icon:e.jsx(qt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"å½“å‰ç‰ˆæœ¬",icon:e.jsx(vt,{}),extra:e.jsx("span",{style:{fontSize:12,color:X.colorTextSecondary},children:Ue?`v${Ue}`:"-"})}]},placement:"bottomRight",children:e.jsx(Y,{size:"small",type:"text",icon:e.jsx(mo,{})})})]}),(c||w==="spec")&&e.jsx("div",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center"},children:e.jsx(Je,{size:"small",children:w==="spec"?e.jsx(e.Fragment,{children:e.jsx(ye,{title:`åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ${h==="prd"?"PRD":"SPEC"} æ–‡æ¡£`,children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Yt,{}),onClick:F})})}):c&&e.jsxs(e.Fragment,{children:[k==="pages"&&!Pe&&e.jsx($t,{value:S,size:"small",shape:"round",onChange:m=>D(m),options:B}),e.jsx(ye,{title:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Yt,{}),onClick:F})}),e.jsx(ye,{title:Pe?"é€€å‡ºå¿«é€Ÿç¼–è¾‘":"å¿«é€Ÿç¼–è¾‘",children:e.jsx(Bt,{dot:!0,status:Pe?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:Pe?"inline-flex":"none"}},children:e.jsx(Y,{type:"text",size:"small",disabled:!c,onClick:()=>Pe?Z():G(),icon:e.jsx(As,{})})})}),e.jsx(ye,{title:"åˆ·æ–°",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(bo,{}),onClick:u})}),e.jsx(jo,{content:e.jsxs("div",{style:{width:160},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx(Y,{type:"text",icon:e.jsx(Gt,{}),onClick:H,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶æœ¬åœ°é“¾æ¥"}),pe&&e.jsx(Y,{type:"text",icon:e.jsx(Gt,{}),onClick:d,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶å±€åŸŸç½‘é“¾æ¥"}),e.jsx(Y,{type:"text",icon:e.jsx(vs,{}),disabled:!0,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å‘å¸ƒåŸå‹"})]}),pe&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:1,background:X.colorBorder,margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 0px 4px"},children:[e.jsx(vo,{value:K(),size:128,bordered:!1,style:{marginBottom:8}}),e.jsx(Me.Text,{type:"secondary",style:{fontSize:12,textAlign:"center"},children:"åŒ WiFi çš„æ‰‹æœºæ‰«ç é¢„è§ˆ"})]})]})]}),trigger:"click",placement:"bottomRight",open:J,onOpenChange:de,arrow:!1,children:e.jsx(ye,{title:"åˆ†äº«",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(So,{})})})}),e.jsx(Ct,{trigger:["click"],placement:"bottomCenter",onOpenChange:m=>{m&&L()},menu:{items:[{key:"push",label:"ä¸€é”®æ¨é€",extra:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Bt,{status:z.some(m=>m.type==="figma")?"success":"default"}),e.jsx("span",{style:{marginLeft:4},children:z.some(m=>m.type==="figma")?"å·²è¿æ¥":"æœªè¿æ¥"})]}),icon:e.jsx(vs,{}),disabled:!z.some(m=>m.type==="figma")},{type:"divider"},{key:"download-json",label:"ä¸‹è½½ JSON",icon:e.jsx(Kt,{})},{key:"download-axure",label:"ä¸‹è½½ JSON",extra:"é€‚é… Axure",icon:e.jsx(ot,{})}],onClick:({key:m})=>{m==="push"?ee():m==="download-json"?ae(!0):m==="download-axure"&&ae(!1)}},children:e.jsx(ye,{trigger:["click","hover"],title:"å¯¼å‡ºåˆ° Figma",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(tr,{})})})}),e.jsx(Y,{type:"primary",size:"small",style:{fontSize:"12px"},icon:e.jsx(Kt,{}),onClick:()=>{R(!0)},children:"å¯¼å‡ºåˆ° Axure"})]})})}),e.jsx(Zo,{open:Fe,onClose:()=>ke(!1),onSaved:()=>{fetch("/api/config").then(m=>m.ok?m.json():Promise.reject(new Error("Request failed"))).then(m=>{var I;return Ee(((I=m==null?void 0:m.server)==null?void 0:I.allowLAN)!==!1)}).catch(()=>{}),ce==null||ce()}})]})}const nr=({width:f,height:v,children:c,scale:w=1})=>e.jsx("div",{style:{position:"relative",padding:"12px",background:"#1f1f1f",borderRadius:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.2)",border:"4px solid #333",display:"flex",flexDirection:"column",transform:`scale(${w})`,transformOrigin:"center center"},children:e.jsx("div",{style:{width:f,height:v,background:"#fff",borderRadius:"32px",overflow:"hidden",position:"relative"},children:c})}),{Content:or}=xt,{useToken:rr}=rt;function ar({containerRef:f,previewIframeRef:v,selectedItem:c,activeTab:w,currentDevice:T,displaySize:k,scale:S,elementIframeKey:D,iframeUrl:B,elementIframeSize:ie,setElementIframeSize:G,viewMode:Z}){const{token:U}=rr();return e.jsx(or,{ref:f,style:{background:U.colorBgLayout,position:"relative",flex:1,minWidth:0,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:c?Z==="spec"?e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},D):w==="pages"&&T.id!=="desktop"?e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(nr,{width:k.width,height:k.height,scale:S,children:e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},D)})}):w==="elements"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:e.jsx("div",{style:{position:"relative",display:"inline-block"},children:e.jsx(Us,{size:ie,onResize:(ne,Q,g)=>{if(g){const u=g.getBoundingClientRect();G({width:u.width,height:u.height})}},minWidth:50,minHeight:50,bounds:"window",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},handleStyles:{right:{width:"8px",right:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottom:{height:"8px",bottom:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottomRight:{width:"12px",height:"12px",right:"-6px",bottom:"-6px",background:"transparent",borderRadius:"0 0 6px 0",transition:"all 0.2s"}},handleClasses:{right:"resize-handle-right",bottom:"resize-handle-bottom",bottomRight:"resize-handle-bottomRight"},style:{border:`1px solid ${U.colorBorder}`,borderRadius:6,overflow:"hidden",background:U.colorBgContainer,boxShadow:U.boxShadow,transition:"box-shadow 0.2s"},className:"ant-card-hoverable",children:e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},D)})})}):e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},D):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:U.colorTextSecondary},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Ro,{style:{fontSize:"64px",marginBottom:"16px"}}),e.jsxs("div",{style:{fontSize:"16px"},children:["è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ª",w==="elements"?"å…ƒç´ ":"é¡µé¢"]})]})})})}const{Dragger:ir}=zs,{Text:Is,Title:lr}=Me;function cr({visible:f,onClose:v,activeTab:c,createName:w,setCreateName:T,createReference:k,setCreateReference:S,createMode:D,setCreateMode:B,generateAxure:ie,setGenerateAxure:G,referenceItems:Z,selectedThemes:U,setSelectedThemes:ne,availableThemes:Q,selectedLibraries:g,setSelectedLibraries:u,availableLibraries:H,selectedDocs:d,setSelectedDocs:N,availableDocs:K,selectedDataAssets:J,setSelectedDataAssets:de,availableDataAssets:z,preferredPromptClient:L,preferredIDE:ee,buildCreatePrompt:ae,onAfterCreatePromptAction:R}){const{token:F}=rt.useToken(),[le,M]=r.useState(!0),[O,o]=r.useState("create"),[b,h]=r.useState("make"),[j,C]=r.useState("zip"),[oe,V]=r.useState([]),[ce,xe]=r.useState(!1),[Te,Ce]=r.useState(null),Ue=r.useRef(null);r.useEffect(()=>{f&&(M(!0),o("create"),h("make"),C("zip"),V([]),xe(!1),Ce(null))},[f]);const et=y=>{h(y),C("zip"),V([]),Ce(null)},Fe=y=>["make","axhub","google_stitch"].includes(y),ke=y=>["axure_prototype","web_page"].includes(y),pe=async y=>{const{file:m,onSuccess:I,onError:P}=y,we=m instanceof File?m:m.originFileObj,se=new FormData;se.append("file",we,we.name),se.append("uploadType",b),se.append("targetType",c),se.append("uploadMode","zip"),console.log("[å‰ç«¯] customRequest ä¸Šä¼ å‚æ•°:",{uploadType:b,targetType:c,fileName:we.name,fileSize:we.size}),xe(!0);try{const q=await fetch("/api/upload",{method:"POST",body:se}),je=await q.json();console.log("[å‰ç«¯] æœåŠ¡å™¨å“åº”:",je),q.ok&&je.success?(Ce(je),I(null,m),Fe(b)?(W.success(je.message||"ä¸Šä¼ å¹¶è§£å‹æˆåŠŸï¼"),setTimeout(()=>{v(),window.location.reload()},1500)):W.success("æ–‡ä»¶å·²è§£å‹ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):(console.error("[å‰ç«¯] ä¸Šä¼ å¤±è´¥:",je),W.error(je.error||"ä¸Šä¼ å¤±è´¥"),P(new Error(je.error||"ä¸Šä¼ å¤±è´¥")))}catch(q){console.error("[å‰ç«¯] ä¸Šä¼ é”™è¯¯:",q),W.error("ä¸Šä¼ å¤±è´¥: "+q.message),P(q)}finally{xe(!1)}},Ee=y=>{Ue.current&&window.clearTimeout(Ue.current),Ue.current=window.setTimeout(()=>{be(y)},250)},be=async y=>{if(ce)return;const m=y.map(se=>se.originFileObj).filter(se=>!!se);if(m.length===0){W.error("ä¸Šä¼ æ–‡ä»¶å¤¹ä¸ºç©º");return}const I=new FormData;I.append("uploadType",b),I.append("targetType",c),I.append("uploadMode","folder");const P=m[0].webkitRelativePath,we=P?P.split("/")[0]:"";we&&I.append("folderName",we),m.forEach(se=>{const q=se.webkitRelativePath||se.name;I.append("files",se,q),I.append("relativePaths",q)}),xe(!0);try{const se=await fetch("/api/upload",{method:"POST",body:I}),q=await se.json();se.ok&&q.success?(Ce(q),Fe(b)?(W.success(q.message||"ä¸Šä¼ æˆåŠŸï¼"),setTimeout(()=>{v(),window.location.reload()},1500)):W.success(q.message||"æ–‡ä»¶å·²ä¸Šä¼ ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):W.error(q.error||"ä¸Šä¼ å¤±è´¥")}catch(se){W.error("ä¸Šä¼ å¤±è´¥: "+se.message)}finally{xe(!1)}},Re=r.useCallback(()=>{const y=Xe.find(P=>P.key===b),m=(y==null?void 0:y.docs)||[];let I="";if(ke(b)){const P=c==="elements"?"å…ƒç´ ":"é¡µé¢",we=b==="axure_prototype"?"Axure åŸå‹é“¾æ¥":"ç½‘é¡µé“¾æ¥";I=`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æ¶æ„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆå‹ï¼‰ï¼ŒååŠ©ç”¨æˆ·ã€ŒåŸºäº${we}å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${P}ã€ã€‚

**ğŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼ˆå¿…é¡»é˜…è¯»ï¼‰**ï¼š
${m.map(se=>`- \`${se}\``).join(`
`)}

**é¦–æ¬¡å›å¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œæˆ‘å°†åŸºäº ${we} å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${P}ã€‚

è¯·æŠŠé“¾æ¥å‘æˆ‘ï¼ˆURLï¼‰ï¼š
\`\`\``}else{if(!Te||!Te.prompt)throw new Error("æ²¡æœ‰å¯å¤åˆ¶çš„ Prompt");I=Te.prompt,m.length>0&&(I+=`

ğŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼š
${m.map(P=>`- \`${P}\``).join(`
`)}`)}return I},[b,c,Te]),X={display:"inline-flex",alignItems:"center",gap:8},Pe=()=>{if(O==="create")return e.jsx("div",{style:X,children:e.jsx(nt,{type:"primary",disabled:!1,preferredClient:L,preferredIDE:ee,scene:`create-${c}`,buildPrompt:()=>ae(),onAfterCopy:R,copySuccessMessage:"å¤åˆ¶æˆåŠŸï¼Œè¯·è¿”å› IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›é€€ä¸ºå¤åˆ¶ Prompt"})});if(Fe(b))return e.jsx("div",{style:X,children:e.jsx(Y,{onClick:v,children:"å–æ¶ˆ"})});const y=ke(b)||Te;return e.jsxs("div",{style:X,children:[e.jsx(Y,{onClick:v,children:"å…³é—­"}),e.jsx(nt,{type:"primary",preferredClient:L,preferredIDE:ee,scene:`upload-${b}-${c}`,buildPrompt:Re,copySuccessMessage:"Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´ç»™ AI å®Œæˆå¯¼å…¥",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›é€€ä¸ºå¤åˆ¶ Prompt",disabled:!y})]})},te={name:j==="folder"?"files":"file",multiple:j==="folder",directory:j==="folder",fileList:oe,customRequest:j==="zip"?pe:void 0,beforeUpload:y=>{var I;return j==="folder"?!1:y.type==="application/zip"||y.type==="application/x-zip-compressed"||((I=y.name)==null?void 0:I.endsWith(".zip"))?!0:(W.error("è¯·ä¸Šä¼  ZIP æ ¼å¼çš„æ–‡ä»¶"),zs.LIST_IGNORE)},onChange:y=>{j==="folder"?(V(y.fileList),Ee(y.fileList)):V(y.fileList.slice(-1))},onRemove:()=>{V([]),Ce(null)},accept:j==="zip"?".zip":void 0,disabled:ce},fe="/skills",Xe=[{key:"make",title:"Axbub Make",description:"æ”¯æŒè‡ªå·±æˆ–ä»–äººçš„ ZIP åŒ…",icon:e.jsx(Yt,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!0,docs:[`${fe}/local-axure-workflow/SKILL.md`]},{key:"axhub",title:"Axhub æ‰©å±•",description:"å¯å¯¼å‡ºä»»æ„ç½‘é¡µï¼ˆé™æ€ï¼‰",icon:e.jsx(Ls,{style:{fontSize:24,color:"#722ed1"}}),isDirect:!0,docs:[`${fe}/screenshot-page-workflow/SKILL.md`]},{key:"google_stitch",title:"Google Stitch",description:"AI é©±åŠ¨çš„ UI è®¾è®¡å·¥å…·ï¼ˆé™æ€ï¼‰",icon:e.jsx(Cs,{style:{fontSize:24,color:"#f5222d"}}),isDirect:!0,docs:[`${fe}/screenshot-page-workflow/SKILL.md`]},{key:"v0",title:"V0 App",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Qt,{style:{fontSize:24,color:"#52c41a"}}),isDirect:!1,docs:[`${fe}/v0-project-converter/SKILL.md`]},{key:"google_aistudio",title:"Google AIStudio",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Cs,{style:{fontSize:24,color:"#faad14"}}),isDirect:!1,docs:[`${fe}/ai-studio-project-converter/SKILL.md`]},{key:"axure_prototype",title:"Axure åŸå‹é“¾æ¥",description:"æ”¯æŒåœ¨çº¿æˆ–æœ¬åœ°é¢„è§ˆçš„é“¾æ¥",icon:e.jsx(Rs,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!1,docs:[`${fe}/axure-prototype-workflow/SKILL.md`,`${fe}/axure-prototype-workflow/page-restoration.md`]},{key:"web_page",title:"ç½‘é¡µé“¾æ¥",description:"æ”¯æŒä»»æ„ç½‘é¡µé“¾æ¥",icon:e.jsx(qt,{style:{fontSize:24,color:"#13c2c2"}}),isDirect:!1,docs:[`${fe}/web-page-workflow/SKILL.md`,`${fe}/web-page-workflow/page-restoration.md`]}],qe=()=>e.jsxs(he,{requiredMark:!1,labelCol:{style:{width:"120px"}},wrapperCol:{style:{minWidth:0}},children:[e.jsx(he.Item,{label:c==="elements"?"å…ƒç´ åç§°":"é¡µé¢åç§°",children:e.jsx(Be,{placeholder:"ç•™ç©ºåˆ™ç”± AI ç”Ÿæˆï¼Œæ‰¹é‡ç”Ÿæˆå»ºè®®ç•™ç©º",value:w,onChange:y=>T(y.target.value),maxLength:20,showCount:!0})}),Z.length>0&&e.jsx(he.Item,{label:"å‚è€ƒæ¡ˆä¾‹",tooltip:`å¯åœ¨${c==="elements"?"å…ƒç´ ":"é¡µé¢"}åˆ—è¡¨ä¸­å°†å…¶è®¾ä¸ºæˆ–å–æ¶ˆä¸ºå‚è€ƒæ¡ˆä¾‹`,children:e.jsx($e,{style:{width:"100%"},placeholder:"ä¸é€‰æ‹©å‚è€ƒæ¡ˆä¾‹",value:k||void 0,onChange:y=>S(y||""),allowClear:!0,options:Z.map(y=>({value:y.name,label:y.displayName}))})}),e.jsx("div",{children:e.jsx(Y,{type:"link",onClick:()=>M(!le),icon:le?e.jsx(Po,{}):e.jsx(Do,{}),style:{padding:0},children:le?"æ›´å¤šé…ç½®":"æ”¶èµ·é…ç½®"})}),!le&&e.jsxs(e.Fragment,{children:[Q.length>0&&e.jsx(he.Item,{label:"ä¸»é¢˜",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰ä¸»é¢˜ç”ŸæˆåŸå‹ï¼Œä¸»é¢˜å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©ä¸»é¢˜ï¼ˆå¯å¤šé€‰ï¼‰",value:U,onChange:y=>ne(y),allowClear:!0,options:Q.map(y=>({value:y.name,label:y.displayName}))})}),z.length>0&&e.jsx(he.Item,{label:"å¼•ç”¨æ•°æ®",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ•°æ®ç”ŸæˆåŸå‹ï¼Œæ•°æ®å¯åœ¨æ•°æ®ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ•°æ®ï¼ˆå¯å¤šé€‰ï¼‰",value:J,onChange:y=>de(y),allowClear:!0,options:z.map(y=>({value:y.name,label:y.displayName}))})}),H.length>0&&e.jsx(he.Item,{label:"å‰ç«¯åº“",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰å‰ç«¯åº“ç”ŸæˆåŸå‹ï¼Œå‰ç«¯åº“å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‰ç«¯åº“ï¼ˆå¯å¤šé€‰ï¼‰",value:g,onChange:y=>u(y),allowClear:!0,options:H.map(y=>({value:y.name,label:y.displayName}))})}),K.length>0&&e.jsx(he.Item,{label:"å‚è€ƒæ–‡æ¡£",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ–‡æ¡£ç”ŸæˆåŸå‹ï¼Œæ–‡æ¡£å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx($e,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ–‡æ¡£ï¼ˆå¯å¤šé€‰ï¼‰",value:d,onChange:y=>N(y),options:K.map(y=>({value:y.name,label:y.displayName}))})}),e.jsx(he.Item,{label:"ç”Ÿæˆæµç¨‹",children:e.jsx($e,{style:{width:"100%"},value:D,onChange:y=>B(y),options:[{value:"simultaneous",label:"åŒæ—¶ç”Ÿæˆè§„æ ¼æ–‡æ¡£å’ŒåŸå‹"},{value:"specFirst",label:"æŒ‰ è§„æ ¼æ–‡æ¡£ > åŸå‹ é¡ºåº"}]})}),e.jsx(he.Item,{label:"Axure æ¨¡å¼",tooltip:"ä¸å½±å“å¯¼å‡º Axure ï¼Œå…³é—­åˆ™ä¸ç”Ÿæˆä¸ Axure åŸç”Ÿå…ƒç´ äº¤äº’çš„åŠŸèƒ½ï¼Œä½†å¯ä»¥æå‡ç”Ÿæˆé€Ÿåº¦",children:e.jsx(Ns,{checked:ie,onChange:y=>G(y)})})]})]}),Ye=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsx(lr,{level:5,style:{marginBottom:16},children:"é€‰æ‹©å¯¼å…¥æ¥æº"}),e.jsx(No,{gutter:[16,16],children:Xe.map(y=>e.jsx(Lo,{span:12,children:e.jsx(Es,{hoverable:!0,bodyStyle:{padding:16,height:"100%",display:"flex",alignItems:"center"},style:{height:"100%",borderColor:b===y.key?F.colorInfo:void 0,backgroundColor:b===y.key?F.colorFillAlter:void 0},onClick:()=>et(y.key),children:e.jsx(Es.Meta,{avatar:y.icon,title:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(Is,{ellipsis:!0,style:{fontSize:13,fontWeight:500},children:y.title})}),description:e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:y.description}),style:{width:"100%"}})})},y.key))})]}),!ke(b)&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(Is,{type:"secondary",style:{fontSize:12},children:"ä¸Šä¼ æ–¹å¼"}),e.jsx($t,{size:"small",value:j,onChange:y=>{C(y),V([]),Ce(null)},options:[{label:"ZIP",value:"zip"},{label:"æ–‡ä»¶å¤¹",value:"folder"}]})]}),e.jsx("div",{style:{flex:1,minHeight:120},children:e.jsx(ir,{...te,style:{background:"#fafafa",border:"1px dashed #d9d9d9",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-drag-icon",style:{marginBottom:8},children:e.jsx(Uo,{style:{color:F.colorInfo,fontSize:36}})}),e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:j==="zip"?"ç‚¹å‡»æˆ–æ‹–æ‹½ ZIP æ–‡ä»¶ä¸Šä¼ ":"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶å¤¹ä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",style:{color:"#888",fontSize:12,padding:"0 16px"},children:Fe(b)?"å¯¼å…¥åå¯é€šè¿‡ AI è¿›è¡Œç¼–è¾‘å’Œä¼˜åŒ–":"ä¸Šä¼ åéœ€è¦ AI è¾…åŠ©å¯¼å…¥"})]})})})]})]});return e.jsx(Ds,{placement:"left",destroyOnClose:!0,title:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx($t,{value:O,onChange:y=>o(y),options:[{label:c==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢",value:"create"},{label:c==="elements"?"å¯¼å…¥å…ƒç´ ":"å¯¼å…¥é¡µé¢",value:"upload"}],style:{fontWeight:500}})}),open:f,onClose:v,width:600,footer:Pe(),styles:{body:{padding:24,overflow:"auto"},header:{borderBottom:"1px solid #f0f0f0",padding:"16px 24px"},footer:{textAlign:"right"}},children:O==="create"?qe():Ye()})}const Tt={simultaneous:{mode:"simultaneous",displayName:"ç›´æ¥ç”Ÿæˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!1]},specFirst:{mode:"specFirst",displayName:"è§„æ ¼ä¼˜å…ˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.mdï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰â†’ ç”Ÿæˆ index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ spec.mdï¼ˆç¡®è®¤ï¼‰â†’ index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!0,!1]}};function dr(f,v){const c=v==="elements"?"å…ƒç´ ":"é¡µé¢",w=v==="elements"?"elements":"pages",T=`src/${w}/${f.name}`,k=`src/${w}/ref-${f.name}`;return`å°† \`${T}\` è®¾ä¸ºå‚è€ƒæ¡ˆä¾‹ï¼š

1. ç§»åŠ¨åˆ° \`${k}\`
2. å‚è€ƒ \`/rules/development-standards.md\`
3. åœ¨ index.tsx é¡¶éƒ¨æ·»åŠ ï¼š
\`\`\`typescript
/**
 * @name ${f.displayName}
 * æœ¬æ–‡ä»¶æ˜¯æ¼”ç¤ºæ–‡ä»¶ï¼Œå±•ç¤ºæœ¬é¡¹ç›®${c}å¼€å‘è§„èŒƒ
 * å®é™…å¼€å‘æ—¶åªéœ€ä¿ç•™ @name æ³¨é‡Šï¼Œä¸éœ€è¦è¯¦ç»†çš„è§„èŒƒè¯´æ˜
 */
\`\`\`
4. åœ¨å…³é”®ä»£ç æ®µæ·»åŠ  \`// ã€è§„èŒƒè¯´æ˜ã€‘\` æ³¨é‡Šï¼šå¯¼å…¥é¡ºåºã€Propså¤„ç†ã€Stateç®¡ç†ã€äº‹ä»¶å¤„ç†ã€useImperativeHandleã€JSXæ¸²æŸ“
5. æ³¨é‡Šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œé"åšä»€ä¹ˆ"ï¼Œé‡ç‚¹è¯´æ˜æ˜“é”™ç‚¹å’Œæœ€ä½³å®è·µ`}function ur(f){return Object.prototype.hasOwnProperty.call(Tt,f)}function hr(f){const{hasName:v,displayName:c,itemType:w,hasReference:T,referenceDisplayName:k}=f,S=T&&k?`
å‚è€ƒæ¡ˆä¾‹ï¼š${k}`:"";return v?`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›å¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›å¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®ç°å†…å®¹

**é¦–æ¬¡å›å¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º **${c}** ${w}ã€‚${S}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼š
\`\`\``:`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›å¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›å¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®ç°å†…å®¹

**é¦–æ¬¡å›å¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º${w}ã€‚${S}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼ˆå¦‚éœ€åˆ›å»ºå¤šä¸ª${w}ï¼Œè¯·ä¸€å¹¶è¯´æ˜ï¼‰ï¼š
\`\`\``}function pr(f){return f?`

**Axure API**ï¼šâœ… å·²å¯ç”¨
- éœ€è¦ä½¿ç”¨ Axure API å®ç°ç»„ä»¶äº¤äº’åŠŸèƒ½
- **âš ï¸ å¿…é¡»å®Œæ•´é˜…è¯» \`/rules/axure-api-guide.md\`ï¼Œä¸è¦è·³è¿‡ï¼**
- è¯¥æ–‡æ¡£åŒ…å«å®Œæ•´çš„ Axure API æ¥å£è§„èŒƒã€ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ`:`

**Axure API**ï¼šâŒ æœªå¯ç”¨
- æœ¬æ¬¡ä½¿ç”¨æ ‡å‡† React ç»„ä»¶å³å¯ï¼Œä¸éœ€è¦ Axure API`}function $s(){return`   - æ–‡ä»¶ç»“æ„ã€ä¾èµ–å¼•ç”¨ã€æ ·å¼è§„èŒƒã€å¯¼å‡ºè§„èŒƒ
   - âš ï¸ **éªŒæ”¶æ ‡å‡†**ï¼šå®Œæˆåå¿…é¡»å¯¹ç…§æ­¤æ–‡æ¡£æ£€æŸ¥å®ç°`}function Os(f){const{createMode:v,modeConfig:c,generateAxure:w}=f;return v==="simultaneous"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${c.description}

**ğŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

2. **\`/rules/development-standards.md\`**
${$s()}

3. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${w?`

4. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}`:v==="specFirst"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${c.description}

**ğŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/requirements-alignment.md\`** â­ï¸ éœ€æ±‚å¯¹é½ï¼ˆç¬¬ä¸€æ­¥ï¼‰
   - éœ€æ±‚ç¡®è®¤æ¸…å•ã€æ²Ÿé€šç­–ç•¥ã€å¯è§†åŒ–æµç¨‹

2. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼Œå¿…é¡»å®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

3. **\`/rules/development-standards.md\`**
${$s()}

4. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${w?`

5. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}

**ç¡®è®¤æµç¨‹**ï¼š
- å®Œæˆ spec.md åï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼š"spec.md å·²å®Œæˆï¼Œè¯·ç¡®è®¤æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚ç¡®è®¤åå°†ç”Ÿæˆä»£ç å®ç°ã€‚"
- ç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†ç”Ÿæˆ index.tsx`:Os({createMode:"simultaneous",modeConfig:Tt.simultaneous,generateAxure:w})}function fr(f){const{referencePath:v,referenceDisplayName:c}=f;return v?`

**ğŸ“ å‚è€ƒæ¡ˆä¾‹**ï¼ˆâ­ï¸ ä¼˜å…ˆå‚è€ƒï¼‰ï¼š
- è·¯å¾„ï¼š\`${v}\`
- åç§°ï¼š${c}
- **è¯·ä¼˜å…ˆå‚è€ƒæ­¤æ¡ˆä¾‹çš„ä»£ç ç»“æ„å’Œå®ç°æ–¹å¼**
- å­¦ä¹ å…¶æ–‡ä»¶ç»„ç»‡ã€å‘½åè§„èŒƒã€ä»£ç é£æ ¼`:""}function St(f){const{title:v,selected:c,available:w,toLine:T}=f;return c.length===0?"":`

${v}${c.map(k=>{const S=w.find(D=>D.name===k);return`
${T(k,S)}`}).join("")}`}function mr(f,v,c,w,T,k=[],S=[],D=[],B=[],ie=[],G=[],Z=[],U=[],ne=!0){const Q=v==="elements",g=Q?"å…ƒç´ ":"é¡µé¢",u=Q?"elements":"pages",H=f.trim().length>0,d=f.trim(),N=w?T.find(O=>O.name===w):null,K=N?`src/${u}/${N.name}`:null,J=ur(c)?Tt[c]:Tt.simultaneous,de=H?`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æ¶æ„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆå‹ï¼‰ï¼Œåˆ›å»º ${g}ã€Œ**${d}**ã€åŸå‹`:`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æ¶æ„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆå‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª${g}åŸå‹`,z=hr({hasName:H,displayName:d,itemType:g,hasReference:!!N,referenceDisplayName:N==null?void 0:N.displayName}),L=pr(ne),ee=Os({createMode:c,modeConfig:J,generateAxure:ne}),ae=fr({referencePath:K,referenceDisplayName:N==null?void 0:N.displayName}),R=St({title:"**ğŸ“š å‚è€ƒæ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/docs/ï¼‰ï¼š",selected:k,available:S,toLine:(O,o)=>`- **\`/assets/docs/${O}\`** - ${(o==null?void 0:o.displayName)||O}`}),F=St({title:"**ğŸ¨ ä¸»é¢˜é…ç½®**ï¼ˆç›¸å¯¹è·¯å¾„ /src/themes/ï¼Œåªæä¾›è·¯å¾„ï¼Œä¸å±•å¼€æ–‡ä»¶å†…å®¹ï¼‰ï¼š",selected:D,available:B,toLine:(O,o)=>`- ${(o==null?void 0:o.displayName)||O}
  - \`/src/themes/${O}/DESIGN-SPEC.md\`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  - \`/src/themes/${O}/designToken.json\`
  - \`/src/themes/${O}/globals.css\` æˆ– \`/src/themes/${O}/style.css\`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  - \`/src/themes/${O}/index.tsx\``}),le=St({title:"**ğŸ“¦ å‰ç«¯åº“æ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/libraries/ï¼‰ï¼š",selected:ie,available:G,toLine:(O,o)=>`- **\`/assets/libraries/${O}\`** - ${(o==null?void 0:o.displayName)||O}`}),M=St({title:"**ğŸ“Š å‚è€ƒæ•°æ®**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/database/ï¼‰ï¼š",selected:Z,available:U,toLine:(O,o)=>`- **\`/assets/database/${O}\`** - ${(o==null?void 0:o.displayName)||O}`});return`${de}

âš ï¸ **é‡è¦æç¤º**ï¼šè¯·åŠ¡å¿…å®Œæ•´é˜…è¯»ä»¥ä¸‹æ‰€æœ‰è§„èŒƒæ–‡æ¡£å’Œå‚è€ƒèµ„æ–™ï¼Œä¸è¦å·æ‡’ï¼è¿™äº›æ–‡æ¡£åŒ…å«äº†å…³é”®çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µã€‚
${ee}${ae}${F}${M}${le}${R}${L}

${z}`}function xr(f,v,c,w){if(!f)return"";const T=window.location.origin+(v==="demo"?f.demoUrl:f.specUrl),k=new URL(T,window.location.origin);return v==="demo"&&c==="webEditorV2"?k.searchParams.set("editor","webEditorV2"):k.searchParams.delete("editor"),w!=null&&w.width&&Number.isFinite(w.width)?k.searchParams.set("width",String(Math.round(w.width))):k.searchParams.delete("width"),k.toString()}function gr(f,v){const[c,w]=r.useState(!1),[T,k]=r.useState(""),[S,D]=r.useState(()=>localStorage.getItem(ps)||""),[B,ie]=r.useState(()=>localStorage.getItem(fs)||"simultaneous"),[G,Z]=r.useState(()=>localStorage.getItem(ms)==="true"),[U,ne]=r.useState([]),[Q,g]=r.useState([]),[u,H]=r.useState([]),[d,N]=r.useState([]),[K,J]=r.useState([]),[de,z]=r.useState([]),[L,ee]=r.useState([]),[ae,R]=r.useState([]),[F,le]=r.useState(!1);r.useEffect(()=>{localStorage.setItem(fs,B)},[B]),r.useEffect(()=>{localStorage.setItem(ms,String(G))},[G]),r.useEffect(()=>{localStorage.setItem(ps,S)},[S]);const M=r.useMemo(()=>(f==="elements"?v.elements:v.pages).filter(j=>j.isReference),[v,f]);return r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/docs");if(j.ok){const C=await j.json();z(C)}}catch(j){console.error("Failed to load docs:",j)}})()},[F]),r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/themes");if(j.ok){const C=await j.json();g(C)}}catch(j){console.error("Failed to load themes:",j)}})()},[F]),r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/libraries");if(j.ok){const C=await j.json();N(C);const oe=C.find(V=>V.name==="tailwind-css.md"||V.name.startsWith("tailwind-css"));oe&&u.length===0&&H([oe.name])}}catch(j){console.error("Failed to load libraries:",j)}})()},[F]),r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/data/tables");if(j.ok){const oe=(await j.json()).map(V=>({name:`${V.fileName}.json`,displayName:V.tableName}));R(oe)}}catch(j){console.error("Failed to load data assets:",j)}})()},[F]),r.useEffect(()=>{c&&(S&&(M.some(j=>j.name===S)||D("")),le(!0))},[c,M,S]),{createDialogVisible:c,createName:T,createReference:S,createMode:B,generateAxure:G,referenceItems:M,selectedThemes:U,availableThemes:Q,selectedLibraries:u,availableLibraries:d,selectedDocs:K,availableDocs:de,selectedDataAssets:L,availableDataAssets:ae,setCreateDialogVisible:w,setCreateName:k,setCreateReference:D,setCreateMode:ie,setGenerateAxure:Z,setSelectedThemes:ne,setSelectedLibraries:H,setSelectedDocs:J,setSelectedDataAssets:ee,buildPrompt:async()=>mr(T,f,B,S,M,K,de,U,Q,u,d,L,ae,G),clearCreateDialogState:()=>{w(!1),k(""),J([]),ne([]),H([]),ee([]),le(!1),z([]),g([]),N([]),R([])},handleCreateCancel:()=>{w(!1),k(""),J([]),ne([]),H([]),ee([]),le(!1),z([]),g([]),N([]),R([])}}}function yr(f,v){const c=Array.isArray(f)?f:[],w=Array.isArray(v)?v:[],T=[...c],k=new Set(T.map(S=>String((S==null?void 0:S.selector)||"").trim()).filter(Boolean));for(const S of w){const D=String((S==null?void 0:S.selector)||"").trim();!D||k.has(D)||(T.push(S),k.add(D))}return T}function wr(f){const v=Array.isArray(f)?f:[],c=[],w=new Set;for(const T of v){const k=String((T==null?void 0:T.tag)||"").trim(),S=String((T==null?void 0:T.selector)||"").trim(),D=String((T==null?void 0:T.label)||"").trim();if(!k||!S||!D)continue;const B=`${k}::${S}::${D}`;w.has(B)||(w.add(B),c.push({tag:k,selector:S,label:D}))}return c}function br({isDarkMode:f,setIsDarkMode:v}){const c="[assistant-runtime-ui]",w="http://localhost:32123",T=/mac/i.test(navigator.platform)?"sudo npm install -g @axhub/genie":"npm install -g @axhub/genie",k={webBaseUrl:w,apiBaseUrl:`${w}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"åŠ©æ‰‹è¿è¡Œæ—¶ä¸å¯ç”¨ï¼Œè¯·å…ˆå¯åŠ¨ Axhub Genieã€‚",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:T,start:"axhub-genie",status:"axhub-genie status"}}},S=320,D=320,B=640,{token:ie}=rt.useToken(),[G,Z]=r.useState(!0),[U,ne]=r.useState({elements:[],pages:[]}),[Q,g]=r.useState(!1),[u,H]=r.useState(()=>{const t=localStorage.getItem(gs);return t==="elements"||t==="pages"?t:"pages"}),[d,N]=r.useState(null),[K,J]=r.useState("desktop"),[de,z]=r.useState(1),L=ve.useRef(null),ee=ve.useRef(null),[ae,R]=r.useState(!1),F=ve.useRef(null),le=ve.useRef(null),[M,O]=r.useState(""),[o,b]=W.useMessage(),[h,j]=Et.useModal(),[C,oe]=r.useState({enabled:!1,editedCount:0}),[V,ce]=r.useState({mode:"none",webEditor:{active:!1,undoCount:0,redoCount:0},textEdit:{enabled:!1,editedCount:0},inspecta:{enabled:!1}}),xe=ve.useRef(!1),[Te,Ce]=r.useState({width:600,height:400}),[Ue,et]=r.useState(0),[Fe,ke]=r.useState(!1),[pe,Ee]=r.useState(null),[be,Re]=r.useState(null),[X,Pe]=r.useState(!1),[te,fe]=r.useState(null),[Xe,qe]=r.useState(!1),[Ye,y]=r.useState(()=>{const t=localStorage.getItem(ys),s=t?Number(t):NaN;return Number.isFinite(s)&&s>=D?Math.min(s,B):S}),m=r.useRef(null),[I,P]=r.useState(!1),[we,se]=r.useState(null),[q,je]=r.useState(null),at=r.useRef(!1),[ue,_s]=r.useState("demo"),[it,kt]=r.useState("spec"),We=ve.useRef(null),{createDialogVisible:Ms,createName:Bs,createReference:Fs,createMode:Ws,generateAxure:Hs,referenceItems:Vs,selectedThemes:Gs,availableThemes:Ks,selectedLibraries:Js,availableLibraries:Xs,selectedDocs:qs,availableDocs:Ys,selectedDataAssets:Zs,availableDataAssets:Qs,setCreateDialogVisible:en,setCreateName:tn,setCreateReference:sn,setCreateMode:nn,setGenerateAxure:on,setSelectedThemes:rn,setSelectedLibraries:an,setSelectedDocs:ln,setSelectedDataAssets:cn,buildPrompt:dn,clearCreateDialogState:un,handleCreateCancel:hn}=gr(u,U);r.useEffect(()=>{let t=!1;return Qe.getConfig().then(s=>{var a,i;if(t)return;const n=(a=s==null?void 0:s.automation)==null?void 0:a.defaultPromptClient;Ee(n==="claude"||n==="cursor"||n==="codex"?n:null),Re(((i=s==null?void 0:s.automation)==null?void 0:i.defaultIDE)||null)}).catch(()=>{t||(Ee(null),Re(null))}),()=>{t=!0}},[]),r.useEffect(()=>{let t=!1;return Qe.getAssistantRuntime({autoStart:!1}).then(s=>{t||fe(s)}).catch(()=>{t||fe(k)}),()=>{t=!0}},[]),r.useEffect(()=>{localStorage.setItem(ys,String(Math.round(Ye)))},[Ye]);const At=B,lt=r.useCallback((t,s)=>{try{const n=new URL(t,window.location.origin);return n.searchParams.set("context",JSON.stringify(s)),n.toString()}catch(n){return console.warn("Failed to serialize assistant context into URL:",n),t}},[]),ct=r.useMemo(()=>{const t=((te==null?void 0:te.webBaseUrl)||w).replace(/\/+$/g,""),s=new URL(`${t}/`),n=(te==null?void 0:te.projectPath)||"";return n&&s.searchParams.set("cwd",n),pe&&s.searchParams.set("provider",pe),s.toString()},[te,pe]),ze=we||ct;r.useEffect(()=>{P(!1)},[ze]),r.useEffect(()=>{at.current=I},[I]);const De=r.useMemo(()=>{const t=d?ht(d):null,s=it==="prd"?"prd":"spec",a=t?ue==="spec"?`${t}/${s==="prd"?"prd.md":"spec.md"}`:`${t}/index.tsx`:null,l={version:"1",systemContext:"",currentFile:a||"",selectedElements:[],extensions:{source:"axhub-runtime",projectPath:(te==null?void 0:te.projectPath)||"",provider:pe,viewMode:ue,activeTab:u,currentSpecDocKey:s,selectedItem:d?{name:d.name,displayName:d.displayName,demoUrl:d.demoUrl,specUrl:d.specUrl}:null,paths:{itemSourcePath:t,currentFilePath:a,currentFileDirectory:t},updatedAt:new Date().toISOString()}};return q?{...l,systemContext:q.systemContext||l.systemContext,currentFile:q.currentFile||l.currentFile,selectedElements:Array.isArray(q.selectedElements)?q.selectedElements:l.selectedElements,extensions:{...l.extensions||{},...q.extensions||{}}}:l},[te==null?void 0:te.projectPath,pe,ue,u,it,d,q]),es=r.useCallback(()=>{const t=m.current;if(!t||!t.contentWindow)return;let s="*";try{s=new URL(ze).origin}catch{s="*"}const n={type:"update_context",context:De};t.contentWindow.postMessage(n,s)},[ze,De]);r.useEffect(()=>{!X||!I||es()},[X,I,es]),r.useEffect(()=>{X||(P(!1),se(null))},[X]);const gt=r.useCallback((t,s)=>{const n=t||ct;let a=n;try{const i=new URL(n,window.location.origin),l=(te==null?void 0:te.projectPath)||"";!i.searchParams.get("cwd")&&l&&i.searchParams.set("cwd",l),!i.searchParams.get("provider")&&pe&&i.searchParams.set("provider",pe),s&&!i.searchParams.get("targetPath")&&i.searchParams.set("targetPath",s),i.searchParams.get("context")?a=i.toString():a=lt(i.toString(),De)}catch{a=lt(n,De)}return a},[te==null?void 0:te.projectPath,pe,ct,De,lt]),ts=r.useCallback((t,s)=>{const n=gt(t,s);Pe(!0),P(!1),se(n)},[gt]),ss=r.useCallback((t,s)=>{const n=gt(t,s);window.open(n,"_blank","noopener,noreferrer")},[gt]),dt=r.useCallback((t,s="replace")=>{const n=m.current;if(!n||!n.contentWindow)return!1;let a="*";try{a=new URL(ze).origin}catch{a="*"}const i={type:"update_context",mode:s,context:{version:t.version,systemContext:t.systemContext,currentFile:t.currentFile,selectedElements:t.selectedElements,extensions:t.extensions}};return n.contentWindow.postMessage(i,a),!0},[ze]),yt=r.useCallback((t,s="replace")=>{dt(t,s),s==="replace"&&(window.setTimeout(()=>dt(t,s),160),window.setTimeout(()=>dt(t,s),520))},[dt]),ns=r.useCallback((t,s)=>{const n=m.current;if(!n||!n.contentWindow)return!1;let a="*";try{a=new URL(ze).origin}catch{a="*"}const i={type:"update_prompt",prompt:t,autoSend:s};return n.contentWindow.postMessage(i,a),!0},[ze]),os=r.useCallback(async(t=8e3)=>{var n;const s=Date.now();for(;Date.now()-s<t;){if((n=m.current)!=null&&n.contentWindow&&at.current)return!0;await new Promise(a=>setTimeout(a,120))}return!1},[]),Rt=r.useCallback((t,s,n,a,i="iframe")=>{const l=t.health.hints;h.confirm({title:"Axhub Genie æœªå°±ç»ª",width:620,content:e.jsxs("div",{children:[e.jsx("p",{children:t.health.message}),e.jsxs(Me.Paragraph,{style:{marginBottom:8},copyable:{text:l.installGlobal,tooltips:["å¤åˆ¶å‘½ä»¤","å·²å¤åˆ¶"],onCopy:()=>o.success("å…¨å±€å®‰è£…å‘½ä»¤å·²å¤åˆ¶")},children:["å…¨å±€å®‰è£…ï¼š",e.jsx(Me.Text,{code:!0,children:l.installGlobal})]}),e.jsxs(Me.Paragraph,{style:{marginBottom:0},copyable:{text:l.start,tooltips:["å¤åˆ¶å‘½ä»¤","å·²å¤åˆ¶"],onCopy:()=>o.success("å¯åŠ¨å‘½ä»¤å·²å¤åˆ¶")},children:["å¯åŠ¨å‘½ä»¤ï¼š",e.jsx(Me.Text,{code:!0,children:l.start})]})]}),cancelText:"å…³é—­",footer:(p,{CancelBtn:x})=>e.jsx(x,{})}),s==="event"&&o.warning("Genie æœªå°±ç»ªï¼Œå·²å›é€€ä¸ºå®‰è£…å¼•å¯¼ã€‚")},[o,h]),Ze=r.useCallback(async(t,s,n,a="iframe")=>{if(Xe)return!1;qe(!0);const i=o.loading("æ­£åœ¨å¯åŠ¨å¹¶æ£€æµ‹ Axhub Genie...",0);console.info(`${c} begin runtime check`,{trigger:t,openTarget:a,targetUrl:s||null,targetPath:n||null});try{const l=await Qe.getAssistantRuntime();if(fe(l),console.info(`${c} runtime response`,{status:l.health.status,message:l.health.message,source:l.source,commandSource:l.health.commandSource,webBaseUrl:l.webBaseUrl,apiBaseUrl:l.apiBaseUrl}),l.health.status==="ready")return a==="window"?ss(s,n):ts(s,n),!0;console.warn(`${c} runtime not ready`,{status:l.health.status,message:l.health.message,hints:l.health.hints}),Rt(l,t,s,n,a)}catch(l){const p=te||k;fe(p),console.error(`${c} runtime check failed`,l),o.error((l==null?void 0:l.message)||"æ£€æµ‹ Axhub Genie çŠ¶æ€å¤±è´¥"),Rt(p,t,s,n,a)}finally{i(),qe(!1)}return!1},[Xe,te,o,ts,ss,Rt]),rs=r.useCallback(async t=>{var A,re;const s=((A=t.targetPath)==null?void 0:A.trim())||void 0,n=t.context,a=String(t.prompt||"").trim(),i=t.mode==="selection_context",l=(()=>{if(!n)return q;const _=q??{systemContext:"",currentFile:"",selectedElements:[],extensions:{}},me=yr(_.selectedElements,n.selectedElements);return{version:"1",systemContext:n.systemContext||_.systemContext,currentFile:n.currentFile||_.currentFile,selectedElements:wr(me),extensions:{..._.extensions||{},...n.extensions||{}}}})();l&&je(l);let p=X&&I&&!!((re=m.current)!=null&&re.contentWindow),x=!1;if(!p){const _=i?n:l,me=_?lt(ct,_):void 0;if(!await Ze("event",me,s))return;if(x=!!_,p=await os(8e3),!p){o.warning("åŠ©æ‰‹é¢æ¿å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•ã€‚");return}}if(l){const _=i?"append":"replace",me=i?n:l;me&&!(i&&x)&&yt(me,_)}if(i)return;if(!a){o.warning("ç¼ºå°‘å‘é€å†…å®¹");return}ns(a,!0)||o.error("å‘é€å¤±è´¥ï¼šæ— æ³•å†™å…¥åŠ©æ‰‹è¾“å…¥æ¡†")},[q,X,I,dt,yt,ns,Ze,os,o,lt,ct]),pn=r.useCallback(()=>{if(X){Pe(!1);return}Ze("button")},[X,Ze]);r.useEffect(()=>{const t=s=>{const n=s,a=n.detail,i=a==null?void 0:a.url;!i||typeof i!="string"||(Ze("event",i,a==null?void 0:a.targetPath),n.preventDefault())};return window.addEventListener(ws,t),()=>{window.removeEventListener(ws,t)}},[Ze]);const fn=()=>{const t=`${window.location.protocol}//${window.location.hostname}:${window.location.port}${(d==null?void 0:d.demoUrl)||""}`;navigator.clipboard.writeText(t).then(()=>{o.success("æœ¬åœ°é“¾æ¥å·²å¤åˆ¶")}).catch(s=>{o.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),ke(!1)},mn=()=>{const t=ds();navigator.clipboard.writeText(t).then(()=>{o.success("å±€åŸŸç½‘é“¾æ¥å·²å¤åˆ¶")}).catch(s=>{o.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),ke(!1)},xn=()=>{window.open("/api/download-dist","_blank"),ke(!1)},gn=async()=>{let t="",s="";const n=[...Ts];if(d){const i=d;if(ue==="spec"){const l=it==="prd"?"prd.md":"spec.md";t=`src/${u}/${d.name}/${l}`,s=`[${d.displayName} - ${l==="prd.md"?"PRD":"SPEC"}](${ht(d)}/${l})`}else{if(i.filePath){const l=i.filePath.indexOf("src/");l>=0?t=i.filePath.substring(l):t=i.filePath}else t=`src/${u}/${d.name}/index.tsx`;s=`[${d.displayName}](${ht(d)})`}}else{o.warning("è¯·å…ˆé€‰æ‹©æ¡ç›®");return}const a=o.loading("æ­£åœ¨å‘é€åˆ° IDE...",0);try{s&&await navigator.clipboard.writeText(s);const i=await bs({preferredIDE:be,targetPath:t}),l=i?10:1;let p=!1;for(let A=0;A<l;A+=1){const re=await Qe.sendWsMessage({type:"handshake",payload:"prototype-admin",targetClientTypes:n});if(re!=null&&re.sent){p=!0;break}A<l-1&&await new Promise(_=>setTimeout(_,500))}if(!p){o.info("ç¼–è¾‘å™¨æ­£åœ¨å¯åŠ¨ä¸­ï¼Œå·²å¤åˆ¶æ–‡ä»¶æ ‡é¢˜ï¼Œå¯ç¨ååœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€");return}const x=i?3:1;let E=!1;for(let A=0;A<x;A+=1){const re=await Qe.sendWsMessage({type:"open-file",payload:t,targetClientTypes:n});if(re!=null&&re.sent){E=!0;break}A<x-1&&await new Promise(_=>setTimeout(_,300))}if(!E){o.warning("ç¼–è¾‘å™¨æœªè¿æ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}o.success("å·²åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œå¹¶å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ç¼–è¾‘")}catch(i){o.error((i==null?void 0:i.message)||"å‘é€å¤±è´¥")}finally{a()}},yn=async t=>bs({preferredIDE:t||be}),wn=async t=>{let s="";if(ue==="spec"){const n=it==="prd"?"prd.md":"spec.md";s=`[${t.displayName} - ${n==="prd.md"?"PRD":"SPEC"}](${ht(t)}/${n})`}else s=`[${t.displayName}](${ht(t)})`;if(!s){o.warning("æ— æ³•è·å–è·¯å¾„");return}try{await navigator.clipboard.writeText(s),o.success("è·¯å¾„å·²å¤åˆ¶")}catch(n){console.error("Failed to copy: ",n),o.error("å¤åˆ¶å¤±è´¥")}},bn=r.useMemo(()=>[{value:"desktop",icon:e.jsx(Mo,{})},{value:"mobile",icon:e.jsx(Bo,{})},{value:"tablet",icon:e.jsx(Fo,{})}],[]),[tt,Pt]=r.useState(!1),[jn,Dt]=r.useState(!1),[$,Oe]=r.useState({width:1920,height:1080,includeConfig:"code",contentType:"title",rawScreenshotUrl:"",screenshotWidth:0,screenshotHeight:0,previewUrl:""});r.useEffect(()=>{ut()},[]),r.useEffect(()=>{const t=s=>{var i;const n=(i=le.current)==null?void 0:i.contentWindow;if(!n||s.source!==n)return;const a=pt();if(!(a!=="*"&&s.origin!==a))if(s.data&&s.data.type==="SCREENSHOT_CAPTURED")Oe(l=>({...l,rawScreenshotUrl:s.data.dataUrl,screenshotWidth:s.data.width,screenshotHeight:s.data.height}));else if(s.data&&s.data.type==="spec-doc-changed"){console.log("Spec document changed:",s.data.activeDocKey);const l=s.data.activeDocKey==="prd"?"prd":"spec";kt(l)}else if(s.data&&s.data.type==="TEXT_EDIT_STATUS")oe({enabled:!!s.data.enabled,editedCount:Number(s.data.editedCount||0)});else if(s.data&&s.data.type==="TEXT_EDIT_NOTICE"){const l=s.data.level||"info",p=s.data.message||"";p&&(o[l]||o.info)(p)}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_CONFIRM_REQUEST"){const l=Number(s.data.totalCount||0),p=Number(s.data.changedCount||0),x=!!s.data.exitAfterSave;h.confirm({title:"ç¡®è®¤ä¿å­˜æ–‡æœ¬æ›´æ”¹",content:e.jsxs("div",{children:[e.jsxs("div",{children:["æ£€æµ‹åˆ° ",p," å¤„æ–‡æœ¬æ›´æ”¹ã€‚"]}),e.jsxs("div",{children:["é¢„è®¡å°†æ›¿æ¢é¡¹ç›®ä¸­çš„ ",l," å¤„åŒ¹é…æ–‡æœ¬ã€‚"]}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"ä¿å­˜åå°†æ‰¹é‡ä¿®æ”¹ç›¸å…³æ–‡ä»¶å†…å®¹ã€‚"})]}),okText:"ç¡®è®¤ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{_e({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!0,exitAfterSave:x})},onCancel:()=>{_e({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!1,exitAfterSave:x})}})}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_RESULT"){const l=!!s.data.success;if(xe.current&&(xe.current=!1,l)){const p=He();p!=null&&p.disable&&(p.disable(),Ve())}}else if(s.data&&s.data.type==="TEXT_EDIT_CONFLICT"){const l=Array.isArray(s.data.conflicts)?s.data.conflicts:[];h.warning({title:"å­˜åœ¨å†²çªçš„æ–‡æœ¬ä¿®æ”¹",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"æ£€æµ‹åˆ°ç›¸åŒåŸæ–‡è¢«ä¿®æ”¹æˆä¸åŒå†…å®¹ï¼Œæ— æ³•æ‰¹é‡ä¿å­˜ã€‚"}),e.jsx("div",{style:{maxHeight:200,overflow:"auto",fontSize:12,color:"#555"},children:l.map((p,x)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{fontWeight:600},children:["åŸæ–‡ï¼š",p.original]}),e.jsxs("div",{children:["ä¿®æ”¹ä¸ºï¼š",(p.currents||[]).join(" / ")]})]},`${p.original}-${x}`))}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"è¯·ç¡®ä¿ç›¸åŒåŸæ–‡åªä¿®æ”¹ä¸ºä¸€ç§ç»“æœï¼Œæˆ–åˆ†æ‰¹ä¿å­˜ã€‚"})]}),okText:"çŸ¥é“äº†"})}else Ho(s.data)&&rs(s.data.payload)};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[rs]),r.useEffect(()=>{oe({enabled:!1,editedCount:0})},[d,ue,Ue]),r.useEffect(()=>{if(!d)return;if($.contentType==="screenshot"&&!$.rawScreenshotUrl){Oe(s=>({...s,previewUrl:""}));return}(async()=>{const s=u==="elements"?"å…ƒç´ ":"é¡µé¢",n=Nt($.rawScreenshotUrl,$,d.displayName,s),a=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(a);Oe(l=>({...l,previewUrl:i}))})()},[$.rawScreenshotUrl,$.width,$.height,$.contentType,d,u]);const Nt=(t,s,n,a)=>{if(s.contentType==="title"){const i=s.width,l=s.height,p=i/2,x=l/2;return`<svg width="${i}" height="${l}" viewBox="0 0 ${i} ${l}" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect width="100%" height="100%" fill="transparent" />
              <g id="textGroup" transform="translate(${p},${x})">
                <!-- Main Title -->
                <text id="mainTitle"
                      x="0" y="-12"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="28"
                      font-weight="700"
                      fill="#333">
                  ${n}
                </text>

                <!-- Description -->
                <text id="description"
                      x="0" y="18"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="14"
                      font-weight="400"
                      fill="#999">
                  Axhub Runtime ${a}
                </text>
              </g>
            </svg>`}else return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${s.width}" height="${s.height}" viewBox="0 0 ${s.width} ${s.height}">
                <rect width="100%" height="100%" fill="transparent" />
                <image x="0" y="0" width="${s.width}" height="${s.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${t}"/>
            </svg>`},wt=ve.useRef(!1);r.useEffect(()=>{if(wt.current=!1,$.contentType==="screenshot"){const t=u==="pages"?1920:500,s=u==="pages"?1080:300;Oe(n=>({...n,width:t,height:s,screenshotWidth:0,screenshotHeight:0,rawScreenshotUrl:""}))}else $.contentType==="title"&&Oe(t=>({...t,width:500,height:300}))},[u,$.contentType]),r.useEffect(()=>{wt.current||$.contentType==="screenshot"&&(!$.screenshotWidth||!$.screenshotHeight||Oe(t=>({...t,width:$.screenshotWidth,height:$.screenshotHeight})))},[$.screenshotWidth,$.screenshotHeight]);const Sn=(t,s)=>{wt.current=!0,Oe(n=>({...n,[t]:s||0}))},vn=()=>{$.contentType==="screenshot"&&tt&&Ut()},Cn=()=>{wt.current=!0;const t=$.width,s=$.height;Oe(n=>({...n,width:s,height:t})),setTimeout(()=>{$.contentType==="screenshot"&&tt&&Ut(s,t)},0)};r.useEffect(()=>{localStorage.setItem(gs,u)},[u]),r.useEffect(()=>{if(!G&&U){const t=u==="elements"?U.elements:U.pages;t.length>0?(N(t[0]),u==="elements"&&Ce({width:600,height:400})):N(null)}},[G,U,u]);async function ut(){var t,s;try{const n=await fetch("/api/entries.json");if(!n.ok)throw new Error("Failed to fetch data");const a=await n.json();console.log("Loaded data:",a),console.log("Reference elements:",(t=a.elements)==null?void 0:t.filter(i=>i.isReference)),console.log("Reference pages:",(s=a.pages)==null?void 0:s.filter(i=>i.isReference)),ne(a)}catch(n){o.error("åŠ è½½æ•°æ®å¤±è´¥: "+n.message)}finally{Z(!1)}}function ht(t){const s=t;if(s.filePath){const a=s.filePath.indexOf("src/");if(a>=0){let i=s.filePath.substring(a);return i=i.replace(/\/index\.(t|j)sx?$/i,""),i}return s.filePath}return`${u==="pages"?"src/pages":"src/elements"}/${t.name}`}const En=t=>{const s=`${u}/${t.name}`,n=`/api/zip?path=${encodeURIComponent(s)}`;window.open(n,"_blank")},In=t=>{const s=dr(t,u);h.info({title:`è®¾ç½®ä¸ºå‚è€ƒ - ${t.displayName}`,okText:"å…³é—­",width:560,content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:12,color:"#8c8c8c"},children:"å¯ç›´æ¥å¤åˆ¶ Promptï¼Œæˆ–é€‰æ‹©å®¢æˆ·ç«¯è‡ªåŠ¨æ‰§è¡Œã€‚"}),e.jsx(nt,{type:"primary",preferredClient:pe,preferredIDE:be,getIdeTargetPath:()=>`src/${u}/${t.name}`,scene:`set-reference-${u}`,buildPrompt:()=>s,copySuccessMessage:"è®¾ç½®ä¸ºå‚è€ƒçš„ Prompt å·²å¤åˆ¶ï¼Œè¯·è¿”å› IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›é€€ä¸ºå¤åˆ¶ Prompt"})]})})},$n=t=>{const s=u==="elements"?`elements/${t.name}`:`pages/${t.name}`;h.confirm({title:`ç¡®å®šè¦å–æ¶ˆ "${t.displayName}" çš„å‚è€ƒçŠ¶æ€å—ï¼Ÿ`,content:"å–æ¶ˆåè¯¥é¡¹ç›®å°†ä¸å†æ˜¯å‚è€ƒé¡¹ç›®ã€‚",okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const n=o.loading("æ­£åœ¨å–æ¶ˆå‚è€ƒ...",0);try{const a=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!a.ok){const i=await a.json();throw new Error(i.error||"å–æ¶ˆå‚è€ƒå¤±è´¥")}o.success("å·²å–æ¶ˆå‚è€ƒ"),N(null),ut()}catch(a){o.error(a.message||"å–æ¶ˆå‚è€ƒå¤±è´¥")}finally{n()}}})},Tn=t=>{const s=u==="elements"?"å…ƒç´ ":"é¡µé¢",n=u==="elements"?`elements/${t.name}`:`pages/${t.name}`;let a=t.displayName;h.confirm({title:`é‡å‘½å${s}`,content:e.jsx("div",{children:e.jsx(Be,{autoFocus:!0,defaultValue:t.displayName,placeholder:"è¯·è¾“å…¥æ–°çš„æ˜¾ç¤ºåç§°ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰",onChange:i=>{a=i.target.value}})}),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const i=a.trim();if(!i)return o.error("è¯·è¾“å…¥æ–°çš„åç§°"),Promise.reject();if(i===t.displayName)return;const l=o.loading("æ­£åœ¨é‡å‘½å...",0);try{const p=await fetch("/api/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n,newName:i})});if(!p.ok){const x=await p.json().catch(()=>({}));throw new Error(x.error||"é‡å‘½åå¤±è´¥")}o.success("é‡å‘½åæˆåŠŸ"),N(null),ut()}catch(p){return o.error(p.message||"é‡å‘½åå¤±è´¥"),Promise.reject()}finally{l()}}})},kn=async(t,s)=>{const n=await fetch("/api/items/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemType:t,itemName:s})});if(!n.ok){const a=await n.json().catch(()=>({}));throw new Error(a.error||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}return n.json()},An=t=>{if(t.isReference){o.error("å‚è€ƒé¡¹ç›®æ— æ³•åˆ é™¤ï¼Œè¯·å…ˆå–æ¶ˆå‚è€ƒçŠ¶æ€");return}const s=u,n=u==="elements"?"å…ƒç´ ":"é¡µé¢",a=`${s}/${t.name}`,i=async()=>{const p=o.loading("æ­£åœ¨åˆ é™¤...",0);try{const x=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:a})});if(!x.ok){const E=await x.json();throw new Error(E.error||"åˆ é™¤å¤±è´¥")}o.success("åˆ é™¤æˆåŠŸ"),N(null),ut()}catch(x){o.error(x.message||"åˆ é™¤å¤±è´¥")}finally{p()}};(async()=>{const p=o.loading("æ­£åœ¨æ£€æŸ¥å¼•ç”¨...",0);try{const x=await kn(s,t.name),E=Array.isArray(x==null?void 0:x.references)?x.references:[];if(E.length>0){const A=E.map(_=>`- ${_}`).join(`
`),re=`æˆ‘å¸Œæœ›åˆ é™¤${n} "${t.displayName}" (${t.name})ã€‚
è¯¥${n}ä½äºé¡¹ç›®ä¸­çš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š\`src/${s}/${t.name}\`

å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥${n}ï¼š
${A}

è¯·å¸®æˆ‘æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥å’Œæ“ä½œï¼š
1. æ ¸å¯¹ä¸Šè¿°å¼•ç”¨æ˜¯å¦å‡†ç¡®ï¼Œå¹¶è¡¥å……é—æ¼çš„å¼•ç”¨æ–‡ä»¶ï¼ˆä¼˜å…ˆæ£€æŸ¥ \`src/elements/\` ä¸ \`src/pages/\`ï¼‰ã€‚
2. å¦‚æœç¡®è®¤ç»§ç»­åˆ é™¤ï¼Œè¯·ååŠ©æˆ‘å°†è¯¥${n}åœ¨å¼•ç”¨å¤„æ›¿æ¢ä¸ºåˆé€‚çš„å®ç°ï¼Œå¹¶æ›´æ–°å¼•ç”¨è·¯å¾„ï¼Œä½¿è¿™äº›åŸå‹ä¸å†ä¾èµ–è¯¥ç›®å½•ã€‚
3. å®Œæˆä¸Šè¿°è§£è€¦æ“ä½œåï¼Œå†å½»åº•åˆ é™¤ç›®å½• \`src/${s}/${t.name}\`ã€‚`;h.confirm({title:`æ£€æµ‹åˆ°${n}å¼•ç”¨`,width:720,okText:"å…³é—­",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:8},children:["å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥",n,"ï¼š"]}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:A}),e.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:e.jsx(nt,{type:"primary",preferredClient:pe,preferredIDE:be,getIdeTargetPath:()=>`src/${s}/${t.name}`,scene:`delete-ref-fix-${s}`,buildPrompt:()=>re,copySuccessMessage:"å·²å¤åˆ¶å¤„ç†æç¤ºï¼Œè¯·è¿”å›ç¼–è¾‘å™¨è®© AI å¤„ç†ã€‚",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›é€€ä¸ºå¤åˆ¶ Prompt"})})]})})}else h.confirm({title:`ç¡®å®šè¦åˆ é™¤${n} "${t.displayName}" å—ï¼Ÿ`,content:"æœªæ£€æµ‹åˆ°å¼•ç”¨æ–‡ä»¶ã€‚åˆ é™¤åæ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚",okText:"ç¡®è®¤åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",onOk:i})}catch(x){o.error(x.message||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}finally{p()}})()},Rn=async t=>{const s=u==="elements"?"elements":"pages",n=`src/${s}/${t.name}`,a=(l,p)=>{let x=`${l}-copy`,E=1;for(;p.includes(x);)E++,x=`${l}-copy${E}`;return x},i=o.loading("æ­£åœ¨åˆ›å»ºå‰¯æœ¬...",0);try{const l=(u==="elements"?U.elements:U.pages).map(A=>A.name),p=a(t.name,l),x=`src/${s}/${p}`,E=await fetch("/api/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:n,targetPath:x})});if(!E.ok){const A=await E.json();throw new Error(A.error||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}o.success(`å‰¯æœ¬ "${p}" åˆ›å»ºæˆåŠŸ`),ut()}catch(l){o.error(l.message||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}finally{i()}},bt=r.useMemo(()=>{const t=u==="elements"?U.elements:U.pages;if(!M)return t;const s=M.toLowerCase();return t.filter(n=>n.displayName.toLowerCase().includes(s)||n.name.toLowerCase().includes(s))},[U,u,M]),Pn=async({key:t})=>{V.mode==="webEditorV2"&&await is({restoreDevice:!1});const s=bt.find(n=>n.name===t);s&&(N(s),kt("spec"),u==="elements"&&Ce({width:600,height:400}))},as=t=>{H(t),O(""),N(null),kt("spec")},Dn=()=>{et(t=>t+1)},He=t=>{var n,a;const s=t??Ge();return(a=(n=s==null?void 0:s.contentWindow)==null?void 0:n.DevTemplateBootstrap)==null?void 0:a.editors},Ve=()=>{var n;const t=He(),s=(n=t==null?void 0:t.getStatus)==null?void 0:n.call(t);s&&ce(s)},Nn=()=>{if(!d)return"";const t=window.location.origin+d.demoUrl,s=new URL(t,window.location.origin);if(s.searchParams.set("editor","inspecta"),Ie.id!=="desktop"){const n=ft.width?Math.round(ft.width):Ie.width;n&&s.searchParams.set("width",String(n))}return s.toString()},Ln=()=>Ie.id==="desktop"?null:(ft.width?Math.round(ft.width):Ie.width)||null,Un=()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}const t=Nn();if(!t)return;const s=He();if(s!=null&&s.disable)try{s.disable(),V.mode==="webEditorV2"&&Lt(),Ve()}catch(n){console.error("[Axhub] é€€å‡ºå½“å‰ç¼–è¾‘æ¨¡å¼å¤±è´¥:",n)}window.open(t,"_blank")},zn=!!d&&ue!=="spec",Ge=()=>le.current,pt=t=>{const s=t??Ge();if(!s)return window.location.origin;const n=s.getAttribute("src")||s.src;if(!n)return window.location.origin;try{return new URL(n,window.location.origin).origin}catch{return window.location.origin}},On=t=>{const s=Date.now(),n=(t==null?void 0:t.timeoutMs)??5e3,a=t==null?void 0:t.expectedEditor;return new Promise(i=>{const l=x=>{const E=x.getAttribute("src")||x.src;if(!E)return!1;try{return new URL(E,window.location.origin).searchParams.get("editor")===a}catch{return!1}},p=()=>{var A;const x=Ge();if(!x||!x.isConnected){if(Date.now()-s>=n){i(null);return}setTimeout(p,50);return}if(!l(x)){if(Date.now()-s>=n){i(null);return}setTimeout(p,50);return}const E=x.contentWindow;if((A=E==null?void 0:E.DevTemplateBootstrap)!=null&&A.editors){i(x);return}if(Date.now()-s>=n){i(null);return}setTimeout(p,50)};p()})},_e=(t,s)=>{const n=s??Ge();return!n||!n.contentWindow?(o.warning("æœªæ‰¾åˆ°å¯æ“ä½œçš„é¢„è§ˆçª—å£"),!1):(n.contentWindow.postMessage(t,pt(n)),!0)},Lt=r.useCallback(()=>{var t;je(s=>s&&{...s,selectedElements:[]}),X&&I&&((t=m.current)!=null&&t.contentWindow)&&yt({version:De.version,systemContext:De.systemContext,currentFile:De.currentFile,selectedElements:[],extensions:De.extensions},"replace")},[X,I,De,yt]),_n=async()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}try{const t=Ge(),s=Ln();ee.current=s??null,R(!0),Ie.id!=="desktop"&&(L.current=K,J("desktop"));const n=await On({previousIframe:Ie.id!=="desktop"?t:null,expectedEditor:"webEditorV2"});if(!n){R(!1),o.warning("é¢„è§ˆçª—å£å°šæœªå°±ç»ª");return}const a=He(n);if(!(a!=null&&a.enable)){R(!1),o.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨");return}s&&_e({type:"WEB_EDITOR_SET_ROOT_SIZE",width:s},n),await Promise.resolve(a.enable("webEditorV2")),Ve(),We.current===null&&(We.current=Q),g(!0)}catch(t){console.error("[Axhub] å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥:",t),o.error("å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥")}},is=async t=>{const s=He();if(!(s!=null&&s.disable)){Lt(),o.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨"),R(!1),We.current!==null&&(g(We.current),We.current=null),ee.current&&(_e({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),ee.current=null),(t==null?void 0:t.restoreDevice)!==!1&&L.current&&J(L.current),L.current=null;return}try{await Promise.resolve(s.disable()),Lt(),Ve(),R(!1),We.current!==null&&(g(We.current),We.current=null),ee.current&&(_e({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),ee.current=null);const n=(t==null?void 0:t.restoreDevice)!==!1;n&&L.current&&J(L.current),L.current=null,n||(L.current=null)}catch(n){console.error("[Axhub] é€€å‡ºç¼–è¾‘å™¨å¤±è´¥:",n),o.error("é€€å‡ºç¼–è¾‘å™¨å¤±è´¥")}},Mn=()=>{},Bn=()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}const t=He();if(t!=null&&t.enable){try{t.enable("textEdit"),Ve()}catch(s){console.error("[Axhub] å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥:",s),o.error("å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥")}return}_e({type:"TEXT_EDIT_ENABLE"})},ls=(t=!1)=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}xe.current=t,_e({type:"TEXT_EDIT_SAVE",exitAfterSave:t})},Fn=()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}if(C.editedCount>0){h.confirm({title:"é€€å‡ºæ–‡æœ¬ç¼–è¾‘",content:`æ£€æµ‹åˆ° ${C.editedCount} å¤„æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦ä¿å­˜åé€€å‡ºï¼Ÿ`,okText:"ä¿å­˜å¹¶é€€å‡º",cancelText:"ä¸ä¿å­˜é€€å‡º",onOk:()=>ls(!0),onCancel:()=>{_e({type:"TEXT_EDIT_EXIT",discardChanges:!0});const s=He();s!=null&&s.disable&&(s.disable(),Ve())}});return}const t=He();if(t!=null&&t.disable){t.disable(),Ve();return}_e({type:"TEXT_EDIT_EXIT",discardChanges:!1})},cs=(t=!0)=>new Promise((s,n)=>{const a=Ge();if(!a||!a.contentWindow){n(new Error("æœªæ‰¾åˆ°å¯å¯¼å‡ºçš„é¢„è§ˆçª—å£"));return}const i=pt(a),l=window.setTimeout(()=>{window.removeEventListener("message",p),n(new Error("å¯¼å‡ºè¶…æ—¶ï¼Œè¯·é‡è¯•"))},15e3),p=x=>{if(x.source===a.contentWindow&&x.origin===i&&!(!x.data||x.data.type!=="FIGMA_JSON_READY"))if(window.removeEventListener("message",p),window.clearTimeout(l),x.data.success){const E=x.data.json??x.data.data??x.data.payload;if(E===void 0){n(new Error("å¯¼å‡ºæˆåŠŸä½†æœªè¿”å›æ•°æ®ï¼ˆç¼ºå°‘ json/data/payload å­—æ®µï¼‰"));return}const A=Array.isArray(E)?E:E.layers||[];s({layers:A,widgetId:x.data.widgetId,pageId:x.data.pageId})}else n(new Error(x.data.error||"å¯¼å‡ºå¤±è´¥"))};window.addEventListener("message",p),a.contentWindow.postMessage({type:"EXPORT_FIGMA_JSON",rootName:(d==null?void 0:d.displayName)||(d==null?void 0:d.name),enableAutoLayout:t},i)}),Wn=async(t=!0)=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const s=o.loading("æ­£åœ¨ç”Ÿæˆ Figma JSON...",0);try{const{layers:n,widgetId:a,pageId:i}=await cs(t),l={layers:n,...a?{widgetId:a}:{},...i?{pageId:i}:{}},p=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),x=URL.createObjectURL(p),E=document.createElement("a");E.href=x,E.download=`${d.name}-${u}.json`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(x),o.success("JSON å·²ä¸‹è½½")}catch(n){o.error((n==null?void 0:n.message)||"å¯¼å‡ºå¤±è´¥")}finally{s()}},ds=()=>{if(!d)return"";const t=d.demoUrl,s=window.__LOCAL_IP__||"localhost",n=window.location.port||(window.location.protocol==="https:"?"443":"80");return`${window.location.protocol}//${s}:${n}${t}`},Ie=r.useMemo(()=>_t.find(t=>t.id===K)||_t[0],[K]);r.useEffect(()=>{_t.some(s=>s.id===K)||J("desktop")},[K]);const[ft,us]=r.useState({width:0,height:0});r.useEffect(()=>{if(Ie.id==="desktop"||Ie.width===0||!F.current){us({width:0,height:0}),z(1);return}const t=()=>{if(!F.current)return;const s=F.current.clientWidth*.9,n=F.current.clientHeight*.9,a=Ie.width,i=Ie.height,x=24+8,E=(s-x)/a,A=(n-x)/i,re=Math.min(E,A),_=a*re,me=i*re;us({width:_,height:me}),z(1)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[Ie,Q]);const Ut=(t,s)=>{const n=t??$.width,a=s??$.height,i=Ge();if(i&&i.contentWindow){const l=pt(i);i.contentWindow.postMessage({type:"CAPTURE_SCREENSHOT",targetWidth:n,targetHeight:a},l)}};r.useEffect(()=>{if(tt&&$.contentType==="screenshot"){const t=u==="pages"?1920:500,s=u==="pages"?1080:300;$.width===t&&$.height===s&&Ut()}if(!tt){const t=Ge();if(t&&t.contentWindow){const s=pt(t);t.contentWindow.postMessage({type:"RESET_SCREENSHOT_STYLES"},s)}}},[tt,$.contentType,$.width,$.height]);const[Hn,zt]=r.useState([]),Vn=window.location.port||(window.location.protocol==="https:"?"443":"80"),Ot=async()=>{try{const t=await fetch("/api/ws/clients");if(t.ok){const n=(await t.json()).clients||[];return zt(n),n}else return zt([]),[]}catch(t){return console.error("Failed to check WS clients",t),zt([]),[]}};r.useEffect(()=>{Ot()},[]);const Gn=async()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const t=o.loading("æ­£åœ¨æ£€æŸ¥è¿æ¥...",0),s=await Ot();t(),s.length===0?h.confirm({title:"æœªæ£€æµ‹åˆ° Figma è¿æ¥",content:e.jsxs("div",{children:[e.jsx("p",{children:"è¯·ç¡®ä¿ Figma æ’ä»¶å·²æ‰“å¼€å¹¶è¿æ¥åˆ°å½“å‰æœåŠ¡ã€‚"}),e.jsxs("p",{style:{color:"#999",fontSize:12},children:["å½“å‰æœåŠ¡ç«¯å£: ",Vn]})]}),okText:"ä»è¦æ¨é€",cancelText:"å–æ¶ˆ",onOk:()=>hs()}):hs()},hs=async()=>{const t=o.loading("æ­£åœ¨è·å–æ•°æ®...",0);try{const{layers:s,widgetId:n,pageId:a}=await cs();if(t(),!s||!Array.isArray(s)||s.length===0){o.error("å›¾å±‚æ•°æ®ä¸ºç©ºï¼Œæ— æ³•æ¨é€");return}let i;u==="elements"?(n||o.warning("å…ƒç´ ç¼ºå°‘ widgetIdï¼Œå¯èƒ½å¯¼è‡´åŒæ­¥å¤±è´¥"),i={type:"sync-widget-content",widgetId:n||`element-${(d==null?void 0:d.name)||"unknown"}-${Date.now()}`,data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}}):i={type:"sync-page-content",...a?{pageId:a}:{},data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}};const l=o.loading("æ­£åœ¨æ¨é€åˆ° Figma...",0);try{const p=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(p.ok)await p.json(),o.success("æ¨é€æˆåŠŸ");else{const x=await p.text();throw new Error(x||"å‘é€å¤±è´¥")}}catch(p){o.error("æ¨é€å¤±è´¥: "+p.message)}finally{l()}}catch(s){t(),o.error((s==null?void 0:s.message)||"è·å–æ•°æ®å¤±è´¥")}},Kn=(t,s,n,a=2)=>new Promise((i,l)=>{const p=new Image,x=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),E=URL.createObjectURL(x);p.onload=()=>{const A=document.createElement("canvas");A.width=s*a,A.height=n*a;const re=A.getContext("2d");if(!re){l(new Error("Could not get canvas context"));return}re.drawImage(p,0,0,A.width,A.height),URL.revokeObjectURL(E),i(A.toDataURL("image/png"))},p.onerror=A=>{URL.revokeObjectURL(E),l(A)},p.src=E}),Jn=async()=>{if(d){Dt(!0);try{const t=window.location.origin+d.jsUrl,s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch code: ${s.statusText}`);const n=await s.text();let a="";if(d){const l=`${window.location.origin}/${u}/${d.name}/hack.css`;try{const p=await fetch(l);p.ok&&(a=await p.text())}catch(p){console.warn("fetch hack.css failed",p)}}const i=async(l=!1)=>{const p=`${window.location.origin}/${u}/${d.name}`,x=["spec","prd"],E={};for(const _ of x){const me=`${p}/${_}.md`;try{const Se=await fetch(me);if(Se.ok){const Ae=await Se.text(),Ne={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};E[_]={name:Ne[_],content:Ae}}}catch(Se){console.warn(`Failed to fetch ${_}.md`,Se)}}if(l){const _=`${u}/${d.name}`,me=`${window.location.origin}/api/source?path=${encodeURIComponent(_)}`;try{const Se=await fetch(me);if(Se.ok){const Ne=`\`\`\`tsx
${await Se.text()}
\`\`\`
`;E.code={name:"å‚è€ƒä»£ç ",content:Ne}}}catch(Se){console.warn("Failed to fetch source code",Se)}}const A=Object.keys(E);return A.length>1?E:A.length===1?E[A[0]].content:null};if($.contentType==="screenshot"&&!$.rawScreenshotUrl){o.warning("æ­£åœ¨ç”Ÿæˆæˆªå›¾ï¼Œè¯·ç¨å€™..."),Dt(!1);return}try{let l="",p="";if($.includeConfig!=="none"&&(l=n,$.includeConfig==="codeAndDocs"||$.includeConfig==="codeAndDocsAndSource")){const Le=$.includeConfig==="codeAndDocsAndSource",Ke=await i(Le);Ke&&(p=Ke)}const x=u==="elements"?"å…ƒç´ ":"é¡µé¢";let E="";if($.contentType==="title"){const Le=Nt("",$,d.displayName,x),Ke=await Kn(Le,$.width,$.height,2);E=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${$.width}" height="${$.height}" viewBox="0 0 ${$.width} ${$.height}">
                            <rect width="100%" height="100%" fill="transparent" />
                            <image x="0" y="0" width="${$.width}" height="${$.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${Ke}"/>
                        </svg>`}else E=Nt($.rawScreenshotUrl,$,d.displayName,x);const re=new DOMParser().parseFromString(E,"image/svg+xml"),_=re.querySelector("svg");if(!_)throw new Error("SVG generation failed");if(l||p){const Le={code:l,spec:p};_.setAttribute("AxExtraData",encodeURIComponent(JSON.stringify(Le)))}if($.includeConfig!=="none"){const Le={time:Math.floor(Date.now()/1e3),config:{codeLink:t,...u==="pages"?{isFullScreen:!0}:{},...a?{hackCss:a}:{}}};_.setAttribute("AxData",encodeURIComponent(JSON.stringify(Le)))}const Se=new XMLSerializer().serializeToString(re),Ae=new Blob([Se],{type:"image/svg+xml;charset=utf-8"}),Ne=URL.createObjectURL(Ae),ge=document.createElement("a");ge.href=Ne,ge.download=`${d.name}.svg`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(Ne),o.success("SVG å¯¼å‡ºæˆåŠŸ"),Pt(!1)}catch(l){console.error("Image export failed:",l),o.error("å›¾ç‰‡å¯¼å‡ºå¤±è´¥")}}catch(t){o.error(`å¯¼å‡ºå¤±è´¥: ${t.message}`),console.error("å¯¼å‡ºå¤±è´¥:",t)}finally{Dt(!1)}}},Xn=async t=>{if(!d)throw new Error("æœªé€‰æ‹©é¡¹ç›®");const s=window.location.origin+d.jsUrl,n=await fetch(s);if(!n.ok)throw new Error(`Failed to fetch code: ${n.statusText}`);const a=await n.text();let i="";const l=`${window.location.origin}/${u}/${d.name}/hack.css`;try{const E=await fetch(l);E.ok&&(i=await E.text())}catch{}const p=async(E=!1)=>{const A=`${window.location.origin}/${u}/${d.name}`,re=["spec","prd"],_={};for(const Ae of re){const Ne=`${A}/${Ae}.md`;try{const ge=await fetch(Ne);if(ge.ok){const Le=await ge.text(),Ke={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};_[Ae]={name:Ke[Ae],content:Le}}}catch(ge){console.warn(`Failed to fetch ${Ae}.md`,ge)}}if(E){const Ae=`${u}/${d.name}`,Ne=`${window.location.origin}/api/source?path=${encodeURIComponent(Ae)}`;try{const ge=await fetch(Ne);if(ge.ok){const Ke=`\`\`\`tsx
${await ge.text()}
\`\`\`
`;_.code={name:"å‚è€ƒä»£ç ",content:Ke}}}catch(ge){console.warn("Failed to fetch source code",ge)}}const me=Object.keys(_);return me.length>1?_:me.length===1?_[me[0]].content:null},x={time:Math.floor(Date.now()/1e3),config:{code:a,...u==="pages"?{isFullScreen:!0}:{},...i?{hackCss:i}:{}}};if(t==="codeAndDocs"||t==="codeAndDocsAndSource"){const A=await p(t==="codeAndDocsAndSource");A&&(x.config.spec=A)}return JSON.stringify(x,null,2)},qn=ae||V.mode==="webEditorV2"?"webEditorV2":V.mode,Yn=ae||V.mode==="webEditorV2"?ee.current??void 0:void 0,Zn=d?xr(d,ue,qn,{width:Yn}):"",Qn=t=>{const s=window.location.origin+t.demoUrl;window.open(s,"_blank")},eo=()=>{Ze("button",ze,void 0,"window")};return e.jsxs(xt,{style:{minHeight:"100vh"},children:[b,e.jsx("style",{children:`
                .resize-handle-right {
                    cursor: ew-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-right::before {
                    content: '';
                    position: absolute;
                    right: 50%;
                    top: 50%;
                    transform: translate(50%, -50%);
                    width: 2px;
                    height: 40px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-right:hover::before,
                .resize-handle-right:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 3px;
                    height: 50px;
                }
                .resize-handle-bottom {
                    cursor: ns-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottom::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    bottom: 50%;
                    transform: translate(-50%, 50%);
                    width: 40px;
                    height: 2px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottom:hover::before,
                .resize-handle-bottom:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 50px;
                    height: 3px;
                }
                .resize-handle-bottomRight {
                    cursor: nwse-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottomRight::before {
                    content: '';
                    position: absolute;
                    right: 0;
                    bottom: 0;
                    width: 12px;
                    height: 12px;
                    background: var(--ant-color-border);
                    border-radius: 0 0 6px 0;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottomRight:hover::before,
                .resize-handle-bottomRight:active::before {
                    background: var(--ant-color-border-secondary);
                    width: 16px;
                    height: 16px;
                }
                /* å®¹å™¨æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹æŸ„ */
                .ant-card-hoverable:hover .resize-handle-right::before,
                .ant-card-hoverable:hover .resize-handle-bottom::before,
                .ant-card-hoverable:hover .resize-handle-bottomRight::before {
                    background: var(--ant-color-border-secondary);
                }

                /* èœå•é¡¹ hover æ—¶æ˜¾ç¤ºæ›´å¤šæŒ‰é’® */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }

                /* ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ */
                @media (max-width: 768px) {
                    /* éšè— PC ç«¯çš„å®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: none !important;
                    }
                    
                    /* æ˜¾ç¤ºç§»åŠ¨ç«¯ç®€åŒ–å¸ƒå±€ */
                    .mobile-layout {
                        display: block !important;
                    }
                }

                @media (min-width: 769px) {
                    /* PC ç«¯æ˜¾ç¤ºå®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: block !important;
                    }
                    
                    /* éšè—ç§»åŠ¨ç«¯å¸ƒå±€ */
                    .mobile-layout {
                        display: none !important;
                    }
                }

                /* ç§»åŠ¨ç«¯åˆ—è¡¨æ ·å¼ */
                .mobile-item-card {
                    background: ${f?"#1f1f1f":"#fff"};
                    border: 1px solid ${f?"#303030":"#f0f0f0"};
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 12px;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .mobile-item-card:hover {
                    border-color: ${f?"#177ddc":"#1890ff"};
                    box-shadow: 0 2px 8px ${f?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.1)"};
                }

                .mobile-item-card:active {
                    transform: scale(0.98);
                }

                .mobile-item-title {
                    font-size: 16px;
                    font-weight: 500;
                    color: ${f?"#fff":"#000"};
                    margin-bottom: 4px;
                }

                .mobile-item-name {
                    font-size: 12px;
                    color: ${f?"#8c8c8c":"#999"};
                }
            `}),e.jsxs("div",{className:"pc-layout",children:[e.jsx(sr,{collapsed:Q,setCollapsed:g,selectedItem:d,viewMode:ue,setViewMode:_s,activeTab:u,selectedDeviceId:K,setSelectedDeviceId:J,deviceSegmentOptions:bn,handleOpenInspect:Un,handleOpenWebEditor:_n,handleExitWebEditor:is,handleSaveWebEditor:Mn,handleEnableTextEdit:Bn,handleSaveTextEdit:()=>ls(!1),handleExitTextEdit:Fn,handleRefreshElement:Dn,handleCopyLocalLink:fn,handleCopyLANLink:mn,handleDownloadZip:xn,getLANUrl:ds,qrCodeVisible:Fe,setQrCodeVisible:ke,wsClients:Hn,checkConnection:Ot,handlePushToFigma:Gn,handleDownloadFigmaJson:Wn,setIsExportModalOpen:Pt,handleOpenIdeFile:gn,handleOpenProjectInIDE:yn,preferredIDE:be,onPreferredIDEChange:Re,isDarkMode:f,setIsDarkMode:v,currentSpecDocKey:it,textEditState:C,textEditAvailable:zn,editorMode:V.mode,handleRefreshEditorStatus:Ve,onSettingsSaved:()=>{Qe.getConfig().then(t=>{var n,a;const s=(n=t==null?void 0:t.automation)==null?void 0:n.defaultPromptClient;Ee(s==="claude"||s==="cursor"||s==="codex"?s:null),Re(((a=t==null?void 0:t.automation)==null?void 0:a.defaultIDE)||null)}).catch(()=>{Ee(null),Re(null)})},assistantEnabled:!0,assistantVisible:X,onToggleAssistant:pn}),e.jsxs(xt,{children:[e.jsx(Yo,{collapsed:Q,loading:G,activeTab:u,handleTabChange:as,data:U,searchText:M,setSearchText:O,filteredItems:bt,selectedItem:d,handleMenuClick:Pn,handleDownloadItemSource:En,handleRenameItem:Tn,handleSetReference:In,handleUnsetReference:$n,handleDuplicateItem:Rn,handleDeleteItem:An,handleCopyItemPath:wn,setCreateDialogVisible:en,preferredPromptClient:pe,preferredIDE:be}),e.jsxs("div",{style:{display:"flex",flex:1,minWidth:0},children:[e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(ar,{containerRef:F,previewIframeRef:le,selectedItem:d,activeTab:u,currentDevice:Ie,displaySize:ft,scale:de,elementIframeKey:Ue,iframeUrl:Zn,elementIframeSize:Te,setElementIframeSize:Ce,viewMode:ue})}),X&&e.jsx(Us,{size:{width:Math.min(Math.max(Ye,D),At),height:"100%"},minWidth:D,maxWidth:At,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(t,s,n)=>{const a=Math.min(Math.max(n.getBoundingClientRect().width,D),At);y(a)},style:{borderLeft:`1px solid ${ie.colorBorderSecondary}`,background:ie.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:m,src:ze,title:"Axhub Genie",onLoad:()=>P(!0),style:{border:"none",width:"100%",height:"100%"}})})]})]}),e.jsx(cr,{visible:Ms,onClose:hn,activeTab:u,createName:Bs,setCreateName:tn,createReference:Fs,setCreateReference:sn,createMode:Ws,setCreateMode:nn,generateAxure:Hs,setGenerateAxure:on,referenceItems:Vs,selectedDocs:qs,setSelectedDocs:ln,availableDocs:Ys,selectedThemes:Gs,setSelectedThemes:rn,availableThemes:Ks,selectedDataAssets:Zs,setSelectedDataAssets:cn,availableDataAssets:Qs,selectedLibraries:Js,setSelectedLibraries:an,availableLibraries:Xs,preferredPromptClient:pe,preferredIDE:be,buildCreatePrompt:dn,onAfterCreatePromptAction:un}),e.jsx(Go,{open:tt,onClose:()=>Pt(!1),imageConfig:$,setImageConfig:Oe,onDimensionChange:Sn,onSwapDimensions:Cn,onDimensionBlur:vn,isExporting:jn,onExport:Jn,onCopyConfig:Xn,activeTab:u,itemName:d==null?void 0:d.name,preferredPromptClient:pe,preferredIDE:be})]}),e.jsx("div",{className:"mobile-layout",style:{display:"none"},children:e.jsxs("div",{style:{padding:"16px",minHeight:"100vh",background:f?"#141414":"#f5f5f5"},children:[e.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsxs("h1",{style:{margin:0,fontSize:"24px",fontWeight:600,color:f?"#fff":"#000"},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})}),e.jsx(Y,{type:"default",icon:e.jsx(Qt,{}),onClick:eo,children:"ç½‘é¡µåŠ©æ‰‹"})]}),e.jsx(Zt,{activeKey:u,onChange:t=>as(t),style:{marginBottom:"16px"},items:[{key:"pages",label:`é¡µé¢ (${U.pages.length})`,icon:e.jsx(ot,{})},{key:"elements",label:`å…ƒç´  (${U.elements.length})`,icon:e.jsx(Xt,{})}]}),e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Ps,{}),value:M,onChange:t=>O(t.target.value),allowClear:!0,style:{marginBottom:"16px"}}),G?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(mt,{tip:"åŠ è½½ä¸­..."})}):e.jsx("div",{children:bt.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:f?"#8c8c8c":"#999"},children:["æš‚æ— ",u==="elements"?"å…ƒç´ ":"é¡µé¢"]}):bt.map(t=>e.jsxs("div",{className:"mobile-item-card",onClick:()=>Qn(t),children:[e.jsx("div",{className:"mobile-item-title",children:t.displayName}),e.jsx("div",{className:"mobile-item-name",children:t.name})]},t.name))})]})}),b,j]})}function jr(){const[f,v]=r.useState(()=>{try{return localStorage.getItem(xs)==="true"}catch{return!1}}),c=w=>{v(w);try{localStorage.setItem(xs,String(w))}catch(T){console.error("Failed to save dark mode preference:",T)}};return e.jsx(Oo,{theme:Wo(f),children:e.jsx(_o,{children:e.jsx(br,{isDarkMode:f,setIsDarkMode:c})})})}const Sr=zo.createRoot(document.getElementById("root"));Sr.render(e.jsx(jr,{}));
