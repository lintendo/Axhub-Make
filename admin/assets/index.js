import"./chunks/modulepreload-polyfill.js";import{I as Se,T as Oe,r,s as _,j as e,M as Ge,ac as bt,H as ze,u as ce,E as Ve,S as Ie,a5 as It,ad as zs,ae as ct,af as we,ag as ft,b as U,ah as ut,ai as We,aj as Xe,t as Ue,ak as Ls,l as Rt,v as Bt,al as Os,o as Pe,am as Mt,a3 as Us,an as Fs,L as Le,V as _t,d as Wt,ao as Bs,ap as Je,aq as mt,Q as Ms,ar as gt,D as Ke,P as _s,G as Ht,K as Ws,N as Hs,O as Vs,$ as re,as as Vt,at as Jt,h as Re,n as Js,au as Ks,a1 as Gs,av as Xs,i as qs,k as Ys,m as xt,w as Kt,x as Gt,y as Zs,e as yt,z as Qs,A as en,B as dt,aw as Xt,p as wt,a0 as tn,ax as sn,ay as nn,az as At,aA as on,aB as rn,aC as an,U as qt,aD as ln,aE as cn,R as dn,C as hn,a as Et,aF as pn,aG as Dt,aa as fn,ab as un,F as mn,aH as gn,g as xn,aI as yn}from"./chunks/vendor.js";import{g as wn}from"./chunks/index.js";const Pt="axhub-admin-active-tab",Nt="axhub-admin-create-mode",zt="axhub-admin-generate-axure",Lt="axhub-admin-create-reference",Ot="axhub-make-dark-mode",ht=[{id:"desktop",name:"ç”µè„‘",width:0,height:0,type:"desktop"},{id:"mobile",name:"æ‰‹æœº",width:10,height:21.7,type:"mobile",ratio:"21.7:10"},{id:"tablet",name:"å¹³æ¿",width:10,height:14.3,type:"tablet",ratio:"10:14.3"}],jt={async deleteItem(i){const c=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:i})});if(!c.ok){const n=await c.json();throw new Error(n.error||"åˆ é™¤å¤±è´¥")}return c.json()},async unsetReference(i){const c=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:i})});if(!c.ok){const n=await c.json();throw new Error(n.error||"å–æ¶ˆå‚è€ƒå¤±è´¥")}return c.json()},async getWsClients(){const i=await fetch("/api/ws/clients");return i.ok?(await i.json()).clients||[]:[]},async sendWsMessage(i){const c=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!c.ok){const n=await c.text();throw new Error(n||"å‘é€å¤±è´¥")}return c.json()},async fetchCode(i){const c=await fetch(i);if(!c.ok)throw new Error(`è·å–æ„å»ºä»£ç å¤±è´¥ï¼Œè¯·è®© AI ä¿®å¤: ${c.statusText}`);return c.text()},async fetchHackCss(i,c){const n=`${window.location.origin}/${i}/${c}/hack.css`;try{const j=await fetch(n);if(j.ok)return await j.text()}catch(j){console.warn("fetch hack.css failed",j)}return""},async fetchSpecMd(i,c){const n=`${window.location.origin}/${i}/${c}/spec.md`;try{const j=await fetch(n);if(j.ok)return await j.text()}catch(j){console.warn("Error fetching spec.md",j)}return""},async reviewCode(i){const c=await fetch("/api/code-review",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:i})});if(!c.ok){const n=await c.json();throw new Error(n.error||"ä»£ç æ£€æŸ¥å¤±è´¥")}return c.json()}},{TextArea:jn}=Se,{Text:De}=Oe,bn=({open:i,onClose:c,imageConfig:n,setImageConfig:j,onDimensionChange:u,onSwapDimensions:W,onDimensionBlur:F,isExporting:z,onExport:p,onCopyConfig:J,activeTab:l,itemName:D})=>{const q=l==="elements"?"å…ƒç´ ":"é¡µé¢",[L,b]=r.useState(null),[E,R]=r.useState(!1),[K,O]=r.useState(!1),[o,P]=_.useMessage(),[B,ne]=r.useState("export"),[Q,Y]=r.useState(""),[A,G]=r.useState(""),[se,H]=r.useState(!1);r.useEffect(()=>{(async()=>{if(A&&B==="copyConfig"){H(!0);try{if(!await X()){G(""),Y(""),H(!1);return}const N=await J(A);Y(N)}catch{o.error("åŠ è½½é…ç½®å¤±è´¥"),Y("")}finally{H(!1)}}})()},[A,B,J,o]),r.useEffect(()=>{i||(ne("export"),G(""),Y(""))},[i]);const X=async()=>{if(!D)return!0;O(!0);try{const m=`${l}/${D}`,oe=await jt.reviewCode(m);return oe.passed?!0:(b(oe),R(!0),!1)}catch(m){return console.error("ä»£ç æ£€æŸ¥å¤±è´¥:",m),!0}finally{O(!1)}},y=async()=>{await X()&&p()},d=async()=>{if(!Q){o.warning("è¯·å…ˆé€‰æ‹©å¯¼å‡ºå†…å®¹");return}try{await navigator.clipboard.writeText(Q),o.success("é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{o.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å‰ªè´´æ¿æƒé™")}},f=m=>{m.target.select()},k=async()=>{if(!L)return;const m=L.issues.filter(g=>g.type==="error"),oe=L.issues.filter(g=>g.type==="warning");let N=`ä»£ç æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·å¸®æˆ‘ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š

`;N+=`æ–‡ä»¶ï¼š${L.file}

`,m.length>0&&(N+=`âŒ é”™è¯¯ (${m.length} ä¸ª):
`,m.forEach((g,M)=>{N+=`
${M+1}. [${g.rule}] ${g.message}
`,g.suggestion&&(N+=`   å»ºè®®: ${g.suggestion}
`)})),oe.length>0&&(N+=`
âš ï¸ è­¦å‘Š (${oe.length} ä¸ª):
`,oe.forEach((g,M)=>{N+=`
${M+1}. [${g.rule}] ${g.message}
`,g.suggestion&&(N+=`   å»ºè®®: ${g.suggestion}
`)}));try{await navigator.clipboard.writeText(N),o.success("å¤åˆ¶æˆåŠŸ"),R(!1)}catch{o.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å‰ªè´´æ¿æƒé™")}};return e.jsxs(e.Fragment,{children:[P,e.jsx(Ge,{title:"å¯¼å‡ºåˆ° Axure",open:i,onCancel:c,footer:B==="export"?[e.jsx(U,{type:"primary",loading:z||K,onClick:y,children:"å¯¼å‡º"},"export")]:[e.jsx(U,{type:"primary",disabled:!Q,onClick:d,children:"å¤åˆ¶é…ç½®"},"copy")],width:800,children:e.jsx(bt,{activeKey:B,onChange:ne,items:[{key:"export",label:"å¯¼å‡ºå›¾ç‰‡",children:e.jsxs("div",{style:{display:"flex",gap:"20px",height:"400px"},children:[e.jsx("div",{style:{flex:1,border:"1px solid #f0f0f0",borderRadius:"8px",overflow:"hidden",background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:n.previewUrl?e.jsx("img",{src:n.previewUrl,alt:"Preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}):e.jsx(ze,{tip:"æ­£åœ¨ç”Ÿæˆé¢„è§ˆ..."})}),e.jsxs("div",{style:{width:"240px",display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å¯¼å‡ºå°ºå¯¸",e.jsx(ce,{title:"è¿”å› Axure åŒå‡»å…ƒç´ å°±å¯ä»¥æ›¿æ¢å›¾ç‰‡ï¼ŒåŒå‡»å›¾ç‰‡å·¦ä¸Šè§’æˆ–è€…åœ¨æ ·å¼é¢æ¿é‡Œç‚¹å‡»è‡ªé€‚åº”å›¾ç‰‡å³å¯æ›´æ–°å›¾ç‰‡å°ºå¯¸",children:e.jsx(Ve,{style:{color:"#999",cursor:"help"}})})]}),e.jsxs(Ie,{children:[e.jsx(It,{value:n.width,onChange:m=>u("width",m),onBlur:F,placeholder:"å®½",style:{width:100},min:1}),e.jsx(zs,{onClick:W,style:{color:"#999",cursor:"pointer",fontSize:14}}),e.jsx(It,{value:n.height,onChange:m=>u("height",m),onBlur:F,placeholder:"é«˜",style:{width:100},min:1})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å›¾ç‰‡å†…å®¹",e.jsx(ce,{title:"æ ‡é¢˜å°é¢ä¾¿äºåœ¨ Axure å†…æ›´æ”¹å°ºå¯¸",children:e.jsx(Ve,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(ct.Group,{value:n.contentType,onChange:m=>j(oe=>({...oe,contentType:m.target.value})),children:e.jsxs(Ie,{direction:"vertical",children:[e.jsxs(ct,{value:"title",children:[q,"æ ‡é¢˜"]}),e.jsxs(ct,{value:"screenshot",children:[q,"æˆªå›¾"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["åŒ…å«é…ç½®",e.jsx(ce,{title:"è‹¥åŒ…å«é…ç½®ï¼Œä»…éœ€å¯¼å…¥å›¾ç‰‡åˆ° Axureï¼Œä¸€èˆ¬ä¸éœ€è¦å†å¤åˆ¶é…ç½®æˆ–è€…ä»£ç ",children:e.jsx(Ve,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(we,{value:n.includeConfig,onChange:m=>j(oe=>({...oe,includeConfig:m})),style:{width:"100%"},options:[{label:"æ— ",value:"none"},{label:"åŸå‹",value:"code"},{label:"åŸå‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŸå‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]})]})]})},{key:"copyConfig",label:"å¤åˆ¶é…ç½®",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"400px"},children:[e.jsx(ft,{message:"å¯¼å‡ºæœ¬åœ° html æˆ–è€…å‘å¸ƒåˆ° Axure Cloud æ—¶è‹¥å›¾ç‰‡å¤±æ•ˆå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½",type:"info",showIcon:!0}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"å¯¼å‡ºå†…å®¹"}),e.jsx(we,{value:A||void 0,onChange:G,placeholder:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",style:{width:"100%"},options:[{label:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",value:"",disabled:!0},{label:"åŸå‹",value:"code"},{label:"åŸå‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŸå‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]}),A&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"é…ç½®å†…å®¹"}),se?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #d9d9d9",borderRadius:"6px"},children:e.jsx(ze,{tip:"æ­£åœ¨åŠ è½½é…ç½®..."})}):e.jsx(jn,{value:Q,readOnly:!0,onFocus:f,style:{flex:1,fontFamily:"monospace",fontSize:"12px"},placeholder:"é…ç½®å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"})]})]})}]})}),e.jsx(Ge,{title:"ä»£ç æ£€æŸ¥æœªé€šè¿‡",open:E,onCancel:()=>R(!1),width:600,footer:[e.jsx(U,{onClick:()=>R(!1),children:"å–æ¶ˆ"},"cancel"),e.jsx(U,{type:"primary",icon:e.jsx(Xe,{}),onClick:k,children:"å¤åˆ¶ç»™ AI ä¿®å¤"},"copy")],children:L&&e.jsxs("div",{style:{maxHeight:"500px",overflowY:"auto"},children:[e.jsx(ft,{description:"ä»£ç ä¸ç¬¦åˆå¼€å‘è§„èŒƒï¼Œéœ€è¦ä¿®å¤åæ‰èƒ½å¯¼å‡º",type:"error",showIcon:!0,style:{marginBottom:"24px"}}),L.issues.filter(m=>m.type==="error").length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(ut,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(De,{type:"danger",children:"é”™è¯¯ (å¿…é¡»ä¿®å¤)"})}),e.jsx(We,{size:"small",dataSource:L.issues.filter(m=>m.type==="error"),renderItem:m=>e.jsx(We.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(De,{strong:!0,children:["[",m.rule,"]"]})," ",e.jsx(De,{children:m.message})]}),m.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",m.suggestion]})]})})})]}),L.issues.filter(m=>m.type==="warning").length>0&&e.jsxs("div",{children:[e.jsx(ut,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(De,{type:"warning",children:"è­¦å‘Š (å»ºè®®ä¿®å¤)"})}),e.jsx(We,{size:"small",dataSource:L.issues.filter(m=>m.type==="warning"),renderItem:m=>e.jsx(We.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(De,{strong:!0,children:["[",m.rule,"]"]})," ",e.jsx(De,{children:m.message})]}),m.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",m.suggestion]})]})})})]})]})})]})},{Text:pt}=Oe,{useToken:vn}=Ue;function Sn({visible:i,onCancel:c,item:n,activeTab:j}){const{token:u}=vn(),[W,F]=r.useState([]),[z,p]=r.useState(!1),[J,l]=r.useState(""),[D,q]=r.useState(""),[L,b]=r.useState(!1),[E,R]=r.useState(!1),[K,O]=r.useState(null),[o,P]=r.useState(null),B=y=>{const d=y;let f="";if(d.filePath){const k=d.filePath.indexOf("src/");f=k>=0?d.filePath.substring(k):d.filePath}else f=`${j==="pages"?"src/pages":"src/elements"}/${y.name}`;return f=f.replace(/\/index\.(t|j)sx?$/i,""),f=f.replace(/^\/+/,""),f.startsWith("src/")&&(f=f.substring(4)),f},ne=y=>{const d=new Date(y),f=k=>String(k).padStart(2,"0");return`${d.getFullYear()}/${f(d.getMonth()+1)}/${f(d.getDate())} ${f(d.getHours())}:${f(d.getMinutes())}:${f(d.getSeconds())}`},Q=y=>{const d=Math.floor((Date.now()-y)/1e3);let f=d/31536e3;return f>1?Math.floor(f)+" å¹´å‰":(f=d/2592e3,f>1?Math.floor(f)+" ä¸ªæœˆå‰":(f=d/86400,f>1?Math.floor(f)+" å¤©å‰":(f=d/3600,f>1?Math.floor(f)+" å°æ—¶å‰":(f=d/60,f>1?Math.floor(f)+" åˆ†é’Ÿå‰":"åˆšåˆš"))))},Y=async()=>{if(n){R(!0);try{const y=B(n);if(!y){_.error("æ— æ³•è·å–æ–‡ä»¶è·¯å¾„"),R(!1);return}const d=await fetch(`/api/git/history?path=${encodeURIComponent(y)}`),f=await d.json();d.ok?(F(f.commits),p(f.hasUncommitted),l(f.uncommittedFiles)):_.error(f.error||"åŠ è½½ç‰ˆæœ¬å†å²å¤±è´¥")}catch{_.error("åŠ è½½ç‰ˆæœ¬å†å²å¤±è´¥")}finally{R(!1)}}};r.useEffect(()=>{i&&n&&Y()},[i,n]);const A=async y=>{if(n)try{const d=B(n),f=await fetch("/api/git/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:d,commitHash:y})}),k=await f.json();f.ok?(_.success("ç‰ˆæœ¬æ¢å¤æˆåŠŸ"),Y()):_.error(k.error||"ç‰ˆæœ¬æ¢å¤å¤±è´¥")}catch{_.error("ç‰ˆæœ¬æ¢å¤å¤±è´¥")}},G=async()=>{if(!n||!D.trim()){_.warning("è¯·è¾“å…¥æäº¤ä¿¡æ¯");return}b(!0);try{const y=B(n),d=await fetch("/api/git/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:y,message:D})}),f=await d.json();d.ok?(_.success("æäº¤æˆåŠŸ"),q(""),Y()):_.error(f.error||"æäº¤å¤±è´¥")}catch{_.error("æäº¤å¤±è´¥")}finally{b(!1)}},se=async()=>{if(n)try{const y=B(n),d=`æˆ‘éœ€è¦æäº¤ä»¥ä¸‹ç›®å½•çš„æ›´æ”¹ï¼Œè¯·å¸®æˆ‘å¤„ç†ï¼š

ç›®æ ‡è·¯å¾„: src/${y}

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. ä½¿ç”¨ git status å’Œ git diff æŸ¥çœ‹è¯¥è·¯å¾„ä¸‹çš„å˜æ›´å†…å®¹ã€‚
2. åˆ†æå˜æ›´ï¼Œç”Ÿæˆä¸€ä¸ªç®€æ´æ˜äº†çš„ä¸­æ–‡æäº¤ä¿¡æ¯ï¼ˆCommit Messageï¼‰ã€‚
3. å‘æˆ‘å±•ç¤ºå˜æ›´æ‘˜è¦å’Œå»ºè®®çš„æäº¤ä¿¡æ¯ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­ã€‚
4. è·å¾—ç¡®è®¤åï¼Œæ‰§è¡Œï¼š
   git add src/${y}
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"

è¯·ç›´æ¥å¼€å§‹æ‰§è¡Œç¬¬ 1 æ­¥ã€‚`;await navigator.clipboard.writeText(d),_.success("AI æŒ‡ä»¤å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´ç»™åŠ©æ‰‹")}catch{_.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")}},H=async y=>{if(n){O(y);try{const d=B(n),f=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:d,commitHash:y})}),k=await f.json();f.ok&&k.hasSpec&&k.specUrl?window.open(k.specUrl,"_blank"):k.hasSpec?_.error(k.error||"æ— æ³•è®¿é—®è§„æ ¼æ–‡æ¡£"):_.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰è§„æ ¼æ–‡æ¡£")}catch{_.error("åŠ è½½è§„æ ¼æ–‡æ¡£å¤±è´¥")}finally{O(null)}}},X=async y=>{if(n){P(y);try{const d=B(n),f=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:d,commitHash:y})}),k=await f.json();f.ok&&k.hasPrototype&&k.prototypeUrl?window.open(k.prototypeUrl,"_blank"):k.hasPrototype?_.error(k.error||"æ— æ³•è®¿é—®åŸå‹"):_.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰åŸå‹æ–‡ä»¶")}catch{_.error("åŠ è½½åŸå‹å¤±è´¥")}finally{P(null)}}};return e.jsx(Ge,{title:`ç‰ˆæœ¬ç®¡ç† - ${n==null?void 0:n.displayName}`,open:i,onCancel:c,footer:null,width:700,centered:!0,className:"version-dialog",styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingTop:12,paddingBottom:12}},destroyOnClose:!0,children:e.jsx(ze,{spinning:E,children:W.length===0&&!z?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"æš‚æ— ç‰ˆæœ¬å†å²"}):e.jsx(Ls,{mode:"left",items:[...z?[{children:e.jsx("div",{className:"commit-item uncommitted",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(pt,{strong:!0,style:{fontSize:14,marginRight:8},children:"æœªæäº¤çš„æ›´æ”¹"}),e.jsx(Rt,{color:"warning",children:"æœªä¿å­˜"})]})}),e.jsxs("div",{style:{background:u.colorFillAlter,padding:12,borderRadius:8,border:`1px solid ${u.colorBorderSecondary}`},children:[e.jsx(Se,{placeholder:"æ‰‹åŠ¨è¾“å…¥æäº¤ä¿¡æ¯...",value:D,onChange:y=>q(y.target.value),onPressEnter:G,style:{marginBottom:12}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,color:u.colorTextSecondary},children:J?`${J.split(`
`).filter(Boolean).length} ä¸ªæ–‡ä»¶å˜æ›´`:"æœ‰æ–‡ä»¶å˜æ›´"}),e.jsxs(Ie,{children:[e.jsx(U,{size:"small",icon:e.jsx(Bt,{}),onClick:se,style:{color:u.colorPrimary,borderColor:u.colorPrimary},children:"AI æäº¤"}),e.jsx(U,{type:"primary",size:"small",onClick:G,loading:L,disabled:!D.trim(),children:"æäº¤"})]})]})]})]})}),color:"orange",dot:e.jsx("div",{style:{width:10,height:10,background:u.colorWarning,borderRadius:"50%",border:`2px solid ${u.colorBgContainer}`}})}]:[],...W.map((y,d)=>{const f=d===0&&!z;return{children:e.jsx("div",{className:"commit-item",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{marginBottom:4,display:"flex",alignItems:"center"},children:[e.jsx(pt,{strong:!0,style:{fontSize:14,marginRight:8},children:y.message}),f&&e.jsx(Rt,{color:"success",children:"å½“å‰ç‰ˆæœ¬"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:u.colorTextSecondary},children:[e.jsxs(Ie,{size:4,children:[e.jsx(Os,{size:20,style:{backgroundColor:u.colorPrimary,fontSize:12},children:y.author?y.author[0].toUpperCase():"U"}),e.jsx("span",{children:y.author})]}),e.jsx("span",{style:{color:u.colorBorder},children:"|"}),e.jsx(ce,{title:ne(y.timestamp),children:e.jsx("span",{style:{cursor:"help"},children:Q(y.timestamp)})}),e.jsx("span",{style:{color:u.colorBorder},children:"|"}),e.jsx(pt,{code:!0,style:{fontSize:12,margin:0},children:y.hash.substring(0,7)})]})]}),!f&&e.jsxs(Ie,{size:0,children:[e.jsx(ce,{title:"æŸ¥çœ‹è§„æ ¼æ–‡æ¡£",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(Pe,{}),style:{color:u.colorTextSecondary},onClick:()=>H(y.hash),loading:K===y.hash})}),e.jsx(ce,{title:"æŸ¥çœ‹åŸå‹",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(Mt,{}),style:{color:u.colorTextSecondary},onClick:()=>X(y.hash),loading:o===y.hash})}),e.jsx(Us,{title:"ç¡®è®¤æ¢å¤",description:"ç¡®å®šè¦æ¢å¤åˆ°æ­¤ç‰ˆæœ¬å—ï¼Ÿå½“å‰æœªæäº¤çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚",onConfirm:()=>A(y.hash),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(ce,{title:"æ¢å¤æ­¤ç‰ˆæœ¬",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(Fs,{}),style:{color:u.colorTextSecondary}})})})]}),f&&e.jsx(Ie,{size:0})]})}),color:f?"green":"gray",dot:f?e.jsx("div",{style:{width:10,height:10,background:u.colorSuccess,borderRadius:"50%",border:`2px solid ${u.colorBgContainer}`}}):void 0}})]})})})}const{Sider:Cn}=Le,{useToken:$n}=Ue;function kn({collapsed:i,loading:c,activeTab:n,handleTabChange:j,data:u,searchText:W,setSearchText:F,filteredItems:z,selectedItem:p,handleMenuClick:J,handleDownloadItemSource:l,handleRenameItem:D,handleSetReference:q,handleUnsetReference:L,handleDuplicateItem:b,handleDeleteItem:E,handleCopyItemPath:R,setCreateDialogVisible:K}){const{token:O}=$n(),[o,P]=r.useState(!1),[B,ne]=r.useState(null),Q=A=>{ne(A),P(!0)},Y=r.useMemo(()=>z.map(A=>{const G=p&&p.name===A.name,se=[{key:"rename",label:"é‡å‘½å",icon:e.jsx(_t,{})},{key:"duplicate",label:"åˆ›å»ºå‰¯æœ¬",icon:e.jsx(Xe,{})},{key:"copy-path",label:"å¤åˆ¶è·¯å¾„",icon:e.jsx(Wt,{})},{type:"divider"},{key:"version-management",label:"ç‰ˆæœ¬ç®¡ç†",icon:e.jsx(Bs,{})},{key:"download-source",label:"å¯¼å‡º ZIP",icon:e.jsx(Je,{})},{type:"divider"},...A.isReference?[{key:"unset-reference",label:"å–æ¶ˆå‚è€ƒ",icon:e.jsx(mt,{})}]:[{key:"set-reference",label:"è®¾ç½®ä¸ºå‚è€ƒ",icon:e.jsx(mt,{})}],{key:"delete",label:`åˆ é™¤${n==="elements"?"å…ƒç´ ":"é¡µé¢"}`,icon:e.jsx(Ms,{}),danger:!0,disabled:A.isReference}];return{key:A.name,label:e.jsxs("div",{className:`menu-item-wrapper ${G?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:A.displayName})}),e.jsx(Ke,{trigger:["click"],menu:{items:se,onClick:({key:H})=>{H==="download-source"?l(A):H==="rename"?D(A):H==="duplicate"?b(A):H==="copy-path"?R(A):H==="version-management"?Q(A):H==="set-reference"?q(A):H==="unset-reference"?L(A):H==="delete"&&E(A)}},children:e.jsx(U,{type:"text",size:"small",className:"more-btn",icon:e.jsx(_s,{}),onClick:H=>{H.stopPropagation()}})})]}),icon:n==="elements"?e.jsx(gt,{}):e.jsx(Pe,{})}}),[z,n,p,l,D,q,L,E,R,b]);return e.jsxs(Cn,{trigger:null,collapsible:!0,collapsed:i,width:240,collapsedWidth:0,style:{background:O.colorBgContainer,borderRight:`1px solid ${O.colorBorder}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:[e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!i&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{activeKey:n,size:"small",centered:!0,onChange:A=>j(A),items:[{key:"pages",label:`é¡µé¢ (${u.pages.length})`,icon:e.jsx(Pe,{})},{key:"elements",label:`å…ƒç´  (${u.elements.length})`,icon:e.jsx(gt,{})}]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(Se,{placeholder:"æœç´¢...",prefix:e.jsx(Ht,{}),value:W,onChange:A=>F(A.target.value),allowClear:!0,style:{flex:1}})})]})}),c?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(ze,{tip:"åŠ è½½ä¸­..."})}):e.jsxs(e.Fragment,{children:[e.jsx(Ws,{mode:"inline",selectedKeys:p?[p.name]:[],items:Y,onClick:J,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!i&&e.jsx(Hs,{icon:e.jsx(Vs,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:()=>K(!0),tooltip:n==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢"})]}),e.jsx(Sn,{visible:o,onCancel:()=>P(!1),item:B,activeTab:n})]})}const{Title:Ut}=Oe;function Tn({open:i,onClose:c}){const[n]=re.useForm(),[j,u]=r.useState(!1),[W,F]=r.useState([]),[z,p]=r.useState([]),[J,l]=r.useState(!1);r.useEffect(()=>{i&&(D(),q())},[i]);const D=async()=>{var b,E,R,K;try{const O=await fetch("/api/config");if(!O.ok)throw new Error("Failed to load config");const o=await O.json();n.setFieldsValue({host:o.server.host||"localhost",allowLAN:o.server.allowLAN!==!1,enableCommandAPI:o.server.enableCommandAPI||!1,projectName:((b=o.projectInfo)==null?void 0:b.name)||void 0,projectDescription:((E=o.projectInfo)==null?void 0:E.description)||void 0,defaultDoc:((R=o.projectDefaults)==null?void 0:R.defaultDoc)||void 0,defaultTheme:((K=o.projectDefaults)==null?void 0:K.defaultTheme)||void 0})}catch(O){console.error("Error loading config:",O),_.error("åŠ è½½é…ç½®å¤±è´¥")}},q=async()=>{l(!0);try{const[b,E]=await Promise.all([fetch("/api/docs"),fetch("/api/themes")]);if(b.ok){const R=await b.json();F(Array.isArray(R)?R:[])}if(E.ok){const R=await E.json();p(Array.isArray(R)?R:[])}}catch(b){console.error("Error loading assets:",b)}finally{l(!1)}},L=async()=>{try{const b=await n.validateFields();u(!0);const E=await fetch("/api/config"),R=E.ok?await E.json():{server:{host:"localhost",port:51720,allowLAN:!0}},K={server:{host:b.host,port:R.server.port||51720,allowLAN:b.allowLAN,enableCommandAPI:b.enableCommandAPI||!1},projectInfo:{name:b.projectName??null,description:b.projectDescription??null},projectDefaults:{defaultDoc:b.defaultDoc??null,defaultTheme:b.defaultTheme??null}},O=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(!O.ok){const P=await O.json();throw new Error(P.error||"Failed to save config")}const o=await O.json();_.success(o.message||"é…ç½®å·²ä¿å­˜"),c()}catch(b){console.error("Error saving config:",b),_.error(b.message||"ä¿å­˜é…ç½®å¤±è´¥")}finally{u(!1)}};return e.jsx(Vt,{title:"é¡¹ç›®è®¾ç½®",open:i,onClose:c,width:600,extra:e.jsxs(Ie,{children:[e.jsx(U,{onClick:c,children:"å–æ¶ˆ"}),e.jsx(U,{type:"primary",onClick:L,loading:j,children:"ä¿å­˜"})]}),children:e.jsxs(re,{form:n,layout:"vertical",initialValues:{host:"localhost",allowLAN:!0,enableCommandAPI:!1,projectName:void 0,projectDescription:void 0,defaultDoc:void 0,defaultTheme:void 0},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Ut,{level:5,style:{marginBottom:16},children:"é¡¹ç›®ç”Ÿæˆé…ç½®"}),e.jsx(ft,{type:"info",showIcon:!0,message:"é¡¹ç›®ä¿¡æ¯å°†ä½œä¸º AI ç”Ÿæˆä¸å¯¹é½çš„å…³é”®å‚è€ƒï¼Œéœ€è¦é‡å¯ç¼–è¾‘å™¨æ‰ç”Ÿæ•ˆã€‚",style:{marginBottom:16}}),e.jsx(re.Item,{label:"é¡¹ç›®åç§°",name:"projectName",tooltip:"ç”¨äº AI ç†è§£é¡¹ç›®å®šä½ä¸äº§å‡ºé£æ ¼",children:e.jsx(Se,{placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°",maxLength:20})}),e.jsx(re.Item,{label:"é¡¹ç›®ç®€ä»‹",name:"projectDescription",tooltip:"ç®€è¦æè¿°é¡¹ç›®èƒŒæ™¯ã€ç›®æ ‡ç”¨æˆ·ä¸æ ¸å¿ƒåœºæ™¯",children:e.jsx(Se.TextArea,{placeholder:"ä¾‹å¦‚ï¼šé¢å‘è¿è¥äººå‘˜çš„æ´»åŠ¨é…ç½®åå°ï¼Œå¼ºè°ƒé«˜æ•ˆé…ç½®ä¸ç¨³å®šäº¤ä»˜",rows:2,maxLength:60,showCount:!0})}),e.jsx(re.Item,{label:"é¡¹ç›®æ€»æ–‡æ¡£",name:"defaultDoc",tooltip:"ä»â€œèµ„äº§ç®¡ç†-æ–‡æ¡£â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤å‚è€ƒæ–‡æ¡£",children:e.jsx(we,{allowClear:!0,loading:J,placeholder:"è¯·é€‰æ‹©é¡¹ç›®æ€»æ–‡æ¡£",options:W.map(b=>({value:b.name,label:b.displayName||b.name})),showSearch:!0,filterOption:(b,E)=>String((E==null?void 0:E.label)||"").toLowerCase().includes(b.toLowerCase())})}),e.jsx(re.Item,{label:"é»˜è®¤ä¸»é¢˜",name:"defaultTheme",tooltip:"ä»â€œèµ„äº§ç®¡ç†-ä¸»é¢˜â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤ä¸»é¢˜",children:e.jsx(we,{allowClear:!0,loading:J,placeholder:"è¯·é€‰æ‹©é»˜è®¤ä¸»é¢˜",options:z.map(b=>({value:b.name,label:b.displayName||b.name})),showSearch:!0,filterOption:(b,E)=>String((E==null?void 0:E.label)||"").toLowerCase().includes(b.toLowerCase())})})]}),e.jsx(ut,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Ut,{level:5,style:{marginBottom:16},children:"æœåŠ¡å™¨é…ç½®"}),e.jsx(re.Item,{label:"ä¸»æœºåœ°å€",name:"host",rules:[{required:!0,message:"è¯·è¾“å…¥ä¸»æœºåœ°å€"}],tooltip:"æœåŠ¡å™¨å¯åŠ¨çš„åŸŸåæˆ– IP åœ°å€",children:e.jsx(Se,{placeholder:"localhost"})}),e.jsx(re.Item,{label:"å…è®¸å±€åŸŸç½‘è®¿é—®",name:"allowLAN",valuePropName:"checked",tooltip:"å¼€å¯åï¼Œå±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡å¯ä»¥è®¿é—®æ­¤æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼Œè¯·ç¡®ä¿åœ¨å¯ä¿¡ç½‘ç»œç¯å¢ƒä¸­ä½¿ç”¨",children:e.jsx(Jt,{})})]})]})})}const{Header:In}=Le,{useToken:Rn}=Ue,An=i=>e.jsx("span",{role:"img","aria-label":"figma",className:"anticon anticon-figma",...i,children:e.jsxs("svg",{fill:"currentColor",fillRule:"evenodd",height:"1em",width:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[e.jsx("title",{children:"Figma"}),e.jsx("path",{clipRule:"evenodd",d:"M6.082 8.241C4.83 7.441 4 6.057 4 4.483 4 2.007 6.05 0 8.578 0h7.844C18.95 0 21 2.007 21 4.483c0 1.574-.829 2.959-2.082 3.758C20.17 9.041 21 10.426 21 12c0 2.476-2.05 4.483-4.578 4.483h-.084A4.615 4.615 0 0113.24 15.3v4.176C13.24 21.98 11.145 24 8.599 24 6.076 24 4 21.998 4 19.517c0-1.574.829-2.959 2.082-3.758C4.829 14.959 4 13.574 4 12c0-1.574.829-2.959 2.082-3.759zM13.24 12c0 1.676 1.387 3.034 3.098 3.034h.084c1.711 0 3.099-1.358 3.099-3.034 0-1.676-1.388-3.034-3.1-3.034h-.083c-1.71 0-3.098 1.358-3.098 3.034zm-1.48-3.034H8.578C6.867 8.966 5.48 10.324 5.48 12c0 1.672 1.382 3.029 3.089 3.034H11.76V8.966zm-3.182 7.517h-.01c-1.707.005-3.089 1.362-3.089 3.034 0 1.67 1.403 3.034 3.12 3.034 1.74 0 3.161-1.381 3.161-3.075v-2.993H8.578zm3.182-8.966H8.578c-1.711 0-3.099-1.358-3.099-3.034 0-1.676 1.388-3.034 3.1-3.034h3.181v6.068zm4.662 0H13.24V1.45h3.182c1.711 0 3.099 1.358 3.099 3.034 0 1.676-1.388 3.034-3.1 3.034z"})]})});function En({collapsed:i,setCollapsed:c,selectedItem:n,viewMode:j,setViewMode:u,activeTab:W,selectedDeviceId:F,setSelectedDeviceId:z,deviceSegmentOptions:p,handleOpenInspect:J,handleEnableTextEdit:l,handleSaveTextEdit:D,handleExitTextEdit:q,handleRefreshElement:L,handleCopyLocalLink:b,handleCopyLANLink:E,handleDownloadZip:R,getLANUrl:K,qrCodeVisible:O,setQrCodeVisible:o,wsClients:P,checkConnection:B,handlePushToFigma:ne,handleDownloadFigmaJson:Q,setIsExportModalOpen:Y,handleOpenIdeFile:A,isDarkMode:G,setIsDarkMode:se,currentSpecDocKey:H="spec",textEditState:X,textEditAvailable:y}){const[d,f]=Re.useState(null),[k,m]=Re.useState(!1),[oe,N]=Re.useState(!0),{token:g}=Rn(),M=[{key:"inspecta",label:"ä¿®æ”¹æ ·å¼",icon:e.jsx(Js,{}),disabled:!n},{type:"divider"},...X.enabled?[]:[{key:"enable-text-edit",label:"ä¿®æ”¹æ–‡æœ¬",icon:e.jsx(Ks,{}),disabled:!y}],...X.enabled?[{key:"save-text-edit",label:"ä¿å­˜ä¿®æ”¹",icon:e.jsx(Gs,{}),disabled:!y,extra:e.jsxs("span",{style:{fontSize:12,color:g.colorTextSecondary},children:[X.editedCount," å¤„"]})},{key:"exit-text-edit",label:"é€€å‡ºä¿®æ”¹",icon:e.jsx(Xs,{}),disabled:!y}]:[]],ee=({key:v})=>{switch(v){case"inspecta":J();break;case"enable-text-edit":l();break;case"save-text-edit":D();break;case"exit-text-edit":q();break}};return Re.useEffect(()=>{let v=!1;return fetch("/api/version").then(Z=>Z.ok?Z.json():Promise.reject(new Error("Request failed"))).then(Z=>{if(v)return;const de=typeof(Z==null?void 0:Z.version)=="string"?Z.version:null;f(de)}).catch(()=>{v||f(null)}),()=>{v=!0}},[]),Re.useEffect(()=>{let v=!1;return fetch("/api/config").then(Z=>Z.ok?Z.json():Promise.reject(new Error("Request failed"))).then(Z=>{var de;v||N(((de=Z==null?void 0:Z.server)==null?void 0:de.allowLAN)!==!1)}).catch(()=>{v||N(!0)}),()=>{v=!0}},[]),e.jsxs(In,{hasSider:!0,style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:g.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${g.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[e.jsx(U,{type:"text",icon:i?e.jsx(qs,{}):e.jsx(Ys,{}),onClick:()=>c(!i),style:{fontSize:"16px",height:40}}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:g.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx(xt,{value:j,size:"small",style:{fontSize:"12px"},onChange:v=>u(v),options:[{label:"åŸå‹",value:"demo",icon:e.jsx(Mt,{})},{label:"æ–‡æ¡£",value:"spec",icon:e.jsx(mt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ce,{title:G?"åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼":"åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼",children:e.jsx(U,{type:"text",icon:G?e.jsx(Kt,{}):e.jsx(Gt,{}),onClick:()=>se(!G)})}),e.jsx(Ke,{menu:{items:[{key:"assets",label:"èµ„äº§ç®¡ç†",icon:e.jsx(Pe,{}),onClick:()=>window.open(new URL("/assets.html",window.location.origin).toString(),"_blank")},{key:"settings",label:"é¡¹ç›®è®¾ç½®",icon:e.jsx(yt,{}),onClick:()=>m(!0)},{type:"divider"},{key:"help",label:"å¸®åŠ©ä¸­å¿ƒ",icon:e.jsx(Qs,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"åŸ¹è®­æœåŠ¡",icon:e.jsx(en,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"plugin",label:"ç¼–è¾‘å™¨æ‰©å±•",icon:e.jsx(Xt,{}),extra:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(dt,{status:P.some(v=>v.type==="vscode"||v.type==="cursor")?"success":"default"}),e.jsx("span",{style:{marginLeft:4,fontSize:12,color:P.some(v=>v.type==="vscode"||v.type==="cursor")?"#52c41a":g.colorTextSecondary},children:P.some(v=>v.type==="vscode"||v.type==="cursor")?"å·²è¿æ¥":"æœªè¿æ¥"})]}),onClick:()=>window.open("https://static.axhub.im/chrome/axhub.vsix","_blank")},{key:"site",label:"Axhub å®˜ç½‘",icon:e.jsx(yt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"å½“å‰ç‰ˆæœ¬",icon:e.jsx(Ve,{}),extra:e.jsx("span",{style:{fontSize:12,color:g.colorTextSecondary},children:d?`v${d}`:"-"})}]},placement:"bottomRight",children:e.jsx(U,{type:"text",icon:e.jsx(Zs,{})})})]}),(n||j==="spec")&&e.jsx("div",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center"},children:e.jsx(Ie,{size:"small",children:j==="spec"?e.jsx(e.Fragment,{children:e.jsx(ce,{title:`åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ${H==="prd"?"PRD":"SPEC"} æ–‡æ¡£`,children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(wt,{}),onClick:A})})}):n&&e.jsxs(e.Fragment,{children:[W==="pages"&&e.jsx(xt,{value:F,size:"small",shape:"round",onChange:v=>z(v),options:p}),e.jsx(ce,{title:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(wt,{}),onClick:A})}),e.jsx(dt,{count:X.editedCount,color:g.colorError,offset:[-2,2],overflowCount:99,style:{fontSize:10,height:14,minWidth:14,lineHeight:"14px",padding:"0 4px",boxShadow:"none"},children:e.jsx(Ke,{menu:{items:M,onClick:ee},placement:"bottomLeft",trigger:["hover"],children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(_t,{}),disabled:!n})})}),e.jsx(ce,{title:"åˆ·æ–°",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(tn,{}),onClick:L})}),e.jsx(sn,{content:e.jsxs("div",{style:{width:160},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx(U,{type:"text",icon:e.jsx(Xe,{}),onClick:b,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶æœ¬åœ°é“¾æ¥"}),oe&&e.jsx(U,{type:"text",icon:e.jsx(Xe,{}),onClick:E,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶å±€åŸŸç½‘é“¾æ¥"}),e.jsx(U,{type:"text",icon:e.jsx(Je,{}),onClick:R,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"ä¸‹è½½é¡¹ç›®"}),e.jsx(U,{type:"text",icon:e.jsx(At,{}),disabled:!0,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å‘å¸ƒåŸå‹"})]}),oe&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:1,background:g.colorBorder,margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 0px 4px"},children:[e.jsx(on,{value:K(),size:128,bordered:!1,style:{marginBottom:8}}),e.jsx(Oe.Text,{type:"secondary",style:{fontSize:12,textAlign:"center"},children:"åŒ WiFi çš„æ‰‹æœºæ‰«ç é¢„è§ˆ"})]})]})]}),trigger:"click",placement:"bottomRight",open:O,onOpenChange:o,arrow:!1,children:e.jsx(ce,{title:"åˆ†äº«",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(nn,{})})})}),e.jsx(Ke,{trigger:["click"],placement:"bottomCenter",onOpenChange:v=>{v&&B()},menu:{items:[{key:"push",label:"ä¸€é”®æ¨é€",extra:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(dt,{status:P.some(v=>v.type==="figma")?"success":"default"}),e.jsx("span",{style:{marginLeft:4},children:P.some(v=>v.type==="figma")?"å·²è¿æ¥":"æœªè¿æ¥"})]}),icon:e.jsx(At,{}),disabled:!P.some(v=>v.type==="figma")},{type:"divider"},{key:"download-json",label:"ä¸‹è½½ JSON",icon:e.jsx(Je,{})},{key:"download-axure",label:"ä¸‹è½½ JSON",extra:"é€‚é… Axure",icon:e.jsx(Pe,{})}],onClick:({key:v})=>{v==="push"?ne():v==="download-json"?Q(!0):v==="download-axure"&&Q(!1)}},children:e.jsx(ce,{trigger:["click","hover"],title:"å¯¼å‡ºåˆ° Figma",children:e.jsx(U,{type:"text",size:"small",icon:e.jsx(An,{})})})}),e.jsx(U,{type:"primary",size:"small",style:{fontSize:"12px"},icon:e.jsx(Je,{}),onClick:()=>{Y(!0)},children:"å¯¼å‡ºåˆ° Axure"})]})})}),e.jsx(Tn,{open:k,onClose:()=>m(!1)})]})}const Dn=({width:i,height:c,children:n,scale:j=1})=>e.jsx("div",{style:{position:"relative",padding:"12px",background:"#1f1f1f",borderRadius:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.2)",border:"4px solid #333",display:"flex",flexDirection:"column",transform:`scale(${j})`,transformOrigin:"center center"},children:e.jsx("div",{style:{width:i,height:c,background:"#fff",borderRadius:"32px",overflow:"hidden",position:"relative"},children:n})}),{Content:Pn}=Le,{useToken:Nn}=Ue;function zn({containerRef:i,selectedItem:c,activeTab:n,currentDevice:j,displaySize:u,scale:W,elementIframeKey:F,iframeUrl:z,elementIframeSize:p,setElementIframeSize:J,viewMode:l}){const{token:D}=Nn();return e.jsx(Pn,{ref:i,style:{background:D.colorBgLayout,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:c?l==="spec"?e.jsx("iframe",{src:z,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},F):n==="pages"&&j.id!=="desktop"?e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Dn,{width:u.width,height:u.height,scale:W,children:e.jsx("iframe",{src:z,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},F)})}):n==="elements"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:e.jsx("div",{style:{position:"relative",display:"inline-block"},children:e.jsx(rn,{size:p,onResize:(q,L,b)=>{if(b){const E=b.getBoundingClientRect();J({width:E.width,height:E.height})}},minWidth:50,minHeight:50,bounds:"window",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},handleStyles:{right:{width:"8px",right:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottom:{height:"8px",bottom:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottomRight:{width:"12px",height:"12px",right:"-6px",bottom:"-6px",background:"transparent",borderRadius:"0 0 6px 0",transition:"all 0.2s"}},handleClasses:{right:"resize-handle-right",bottom:"resize-handle-bottom",bottomRight:"resize-handle-bottomRight"},style:{border:`1px solid ${D.colorBorder}`,borderRadius:6,overflow:"hidden",background:D.colorBgContainer,boxShadow:D.boxShadow,transition:"box-shadow 0.2s"},className:"ant-card-hoverable",children:e.jsx("iframe",{src:z,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},F)})})}):e.jsx("iframe",{src:z,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},F):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:D.colorTextSecondary},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(an,{style:{fontSize:"64px",marginBottom:"16px"}}),e.jsxs("div",{style:{fontSize:"16px"},children:["è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ª",n==="elements"?"å…ƒç´ ":"é¡µé¢"]})]})})})}const{Dragger:Ln}=qt,{Text:On,Title:Un}=Oe;function Fn({visible:i,onClose:c,onOk:n,onSendPrompt:j,activeTab:u,createName:W,setCreateName:F,createReference:z,setCreateReference:p,createMode:J,setCreateMode:l,generateAxure:D,setGenerateAxure:q,referenceItems:L,selectedThemes:b,setSelectedThemes:E,availableThemes:R,selectedLibraries:K,setSelectedLibraries:O,availableLibraries:o,selectedDocs:P,setSelectedDocs:B,availableDocs:ne,selectedDataAssets:Q,setSelectedDataAssets:Y,availableDataAssets:A}){const{token:G}=Ue.useToken(),[se,H]=r.useState(!0),[X,y]=r.useState("create"),[d,f]=r.useState("make"),[k,m]=r.useState([]),[oe,N]=r.useState(!1),[g,M]=r.useState(null);r.useEffect(()=>{i&&(H(!0),y("create"),f("make"),m([]),N(!1),M(null))},[i]);const ee=x=>{f(x),m([]),M(null)},v=x=>["make","axhub","google_stitch"].includes(x),Z=x=>["axure_prototype","web_page"].includes(x),de=async x=>{const{file:fe,onSuccess:ue,onError:ie}=x,je=fe instanceof File?fe:fe.originFileObj,Ce=new FormData;Ce.append("file",je,je.name),Ce.append("uploadType",d),Ce.append("targetType",u),console.log("[å‰ç«¯] customRequest ä¸Šä¼ å‚æ•°:",{uploadType:d,targetType:u,fileName:je.name,fileSize:je.size}),N(!0);try{const $e=await fetch("/api/upload",{method:"POST",body:Ce}),be=await $e.json();console.log("[å‰ç«¯] æœåŠ¡å™¨å“åº”:",be),$e.ok&&be.success?(M(be),ue(null,fe),v(d)?(_.success(be.message||"ä¸Šä¼ å¹¶è§£å‹æˆåŠŸï¼"),setTimeout(()=>{c(),window.location.reload()},1500)):_.success("æ–‡ä»¶å·²è§£å‹ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):(console.error("[å‰ç«¯] ä¸Šä¼ å¤±è´¥:",be),_.error(be.error||"ä¸Šä¼ å¤±è´¥"),ie(new Error(be.error||"ä¸Šä¼ å¤±è´¥")))}catch($e){console.error("[å‰ç«¯] ä¸Šä¼ é”™è¯¯:",$e),_.error("ä¸Šä¼ å¤±è´¥: "+$e.message),ie($e)}finally{N(!1)}},Ye=()=>{const x=Fe.find(ie=>ie.key===d),fe=(x==null?void 0:x.docs)||[];let ue="";if(Z(d)){const ie=u==="elements"?"å…ƒç´ ":"é¡µé¢",je=d==="axure_prototype"?"Axure åŸå‹é“¾æ¥":"ç½‘é¡µé“¾æ¥";ue=`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æ¶æ„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆå‹ï¼‰ï¼ŒååŠ©ç”¨æˆ·ã€ŒåŸºäº${je}å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${ie}ã€ã€‚

**ğŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼ˆå¿…é¡»é˜…è¯»ï¼‰**ï¼š
${fe.map(Ce=>`- \`${Ce}\``).join(`
`)}

**é¦–æ¬¡å›å¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œæˆ‘å°†åŸºäº ${je} å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${ie}ã€‚

è¯·æŠŠé“¾æ¥å‘æˆ‘ï¼ˆURLï¼‰ï¼š
\`\`\``}else{if(!g||!g.prompt){_.error("æ²¡æœ‰å¯å¤åˆ¶çš„ Prompt");return}ue=g.prompt,fe.length>0&&(ue+=`

ğŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼š
${fe.map(ie=>`- \`${ie}\``).join(`
`)}`)}navigator.clipboard.writeText(ue).then(()=>{_.success("Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´ç»™ AI å®Œæˆå¯¼å…¥")}).catch(ie=>{console.error("å¤åˆ¶å¤±è´¥:",ie),_.error("å¤åˆ¶å¤±è´¥")})},Ze=()=>{if(X==="create")return e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx(U,{onClick:j,disabled:!1,children:"å‘é€åˆ° Cursor"}),e.jsx(U,{type:"primary",onClick:n,disabled:!1,children:"å¤åˆ¶ Prompt"})]});if(v(d))return e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:e.jsx(U,{onClick:c,children:"å–æ¶ˆ"})});const x=Z(d)||g;return e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[e.jsx(U,{onClick:c,children:"å…³é—­"}),e.jsx(U,{type:"primary",onClick:Ye,disabled:!x,children:"å¤åˆ¶ Prompt ç»™ AI å®Œæˆå¯¼å…¥"})]})},Qe={name:"file",multiple:!1,fileList:k,customRequest:de,beforeUpload:x=>{var ue;return x.type==="application/zip"||x.type==="application/x-zip-compressed"||((ue=x.name)==null?void 0:ue.endsWith(".zip"))?!0:(_.error("è¯·ä¸Šä¼  ZIP æ ¼å¼çš„æ–‡ä»¶"),qt.LIST_IGNORE)},onChange:x=>{m(x.fileList.slice(-1))},onRemove:()=>{m([]),M(null)},accept:".zip"},pe="/skills",Fe=[{key:"make",title:"Axbub Make",description:"æ”¯æŒè‡ªå·±æˆ–ä»–äººçš„ ZIP åŒ…",icon:e.jsx(wt,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!0,docs:[`${pe}/local-axure-workflow/SKILL.md`]},{key:"axhub",title:"Axhub æ‰©å±•",description:"å¯å¯¼å‡ºä»»æ„ç½‘é¡µï¼ˆé™æ€ï¼‰",icon:e.jsx(Xt,{style:{fontSize:24,color:"#722ed1"}}),isDirect:!0,docs:[`${pe}/screenshot-page-workflow/SKILL.md`]},{key:"google_stitch",title:"Google Stitch",description:"AI é©±åŠ¨çš„ UI è®¾è®¡å·¥å…·ï¼ˆé™æ€ï¼‰",icon:e.jsx(Dt,{style:{fontSize:24,color:"#f5222d"}}),isDirect:!0,docs:[`${pe}/screenshot-page-workflow/SKILL.md`]},{key:"v0",title:"V0 App",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Bt,{style:{fontSize:24,color:"#52c41a"}}),isDirect:!1,docs:[`${pe}/v0-project-converter/SKILL.md`]},{key:"google_aistudio",title:"Google AIStudio",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(Dt,{style:{fontSize:24,color:"#faad14"}}),isDirect:!1,docs:[`${pe}/ai-studio-project-converter/SKILL.md`]},{key:"axure_prototype",title:"Axure åŸå‹é“¾æ¥",description:"æ”¯æŒåœ¨çº¿æˆ–æœ¬åœ°é¢„è§ˆçš„é“¾æ¥",icon:e.jsx(Wt,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!1,docs:[`${pe}/axure-prototype-workflow/SKILL.md`,`${pe}/axure-prototype-workflow/page-restoration.md`]},{key:"web_page",title:"ç½‘é¡µé“¾æ¥",description:"æ”¯æŒä»»æ„ç½‘é¡µé“¾æ¥",icon:e.jsx(yt,{style:{fontSize:24,color:"#13c2c2"}}),isDirect:!1,docs:[`${pe}/web-page-workflow/SKILL.md`,`${pe}/web-page-workflow/page-restoration.md`]}],et=()=>e.jsxs(re,{requiredMark:!1,labelCol:{style:{width:"120px"}},wrapperCol:{style:{minWidth:0}},children:[e.jsx(re.Item,{label:u==="elements"?"å…ƒç´ åç§°":"é¡µé¢åç§°",children:e.jsx(Se,{placeholder:"ç•™ç©ºåˆ™ç”± AI ç”Ÿæˆï¼Œæ‰¹é‡ç”Ÿæˆå»ºè®®ç•™ç©º",value:W,onChange:x=>F(x.target.value),maxLength:20,showCount:!0})}),L.length>0&&e.jsx(re.Item,{label:"å‚è€ƒæ¡ˆä¾‹",tooltip:`å¯åœ¨${u==="elements"?"å…ƒç´ ":"é¡µé¢"}åˆ—è¡¨ä¸­å°†å…¶è®¾ä¸ºæˆ–å–æ¶ˆä¸ºå‚è€ƒæ¡ˆä¾‹`,children:e.jsx(we,{style:{width:"100%"},placeholder:"ä¸é€‰æ‹©å‚è€ƒæ¡ˆä¾‹",value:z||void 0,onChange:x=>p(x||""),allowClear:!0,options:L.map(x=>({value:x.name,label:x.displayName}))})}),e.jsx("div",{children:e.jsx(U,{type:"link",onClick:()=>H(!se),icon:se?e.jsx(ln,{}):e.jsx(cn,{}),style:{padding:0},children:se?"æ›´å¤šé…ç½®":"æ”¶èµ·é…ç½®"})}),!se&&e.jsxs(e.Fragment,{children:[R.length>0&&e.jsx(re.Item,{label:"ä¸»é¢˜",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰ä¸»é¢˜ç”ŸæˆåŸå‹ï¼Œä¸»é¢˜å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(we,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©ä¸»é¢˜ï¼ˆå¯å¤šé€‰ï¼‰",value:b,onChange:x=>E(x),allowClear:!0,options:R.map(x=>({value:x.name,label:x.displayName}))})}),A.length>0&&e.jsx(re.Item,{label:"å¼•ç”¨æ•°æ®",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ•°æ®ç”ŸæˆåŸå‹ï¼Œæ•°æ®å¯åœ¨æ•°æ®ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(we,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ•°æ®ï¼ˆå¯å¤šé€‰ï¼‰",value:Q,onChange:x=>Y(x),allowClear:!0,options:A.map(x=>({value:x.name,label:x.displayName}))})}),o.length>0&&e.jsx(re.Item,{label:"å‰ç«¯åº“",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰å‰ç«¯åº“ç”ŸæˆåŸå‹ï¼Œå‰ç«¯åº“å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(we,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‰ç«¯åº“ï¼ˆå¯å¤šé€‰ï¼‰",value:K,onChange:x=>O(x),allowClear:!0,options:o.map(x=>({value:x.name,label:x.displayName}))})}),ne.length>0&&e.jsx(re.Item,{label:"å‚è€ƒæ–‡æ¡£",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ–‡æ¡£ç”ŸæˆåŸå‹ï¼Œæ–‡æ¡£å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(we,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ–‡æ¡£ï¼ˆå¯å¤šé€‰ï¼‰",value:P,onChange:x=>B(x),options:ne.map(x=>({value:x.name,label:x.displayName}))})}),e.jsx(re.Item,{label:"ç”Ÿæˆæµç¨‹",children:e.jsx(we,{style:{width:"100%"},value:J,onChange:x=>l(x),options:[{value:"simultaneous",label:"åŒæ—¶ç”Ÿæˆè§„æ ¼æ–‡æ¡£å’ŒåŸå‹"},{value:"specFirst",label:"æŒ‰ è§„æ ¼æ–‡æ¡£ > åŸå‹ é¡ºåº"}]})}),e.jsx(re.Item,{label:"Axure æ¨¡å¼",tooltip:"ä¸å½±å“å¯¼å‡º Axure ï¼Œå…³é—­åˆ™ä¸ç”Ÿæˆä¸ Axure åŸç”Ÿå…ƒç´ äº¤äº’çš„åŠŸèƒ½ï¼Œä½†å¯ä»¥æå‡ç”Ÿæˆé€Ÿåº¦",children:e.jsx(Jt,{checked:D,onChange:x=>q(x)})})]})]}),tt=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsx(Un,{level:5,style:{marginBottom:16},children:"é€‰æ‹©å¯¼å…¥æ¥æº"}),e.jsx(dn,{gutter:[16,16],children:Fe.map(x=>e.jsx(hn,{span:12,children:e.jsx(Et,{hoverable:!0,bodyStyle:{padding:16,height:"100%",display:"flex",alignItems:"center"},style:{height:"100%",borderColor:d===x.key?G.colorInfo:void 0,backgroundColor:d===x.key?G.colorFillAlter:void 0},onClick:()=>ee(x.key),children:e.jsx(Et.Meta,{avatar:x.icon,title:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(On,{ellipsis:!0,style:{fontSize:13,fontWeight:500},children:x.title})}),description:e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:x.description}),style:{width:"100%"}})})},x.key))})]}),!Z(d)&&e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:e.jsx("div",{style:{flex:1,minHeight:120},children:e.jsx(Ln,{...Qe,style:{background:"#fafafa",border:"1px dashed #d9d9d9",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-drag-icon",style:{marginBottom:8},children:e.jsx(pn,{style:{color:G.colorInfo,fontSize:36}})}),e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"ç‚¹å‡»æˆ–æ‹–æ‹½ ZIP æ–‡ä»¶ä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",style:{color:"#888",fontSize:12,padding:"0 16px"},children:v(d)?"å¯¼å…¥åå¯é€šè¿‡ AI è¿›è¡Œç¼–è¾‘å’Œä¼˜åŒ–":"ä¸Šä¼ åéœ€è¦ AI è¾…åŠ©å¯¼å…¥"})]})})})})]});return e.jsx(Vt,{placement:"left",destroyOnClose:!0,title:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(xt,{value:X,onChange:x=>y(x),options:[{label:u==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢",value:"create"},{label:u==="elements"?"å¯¼å…¥å…ƒç´ ":"å¯¼å…¥é¡µé¢",value:"upload"}],style:{fontWeight:500}})}),open:i,onClose:c,width:600,footer:Ze(),styles:{body:{padding:24,overflow:"auto"},header:{borderBottom:"1px solid #f0f0f0",padding:"16px 24px"}},children:X==="create"?et():tt()})}const qe={simultaneous:{mode:"simultaneous",displayName:"ç›´æ¥ç”Ÿæˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!1]},specFirst:{mode:"specFirst",displayName:"è§„æ ¼ä¼˜å…ˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.mdï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰â†’ ç”Ÿæˆ index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ spec.mdï¼ˆç¡®è®¤ï¼‰â†’ index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!0,!1]}};function Bn(i,c){const n=c==="elements"?"å…ƒç´ ":"é¡µé¢",j=c==="elements"?"elements":"pages",u=`src/${j}/${i.name}`,W=`src/${j}/ref-${i.name}`;return`å°† \`${u}\` è®¾ä¸ºå‚è€ƒæ¡ˆä¾‹ï¼š

1. ç§»åŠ¨åˆ° \`${W}\`
2. å‚è€ƒ \`/rules/development-standards.md\`
3. åœ¨ index.tsx é¡¶éƒ¨æ·»åŠ ï¼š
\`\`\`typescript
/**
 * @name ${i.displayName}
 * æœ¬æ–‡ä»¶æ˜¯æ¼”ç¤ºæ–‡ä»¶ï¼Œå±•ç¤ºæœ¬é¡¹ç›®${n}å¼€å‘è§„èŒƒ
 * å®é™…å¼€å‘æ—¶åªéœ€ä¿ç•™ @name æ³¨é‡Šï¼Œä¸éœ€è¦è¯¦ç»†çš„è§„èŒƒè¯´æ˜
 */
\`\`\`
4. åœ¨å…³é”®ä»£ç æ®µæ·»åŠ  \`// ã€è§„èŒƒè¯´æ˜ã€‘\` æ³¨é‡Šï¼šå¯¼å…¥é¡ºåºã€Propså¤„ç†ã€Stateç®¡ç†ã€äº‹ä»¶å¤„ç†ã€useImperativeHandleã€JSXæ¸²æŸ“
5. æ³¨é‡Šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œé"åšä»€ä¹ˆ"ï¼Œé‡ç‚¹è¯´æ˜æ˜“é”™ç‚¹å’Œæœ€ä½³å®è·µ`}function Mn(i){return Object.prototype.hasOwnProperty.call(qe,i)}function _n(i){const{hasName:c,displayName:n,itemType:j,hasReference:u,referenceDisplayName:W}=i,F=u&&W?`
å‚è€ƒæ¡ˆä¾‹ï¼š${W}`:"";return c?`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›å¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›å¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®ç°å†…å®¹

**é¦–æ¬¡å›å¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º **${n}** ${j}ã€‚${F}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼š
\`\`\``:`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›å¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›å¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®ç°å†…å®¹

**é¦–æ¬¡å›å¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º${j}ã€‚${F}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼ˆå¦‚éœ€åˆ›å»ºå¤šä¸ª${j}ï¼Œè¯·ä¸€å¹¶è¯´æ˜ï¼‰ï¼š
\`\`\``}function Wn(i){return i?`

**Axure API**ï¼šâœ… å·²å¯ç”¨
- éœ€è¦ä½¿ç”¨ Axure API å®ç°ç»„ä»¶äº¤äº’åŠŸèƒ½
- **âš ï¸ å¿…é¡»å®Œæ•´é˜…è¯» \`/rules/axure-api-guide.md\`ï¼Œä¸è¦è·³è¿‡ï¼**
- è¯¥æ–‡æ¡£åŒ…å«å®Œæ•´çš„ Axure API æ¥å£è§„èŒƒã€ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ`:`

**Axure API**ï¼šâŒ æœªå¯ç”¨
- æœ¬æ¬¡ä½¿ç”¨æ ‡å‡† React ç»„ä»¶å³å¯ï¼Œä¸éœ€è¦ Axure API`}function Ft(){return`   - æ–‡ä»¶ç»“æ„ã€ä¾èµ–å¼•ç”¨ã€æ ·å¼è§„èŒƒã€å¯¼å‡ºè§„èŒƒ
   - âš ï¸ **éªŒæ”¶æ ‡å‡†**ï¼šå®Œæˆåå¿…é¡»å¯¹ç…§æ­¤æ–‡æ¡£æ£€æŸ¥å®ç°`}function Yt(i){const{createMode:c,modeConfig:n,generateAxure:j}=i;return c==="simultaneous"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${n.description}

**ğŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

2. **\`/rules/development-standards.md\`**
${Ft()}

3. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${j?`

4. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}`:c==="specFirst"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${n.description}

**ğŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/requirements-alignment.md\`** â­ï¸ éœ€æ±‚å¯¹é½ï¼ˆç¬¬ä¸€æ­¥ï¼‰
   - éœ€æ±‚ç¡®è®¤æ¸…å•ã€æ²Ÿé€šç­–ç•¥ã€å¯è§†åŒ–æµç¨‹

2. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼Œå¿…é¡»å®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

3. **\`/rules/development-standards.md\`**
${Ft()}

4. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${j?`

5. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}

**ç¡®è®¤æµç¨‹**ï¼š
- å®Œæˆ spec.md åï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼š"spec.md å·²å®Œæˆï¼Œè¯·ç¡®è®¤æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚ç¡®è®¤åå°†ç”Ÿæˆä»£ç å®ç°ã€‚"
- ç­‰å¾…ç”¨æˆ·ç¡®è®¤åå†ç”Ÿæˆ index.tsx`:Yt({createMode:"simultaneous",modeConfig:qe.simultaneous,generateAxure:j})}function Hn(i){const{referencePath:c,referenceDisplayName:n}=i;return c?`

**ğŸ“ å‚è€ƒæ¡ˆä¾‹**ï¼ˆâ­ï¸ ä¼˜å…ˆå‚è€ƒï¼‰ï¼š
- è·¯å¾„ï¼š\`${c}\`
- åç§°ï¼š${n}
- **è¯·ä¼˜å…ˆå‚è€ƒæ­¤æ¡ˆä¾‹çš„ä»£ç ç»“æ„å’Œå®ç°æ–¹å¼**
- å­¦ä¹ å…¶æ–‡ä»¶ç»„ç»‡ã€å‘½åè§„èŒƒã€ä»£ç é£æ ¼`:""}function He(i){const{title:c,selected:n,available:j,toLine:u}=i;return n.length===0?"":`

${c}${n.map(W=>{const F=j.find(z=>z.name===W);return`
${u(W,F)}`}).join("")}`}function Vn(i){return i.length?`

**ğŸ¨ ä¸»é¢˜æ–‡ä»¶å†…å®¹**ï¼š${i.map(n=>{const j=[`
- ä¸»é¢˜ï¼š${n.themeName}`];return n.designToken&&j.push(`
  - designToken.json:
\`\`\`json
${n.designToken}
\`\`\``),n.globalsCss&&j.push(`
  - globals.css:
\`\`\`css
${n.globalsCss}
\`\`\``),n.designSpec&&j.push(`
  - DESIGN-SPEC.md: è¯·é˜…è¯» \`/src/themes/${n.themeName}/DESIGN-SPEC.md\``),j.join("")}).join("")}`:""}function Jn(i,c,n,j,u,W=[],F=[],z=[],p=[],J=[],l=[],D=[],q=[],L=!0,b=[]){const E=c==="elements",R=E?"å…ƒç´ ":"é¡µé¢",K=E?"elements":"pages",O=i.trim().length>0,o=i.trim(),P=j?u.find(k=>k.name===j):null,B=P?`src/${K}/${P.name}`:null,ne=Mn(n)?qe[n]:qe.simultaneous,Q=O?`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æ¶æ„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆå‹ï¼‰ï¼Œåˆ›å»º ${R}ã€Œ**${o}**ã€åŸå‹`:`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æ¶æ„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆå‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª${R}åŸå‹`,Y=_n({hasName:O,displayName:o,itemType:R,hasReference:!!P,referenceDisplayName:P==null?void 0:P.displayName}),A=Wn(L),G=Yt({createMode:n,modeConfig:ne,generateAxure:L}),se=Hn({referencePath:B,referenceDisplayName:P==null?void 0:P.displayName}),H=He({title:"**ğŸ“š å‚è€ƒæ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/docs/ï¼‰ï¼š",selected:W,available:F,toLine:(k,m)=>`- **\`/assets/docs/${k}\`** - ${(m==null?void 0:m.displayName)||k}`}),X=He({title:"**ğŸ¨ ä¸»é¢˜é…ç½®**ï¼ˆç›¸å¯¹è·¯å¾„ /src/themes/ï¼‰ï¼š",selected:z,available:p,toLine:(k,m)=>`- **\`/src/themes/${k}/designToken.json\`** - ${(m==null?void 0:m.displayName)||k} Design Tokens`}),y=Vn(b),d=He({title:"**ğŸ“¦ å‰ç«¯åº“æ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/libraries/ï¼‰ï¼š",selected:J,available:l,toLine:(k,m)=>`- **\`/assets/libraries/${k}\`** - ${(m==null?void 0:m.displayName)||k}`}),f=He({title:"**ğŸ“Š å‚è€ƒæ•°æ®**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/database/ï¼‰ï¼š",selected:D,available:q,toLine:(k,m)=>`- **\`/assets/database/${k}\`** - ${(m==null?void 0:m.displayName)||k}`});return`${Q}

âš ï¸ **é‡è¦æç¤º**ï¼šè¯·åŠ¡å¿…å®Œæ•´é˜…è¯»ä»¥ä¸‹æ‰€æœ‰è§„èŒƒæ–‡æ¡£å’Œå‚è€ƒèµ„æ–™ï¼Œä¸è¦å·æ‡’ï¼è¿™äº›æ–‡æ¡£åŒ…å«äº†å…³é”®çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µã€‚
${G}${se}${X}${y}${f}${d}${H}${A}

${Y}`}function Kn(i,c,n){const[j,u]=r.useState(!1),[W,F]=r.useState(""),[z,p]=r.useState(()=>localStorage.getItem(Lt)||""),[J,l]=r.useState(()=>localStorage.getItem(Nt)||"simultaneous"),[D,q]=r.useState(()=>localStorage.getItem(zt)==="true"),[L,b]=r.useState([]),[E,R]=r.useState([]),[K,O]=r.useState([]),[o,P]=r.useState([]),[B,ne]=r.useState([]),[Q,Y]=r.useState([]),[A,G]=r.useState([]),[se,H]=r.useState([]),[X,y]=r.useState(!1);r.useEffect(()=>{localStorage.setItem(Nt,J)},[J]),r.useEffect(()=>{localStorage.setItem(zt,String(D))},[D]),r.useEffect(()=>{localStorage.setItem(Lt,z)},[z]);const d=r.useMemo(()=>(i==="elements"?c.elements:c.pages).filter(g=>g.isReference),[c,i]);r.useEffect(()=>{if(!X)return;(async()=>{try{const g=await fetch("/api/docs");if(g.ok){const M=await g.json();Y(M)}}catch(g){console.error("Failed to load docs:",g)}})()},[X]),r.useEffect(()=>{if(!X)return;(async()=>{try{const g=await fetch("/api/themes");if(g.ok){const M=await g.json();R(M)}}catch(g){console.error("Failed to load themes:",g)}})()},[X]),r.useEffect(()=>{if(!X)return;(async()=>{try{const g=await fetch("/api/libraries");if(g.ok){const M=await g.json();P(M);const ee=M.find(v=>v.name==="tailwind-css.md"||v.name.startsWith("tailwind-css"));ee&&K.length===0&&O([ee.name])}}catch(g){console.error("Failed to load libraries:",g)}})()},[X]),r.useEffect(()=>{if(!X)return;(async()=>{try{const g=await fetch("/api/data/tables");if(g.ok){const ee=(await g.json()).map(v=>({name:`${v.fileName}.json`,displayName:v.tableName}));H(ee)}}catch(g){console.error("Failed to load data assets:",g)}})()},[X]),r.useEffect(()=>{j&&(z&&(d.some(g=>g.name===z)||p("")),y(!0))},[j,d,z]);const f=async()=>{console.log("=== ç‚¹å‡»äº†ç”Ÿæˆ AI Prompt æŒ‰é’® ==="),console.log("createName:",W),console.log("createReference:",z),console.log("createMode:",J),console.log("activeTab:",i);const N=await k();N&&(console.log("å¼€å§‹å¤åˆ¶ Prompt åˆ°å‰ªè´´æ¿..."),console.log("Prompt é•¿åº¦:",N.length),navigator.clipboard.writeText(N).then(()=>{console.log("âœ… å¤åˆ¶æˆåŠŸ"),u(!1),F(""),ne([]),b([]),O([]),G([]),n.success("å¤åˆ¶æˆåŠŸï¼Œè¯·è¿”å› IDE å‘é€ç»™ AI"),y(!1),Y([]),R([]),P([]),H([])}))},k=async()=>{let N=[];if(L.length>0)try{N=await Promise.all(L.map(async g=>{const M=await fetch("/api/themes/get-contents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:g})});if(!M.ok){const v=await M.json().catch(()=>null);throw new Error((v==null?void 0:v.error)||"ä¸»é¢˜å†…å®¹è·å–å¤±è´¥")}const ee=await M.json();return{themeName:g,designToken:(ee==null?void 0:ee.designToken)??null,globalsCss:(ee==null?void 0:ee.globalsCss)??null,designSpec:(ee==null?void 0:ee.designSpec)??null}}))}catch(g){console.error("Failed to load theme contents:",g),n.error((g==null?void 0:g.message)||"ä¸»é¢˜å†…å®¹è·å–å¤±è´¥")}return Jn(W,i,J,z,d,B,Q,L,E,K,o,A,se,D,N)};return{createDialogVisible:j,createName:W,createReference:z,createMode:J,generateAxure:D,referenceItems:d,selectedThemes:L,availableThemes:E,selectedLibraries:K,availableLibraries:o,selectedDocs:B,availableDocs:Q,selectedDataAssets:A,availableDataAssets:se,setCreateDialogVisible:u,setCreateName:F,setCreateReference:p,setCreateMode:l,setGenerateAxure:q,setSelectedThemes:b,setSelectedLibraries:O,setSelectedDocs:ne,setSelectedDataAssets:G,handleCreateSubmit:f,handleSendPrompt:async()=>{const N=await k();if(!N)return;const g=n.loading("æ­£åœ¨å‘é€ Prompt...",0);try{const M=async(ee,v)=>{const Z=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:ee,payload:v})});if(!Z.ok){const de=await Z.json().catch(()=>null);throw new Error((de==null?void 0:de.error)||"å‘é€å¤±è´¥")}};await M("handshake","test-client"),await M("insert",N),n.success("å·²é€šè¿‡ WebSocket å‘é€"),y(!1),Y([]),R([]),P([]),H([])}catch(M){n.error((M==null?void 0:M.message)||"å‘é€å¤±è´¥")}finally{g()}},handleCreateCancel:()=>{u(!1),F(""),ne([]),b([]),O([]),G([]),y(!1),Y([]),R([]),P([]),H([])}}}function Gn({isDarkMode:i,setIsDarkMode:c}){const[n,j]=r.useState(!0),[u,W]=r.useState({elements:[],pages:[]}),[F,z]=r.useState(!1),[p,J]=r.useState(()=>{const t=localStorage.getItem(Pt);return t==="elements"||t==="pages"?t:"pages"}),[l,D]=r.useState(null),[q,L]=r.useState("desktop"),[b,E]=r.useState(1),R=Re.useRef(null),[K,O]=r.useState(""),[o,P]=_.useMessage(),[B,ne]=Ge.useModal(),[Q,Y]=r.useState({enabled:!1,editedCount:0}),[A,G]=r.useState({width:600,height:400}),[se,H]=r.useState(0),[X,y]=r.useState(!1),[d,f]=r.useState("demo"),[k,m]=r.useState("spec"),{createDialogVisible:oe,createName:N,createReference:g,createMode:M,generateAxure:ee,referenceItems:v,selectedThemes:Z,availableThemes:de,selectedLibraries:Ye,availableLibraries:Ze,selectedDocs:Qe,availableDocs:pe,selectedDataAssets:Fe,availableDataAssets:et,setCreateDialogVisible:tt,setCreateName:x,setCreateReference:fe,setCreateMode:ue,setGenerateAxure:ie,setSelectedThemes:je,setSelectedLibraries:Ce,setSelectedDocs:$e,setSelectedDataAssets:be,handleCreateSubmit:Zt,handleSendPrompt:Qt,handleCreateCancel:es}=Kn(p,u,o),ts=()=>{const t=`${window.location.protocol}//${window.location.hostname}:${window.location.port}${(l==null?void 0:l.demoUrl)||""}`;navigator.clipboard.writeText(t).then(()=>{o.success("æœ¬åœ°é“¾æ¥å·²å¤åˆ¶")}).catch(s=>{o.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),y(!1)},ss=()=>{const t=$t();navigator.clipboard.writeText(t).then(()=>{o.success("å±€åŸŸç½‘é“¾æ¥å·²å¤åˆ¶")}).catch(s=>{o.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),y(!1)},ns=()=>{window.open("/api/download-dist","_blank"),y(!1)},os=async()=>{let t="",s="";const a=["vscode","cursor"];if(l){const h=l;if(d==="spec"){const S=k==="prd"?"prd.md":"spec.md";t=`src/${p}/${l.name}/${S}`,s=`[${l.displayName} - ${S==="prd.md"?"PRD":"SPEC"}](${Me(l)}/${S})`}else{if(h.filePath){const S=h.filePath.indexOf("src/");S>=0?t=h.filePath.substring(S):t=h.filePath}else t=`src/${p}/${l.name}/index.tsx`;s=`[${l.displayName}](${Me(l)})`}}else{o.warning("è¯·å…ˆé€‰æ‹©æ¡ç›®");return}const w=o.loading("æ­£åœ¨å‘é€åˆ° IDE...",0);try{s&&await navigator.clipboard.writeText(s);const h=await jt.sendWsMessage({type:"handshake",payload:"prototype-admin",targetClientTypes:a});if(!(h!=null&&h.sent)){o.warning("ç¼–è¾‘å™¨æœªè¿æ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}const S=await jt.sendWsMessage({type:"open-file",payload:t,targetClientTypes:a});if(!(S!=null&&S.sent)){o.warning("ç¼–è¾‘å™¨æœªè¿æ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}o.success("å·²åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œå¹¶å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ç¼–è¾‘")}catch(h){o.error((h==null?void 0:h.message)||"å‘é€å¤±è´¥")}finally{w()}},rs=async t=>{let s="";if(d==="spec"){const a=k==="prd"?"prd.md":"spec.md";s=`[${t.displayName} - ${a==="prd.md"?"PRD":"SPEC"}](${Me(t)}/${a})`}else s=`[${t.displayName}](${Me(t)})`;if(!s){o.warning("æ— æ³•è·å–è·¯å¾„");return}try{await navigator.clipboard.writeText(s),o.success("è·¯å¾„å·²å¤åˆ¶")}catch(a){console.error("Failed to copy: ",a),o.error("å¤åˆ¶å¤±è´¥")}},as=r.useMemo(()=>[{value:"desktop",icon:e.jsx(gn,{})},{value:"mobile",icon:e.jsx(xn,{})},{value:"tablet",icon:e.jsx(yn,{})}],[]),[Ae,st]=r.useState(!1),[is,nt]=r.useState(!1),[C,ve]=r.useState({width:1920,height:1080,includeConfig:"code",contentType:"title",rawScreenshotUrl:"",screenshotWidth:0,screenshotHeight:0,previewUrl:""});r.useEffect(()=>{Ne()},[]),r.useEffect(()=>{const t=s=>{if(s.data&&s.data.type==="SCREENSHOT_CAPTURED")ve(a=>({...a,rawScreenshotUrl:s.data.dataUrl,screenshotWidth:s.data.width,screenshotHeight:s.data.height}));else if(s.data&&s.data.type==="spec-doc-changed")console.log("Spec document changed:",s.data.activeDocKey),m(s.data.activeDocKey);else if(s.data&&s.data.type==="TEXT_EDIT_STATUS")Y({enabled:!!s.data.enabled,editedCount:Number(s.data.editedCount||0)});else if(s.data&&s.data.type==="TEXT_EDIT_NOTICE"){const a=s.data.level||"info",w=s.data.message||"";w&&(o[a]||o.info)(w)}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_CONFIRM_REQUEST"){const a=Number(s.data.totalCount||0),w=Number(s.data.changedCount||0),h=!!s.data.exitAfterSave;B.confirm({title:"ç¡®è®¤ä¿å­˜æ–‡æœ¬æ›´æ”¹",content:e.jsxs("div",{children:[e.jsxs("div",{children:["æ£€æµ‹åˆ° ",w," å¤„æ–‡æœ¬æ›´æ”¹ã€‚"]}),e.jsxs("div",{children:["é¢„è®¡å°†æ›¿æ¢é¡¹ç›®ä¸­çš„ ",a," å¤„åŒ¹é…æ–‡æœ¬ã€‚"]}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"ä¿å­˜åå°†æ‰¹é‡ä¿®æ”¹ç›¸å…³æ–‡ä»¶å†…å®¹ã€‚"})]}),okText:"ç¡®è®¤ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{Ee({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!0,exitAfterSave:h})},onCancel:()=>{Ee({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!1,exitAfterSave:h})}})}else if(s.data&&s.data.type==="TEXT_EDIT_CONFLICT"){const a=Array.isArray(s.data.conflicts)?s.data.conflicts:[];B.warning({title:"å­˜åœ¨å†²çªçš„æ–‡æœ¬ä¿®æ”¹",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"æ£€æµ‹åˆ°ç›¸åŒåŸæ–‡è¢«ä¿®æ”¹æˆä¸åŒå†…å®¹ï¼Œæ— æ³•æ‰¹é‡ä¿å­˜ã€‚"}),e.jsx("div",{style:{maxHeight:200,overflow:"auto",fontSize:12,color:"#555"},children:a.map((w,h)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{fontWeight:600},children:["åŸæ–‡ï¼š",w.original]}),e.jsxs("div",{children:["ä¿®æ”¹ä¸ºï¼š",(w.currents||[]).join(" / ")]})]},`${w.original}-${h}`))}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"è¯·ç¡®ä¿ç›¸åŒåŸæ–‡åªä¿®æ”¹ä¸ºä¸€ç§ç»“æœï¼Œæˆ–åˆ†æ‰¹ä¿å­˜ã€‚"})]}),okText:"çŸ¥é“äº†"})}};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[]),r.useEffect(()=>{Y({enabled:!1,editedCount:0})},[l,d,se]),r.useEffect(()=>{if(!l)return;if(C.contentType==="screenshot"&&!C.rawScreenshotUrl){ve(s=>({...s,previewUrl:""}));return}(async()=>{const s=p==="elements"?"å…ƒç´ ":"é¡µé¢",a=ot(C.rawScreenshotUrl,C,l.displayName,s),w=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(w);ve(S=>({...S,previewUrl:h}))})()},[C.rawScreenshotUrl,C.width,C.height,C.contentType,l,p]);const ot=(t,s,a,w)=>{if(s.contentType==="title"){const h=s.width,S=s.height,T=h/2,$=S/2;return`<svg width="${h}" height="${S}" viewBox="0 0 ${h} ${S}" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect width="100%" height="100%" fill="transparent" />
              <g id="textGroup" transform="translate(${T},${$})">
                <!-- Main Title -->
                <text id="mainTitle"
                      x="0" y="-12"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="28"
                      font-weight="700"
                      fill="#333">
                  ${a}
                </text>

                <!-- Description -->
                <text id="description"
                      x="0" y="18"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="14"
                      font-weight="400"
                      fill="#999">
                  Axhub Runtime ${w}
                </text>
              </g>
            </svg>`}else return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${s.width}" height="${s.height}" viewBox="0 0 ${s.width} ${s.height}">
                <rect width="100%" height="100%" fill="transparent" />
                <image x="0" y="0" width="${s.width}" height="${s.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${t}"/>
            </svg>`},Be=Re.useRef(!1);r.useEffect(()=>{if(Be.current=!1,C.contentType==="screenshot"){const t=p==="pages"?1920:500,s=p==="pages"?1080:300;ve(a=>({...a,width:t,height:s,screenshotWidth:0,screenshotHeight:0,rawScreenshotUrl:""}))}else C.contentType==="title"&&ve(t=>({...t,width:500,height:300}))},[p,C.contentType]),r.useEffect(()=>{Be.current||C.contentType==="screenshot"&&(!C.screenshotWidth||!C.screenshotHeight||ve(t=>({...t,width:C.screenshotWidth,height:C.screenshotHeight})))},[C.screenshotWidth,C.screenshotHeight]);const ls=(t,s)=>{Be.current=!0,ve(a=>({...a,[t]:s||0}))},cs=()=>{C.contentType==="screenshot"&&Ae&&at()},ds=()=>{Be.current=!0;const t=C.width,s=C.height;ve(a=>({...a,width:s,height:t})),setTimeout(()=>{C.contentType==="screenshot"&&Ae&&at(s,t)},0)};r.useEffect(()=>{localStorage.setItem(Pt,p)},[p]),r.useEffect(()=>{if(!n&&u){const t=p==="elements"?u.elements:u.pages;t.length>0?(D(t[0]),p==="elements"&&G({width:600,height:400})):D(null)}},[n,u,p]);async function Ne(){var t,s;try{const a=await fetch("/api/entries.json");if(!a.ok)throw new Error("Failed to fetch data");const w=await a.json();console.log("Loaded data:",w),console.log("Reference elements:",(t=w.elements)==null?void 0:t.filter(h=>h.isReference)),console.log("Reference pages:",(s=w.pages)==null?void 0:s.filter(h=>h.isReference)),W(w)}catch(a){o.error("åŠ è½½æ•°æ®å¤±è´¥: "+a.message)}finally{j(!1)}}const Me=t=>{const s=t;if(s.filePath){const w=s.filePath.indexOf("src/");if(w>=0){let h=s.filePath.substring(w);return h=h.replace(/\/index\.(t|j)sx?$/i,""),h}return s.filePath}return`${p==="pages"?"src/pages":"src/elements"}/${t.name}`},hs=t=>{const s=`${p}/${t.name}`,a=`/api/zip?path=${encodeURIComponent(s)}`;window.open(a,"_blank")},ps=t=>{const s=Bn(t,p);navigator.clipboard.writeText(s),o.success("è®¾ç½®ä¸ºå‚è€ƒçš„ Prompt å·²å¤åˆ¶ï¼Œè¯·è¿”å› IDE å‘é€ç»™ AI")},fs=t=>{const s=p==="elements"?`elements/${t.name}`:`pages/${t.name}`;B.confirm({title:`ç¡®å®šè¦å–æ¶ˆ "${t.displayName}" çš„å‚è€ƒçŠ¶æ€å—ï¼Ÿ`,content:"å–æ¶ˆåè¯¥é¡¹ç›®å°†ä¸å†æ˜¯å‚è€ƒé¡¹ç›®ã€‚",okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const a=o.loading("æ­£åœ¨å–æ¶ˆå‚è€ƒ...",0);try{const w=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!w.ok){const h=await w.json();throw new Error(h.error||"å–æ¶ˆå‚è€ƒå¤±è´¥")}o.success("å·²å–æ¶ˆå‚è€ƒ"),D(null),Ne()}catch(w){o.error(w.message||"å–æ¶ˆå‚è€ƒå¤±è´¥")}finally{a()}}})},us=t=>{const s=p==="elements"?"å…ƒç´ ":"é¡µé¢",a=p==="elements"?`elements/${t.name}`:`pages/${t.name}`;let w=t.displayName;B.confirm({title:`é‡å‘½å${s}`,content:e.jsx("div",{children:e.jsx(Se,{autoFocus:!0,defaultValue:t.displayName,placeholder:"è¯·è¾“å…¥æ–°çš„æ˜¾ç¤ºåç§°ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰",onChange:h=>{w=h.target.value}})}),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const h=w.trim();if(!h)return o.error("è¯·è¾“å…¥æ–°çš„åç§°"),Promise.reject();if(h===t.displayName)return;const S=o.loading("æ­£åœ¨é‡å‘½å...",0);try{const T=await fetch("/api/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:a,newName:h})});if(!T.ok){const $=await T.json().catch(()=>({}));throw new Error($.error||"é‡å‘½åå¤±è´¥")}o.success("é‡å‘½åæˆåŠŸ"),D(null),Ne()}catch(T){return o.error(T.message||"é‡å‘½åå¤±è´¥"),Promise.reject()}finally{S()}}})},ms=async(t,s)=>{const a=await fetch("/api/items/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemType:t,itemName:s})});if(!a.ok){const w=await a.json().catch(()=>({}));throw new Error(w.error||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}return a.json()},gs=t=>{if(t.isReference){o.error("å‚è€ƒé¡¹ç›®æ— æ³•åˆ é™¤ï¼Œè¯·å…ˆå–æ¶ˆå‚è€ƒçŠ¶æ€");return}const s=p,a=p==="elements"?"å…ƒç´ ":"é¡µé¢",w=`${s}/${t.name}`,h=async()=>{const T=o.loading("æ­£åœ¨åˆ é™¤...",0);try{const $=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:w})});if(!$.ok){const I=await $.json();throw new Error(I.error||"åˆ é™¤å¤±è´¥")}o.success("åˆ é™¤æˆåŠŸ"),D(null),Ne()}catch($){o.error($.message||"åˆ é™¤å¤±è´¥")}finally{T()}};(async()=>{const T=o.loading("æ­£åœ¨æ£€æŸ¥å¼•ç”¨...",0);try{const $=await ms(s,t.name),I=Array.isArray($==null?void 0:$.references)?$.references:[];if(I.length>0){const V=I.map(te=>`- ${te}`).join(`
`),le=`æˆ‘å¸Œæœ›åˆ é™¤${a} "${t.displayName}" (${t.name})ã€‚
è¯¥${a}ä½äºé¡¹ç›®ä¸­çš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š\`src/${s}/${t.name}\`

å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥${a}ï¼š
${V}

è¯·å¸®æˆ‘æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥å’Œæ“ä½œï¼š
1. æ ¸å¯¹ä¸Šè¿°å¼•ç”¨æ˜¯å¦å‡†ç¡®ï¼Œå¹¶è¡¥å……é—æ¼çš„å¼•ç”¨æ–‡ä»¶ï¼ˆä¼˜å…ˆæ£€æŸ¥ \`src/elements/\` ä¸ \`src/pages/\`ï¼‰ã€‚
2. å¦‚æœç¡®è®¤ç»§ç»­åˆ é™¤ï¼Œè¯·ååŠ©æˆ‘å°†è¯¥${a}åœ¨å¼•ç”¨å¤„æ›¿æ¢ä¸ºåˆé€‚çš„å®ç°ï¼Œå¹¶æ›´æ–°å¼•ç”¨è·¯å¾„ï¼Œä½¿è¿™äº›åŸå‹ä¸å†ä¾èµ–è¯¥ç›®å½•ã€‚
3. å®Œæˆä¸Šè¿°è§£è€¦æ“ä½œåï¼Œå†å½»åº•åˆ é™¤ç›®å½• \`src/${s}/${t.name}\`ã€‚`;B.confirm({title:`æ£€æµ‹åˆ°${a}å¼•ç”¨`,width:720,okText:"å¤åˆ¶æç¤º",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:8},children:["å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥",a,"ï¼š"]}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:V})]}),async onOk(){try{await navigator.clipboard.writeText(le),o.success("å·²å¤åˆ¶å¤„ç†æç¤ºï¼Œè¯·è¿”å›ç¼–è¾‘å™¨è®© AI å¤„ç†ã€‚")}catch(te){console.error("Failed to copy: ",te),o.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤„ç†")}}})}else B.confirm({title:`ç¡®å®šè¦åˆ é™¤${a} "${t.displayName}" å—ï¼Ÿ`,content:"æœªæ£€æµ‹åˆ°å¼•ç”¨æ–‡ä»¶ã€‚åˆ é™¤åæ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚",okText:"ç¡®è®¤åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",onOk:h})}catch($){o.error($.message||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}finally{T()}})()},xs=async t=>{const s=p==="elements"?"elements":"pages",a=`src/${s}/${t.name}`,w=(S,T)=>{let $=`${S}-copy`,I=1;for(;T.includes($);)I++,$=`${S}-copy${I}`;return $},h=o.loading("æ­£åœ¨åˆ›å»ºå‰¯æœ¬...",0);try{const S=(p==="elements"?u.elements:u.pages).map(V=>V.name),T=w(t.name,S),$=`src/${s}/${T}`,I=await fetch("/api/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:a,targetPath:$})});if(!I.ok){const V=await I.json();throw new Error(V.error||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}o.success(`å‰¯æœ¬ "${T}" åˆ›å»ºæˆåŠŸ`),Ne()}catch(S){o.error(S.message||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}finally{h()}},_e=r.useMemo(()=>{const t=p==="elements"?u.elements:u.pages;if(!K)return t;const s=K.toLowerCase();return t.filter(a=>a.displayName.toLowerCase().includes(s)||a.name.toLowerCase().includes(s))},[u,p,K]),ys=({key:t})=>{const s=_e.find(a=>a.name===t);s&&(D(s),m("spec"),p==="elements"&&G({width:600,height:400}))},vt=t=>{J(t),O(""),D(null),m("spec")},ws=()=>{H(t=>t+1)},js=()=>{if(!l)return"";const t=window.location.origin+l.demoUrl,s=new URL(t,window.location.origin);if(s.searchParams.set("inspecta","true"),ke.id!=="desktop"){const a=rt.width?Math.round(rt.width):ke.width;a&&s.searchParams.set("width",String(a))}return s.toString()},bs=()=>{const t=js();t&&window.open(t,"_blank")},vs=!!l&&d!=="spec",Ss=()=>{const t=document.querySelectorAll("iframe");return t[t.length-1]||null},Ee=t=>{const s=Ss();return!s||!s.contentWindow?(o.warning("æœªæ‰¾åˆ°å¯æ“ä½œçš„é¢„è§ˆçª—å£"),!1):(s.contentWindow.postMessage(t,"*"),!0)},Cs=()=>{if(!l){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(d==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}Ee({type:"TEXT_EDIT_ENABLE"})},St=(t=!1)=>{if(!l){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(d==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}Ee({type:"TEXT_EDIT_SAVE",exitAfterSave:t})},$s=()=>{if(!l){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(d==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}if(Q.editedCount>0){B.confirm({title:"é€€å‡ºæ–‡æœ¬ç¼–è¾‘",content:`æ£€æµ‹åˆ° ${Q.editedCount} å¤„æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦ä¿å­˜åé€€å‡ºï¼Ÿ`,okText:"ä¿å­˜å¹¶é€€å‡º",cancelText:"ä¸ä¿å­˜é€€å‡º",onOk:()=>St(!0),onCancel:()=>Ee({type:"TEXT_EDIT_EXIT",discardChanges:!0})});return}Ee({type:"TEXT_EDIT_EXIT",discardChanges:!1})},Ct=(t=!0)=>new Promise((s,a)=>{const w=document.querySelectorAll("iframe"),h=w[w.length-1];if(!h||!h.contentWindow){a(new Error("æœªæ‰¾åˆ°å¯å¯¼å‡ºçš„é¢„è§ˆçª—å£"));return}const S=window.setTimeout(()=>{window.removeEventListener("message",T),a(new Error("å¯¼å‡ºè¶…æ—¶ï¼Œè¯·é‡è¯•"))},15e3),T=$=>{if($.source===h.contentWindow&&!(!$.data||$.data.type!=="FIGMA_JSON_READY"))if(window.removeEventListener("message",T),window.clearTimeout(S),$.data.success){const I=$.data.json??$.data.data??$.data.payload;if(I===void 0){a(new Error("å¯¼å‡ºæˆåŠŸä½†æœªè¿”å›æ•°æ®ï¼ˆç¼ºå°‘ json/data/payload å­—æ®µï¼‰"));return}const V=Array.isArray(I)?I:I.layers||[];s({layers:V,widgetId:$.data.widgetId,pageId:$.data.pageId})}else a(new Error($.data.error||"å¯¼å‡ºå¤±è´¥"))};window.addEventListener("message",T),h.contentWindow.postMessage({type:"EXPORT_FIGMA_JSON",rootName:(l==null?void 0:l.displayName)||(l==null?void 0:l.name),enableAutoLayout:t},"*")}),ks=async(t=!0)=>{if(!l){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const s=o.loading("æ­£åœ¨ç”Ÿæˆ Figma JSON...",0);try{const{layers:a,widgetId:w,pageId:h}=await Ct(t),S={layers:a,...w?{widgetId:w}:{},...h?{pageId:h}:{}},T=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),$=URL.createObjectURL(T),I=document.createElement("a");I.href=$,I.download=`${l.name}-${p}.json`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL($),o.success("JSON å·²ä¸‹è½½")}catch(a){o.error((a==null?void 0:a.message)||"å¯¼å‡ºå¤±è´¥")}finally{s()}},$t=()=>{if(!l)return"";const t=l.demoUrl,s=window.__LOCAL_IP__||"localhost",a=window.location.port||(window.location.protocol==="https:"?"443":"80");return`${window.location.protocol}//${s}:${a}${t}`},ke=r.useMemo(()=>ht.find(t=>t.id===q)||ht[0],[q]);r.useEffect(()=>{ht.some(s=>s.id===q)||L("desktop")},[q]);const[rt,kt]=r.useState({width:0,height:0});r.useEffect(()=>{if(ke.id==="desktop"||ke.width===0||!R.current){kt({width:0,height:0}),E(1);return}const t=()=>{if(!R.current)return;const s=R.current.clientWidth*.9,a=R.current.clientHeight*.9,w=ke.width,h=ke.height,$=24+8,I=(s-$)/w,V=(a-$)/h,le=Math.min(I,V),te=w*le,ge=h*le;kt({width:te,height:ge}),E(1)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[ke,F]);const at=(t,s)=>{const a=t??C.width,w=s??C.height,h=document.querySelectorAll("iframe"),S=h[h.length-1];S&&S.contentWindow&&S.contentWindow.postMessage({type:"CAPTURE_SCREENSHOT",targetWidth:a,targetHeight:w},"*")};r.useEffect(()=>{if(Ae&&C.contentType==="screenshot"){const t=p==="pages"?1920:500,s=p==="pages"?1080:300;C.width===t&&C.height===s&&at()}if(!Ae){const t=document.querySelectorAll("iframe"),s=t[t.length-1];s&&s.contentWindow&&s.contentWindow.postMessage({type:"RESET_SCREENSHOT_STYLES"},"*")}},[Ae,C.contentType,C.width,C.height]);const[Ts,it]=r.useState([]),Is=window.location.port||(window.location.protocol==="https:"?"443":"80"),lt=async()=>{try{const t=await fetch("/api/ws/clients");if(t.ok){const a=(await t.json()).clients||[];return it(a),a}else return it([]),[]}catch(t){return console.error("Failed to check WS clients",t),it([]),[]}};r.useEffect(()=>{lt()},[]);const Rs=async()=>{if(!l){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const t=o.loading("æ­£åœ¨æ£€æŸ¥è¿æ¥...",0),s=await lt();t(),s.length===0?B.confirm({title:"æœªæ£€æµ‹åˆ° Figma è¿æ¥",content:e.jsxs("div",{children:[e.jsx("p",{children:"è¯·ç¡®ä¿ Figma æ’ä»¶å·²æ‰“å¼€å¹¶è¿æ¥åˆ°å½“å‰æœåŠ¡ã€‚"}),e.jsxs("p",{style:{color:"#999",fontSize:12},children:["å½“å‰æœåŠ¡ç«¯å£: ",Is]})]}),okText:"ä»è¦æ¨é€",cancelText:"å–æ¶ˆ",onOk:()=>Tt()}):Tt()},Tt=async()=>{const t=o.loading("æ­£åœ¨è·å–æ•°æ®...",0);try{const{layers:s,widgetId:a,pageId:w}=await Ct();if(t(),!s||!Array.isArray(s)||s.length===0){o.error("å›¾å±‚æ•°æ®ä¸ºç©ºï¼Œæ— æ³•æ¨é€");return}let h;p==="elements"?(a||o.warning("å…ƒç´ ç¼ºå°‘ widgetIdï¼Œå¯èƒ½å¯¼è‡´åŒæ­¥å¤±è´¥"),h={type:"sync-widget-content",widgetId:a||`element-${(l==null?void 0:l.name)||"unknown"}-${Date.now()}`,data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}}):h={type:"sync-page-content",...w?{pageId:w}:{},data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}};const S=o.loading("æ­£åœ¨æ¨é€åˆ° Figma...",0);try{const T=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(T.ok)await T.json(),o.success("æ¨é€æˆåŠŸ");else{const $=await T.text();throw new Error($||"å‘é€å¤±è´¥")}}catch(T){o.error("æ¨é€å¤±è´¥: "+T.message)}finally{S()}}catch(s){t(),o.error((s==null?void 0:s.message)||"è·å–æ•°æ®å¤±è´¥")}},As=(t,s,a,w=2)=>new Promise((h,S)=>{const T=new Image,$=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),I=URL.createObjectURL($);T.onload=()=>{const V=document.createElement("canvas");V.width=s*w,V.height=a*w;const le=V.getContext("2d");if(!le){S(new Error("Could not get canvas context"));return}le.drawImage(T,0,0,V.width,V.height),URL.revokeObjectURL(I),h(V.toDataURL("image/png"))},T.onerror=V=>{URL.revokeObjectURL(I),S(V)},T.src=I}),Es=async()=>{if(l){nt(!0);try{const t=window.location.origin+l.jsUrl,s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch code: ${s.statusText}`);const a=await s.text();let w="";if(l){const S=`${window.location.origin}/${p}/${l.name}/hack.css`;try{const T=await fetch(S);T.ok&&(w=await T.text())}catch(T){console.warn("fetch hack.css failed",T)}}const h=async(S=!1)=>{const T=`${window.location.origin}/${p}/${l.name}`,$=["spec","prd"],I={};for(const te of $){const ge=`${T}/${te}.md`;try{const he=await fetch(ge);if(he.ok){const me=await he.text(),xe={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};I[te]={name:xe[te],content:me}}}catch(he){console.warn(`Failed to fetch ${te}.md`,he)}}if(S){const te=`${p}/${l.name}`,ge=`${window.location.origin}/api/source?path=${encodeURIComponent(te)}`;try{const he=await fetch(ge);if(he.ok){const xe=`\`\`\`tsx
${await he.text()}
\`\`\`
`;I.code={name:"å‚è€ƒä»£ç ",content:xe}}}catch(he){console.warn("Failed to fetch source code",he)}}const V=Object.keys(I);return V.length>1?I:V.length===1?I[V[0]].content:null};if(C.contentType==="screenshot"&&!C.rawScreenshotUrl){o.warning("æ­£åœ¨ç”Ÿæˆæˆªå›¾ï¼Œè¯·ç¨å€™..."),nt(!1);return}try{let S="",T="";if(C.includeConfig!=="none"&&(S=a,C.includeConfig==="codeAndDocs"||C.includeConfig==="codeAndDocsAndSource")){const ye=C.includeConfig==="codeAndDocsAndSource",Te=await h(ye);Te&&(T=Te)}const $=p==="elements"?"å…ƒç´ ":"é¡µé¢";let I="";if(C.contentType==="title"){const ye=ot("",C,l.displayName,$),Te=await As(ye,C.width,C.height,2);I=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${C.width}" height="${C.height}" viewBox="0 0 ${C.width} ${C.height}">
                            <rect width="100%" height="100%" fill="transparent" />
                            <image x="0" y="0" width="${C.width}" height="${C.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${Te}"/>
                        </svg>`}else I=ot(C.rawScreenshotUrl,C,l.displayName,$);const le=new DOMParser().parseFromString(I,"image/svg+xml"),te=le.querySelector("svg");if(!te)throw new Error("SVG generation failed");if(S||T){const ye={code:S,spec:T};te.setAttribute("AxExtraData",encodeURIComponent(JSON.stringify(ye)))}if(C.includeConfig!=="none"){const ye={time:Math.floor(Date.now()/1e3),config:{codeLink:t,...p==="pages"?{isFullScreen:!0}:{},...w?{hackCss:w}:{}}};te.setAttribute("AxData",encodeURIComponent(JSON.stringify(ye)))}const he=new XMLSerializer().serializeToString(le),me=new Blob([he],{type:"image/svg+xml;charset=utf-8"}),xe=URL.createObjectURL(me),ae=document.createElement("a");ae.href=xe,ae.download=`${l.name}.svg`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(xe),o.success("SVG å¯¼å‡ºæˆåŠŸ"),st(!1)}catch(S){console.error("Image export failed:",S),o.error("å›¾ç‰‡å¯¼å‡ºå¤±è´¥")}}catch(t){o.error(`å¯¼å‡ºå¤±è´¥: ${t.message}`),console.error("å¯¼å‡ºå¤±è´¥:",t)}finally{nt(!1)}}},Ds=async t=>{if(!l)throw new Error("æœªé€‰æ‹©é¡¹ç›®");const s=window.location.origin+l.jsUrl,a=await fetch(s);if(!a.ok)throw new Error(`Failed to fetch code: ${a.statusText}`);const w=await a.text();let h="";const S=`${window.location.origin}/${p}/${l.name}/hack.css`;try{const I=await fetch(S);I.ok&&(h=await I.text())}catch{}const T=async(I=!1)=>{const V=`${window.location.origin}/${p}/${l.name}`,le=["spec","prd"],te={};for(const me of le){const xe=`${V}/${me}.md`;try{const ae=await fetch(xe);if(ae.ok){const ye=await ae.text(),Te={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};te[me]={name:Te[me],content:ye}}}catch(ae){console.warn(`Failed to fetch ${me}.md`,ae)}}if(I){const me=`${p}/${l.name}`,xe=`${window.location.origin}/api/source?path=${encodeURIComponent(me)}`;try{const ae=await fetch(xe);if(ae.ok){const Te=`\`\`\`tsx
${await ae.text()}
\`\`\`
`;te.code={name:"å‚è€ƒä»£ç ",content:Te}}}catch(ae){console.warn("Failed to fetch source code",ae)}}const ge=Object.keys(te);return ge.length>1?te:ge.length===1?te[ge[0]].content:null},$={time:Math.floor(Date.now()/1e3),config:{code:w,...p==="pages"?{isFullScreen:!0}:{},...h?{hackCss:h}:{}}};if(t==="codeAndDocs"||t==="codeAndDocsAndSource"){const V=await T(t==="codeAndDocsAndSource");V&&($.config.spec=V)}return JSON.stringify($,null,2)},Ps=l?d==="spec"?l.specUrl:l.demoUrl:"",Ns=t=>{const s=window.location.origin+t.demoUrl;window.open(s,"_blank")};return e.jsxs(Le,{style:{minHeight:"100vh"},children:[P,e.jsx("style",{children:`
                .resize-handle-right {
                    cursor: ew-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-right::before {
                    content: '';
                    position: absolute;
                    right: 50%;
                    top: 50%;
                    transform: translate(50%, -50%);
                    width: 2px;
                    height: 40px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-right:hover::before,
                .resize-handle-right:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 3px;
                    height: 50px;
                }
                .resize-handle-bottom {
                    cursor: ns-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottom::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    bottom: 50%;
                    transform: translate(-50%, 50%);
                    width: 40px;
                    height: 2px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottom:hover::before,
                .resize-handle-bottom:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 50px;
                    height: 3px;
                }
                .resize-handle-bottomRight {
                    cursor: nwse-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottomRight::before {
                    content: '';
                    position: absolute;
                    right: 0;
                    bottom: 0;
                    width: 12px;
                    height: 12px;
                    background: var(--ant-color-border);
                    border-radius: 0 0 6px 0;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottomRight:hover::before,
                .resize-handle-bottomRight:active::before {
                    background: var(--ant-color-border-secondary);
                    width: 16px;
                    height: 16px;
                }
                /* å®¹å™¨æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹æŸ„ */
                .ant-card-hoverable:hover .resize-handle-right::before,
                .ant-card-hoverable:hover .resize-handle-bottom::before,
                .ant-card-hoverable:hover .resize-handle-bottomRight::before {
                    background: var(--ant-color-border-secondary);
                }

                /* èœå•é¡¹ hover æ—¶æ˜¾ç¤ºæ›´å¤šæŒ‰é’® */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }

                /* ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ */
                @media (max-width: 768px) {
                    /* éšè— PC ç«¯çš„å®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: none !important;
                    }
                    
                    /* æ˜¾ç¤ºç§»åŠ¨ç«¯ç®€åŒ–å¸ƒå±€ */
                    .mobile-layout {
                        display: block !important;
                    }
                }

                @media (min-width: 769px) {
                    /* PC ç«¯æ˜¾ç¤ºå®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: block !important;
                    }
                    
                    /* éšè—ç§»åŠ¨ç«¯å¸ƒå±€ */
                    .mobile-layout {
                        display: none !important;
                    }
                }

                /* ç§»åŠ¨ç«¯åˆ—è¡¨æ ·å¼ */
                .mobile-item-card {
                    background: ${i?"#1f1f1f":"#fff"};
                    border: 1px solid ${i?"#303030":"#f0f0f0"};
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 12px;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .mobile-item-card:hover {
                    border-color: ${i?"#177ddc":"#1890ff"};
                    box-shadow: 0 2px 8px ${i?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.1)"};
                }

                .mobile-item-card:active {
                    transform: scale(0.98);
                }

                .mobile-item-title {
                    font-size: 16px;
                    font-weight: 500;
                    color: ${i?"#fff":"#000"};
                    margin-bottom: 4px;
                }

                .mobile-item-name {
                    font-size: 12px;
                    color: ${i?"#8c8c8c":"#999"};
                }
            `}),e.jsxs("div",{className:"pc-layout",children:[e.jsx(En,{collapsed:F,setCollapsed:z,selectedItem:l,viewMode:d,setViewMode:f,activeTab:p,selectedDeviceId:q,setSelectedDeviceId:L,deviceSegmentOptions:as,handleOpenInspect:bs,handleEnableTextEdit:Cs,handleSaveTextEdit:()=>St(!1),handleExitTextEdit:$s,handleRefreshElement:ws,handleCopyLocalLink:ts,handleCopyLANLink:ss,handleDownloadZip:ns,getLANUrl:$t,qrCodeVisible:X,setQrCodeVisible:y,wsClients:Ts,checkConnection:lt,handlePushToFigma:Rs,handleDownloadFigmaJson:ks,setIsExportModalOpen:st,handleOpenIdeFile:os,isDarkMode:i,setIsDarkMode:c,currentSpecDocKey:k,textEditState:Q,textEditAvailable:vs}),e.jsxs(Le,{children:[e.jsx(kn,{collapsed:F,loading:n,activeTab:p,handleTabChange:vt,data:u,searchText:K,setSearchText:O,filteredItems:_e,selectedItem:l,handleMenuClick:ys,handleDownloadItemSource:hs,handleRenameItem:us,handleSetReference:ps,handleUnsetReference:fs,handleDuplicateItem:xs,handleDeleteItem:gs,handleCopyItemPath:rs,setCreateDialogVisible:tt}),e.jsx(zn,{containerRef:R,selectedItem:l,activeTab:p,currentDevice:ke,displaySize:rt,scale:b,elementIframeKey:se,iframeUrl:Ps,elementIframeSize:A,setElementIframeSize:G,viewMode:d})]}),e.jsx(Fn,{visible:oe,onClose:es,onOk:Zt,onSendPrompt:Qt,activeTab:p,createName:N,setCreateName:x,createReference:g,setCreateReference:fe,createMode:M,setCreateMode:ue,generateAxure:ee,setGenerateAxure:ie,referenceItems:v,selectedDocs:Qe,setSelectedDocs:$e,availableDocs:pe,selectedThemes:Z,setSelectedThemes:je,availableThemes:de,selectedDataAssets:Fe,setSelectedDataAssets:be,availableDataAssets:et,selectedLibraries:Ye,setSelectedLibraries:Ce,availableLibraries:Ze}),e.jsx(bn,{open:Ae,onClose:()=>st(!1),imageConfig:C,setImageConfig:ve,onDimensionChange:ls,onSwapDimensions:ds,onDimensionBlur:cs,isExporting:is,onExport:Es,onCopyConfig:Ds,activeTab:p,itemName:l==null?void 0:l.name})]}),e.jsx("div",{className:"mobile-layout",style:{display:"none"},children:e.jsxs("div",{style:{padding:"16px",minHeight:"100vh",background:i?"#141414":"#f5f5f5"},children:[e.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsxs("h1",{style:{margin:0,fontSize:"24px",fontWeight:600,color:i?"#fff":"#000"},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})}),e.jsx(U,{type:"text",icon:i?e.jsx(Kt,{}):e.jsx(Gt,{}),onClick:()=>c(!i)})]}),e.jsx(bt,{activeKey:p,onChange:t=>vt(t),style:{marginBottom:"16px"},items:[{key:"pages",label:`é¡µé¢ (${u.pages.length})`,icon:e.jsx(Pe,{})},{key:"elements",label:`å…ƒç´  (${u.elements.length})`,icon:e.jsx(gt,{})}]}),e.jsx(Se,{placeholder:"æœç´¢...",prefix:e.jsx(Ht,{}),value:K,onChange:t=>O(t.target.value),allowClear:!0,style:{marginBottom:"16px"}}),n?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(ze,{tip:"åŠ è½½ä¸­..."})}):e.jsx("div",{children:_e.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:i?"#8c8c8c":"#999"},children:["æš‚æ— ",p==="elements"?"å…ƒç´ ":"é¡µé¢"]}):_e.map(t=>e.jsxs("div",{className:"mobile-item-card",onClick:()=>Ns(t),children:[e.jsx("div",{className:"mobile-item-title",children:t.displayName}),e.jsx("div",{className:"mobile-item-name",children:t.name})]},t.name))})]})}),P,ne]})}function Xn(){const[i,c]=r.useState(()=>{try{return localStorage.getItem(Ot)==="true"}catch{return!1}}),n=j=>{c(j);try{localStorage.setItem(Ot,String(j))}catch(u){console.error("Failed to save dark mode preference:",u)}};return e.jsx(un,{theme:wn(i),children:e.jsx(mn,{children:e.jsx(Gn,{isDarkMode:i,setIsDarkMode:n})})})}const qn=fn.createRoot(document.getElementById("root"));qn.render(e.jsx(Xn,{}));
