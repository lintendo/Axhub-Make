import{P as ot,a as Xe,n as It,M as Gt,W as Rs,b as xs,c as gs,d as ys,e as ws,f as bs,S as js,t as oo,A as Ss,D as Bt,o as vs}from"./chunks/PromptActionButton.js";import{I as Be,T as Me,r,s as W,j as e,M as $t,ab as es,J as xt,u as ge,F as Ct,S as qe,a3 as Cs,ac as ro,ad as Ft,ae as Ie,af as Kt,b as Y,ag as Tt,ah as St,t as at,ai as ao,l as Es,aj as io,o as rt,ak as Ps,a1 as lo,al as co,L as gt,Q as Ds,am as Jt,d as Ns,an as uo,ao as Xt,ap as qt,P as ho,aq as Yt,D as Et,O as po,H as Ls,N as fo,ar as mo,as as xo,Z as he,at as Us,au as zs,h as Se,i as go,k as yo,m as kt,B as Wt,w as ts,x as wo,e as Zt,y as bo,z as jo,A as So,E as vo,p as Qt,_ as Co,av as Eo,aw as Io,ax as Is,ay as $o,az as To,aA as ko,aB as Ao,aC as Ro,aD as Po,aE as Do,aF as No,aG as _s,aa as Os,aH as Lo,U as Ms,aI as $s,aJ as Uo,aK as zo,R as _o,C as Oo,a as Ts,aL as Mo,a8 as Bo,a9 as Fo,G as Wo,aM as Ho,g as Vo,aN as Go}from"./chunks/vendor.js";import{g as Ko}from"./chunks/index.js";import{i as Jo}from"./chunks/bridge.js";import"./chunks/execute.js";const{TextArea:Xo}=Be,{Text:nt}=Me,qo=({open:f,onClose:v,imageConfig:c,setImageConfig:w,onDimensionChange:T,onSwapDimensions:k,onDimensionBlur:S,isExporting:D,onExport:B,onCopyConfig:ie,activeTab:G,itemName:Z,preferredPromptClient:U,preferredIDE:ne})=>{const Q=G==="elements"?"å…ƒç´ ":"é¡µé¢",[y,u]=r.useState(null),[H,d]=r.useState(!1),[N,K]=r.useState(!1),[J,de]=W.useMessage(),[z,L]=r.useState("export"),[ee,ae]=r.useState(""),[R,F]=r.useState(""),[le,M]=r.useState(!1);r.useEffect(()=>{(async()=>{if(R&&z==="copyConfig"){M(!0);try{if(!await _()){F(""),ae(""),M(!1);return}const V=await ie(R);ae(V)}catch{J.error("åŠ è½½é…ç½®å¤±è´¥"),ae("")}finally{M(!1)}}})()},[R,z,ie,J]),r.useEffect(()=>{f||(L("export"),F(""),ae(""))},[f]);const _=async()=>{if(!Z)return!0;K(!0);try{const C=`${G}/${Z}`,oe=await Xe.reviewCode(C);return oe.passed?!0:(u(oe),d(!0),!1)}catch(C){return console.error("ä»£ç æ£€æŸ¥å¤±è´¥:",C),!0}finally{K(!1)}},o=async()=>{await _()&&B()},b=async()=>{if(!ee){J.warning("è¯·å…ˆé€‰æ‹©å¯¼å‡ºå†…å®¹");return}try{await navigator.clipboard.writeText(ee),J.success("é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}catch{J.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å‰ªè´´æ¿æƒé™")}},p=C=>{C.target.select()},j=async()=>{if(!y)throw new Error("æ²¡æœ‰å¯ç”¨çš„æ£€æŸ¥ç»“æžœ");const C=y.issues.filter(ce=>ce.type==="error"),oe=y.issues.filter(ce=>ce.type==="warning");let V=`ä»£ç æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·å¸®æˆ‘ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š

`;return V+=`æ–‡ä»¶ï¼š${y.file}

`,C.length>0&&(V+=`âŒ é”™è¯¯ (${C.length} ä¸ª):
`,C.forEach((ce,me)=>{V+=`
${me+1}. [${ce.rule}] ${ce.message}
`,ce.suggestion&&(V+=`   å»ºè®®: ${ce.suggestion}
`)})),oe.length>0&&(V+=`
âš ï¸ è­¦å‘Š (${oe.length} ä¸ª):
`,oe.forEach((ce,me)=>{V+=`
${me+1}. [${ce.rule}] ${ce.message}
`,ce.suggestion&&(V+=`   å»ºè®®: ${ce.suggestion}
`)})),V};return e.jsxs(e.Fragment,{children:[de,e.jsx($t,{title:"å¯¼å‡ºåˆ° Axure",open:f,onCancel:v,footer:z==="export"?[e.jsx(Y,{type:"primary",loading:D||N,onClick:o,children:"å¯¼å‡º"},"export")]:[e.jsx(Y,{type:"primary",disabled:!ee,onClick:b,children:"å¤åˆ¶é…ç½®"},"copy")],width:800,children:e.jsx(es,{activeKey:z,onChange:L,items:[{key:"export",label:"å¯¼å‡ºå›¾ç‰‡",children:e.jsxs("div",{style:{display:"flex",gap:"20px",height:"400px"},children:[e.jsx("div",{style:{flex:1,border:"1px solid #f0f0f0",borderRadius:"8px",overflow:"hidden",background:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:c.previewUrl?e.jsx("img",{src:c.previewUrl,alt:"Preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}):e.jsx(xt,{tip:"æ­£åœ¨ç”Ÿæˆé¢„è§ˆ..."})}),e.jsxs("div",{style:{width:"240px",display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å¯¼å‡ºå°ºå¯¸",e.jsx(ge,{title:"è¿”å›ž Axure åŒå‡»å…ƒç´ å°±å¯ä»¥æ›¿æ¢å›¾ç‰‡ï¼ŒåŒå‡»å›¾ç‰‡å·¦ä¸Šè§’æˆ–è€…åœ¨æ ·å¼é¢æ¿é‡Œç‚¹å‡»è‡ªé€‚åº”å›¾ç‰‡å³å¯æ›´æ–°å›¾ç‰‡å°ºå¯¸",children:e.jsx(Ct,{style:{color:"#999",cursor:"help"}})})]}),e.jsxs(qe,{children:[e.jsx(Cs,{value:c.width,onChange:C=>T("width",C),onBlur:S,placeholder:"å®½",style:{width:100},min:1}),e.jsx(ro,{onClick:k,style:{color:"#999",cursor:"pointer",fontSize:14}}),e.jsx(Cs,{value:c.height,onChange:C=>T("height",C),onBlur:S,placeholder:"é«˜",style:{width:100},min:1})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["å›¾ç‰‡å†…å®¹",e.jsx(ge,{title:"æ ‡é¢˜å°é¢ä¾¿äºŽåœ¨ Axure å†…æ›´æ”¹å°ºå¯¸",children:e.jsx(Ct,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(Ft.Group,{value:c.contentType,onChange:C=>w(oe=>({...oe,contentType:C.target.value})),children:e.jsxs(qe,{direction:"vertical",children:[e.jsxs(Ft,{value:"title",children:[Q,"æ ‡é¢˜"]}),e.jsxs(Ft,{value:"screenshot",children:[Q,"æˆªå›¾"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"8px",fontWeight:500,display:"flex",alignItems:"center",gap:"4px"},children:["åŒ…å«é…ç½®",e.jsx(ge,{title:"è‹¥åŒ…å«é…ç½®ï¼Œä»…éœ€å¯¼å…¥å›¾ç‰‡åˆ° Axureï¼Œä¸€èˆ¬ä¸éœ€è¦å†å¤åˆ¶é…ç½®æˆ–è€…ä»£ç ",children:e.jsx(Ct,{style:{color:"#999",cursor:"help"}})})]}),e.jsx(Ie,{value:c.includeConfig,onChange:C=>w(oe=>({...oe,includeConfig:C})),style:{width:"100%"},options:[{label:"æ— ",value:"none"},{label:"åŽŸåž‹",value:"code"},{label:"åŽŸåž‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŽŸåž‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]})]})]})},{key:"copyConfig",label:"å¤åˆ¶é…ç½®",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",height:"400px"},children:[e.jsx(Kt,{message:"å¯¼å‡ºæœ¬åœ° html æˆ–è€…å‘å¸ƒåˆ° Axure Cloud æ—¶è‹¥å›¾ç‰‡å¤±æ•ˆå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½",type:"info",showIcon:!0}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"å¯¼å‡ºå†…å®¹"}),e.jsx(Ie,{value:R||void 0,onChange:F,placeholder:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",style:{width:"100%"},options:[{label:"è¯·é€‰æ‹©å¯¼å‡ºå†…å®¹",value:"",disabled:!0},{label:"åŽŸåž‹",value:"code"},{label:"åŽŸåž‹ + æ–‡æ¡£",value:"codeAndDocs"},{label:"åŽŸåž‹ + æ–‡æ¡£ + ä»£ç ",value:"codeAndDocsAndSource"}]})]}),R&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"8px",fontWeight:500},children:"é…ç½®å†…å®¹"}),le?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #d9d9d9",borderRadius:"6px"},children:e.jsx(xt,{tip:"æ­£åœ¨åŠ è½½é…ç½®..."})}):e.jsx(Xo,{value:ee,readOnly:!0,onFocus:p,style:{flex:1,fontFamily:"monospace",fontSize:"12px"},placeholder:"é…ç½®å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"})]})]})}]})}),e.jsx($t,{title:"ä»£ç æ£€æŸ¥æœªé€šè¿‡",open:H,onCancel:()=>d(!1),width:600,footer:[e.jsx(Y,{onClick:()=>d(!1),children:"å–æ¶ˆ"},"cancel"),e.jsx(ot,{type:"primary",preferredClient:U,preferredIDE:ne,scene:`review-fix-${G}`,buildPrompt:j,getIdeTargetPath:()=>Z?`src/${G}/${Z}/index.tsx`:null,copySuccessMessage:"å¤åˆ¶æˆåŠŸ",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt",onAfterCopy:()=>d(!1)},"copy")],children:y&&e.jsxs("div",{style:{maxHeight:"500px",overflowY:"auto"},children:[e.jsx(Kt,{description:"ä»£ç ä¸ç¬¦åˆå¼€å‘è§„èŒƒï¼Œéœ€è¦ä¿®å¤åŽæ‰èƒ½å¯¼å‡º",type:"error",showIcon:!0,style:{marginBottom:"24px"}}),y.issues.filter(C=>C.type==="error").length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(Tt,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(nt,{type:"danger",children:"é”™è¯¯ (å¿…é¡»ä¿®å¤)"})}),e.jsx(St,{size:"small",dataSource:y.issues.filter(C=>C.type==="error"),renderItem:C=>e.jsx(St.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(nt,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(nt,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]}),y.issues.filter(C=>C.type==="warning").length>0&&e.jsxs("div",{children:[e.jsx(Tt,{orientation:"left",style:{margin:"0 0 16px 0",fontSize:"14px"},children:e.jsx(nt,{type:"warning",children:"è­¦å‘Š (å»ºè®®ä¿®å¤)"})}),e.jsx(St,{size:"small",dataSource:y.issues.filter(C=>C.type==="warning"),renderItem:C=>e.jsx(St.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsxs(nt,{strong:!0,children:["[",C.rule,"]"]})," ",e.jsx(nt,{children:C.message})]}),C.suggestion&&e.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",background:"#fafafa",padding:"8px",borderRadius:"4px"},children:["å»ºè®®: ",C.suggestion]})]})})})]})]})})]})},{Text:Ht}=Me,{useToken:Yo}=at;function Zo({visible:f,onCancel:v,item:c,activeTab:w,preferredPromptClient:T,preferredIDE:k}){const{token:S}=Yo(),[D,B]=r.useState([]),[ie,G]=r.useState(!1),[Z,U]=r.useState(""),[ne,Q]=r.useState(""),[y,u]=r.useState(!1),[H,d]=r.useState(!1),[N,K]=r.useState(null),[J,de]=r.useState(null),z=o=>{const b=o;let p="";if(b.filePath){const j=b.filePath.indexOf("src/");p=j>=0?b.filePath.substring(j):b.filePath}else p=`${w==="pages"?"src/pages":"src/elements"}/${o.name}`;return p=p.replace(/\/index\.(t|j)sx?$/i,""),p=p.replace(/^\/+/,""),p.startsWith("src/")&&(p=p.substring(4)),p},L=o=>{const b=new Date(o),p=j=>String(j).padStart(2,"0");return`${b.getFullYear()}/${p(b.getMonth()+1)}/${p(b.getDate())} ${p(b.getHours())}:${p(b.getMinutes())}:${p(b.getSeconds())}`},ee=o=>{const b=Math.floor((Date.now()-o)/1e3);let p=b/31536e3;return p>1?Math.floor(p)+" å¹´å‰":(p=b/2592e3,p>1?Math.floor(p)+" ä¸ªæœˆå‰":(p=b/86400,p>1?Math.floor(p)+" å¤©å‰":(p=b/3600,p>1?Math.floor(p)+" å°æ—¶å‰":(p=b/60,p>1?Math.floor(p)+" åˆ†é’Ÿå‰":"åˆšåˆš"))))},ae=async()=>{if(c){d(!0);try{const o=z(c);if(!o){W.error("æ— æ³•èŽ·å–æ–‡ä»¶è·¯å¾„"),d(!1);return}const b=await fetch(`/api/git/history?path=${encodeURIComponent(o)}`),p=await b.json();b.ok?(B(p.commits),G(p.hasUncommitted),U(p.uncommittedFiles)):W.error(p.error||"åŠ è½½ç‰ˆæœ¬åŽ†å²å¤±è´¥")}catch{W.error("åŠ è½½ç‰ˆæœ¬åŽ†å²å¤±è´¥")}finally{d(!1)}}};r.useEffect(()=>{f&&c&&ae()},[f,c]);const R=async o=>{if(c)try{const b=z(c),p=await fetch("/api/git/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b,commitHash:o})}),j=await p.json();p.ok?(W.success("ç‰ˆæœ¬æ¢å¤æˆåŠŸ"),ae()):W.error(j.error||"ç‰ˆæœ¬æ¢å¤å¤±è´¥")}catch{W.error("ç‰ˆæœ¬æ¢å¤å¤±è´¥")}},F=async()=>{if(!c||!ne.trim()){W.warning("è¯·è¾“å…¥æäº¤ä¿¡æ¯");return}u(!0);try{const o=z(c),b=await fetch("/api/git/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:o,message:ne})}),p=await b.json();b.ok?(W.success("æäº¤æˆåŠŸ"),Q(""),ae()):W.error(p.error||"æäº¤å¤±è´¥")}catch{W.error("æäº¤å¤±è´¥")}finally{u(!1)}},le=async()=>{if(!c)throw new Error("è¯·é€‰æ‹©æ¡ç›®åŽå†æ‰§è¡Œ");const o=z(c);return`æˆ‘éœ€è¦æäº¤ä»¥ä¸‹ç›®å½•çš„æ›´æ”¹ï¼Œè¯·å¸®æˆ‘å¤„ç†ï¼š

ç›®æ ‡è·¯å¾„: src/${o}

è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. ä½¿ç”¨ git status å’Œ git diff æŸ¥çœ‹è¯¥è·¯å¾„ä¸‹çš„å˜æ›´å†…å®¹ã€‚
2. åˆ†æžå˜æ›´ï¼Œç”Ÿæˆä¸€ä¸ªç®€æ´æ˜Žäº†çš„ä¸­æ–‡æäº¤ä¿¡æ¯ï¼ˆCommit Messageï¼‰ã€‚
3. å‘æˆ‘å±•ç¤ºå˜æ›´æ‘˜è¦å’Œå»ºè®®çš„æäº¤ä¿¡æ¯ï¼Œå¹¶è¯¢é—®æ˜¯å¦ç»§ç»­ã€‚
4. èŽ·å¾—ç¡®è®¤åŽï¼Œæ‰§è¡Œï¼š
   git add src/${o}
   git commit -m "ä½ çš„æäº¤ä¿¡æ¯"

è¯·ç›´æŽ¥å¼€å§‹æ‰§è¡Œç¬¬ 1 æ­¥ã€‚`},M=async o=>{if(c){K(o);try{const b=z(c),p=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b,commitHash:o})}),j=await p.json();p.ok&&j.hasSpec&&j.specUrl?window.open(j.specUrl,"_blank"):j.hasSpec?W.error(j.error||"æ— æ³•è®¿é—®è§„æ ¼æ–‡æ¡£"):W.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰è§„æ ¼æ–‡æ¡£")}catch{W.error("åŠ è½½è§„æ ¼æ–‡æ¡£å¤±è´¥")}finally{K(null)}}},_=async o=>{if(c){de(o);try{const b=z(c),p=await fetch("/api/git/build-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b,commitHash:o})}),j=await p.json();p.ok&&j.hasPrototype&&j.prototypeUrl?window.open(j.prototypeUrl,"_blank"):j.hasPrototype?W.error(j.error||"æ— æ³•è®¿é—®åŽŸåž‹"):W.warning("è¯¥ç‰ˆæœ¬æ²¡æœ‰åŽŸåž‹æ–‡ä»¶")}catch{W.error("åŠ è½½åŽŸåž‹å¤±è´¥")}finally{de(null)}}};return e.jsx($t,{title:`ç‰ˆæœ¬ç®¡ç† - ${c==null?void 0:c.displayName}`,open:f,onCancel:v,footer:null,width:700,centered:!0,className:"version-dialog",styles:{body:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",paddingTop:12,paddingBottom:12}},destroyOnClose:!0,children:e.jsx(xt,{spinning:H,children:D.length===0&&!ie?e.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#999"},children:"æš‚æ— ç‰ˆæœ¬åŽ†å²"}):e.jsx(ao,{mode:"left",items:[...ie?[{children:e.jsx("div",{className:"commit-item uncommitted",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Ht,{strong:!0,style:{fontSize:14,marginRight:8},children:"æœªæäº¤çš„æ›´æ”¹"}),e.jsx(Es,{color:"warning",children:"æœªä¿å­˜"})]})}),e.jsxs("div",{style:{background:S.colorFillAlter,padding:12,borderRadius:8,border:`1px solid ${S.colorBorderSecondary}`},children:[e.jsx(Be,{placeholder:"æ‰‹åŠ¨è¾“å…¥æäº¤ä¿¡æ¯...",value:ne,onChange:o=>Q(o.target.value),onPressEnter:F,style:{marginBottom:12}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{fontSize:12,color:S.colorTextSecondary},children:Z?`${Z.split(`
`).filter(Boolean).length} ä¸ªæ–‡ä»¶å˜æ›´`:"æœ‰æ–‡ä»¶å˜æ›´"}),e.jsxs(qe,{children:[e.jsx(ot,{type:"default",preferredClient:T,preferredIDE:k,scene:`version-commit-${w}`,buildPrompt:le,getIdeTargetPath:()=>c?`src/${z(c)}`:null,copySuccessMessage:"AI æŒ‡ä»¤å·²å¤åˆ¶ï¼Œè¯·ç²˜è´´ç»™åŠ©æ‰‹",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"}),e.jsx(Y,{type:"primary",size:"small",onClick:F,loading:y,disabled:!ne.trim(),children:"æäº¤"})]})]})]})]})}),color:"orange",dot:e.jsx("div",{style:{width:10,height:10,background:S.colorWarning,borderRadius:"50%",border:`2px solid ${S.colorBgContainer}`}})}]:[],...D.map((o,b)=>{const p=b===0&&!ie;return{children:e.jsx("div",{className:"commit-item",style:{paddingBottom:20},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{marginBottom:4,display:"flex",alignItems:"center"},children:[e.jsx(Ht,{strong:!0,style:{fontSize:14,marginRight:8},children:o.message}),p&&e.jsx(Es,{color:"success",children:"å½“å‰ç‰ˆæœ¬"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:S.colorTextSecondary},children:[e.jsxs(qe,{size:4,children:[e.jsx(io,{size:20,style:{backgroundColor:S.colorPrimary,fontSize:12},children:o.author?o.author[0].toUpperCase():"U"}),e.jsx("span",{children:o.author})]}),e.jsx("span",{style:{color:S.colorBorder},children:"|"}),e.jsx(ge,{title:L(o.timestamp),children:e.jsx("span",{style:{cursor:"help"},children:ee(o.timestamp)})}),e.jsx("span",{style:{color:S.colorBorder},children:"|"}),e.jsx(Ht,{code:!0,style:{fontSize:12,margin:0},children:o.hash.substring(0,7)})]})]}),!p&&e.jsxs(qe,{size:0,children:[e.jsx(ge,{title:"æŸ¥çœ‹è§„æ ¼æ–‡æ¡£",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(rt,{}),style:{color:S.colorTextSecondary},onClick:()=>M(o.hash),loading:N===o.hash})}),e.jsx(ge,{title:"æŸ¥çœ‹åŽŸåž‹",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Ps,{}),style:{color:S.colorTextSecondary},onClick:()=>_(o.hash),loading:J===o.hash})}),e.jsx(lo,{title:"ç¡®è®¤æ¢å¤",description:"ç¡®å®šè¦æ¢å¤åˆ°æ­¤ç‰ˆæœ¬å—ï¼Ÿå½“å‰æœªæäº¤çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚",onConfirm:()=>R(o.hash),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",children:e.jsx(ge,{title:"æ¢å¤æ­¤ç‰ˆæœ¬",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(co,{}),style:{color:S.colorTextSecondary}})})})]}),p&&e.jsx(qe,{size:0})]})}),color:p?"green":"gray",dot:p?e.jsx("div",{style:{width:10,height:10,background:S.colorSuccess,borderRadius:"50%",border:`2px solid ${S.colorBgContainer}`}}):void 0}})]})})})}const{Sider:Qo}=gt,{useToken:er}=at;function tr({collapsed:f,loading:v,activeTab:c,handleTabChange:w,data:T,searchText:k,setSearchText:S,filteredItems:D,selectedItem:B,handleMenuClick:ie,handleDownloadItemSource:G,handleRenameItem:Z,handleSetReference:U,handleUnsetReference:ne,handleDuplicateItem:Q,handleDeleteItem:y,handleCopyItemPath:u,setCreateDialogVisible:H,preferredPromptClient:d,preferredIDE:N}){const{token:K}=er(),[J,de]=r.useState(!1),[z,L]=r.useState(null),ee=R=>{L(R),de(!0)},ae=r.useMemo(()=>D.map(R=>{const F=B&&B.name===R.name,le=[{key:"rename",label:"é‡å‘½å",icon:e.jsx(Ds,{})},{key:"duplicate",label:"åˆ›å»ºå‰¯æœ¬",icon:e.jsx(Jt,{})},{key:"copy-path",label:"å¤åˆ¶è·¯å¾„",icon:e.jsx(Ns,{})},{type:"divider"},{key:"version-management",label:"ç‰ˆæœ¬ç®¡ç†",icon:e.jsx(uo,{})},{key:"download-source",label:"å¯¼å‡º ZIP",icon:e.jsx(Xt,{})},{type:"divider"},...R.isReference?[{key:"unset-reference",label:"å–æ¶ˆå‚è€ƒ",icon:e.jsx(qt,{})}]:[{key:"set-reference",label:"è®¾ç½®ä¸ºå‚è€ƒ",icon:e.jsx(qt,{})}],{key:"delete",label:`åˆ é™¤${c==="elements"?"å…ƒç´ ":"é¡µé¢"}`,icon:e.jsx(ho,{}),danger:!0,disabled:R.isReference}];return{key:R.name,label:e.jsxs("div",{className:`menu-item-wrapper ${F?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:R.displayName})}),e.jsx(Et,{trigger:["click"],menu:{items:le,onClick:({key:M})=>{M==="download-source"?G(R):M==="rename"?Z(R):M==="duplicate"?Q(R):M==="copy-path"?u(R):M==="version-management"?ee(R):M==="set-reference"?U(R):M==="unset-reference"?ne(R):M==="delete"&&y(R)}},children:e.jsx(Y,{type:"text",size:"small",className:"more-btn",icon:e.jsx(po,{}),onClick:M=>{M.stopPropagation()}})})]}),icon:c==="elements"?e.jsx(Yt,{}):e.jsx(rt,{})}}),[D,c,B,G,Z,U,ne,y,u,Q]);return e.jsxs(Qo,{trigger:null,collapsible:!0,collapsed:f,width:240,collapsedWidth:0,style:{background:K.colorBgContainer,borderRight:`1px solid ${K.colorBorder}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:[e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!f&&e.jsxs(e.Fragment,{children:[e.jsx(es,{activeKey:c,size:"small",centered:!0,onChange:R=>w(R),items:[{key:"pages",label:`é¡µé¢ (${T.pages.length})`,icon:e.jsx(rt,{})},{key:"elements",label:`å…ƒç´  (${T.elements.length})`,icon:e.jsx(Yt,{})}]}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Ls,{}),value:k,onChange:R=>S(R.target.value),allowClear:!0,style:{flex:1}})})]})}),v?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(xt,{tip:"åŠ è½½ä¸­..."})}):e.jsxs(e.Fragment,{children:[e.jsx(fo,{mode:"inline",selectedKeys:B?[B.name]:[],items:ae,onClick:ie,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!f&&e.jsx(mo,{icon:e.jsx(xo,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:()=>H(!0),tooltip:c==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢"})]}),e.jsx(Zo,{visible:J,onCancel:()=>de(!1),item:z,activeTab:c,preferredPromptClient:d,preferredIDE:N})]})}const{Title:Vt}=Me,sr=[{value:"",label:"æ— "},{label:"Axhub Genie",options:[{value:"genie:claude",label:"ClaudeCode"},{value:"genie:cursor",label:"Cursor CLI"},{value:"genie:codex",label:"Codex"}]},{label:"æœ¬åœ°ç¼–è¾‘å™¨",options:[{value:"local:cursor",label:"Cursor"},{value:"local:qoder",label:"Qoder"}]}];function nr({open:f,onClose:v,onSaved:c}){const[w]=he.useForm(),[T,k]=r.useState(!1),[S,D]=r.useState([]),[B,ie]=r.useState([]),[G,Z]=r.useState(!1);r.useEffect(()=>{f&&(U(),ne())},[f]);const U=async()=>{var y,u,H,d,N,K,J,de;try{const z=await fetch("/api/config");if(!z.ok)throw new Error("Failed to load config");const L=await z.json();w.setFieldsValue({host:L.server.host||"localhost",allowLAN:L.server.allowLAN!==!1,enableCommandAPI:L.server.enableCommandAPI||!1,projectName:((y=L.projectInfo)==null?void 0:y.name)||void 0,projectDescription:((u=L.projectInfo)==null?void 0:u.description)||void 0,defaultDoc:((H=L.projectDefaults)==null?void 0:H.defaultDoc)||void 0,defaultTheme:((d=L.projectDefaults)==null?void 0:d.defaultTheme)||void 0,defaultPromptClient:It((N=L.automation)==null?void 0:N.defaultPromptClient)??"",defaultIDE:((K=L.automation)==null?void 0:K.defaultIDE)??"",assistantWebBaseUrl:((J=L.assistant)==null?void 0:J.webBaseUrl)??"",assistantApiBaseUrl:((de=L.assistant)==null?void 0:de.apiBaseUrl)??""})}catch(z){console.error("Error loading config:",z),W.error("åŠ è½½é…ç½®å¤±è´¥")}},ne=async()=>{Z(!0);try{const[y,u]=await Promise.all([fetch("/api/docs"),fetch("/api/themes")]);if(y.ok){const H=await y.json();D(Array.isArray(H)?H:[])}if(u.ok){const H=await u.json();ie(Array.isArray(H)?H:[])}}catch(y){console.error("Error loading assets:",y)}finally{Z(!1)}},Q=async()=>{try{const y=await w.validateFields();k(!0);const u=await fetch("/api/config"),H=u.ok?await u.json():{server:{host:"localhost",port:51720,allowLAN:!0}},d={server:{host:y.host,port:H.server.port||51720,allowLAN:y.allowLAN,enableCommandAPI:y.enableCommandAPI||!1},projectInfo:{name:y.projectName??null,description:y.projectDescription??null},projectDefaults:{defaultDoc:y.defaultDoc??null,defaultTheme:y.defaultTheme??null},automation:{defaultPromptClient:It(y.defaultPromptClient),defaultIDE:y.defaultIDE?y.defaultIDE:null},assistant:{webBaseUrl:y.assistantWebBaseUrl?y.assistantWebBaseUrl:null,apiBaseUrl:y.assistantApiBaseUrl?y.assistantApiBaseUrl:null}},N=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!N.ok){const J=await N.json();throw new Error(J.error||"Failed to save config")}const K=await N.json();W.success(K.message||"é…ç½®å·²ä¿å­˜"),c==null||c(),v()}catch(y){console.error("Error saving config:",y),W.error(y.message||"ä¿å­˜é…ç½®å¤±è´¥")}finally{k(!1)}};return e.jsx(Us,{title:"é¡¹ç›®è®¾ç½®",open:f,onClose:v,width:600,extra:e.jsxs(qe,{children:[e.jsx(Y,{onClick:v,children:"å–æ¶ˆ"}),e.jsx(Y,{type:"primary",onClick:Q,loading:T,children:"ä¿å­˜"})]}),children:e.jsxs(he,{form:w,layout:"vertical",initialValues:{host:"localhost",allowLAN:!0,enableCommandAPI:!1,projectName:void 0,projectDescription:void 0,defaultDoc:void 0,defaultTheme:void 0,defaultPromptClient:"",defaultIDE:"",assistantWebBaseUrl:"",assistantApiBaseUrl:""},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Vt,{level:5,style:{marginBottom:16},children:"é¡¹ç›®ç”Ÿæˆé…ç½®"}),e.jsx(Kt,{type:"info",showIcon:!0,message:"é¡¹ç›®ä¿¡æ¯å°†ä½œä¸º AI ç”Ÿæˆä¸Žå¯¹é½çš„å…³é”®å‚è€ƒï¼Œéœ€è¦é‡å¯ç¼–è¾‘å™¨æ‰ç”Ÿæ•ˆã€‚",style:{marginBottom:16}}),e.jsx(he.Item,{label:"é¡¹ç›®åç§°",name:"projectName",tooltip:"ç”¨äºŽ AI ç†è§£é¡¹ç›®å®šä½ä¸Žäº§å‡ºé£Žæ ¼",children:e.jsx(Be,{placeholder:"è¯·è¾“å…¥é¡¹ç›®åç§°",maxLength:20})}),e.jsx(he.Item,{label:"é¡¹ç›®ç®€ä»‹",name:"projectDescription",tooltip:"ç®€è¦æè¿°é¡¹ç›®èƒŒæ™¯ã€ç›®æ ‡ç”¨æˆ·ä¸Žæ ¸å¿ƒåœºæ™¯",children:e.jsx(Be.TextArea,{placeholder:"ä¾‹å¦‚ï¼šé¢å‘è¿è¥äººå‘˜çš„æ´»åŠ¨é…ç½®åŽå°ï¼Œå¼ºè°ƒé«˜æ•ˆé…ç½®ä¸Žç¨³å®šäº¤ä»˜",rows:2,maxLength:60,showCount:!0})}),e.jsx(he.Item,{label:"é¡¹ç›®æ€»æ–‡æ¡£",name:"defaultDoc",tooltip:"ä»Žâ€œèµ„äº§ç®¡ç†-æ–‡æ¡£â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤å‚è€ƒæ–‡æ¡£",children:e.jsx(Ie,{allowClear:!0,loading:G,placeholder:"è¯·é€‰æ‹©é¡¹ç›®æ€»æ–‡æ¡£",options:S.map(y=>({value:y.name,label:y.displayName||y.name})),showSearch:!0,filterOption:(y,u)=>String((u==null?void 0:u.label)||"").toLowerCase().includes(y.toLowerCase())})}),e.jsx(he.Item,{label:"é»˜è®¤ä¸»é¢˜",name:"defaultTheme",tooltip:"ä»Žâ€œèµ„äº§ç®¡ç†-ä¸»é¢˜â€ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºé¡¹ç›®é»˜è®¤ä¸»é¢˜",children:e.jsx(Ie,{allowClear:!0,loading:G,placeholder:"è¯·é€‰æ‹©é»˜è®¤ä¸»é¢˜",options:B.map(y=>({value:y.name,label:y.displayName||y.name})),showSearch:!0,filterOption:(y,u)=>String((u==null?void 0:u.label)||"").toLowerCase().includes(y.toLowerCase())})})]}),e.jsx(Tt,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Vt,{level:5,style:{marginBottom:16},children:"è‡ªåŠ¨æ‰§è¡Œ"}),e.jsx(he.Item,{label:"è‡ªåŠ¨æ‰§è¡Œæ–¹å¼",name:"defaultPromptClient",tooltip:"å¯ä»¥åœ¨ç½‘é¡µä¸Šè§£å†³ä¸€äº›ç®€å•çš„é—®é¢˜",children:e.jsx(Ie,{allowClear:!0,placeholder:"æ— ",options:sr})}),e.jsx(he.Item,{label:"ä¸»è¦ IDE",name:"defaultIDE",tooltip:"é…ç½®åŽï¼Œç›¸å…³æ“ä½œä¼šå…ˆè‡ªåŠ¨æ‰“å¼€å¯¹åº” IDEã€‚",children:e.jsx(Ie,{allowClear:!0,placeholder:"æ— ",options:[{value:"",label:"æ— "},...Gt]})})]}),e.jsx(Tt,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(Vt,{level:5,style:{marginBottom:16},children:"æœåŠ¡å™¨é…ç½®"}),e.jsx(he.Item,{label:"ä¸»æœºåœ°å€",name:"host",rules:[{required:!0,message:"è¯·è¾“å…¥ä¸»æœºåœ°å€"}],tooltip:"æœåŠ¡å™¨å¯åŠ¨çš„åŸŸåæˆ– IP åœ°å€",children:e.jsx(Be,{placeholder:"localhost"})}),e.jsx(he.Item,{label:"å…è®¸å±€åŸŸç½‘è®¿é—®",name:"allowLAN",valuePropName:"checked",tooltip:"å¼€å¯åŽï¼Œå±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡å¯ä»¥è®¿é—®æ­¤æœåŠ¡å™¨ã€‚æ³¨æ„ï¼šå¯èƒ½å­˜åœ¨å®‰å…¨é£Žé™©ï¼Œè¯·ç¡®ä¿åœ¨å¯ä¿¡ç½‘ç»œçŽ¯å¢ƒä¸­ä½¿ç”¨",children:e.jsx(zs,{})})]})]})})}const{Header:or}=gt,{useToken:rr}=at,ar=f=>e.jsx("span",{role:"img","aria-label":"figma",className:"anticon anticon-figma",...f,children:e.jsxs("svg",{fill:"currentColor",fillRule:"evenodd",height:"1em",width:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",style:{verticalAlign:"middle"},children:[e.jsx("title",{children:"Figma"}),e.jsx("path",{clipRule:"evenodd",d:"M6.082 8.241C4.83 7.441 4 6.057 4 4.483 4 2.007 6.05 0 8.578 0h7.844C18.95 0 21 2.007 21 4.483c0 1.574-.829 2.959-2.082 3.758C20.17 9.041 21 10.426 21 12c0 2.476-2.05 4.483-4.578 4.483h-.084A4.615 4.615 0 0113.24 15.3v4.176C13.24 21.98 11.145 24 8.599 24 6.076 24 4 21.998 4 19.517c0-1.574.829-2.959 2.082-3.758C4.829 14.959 4 13.574 4 12c0-1.574.829-2.959 2.082-3.759zM13.24 12c0 1.676 1.387 3.034 3.098 3.034h.084c1.711 0 3.099-1.358 3.099-3.034 0-1.676-1.388-3.034-3.1-3.034h-.083c-1.71 0-3.098 1.358-3.098 3.034zm-1.48-3.034H8.578C6.867 8.966 5.48 10.324 5.48 12c0 1.672 1.382 3.029 3.089 3.034H11.76V8.966zm-3.182 7.517h-.01c-1.707.005-3.089 1.362-3.089 3.034 0 1.67 1.403 3.034 3.12 3.034 1.74 0 3.161-1.381 3.161-3.075v-2.993H8.578zm3.182-8.966H8.578c-1.711 0-3.099-1.358-3.099-3.034 0-1.676 1.388-3.034 3.1-3.034h3.181v6.068zm4.662 0H13.24V1.45h3.182c1.711 0 3.099 1.358 3.099 3.034 0 1.676-1.388 3.034-3.1 3.034z"})]})});function ir({collapsed:f,setCollapsed:v,selectedItem:c,viewMode:w,setViewMode:T,activeTab:k,selectedDeviceId:S,setSelectedDeviceId:D,deviceSegmentOptions:B,handleOpenInspect:ie,handleOpenWebEditor:G,handleExitWebEditor:Z,handleSaveWebEditor:U,handleEnableTextEdit:ne,handleSaveTextEdit:Q,handleExitTextEdit:y,handleRefreshElement:u,handleCopyLocalLink:H,handleCopyLANLink:d,handleDownloadZip:N,getLANUrl:K,qrCodeVisible:J,setQrCodeVisible:de,wsClients:z,checkConnection:L,handlePushToFigma:ee,handleDownloadFigmaJson:ae,setIsExportModalOpen:R,handleOpenIdeFile:F,handleOpenProjectInIDE:le,preferredIDE:M,onPreferredIDEChange:_,isDarkMode:o,setIsDarkMode:b,currentSpecDocKey:p="spec",textEditState:j,textEditAvailable:C,editorMode:oe="none",handleRefreshEditorStatus:V,onSettingsSaved:ce,assistantEnabled:me=!1,assistantVisible:$e=!1,onToggleAssistant:ve}){const[Ue,tt]=Se.useState(null),[Fe,Te]=Se.useState(!1),[Ce,Ae]=Se.useState(!0),[we,Re]=Se.useState(!1),{token:X}=rr(),Pe=oe==="webEditorV2";Se.useEffect(()=>{let m=!1;return fetch("/api/version").then(I=>I.ok?I.json():Promise.reject(new Error("Request failed"))).then(I=>{if(m)return;const P=typeof(I==null?void 0:I.version)=="string"?I.version:null;tt(P)}).catch(()=>{m||tt(null)}),()=>{m=!0}},[]),Se.useEffect(()=>{let m=!1;return fetch("/api/config").then(I=>I.ok?I.json():Promise.reject(new Error("Request failed"))).then(I=>{var P;m||Ae(((P=I==null?void 0:I.server)==null?void 0:P.allowLAN)!==!1)}).catch(()=>{m||Ae(!0)}),()=>{m=!0}},[]),z.some(m=>Rs.includes(m.type));const te=M||Gt[0].value,pe=m=>m==="cursor"?e.jsx(To,{size:16,color:X.colorText}):m==="trae"||m==="trae_cn"?e.jsx(ko,{size:16,color:X.colorText}):m==="windsurf"?e.jsx(Ao,{size:16,color:X.colorText}):m==="vscode"?e.jsx(Ro,{size:16,color:X.colorText}):m==="antigravity"?e.jsx(Po,{size:16,color:X.colorText}):m==="kiro"?e.jsx(Do,{size:16,color:X.colorText}):m==="qoder"?e.jsx(No,{size:16,color:X.colorText}):e.jsx(_s,{}),Ye=async m=>{var q,be,it;const I=await fetch("/api/config");if(!I.ok)throw new Error("åŠ è½½é…ç½®å¤±è´¥ï¼Œæ— æ³•ä¿å­˜ä¸»åŠ› IDE");const P=await I.json(),ye={...P,server:{host:((q=P==null?void 0:P.server)==null?void 0:q.host)||"localhost",allowLAN:((be=P==null?void 0:P.server)==null?void 0:be.allowLAN)!==!1,enableCommandAPI:((it=P==null?void 0:P.server)==null?void 0:it.enableCommandAPI)||!1},automation:{...(P==null?void 0:P.automation)||{},defaultIDE:m}},se=await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ye)});if(!se.ok){const ue=await se.json().catch(()=>({}));throw new Error((ue==null?void 0:ue.error)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥")}_==null||_(m)},Ze=async m=>{if(!we){Re(!0);try{if(!await Promise.resolve(le(m)))return;try{await Ye(m)}catch(P){W.warning((P==null?void 0:P.message)||"ä¿å­˜ä¸»åŠ› IDE å¤±è´¥")}}finally{Re(!1)}}},Qe=[{type:"group",label:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:Gt.map(m=>({key:m.value,label:m.label,icon:pe(m.value)}))}],g=m=>e.jsx(ge,{title:m,children:e.jsx(Et.Button,{size:"small",type:"default",loading:we,menu:{items:Qe,onClick:({key:I})=>{Ze(I)}},onClick:()=>{Ze(te)},children:e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6},children:[pe(te),"æ‰“å¼€é¡¹ç›®"]})})});return e.jsxs(or,{hasSider:!0,style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:X.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${X.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[e.jsx(Y,{type:"text",icon:f?e.jsx(go,{}):e.jsx(yo,{}),onClick:()=>v(!f),style:{fontSize:"16px",height:40}}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:X.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center"},children:e.jsx(kt,{value:w,size:"small",style:{fontSize:"12px"},onChange:m=>T(m),options:[{label:"åŽŸåž‹",value:"demo",icon:e.jsx(Ps,{})},{label:"æ–‡æ¡£",value:"spec",icon:e.jsx(qt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[g("æ‰“å¼€é¡¹ç›®"),me&&e.jsx(ge,{title:$e?"å…³é—­ Axhub Genie":"æ‰“å¼€ Axhub Genie",children:e.jsx(Wt,{dot:!0,status:$e?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:$e?"inline-flex":"none"}},children:e.jsx(Y,{size:"small",type:"text",icon:e.jsx(ts,{}),onClick:ve})})}),e.jsx(Et,{menu:{items:[{key:"assets",label:"èµ„äº§ç®¡ç†",icon:e.jsx(rt,{}),onClick:()=>window.open(new URL("/assets.html",window.location.origin).toString(),"_blank")},{key:"settings",label:"é¡¹ç›®è®¾ç½®",icon:e.jsx(Zt,{}),onClick:()=>Te(!0)},{key:"theme",label:o?"æµ…è‰²æ¨¡å¼":"æ·±è‰²æ¨¡å¼",icon:o?e.jsx(bo,{}):e.jsx(jo,{}),onClick:()=>b(!o)},{type:"divider"},{key:"help",label:"å¸®åŠ©ä¸­å¿ƒ",icon:e.jsx(So,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"åŸ¹è®­æœåŠ¡",icon:e.jsx(vo,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub å®˜ç½‘",icon:e.jsx(Zt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"å½“å‰ç‰ˆæœ¬",icon:e.jsx(Ct,{}),extra:e.jsx("span",{style:{fontSize:12,color:X.colorTextSecondary},children:Ue?`v${Ue}`:"-"})}]},placement:"bottomRight",children:e.jsx(Y,{size:"small",type:"text",icon:e.jsx(wo,{})})})]}),(c||w==="spec")&&e.jsx("div",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center"},children:e.jsx(qe,{size:"small",children:w==="spec"?e.jsx(e.Fragment,{children:e.jsx(ge,{title:`åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ ${p==="prd"?"PRD":"SPEC"} æ–‡æ¡£`,children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Qt,{}),onClick:F})})}):c&&e.jsxs(e.Fragment,{children:[k==="pages"&&!Pe&&e.jsx(kt,{value:S,size:"small",shape:"round",onChange:m=>D(m),options:B}),e.jsx(ge,{title:"åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Qt,{}),onClick:F})}),e.jsx(ge,{title:Pe?"é€€å‡ºå¿«é€Ÿç¼–è¾‘":"å¿«é€Ÿç¼–è¾‘",children:e.jsx(Wt,{dot:!0,status:Pe?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:Pe?"inline-flex":"none"}},children:e.jsx(Y,{type:"text",size:"small",disabled:!c,onClick:()=>Pe?Z():G(),icon:e.jsx(Ds,{})})})}),e.jsx(ge,{title:"åˆ·æ–°",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Co,{}),onClick:u})}),e.jsx(Eo,{content:e.jsxs("div",{style:{width:160},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[e.jsx(Y,{type:"text",icon:e.jsx(Jt,{}),onClick:H,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶æœ¬åœ°é“¾æŽ¥"}),Ce&&e.jsx(Y,{type:"text",icon:e.jsx(Jt,{}),onClick:d,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å¤åˆ¶å±€åŸŸç½‘é“¾æŽ¥"}),e.jsx(Y,{type:"text",icon:e.jsx(Is,{}),disabled:!0,style:{justifyContent:"flex-start",padding:"4px 8px",height:32},block:!0,children:"å‘å¸ƒåŽŸåž‹"})]}),Ce&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:1,background:X.colorBorder,margin:"8px 0"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"8px 0px 4px"},children:[e.jsx($o,{value:K(),size:128,bordered:!1,style:{marginBottom:8}}),e.jsx(Me.Text,{type:"secondary",style:{fontSize:12,textAlign:"center"},children:"åŒ WiFi çš„æ‰‹æœºæ‰«ç é¢„è§ˆ"})]})]})]}),trigger:"click",placement:"bottomRight",open:J,onOpenChange:de,arrow:!1,children:e.jsx(ge,{title:"åˆ†äº«",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(Io,{})})})}),e.jsx(Et,{trigger:["click"],placement:"bottomCenter",onOpenChange:m=>{m&&L()},menu:{items:[{key:"push",label:"ä¸€é”®æŽ¨é€",extra:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Wt,{status:z.some(m=>m.type==="figma")?"success":"default"}),e.jsx("span",{style:{marginLeft:4},children:z.some(m=>m.type==="figma")?"å·²è¿žæŽ¥":"æœªè¿žæŽ¥"})]}),icon:e.jsx(Is,{}),disabled:!z.some(m=>m.type==="figma")},{type:"divider"},{key:"download-json",label:"ä¸‹è½½ JSON",icon:e.jsx(Xt,{})},{key:"download-axure",label:"ä¸‹è½½ JSON",extra:"é€‚é… Axure",icon:e.jsx(rt,{})}],onClick:({key:m})=>{m==="push"?ee():m==="download-json"?ae(!0):m==="download-axure"&&ae(!1)}},children:e.jsx(ge,{trigger:["click","hover"],title:"å¯¼å‡ºåˆ° Figma",children:e.jsx(Y,{type:"text",size:"small",icon:e.jsx(ar,{})})})}),e.jsx(Y,{type:"primary",size:"small",style:{fontSize:"12px"},icon:e.jsx(Xt,{}),onClick:()=>{R(!0)},children:"å¯¼å‡ºåˆ° Axure"})]})})}),e.jsx(nr,{open:Fe,onClose:()=>Te(!1),onSaved:()=>{fetch("/api/config").then(m=>m.ok?m.json():Promise.reject(new Error("Request failed"))).then(m=>{var I;return Ae(((I=m==null?void 0:m.server)==null?void 0:I.allowLAN)!==!1)}).catch(()=>{}),ce==null||ce()}})]})}const lr=({width:f,height:v,children:c,scale:w=1})=>e.jsx("div",{style:{position:"relative",padding:"12px",background:"#1f1f1f",borderRadius:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.2)",border:"4px solid #333",display:"flex",flexDirection:"column",transform:`scale(${w})`,transformOrigin:"center center"},children:e.jsx("div",{style:{width:f,height:v,background:"#fff",borderRadius:"32px",overflow:"hidden",position:"relative"},children:c})}),{Content:cr}=gt,{useToken:dr}=at;function ur({containerRef:f,previewIframeRef:v,selectedItem:c,activeTab:w,currentDevice:T,displaySize:k,scale:S,elementIframeKey:D,iframeUrl:B,elementIframeSize:ie,setElementIframeSize:G,viewMode:Z}){const{token:U}=dr();return e.jsx(cr,{ref:f,style:{background:U.colorBgLayout,position:"relative",flex:1,minWidth:0,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:c?Z==="spec"?e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},D):w==="pages"&&T.id!=="desktop"?e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(lr,{width:k.width,height:k.height,scale:S,children:e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},D)})}):w==="elements"?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:e.jsx("div",{style:{position:"relative",display:"inline-block"},children:e.jsx(Os,{size:ie,onResize:(ne,Q,y)=>{if(y){const u=y.getBoundingClientRect();G({width:u.width,height:u.height})}},minWidth:50,minHeight:50,bounds:"window",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},handleStyles:{right:{width:"8px",right:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottom:{height:"8px",bottom:"-4px",background:"transparent",borderRadius:"4px",transition:"all 0.2s"},bottomRight:{width:"12px",height:"12px",right:"-6px",bottom:"-6px",background:"transparent",borderRadius:"0 0 6px 0",transition:"all 0.2s"}},handleClasses:{right:"resize-handle-right",bottom:"resize-handle-bottom",bottomRight:"resize-handle-bottomRight"},style:{border:`1px solid ${U.colorBorder}`,borderRadius:6,overflow:"hidden",background:U.colorBgContainer,boxShadow:U.boxShadow,transition:"box-shadow 0.2s"},className:"ant-card-hoverable",children:e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none"},title:c.displayName},D)})})}):e.jsx("iframe",{ref:v,src:B,style:{width:"100%",height:"100%",border:"none",display:"block"},title:c.displayName},D):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:U.colorTextSecondary},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(Lo,{style:{fontSize:"64px",marginBottom:"16px"}}),e.jsxs("div",{style:{fontSize:"16px"},children:["è¯·ä»Žå·¦ä¾§é€‰æ‹©ä¸€ä¸ª",w==="elements"?"å…ƒç´ ":"é¡µé¢"]})]})})})}const{Dragger:hr}=Ms,{Text:ks,Title:pr}=Me;function fr({visible:f,onClose:v,activeTab:c,createName:w,setCreateName:T,createReference:k,setCreateReference:S,createMode:D,setCreateMode:B,generateAxure:ie,setGenerateAxure:G,referenceItems:Z,selectedThemes:U,setSelectedThemes:ne,availableThemes:Q,selectedLibraries:y,setSelectedLibraries:u,availableLibraries:H,selectedDocs:d,setSelectedDocs:N,availableDocs:K,selectedDataAssets:J,setSelectedDataAssets:de,availableDataAssets:z,preferredPromptClient:L,preferredIDE:ee,buildCreatePrompt:ae,onAfterCreatePromptAction:R}){const{token:F}=at.useToken(),[le,M]=r.useState(!0),[_,o]=r.useState("create"),[b,p]=r.useState("make"),[j,C]=r.useState("zip"),[oe,V]=r.useState([]),[ce,me]=r.useState(!1),[$e,ve]=r.useState(null),Ue=r.useRef(null);r.useEffect(()=>{f&&(M(!0),o("create"),p("make"),C("zip"),V([]),me(!1),ve(null))},[f]);const tt=g=>{p(g),C("zip"),V([]),ve(null)},Fe=g=>["make","axhub","google_stitch"].includes(g),Te=g=>["axure_prototype","web_page"].includes(g),Ce=async g=>{const{file:m,onSuccess:I,onError:P}=g,ye=m instanceof File?m:m.originFileObj,se=new FormData;se.append("file",ye,ye.name),se.append("uploadType",b),se.append("targetType",c),se.append("uploadMode","zip"),console.log("[å‰ç«¯] customRequest ä¸Šä¼ å‚æ•°:",{uploadType:b,targetType:c,fileName:ye.name,fileSize:ye.size}),me(!0);try{const q=await fetch("/api/upload",{method:"POST",body:se}),be=await q.json();console.log("[å‰ç«¯] æœåŠ¡å™¨å“åº”:",be),q.ok&&be.success?(ve(be),I(null,m),Fe(b)?(W.success(be.message||"ä¸Šä¼ å¹¶è§£åŽ‹æˆåŠŸï¼"),setTimeout(()=>{v(),window.location.reload()},1500)):W.success("æ–‡ä»¶å·²è§£åŽ‹ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):(console.error("[å‰ç«¯] ä¸Šä¼ å¤±è´¥:",be),W.error(be.error||"ä¸Šä¼ å¤±è´¥"),P(new Error(be.error||"ä¸Šä¼ å¤±è´¥")))}catch(q){console.error("[å‰ç«¯] ä¸Šä¼ é”™è¯¯:",q),W.error("ä¸Šä¼ å¤±è´¥: "+q.message),P(q)}finally{me(!1)}},Ae=g=>{Ue.current&&window.clearTimeout(Ue.current),Ue.current=window.setTimeout(()=>{we(g)},250)},we=async g=>{if(ce)return;const m=g.map(se=>se.originFileObj).filter(se=>!!se);if(m.length===0){W.error("ä¸Šä¼ æ–‡ä»¶å¤¹ä¸ºç©º");return}const I=new FormData;I.append("uploadType",b),I.append("targetType",c),I.append("uploadMode","folder");const P=m[0].webkitRelativePath,ye=P?P.split("/")[0]:"";ye&&I.append("folderName",ye),m.forEach(se=>{const q=se.webkitRelativePath||se.name;I.append("files",se,q),I.append("relativePaths",q)}),me(!0);try{const se=await fetch("/api/upload",{method:"POST",body:I}),q=await se.json();se.ok&&q.success?(ve(q),Fe(b)?(W.success(q.message||"ä¸Šä¼ æˆåŠŸï¼"),setTimeout(()=>{v(),window.location.reload()},1500)):W.success(q.message||"æ–‡ä»¶å·²ä¸Šä¼ ï¼Œè¯·ç‚¹å‡»æŒ‰é’®å¤åˆ¶ Prompt")):W.error(q.error||"ä¸Šä¼ å¤±è´¥")}catch(se){W.error("ä¸Šä¼ å¤±è´¥: "+se.message)}finally{me(!1)}},Re=r.useCallback(()=>{const g=Ye.find(P=>P.key===b),m=(g==null?void 0:g.docs)||[];let I="";if(Te(b)){const P=c==="elements"?"å…ƒç´ ":"é¡µé¢",ye=b==="axure_prototype"?"Axure åŽŸåž‹é“¾æŽ¥":"ç½‘é¡µé“¾æŽ¥";I=`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼ŒååŠ©ç”¨æˆ·ã€ŒåŸºäºŽ${ye}å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${P}ã€ã€‚

**ðŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼ˆå¿…é¡»é˜…è¯»ï¼‰**ï¼š
${m.map(se=>`- \`${se}\``).join(`
`)}

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œæˆ‘å°†åŸºäºŽ ${ye} å¯¼å…¥å¹¶åˆ›å»ºä¸€ä¸ª${P}ã€‚

è¯·æŠŠé“¾æŽ¥å‘æˆ‘ï¼ˆURLï¼‰ï¼š
\`\`\``}else{if(!$e||!$e.prompt)throw new Error("æ²¡æœ‰å¯å¤åˆ¶çš„ Prompt");I=$e.prompt,m.length>0&&(I+=`

ðŸ“‹ å‚è€ƒæŠ€èƒ½æ–‡æ¡£ï¼š
${m.map(P=>`- \`${P}\``).join(`
`)}`)}return I},[b,c,$e]),X={display:"inline-flex",alignItems:"center",gap:8},Pe=()=>{if(_==="create")return e.jsx("div",{style:X,children:e.jsx(ot,{type:"primary",disabled:!1,preferredClient:L,preferredIDE:ee,scene:`create-${c}`,buildPrompt:()=>ae(),onAfterCopy:R,copySuccessMessage:"å¤åˆ¶æˆåŠŸï¼Œè¯·è¿”å›ž IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})});if(Fe(b))return e.jsx("div",{style:X,children:e.jsx(Y,{onClick:v,children:"å–æ¶ˆ"})});const g=Te(b)||$e;return e.jsxs("div",{style:X,children:[e.jsx(Y,{onClick:v,children:"å…³é—­"}),e.jsx(ot,{type:"primary",preferredClient:L,preferredIDE:ee,scene:`upload-${b}-${c}`,buildPrompt:Re,copySuccessMessage:"Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´ç»™ AI å®Œæˆå¯¼å…¥",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt",disabled:!g})]})},te={name:j==="folder"?"files":"file",multiple:j==="folder",directory:j==="folder",fileList:oe,customRequest:j==="zip"?Ce:void 0,beforeUpload:g=>{var I;return j==="folder"?!1:g.type==="application/zip"||g.type==="application/x-zip-compressed"||((I=g.name)==null?void 0:I.endsWith(".zip"))?!0:(W.error("è¯·ä¸Šä¼  ZIP æ ¼å¼çš„æ–‡ä»¶"),Ms.LIST_IGNORE)},onChange:g=>{j==="folder"?(V(g.fileList),Ae(g.fileList)):V(g.fileList.slice(-1))},onRemove:()=>{V([]),ve(null)},accept:j==="zip"?".zip":void 0,disabled:ce},pe="/skills",Ye=[{key:"make",title:"Axbub Make",description:"æ”¯æŒè‡ªå·±æˆ–ä»–äººçš„ ZIP åŒ…",icon:e.jsx(Qt,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!0,docs:[`${pe}/local-axure-workflow/SKILL.md`]},{key:"axhub",title:"Axhub æ‰©å±•",description:"å¯å¯¼å‡ºä»»æ„ç½‘é¡µï¼ˆé™æ€ï¼‰",icon:e.jsx(_s,{style:{fontSize:24,color:"#722ed1"}}),isDirect:!0,docs:[`${pe}/screenshot-page-workflow/SKILL.md`]},{key:"google_stitch",title:"Google Stitch",description:"AI é©±åŠ¨çš„ UI è®¾è®¡å·¥å…·ï¼ˆé™æ€ï¼‰",icon:e.jsx($s,{style:{fontSize:24,color:"#f5222d"}}),isDirect:!0,docs:[`${pe}/screenshot-page-workflow/SKILL.md`]},{key:"v0",title:"V0 App",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx(ts,{style:{fontSize:24,color:"#52c41a"}}),isDirect:!1,docs:[`${pe}/v0-project-converter/SKILL.md`]},{key:"google_aistudio",title:"Google AIStudio",description:"åœ¨çº¿åº”ç”¨ç”Ÿæˆå¹³å°",icon:e.jsx($s,{style:{fontSize:24,color:"#faad14"}}),isDirect:!1,docs:[`${pe}/ai-studio-project-converter/SKILL.md`]},{key:"axure_prototype",title:"Axure åŽŸåž‹é“¾æŽ¥",description:"æ”¯æŒåœ¨çº¿æˆ–æœ¬åœ°é¢„è§ˆçš„é“¾æŽ¥",icon:e.jsx(Ns,{style:{fontSize:24,color:"#1890ff"}}),isDirect:!1,docs:[`${pe}/axure-prototype-workflow/SKILL.md`,`${pe}/axure-prototype-workflow/page-restoration.md`]},{key:"web_page",title:"ç½‘é¡µé“¾æŽ¥",description:"æ”¯æŒä»»æ„ç½‘é¡µé“¾æŽ¥",icon:e.jsx(Zt,{style:{fontSize:24,color:"#13c2c2"}}),isDirect:!1,docs:[`${pe}/web-page-workflow/SKILL.md`,`${pe}/web-page-workflow/page-restoration.md`]}],Ze=()=>e.jsxs(he,{requiredMark:!1,labelCol:{style:{width:"120px"}},wrapperCol:{style:{minWidth:0}},children:[e.jsx(he.Item,{label:c==="elements"?"å…ƒç´ åç§°":"é¡µé¢åç§°",children:e.jsx(Be,{placeholder:"ç•™ç©ºåˆ™ç”± AI ç”Ÿæˆï¼Œæ‰¹é‡ç”Ÿæˆå»ºè®®ç•™ç©º",value:w,onChange:g=>T(g.target.value),maxLength:20,showCount:!0})}),Z.length>0&&e.jsx(he.Item,{label:"å‚è€ƒæ¡ˆä¾‹",tooltip:`å¯åœ¨${c==="elements"?"å…ƒç´ ":"é¡µé¢"}åˆ—è¡¨ä¸­å°†å…¶è®¾ä¸ºæˆ–å–æ¶ˆä¸ºå‚è€ƒæ¡ˆä¾‹`,children:e.jsx(Ie,{style:{width:"100%"},placeholder:"ä¸é€‰æ‹©å‚è€ƒæ¡ˆä¾‹",value:k||void 0,onChange:g=>S(g||""),allowClear:!0,options:Z.map(g=>({value:g.name,label:g.displayName}))})}),e.jsx("div",{children:e.jsx(Y,{type:"link",onClick:()=>M(!le),icon:le?e.jsx(Uo,{}):e.jsx(zo,{}),style:{padding:0},children:le?"æ›´å¤šé…ç½®":"æ”¶èµ·é…ç½®"})}),!le&&e.jsxs(e.Fragment,{children:[Q.length>0&&e.jsx(he.Item,{label:"ä¸»é¢˜",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰ä¸»é¢˜ç”ŸæˆåŽŸåž‹ï¼Œä¸»é¢˜å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(Ie,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©ä¸»é¢˜ï¼ˆå¯å¤šé€‰ï¼‰",value:U,onChange:g=>ne(g),allowClear:!0,options:Q.map(g=>({value:g.name,label:g.displayName}))})}),z.length>0&&e.jsx(he.Item,{label:"å¼•ç”¨æ•°æ®",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ•°æ®ç”ŸæˆåŽŸåž‹ï¼Œæ•°æ®å¯åœ¨æ•°æ®ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(Ie,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ•°æ®ï¼ˆå¯å¤šé€‰ï¼‰",value:J,onChange:g=>de(g),allowClear:!0,options:z.map(g=>({value:g.name,label:g.displayName}))})}),H.length>0&&e.jsx(he.Item,{label:"å‰ç«¯åº“",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰å‰ç«¯åº“ç”ŸæˆåŽŸåž‹ï¼Œå‰ç«¯åº“å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(Ie,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‰ç«¯åº“ï¼ˆå¯å¤šé€‰ï¼‰",value:y,onChange:g=>u(g),allowClear:!0,options:H.map(g=>({value:g.name,label:g.displayName}))})}),K.length>0&&e.jsx(he.Item,{label:"å‚è€ƒæ–‡æ¡£",tooltip:"AI ä¼šæ ¹æ®æ‰€é€‰æ–‡æ¡£ç”ŸæˆåŽŸåž‹ï¼Œæ–‡æ¡£å¯åœ¨èµ„äº§ç®¡ç†é¡µé¢ä¸­è¿›è¡Œç®¡ç†",children:e.jsx(Ie,{mode:"multiple",style:{width:"100%"},placeholder:"è¯·é€‰æ‹©å‚è€ƒæ–‡æ¡£ï¼ˆå¯å¤šé€‰ï¼‰",value:d,onChange:g=>N(g),options:K.map(g=>({value:g.name,label:g.displayName}))})}),e.jsx(he.Item,{label:"ç”Ÿæˆæµç¨‹",children:e.jsx(Ie,{style:{width:"100%"},value:D,onChange:g=>B(g),options:[{value:"simultaneous",label:"åŒæ—¶ç”Ÿæˆè§„æ ¼æ–‡æ¡£å’ŒåŽŸåž‹"},{value:"specFirst",label:"æŒ‰ è§„æ ¼æ–‡æ¡£ > åŽŸåž‹ é¡ºåº"}]})}),e.jsx(he.Item,{label:"Axure æ¨¡å¼",tooltip:"ä¸å½±å“å¯¼å‡º Axure ï¼Œå…³é—­åˆ™ä¸ç”Ÿæˆä¸Ž Axure åŽŸç”Ÿå…ƒç´ äº¤äº’çš„åŠŸèƒ½ï¼Œä½†å¯ä»¥æå‡ç”Ÿæˆé€Ÿåº¦",children:e.jsx(zs,{checked:ie,onChange:g=>G(g)})})]})]}),Qe=()=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[e.jsxs("div",{children:[e.jsx(pr,{level:5,style:{marginBottom:16},children:"é€‰æ‹©å¯¼å…¥æ¥æº"}),e.jsx(_o,{gutter:[16,16],children:Ye.map(g=>e.jsx(Oo,{span:12,children:e.jsx(Ts,{hoverable:!0,bodyStyle:{padding:16,height:"100%",display:"flex",alignItems:"center"},style:{height:"100%",borderColor:b===g.key?F.colorInfo:void 0,backgroundColor:b===g.key?F.colorFillAlter:void 0},onClick:()=>tt(g.key),children:e.jsx(Ts.Meta,{avatar:g.icon,title:e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsx(ks,{ellipsis:!0,style:{fontSize:13,fontWeight:500},children:g.title})}),description:e.jsx("div",{style:{fontSize:12,color:"#888",marginTop:4},children:g.description}),style:{width:"100%"}})})},g.key))})]}),!Te(b)&&e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(ks,{type:"secondary",style:{fontSize:12},children:"ä¸Šä¼ æ–¹å¼"}),e.jsx(kt,{size:"small",value:j,onChange:g=>{C(g),V([]),ve(null)},options:[{label:"ZIP",value:"zip"},{label:"æ–‡ä»¶å¤¹",value:"folder"}]})]}),e.jsx("div",{style:{flex:1,minHeight:120},children:e.jsx(hr,{...te,style:{background:"#fafafa",border:"1px dashed #d9d9d9",height:"100%"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-drag-icon",style:{marginBottom:8},children:e.jsx(Mo,{style:{color:F.colorInfo,fontSize:36}})}),e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:j==="zip"?"ç‚¹å‡»æˆ–æ‹–æ‹½ ZIP æ–‡ä»¶ä¸Šä¼ ":"ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶å¤¹ä¸Šä¼ "}),e.jsx("p",{className:"ant-upload-hint",style:{color:"#888",fontSize:12,padding:"0 16px"},children:Fe(b)?"å¯¼å…¥åŽå¯é€šè¿‡ AI è¿›è¡Œç¼–è¾‘å’Œä¼˜åŒ–":"ä¸Šä¼ åŽéœ€è¦ AI è¾…åŠ©å¯¼å…¥"})]})})})]})]});return e.jsx(Us,{placement:"left",destroyOnClose:!0,title:e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(kt,{value:_,onChange:g=>o(g),options:[{label:c==="elements"?"æ–°å»ºå…ƒç´ ":"æ–°å»ºé¡µé¢",value:"create"},{label:c==="elements"?"å¯¼å…¥å…ƒç´ ":"å¯¼å…¥é¡µé¢",value:"upload"}],style:{fontWeight:500}})}),open:f,onClose:v,width:600,footer:Pe(),styles:{body:{padding:24,overflow:"auto"},header:{borderBottom:"1px solid #f0f0f0",padding:"16px 24px"},footer:{textAlign:"right"}},children:_==="create"?Ze():Qe()})}const At={simultaneous:{mode:"simultaneous",displayName:"ç›´æŽ¥ç”Ÿæˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.md + index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!1]},specFirst:{mode:"specFirst",displayName:"è§„æ ¼ä¼˜å…ˆ",description:"é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ ç”Ÿæˆ spec.mdï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰â†’ ç”Ÿæˆ index.tsx",steps:["é˜…è¯»è§„èŒƒ â†’ è®¾è®¡ â†’ spec.mdï¼ˆç¡®è®¤ï¼‰â†’ index.tsx"],templates:["spec-template.md"],requiresConfirmation:[!0,!1]}};function mr(f,v){const c=v==="elements"?"å…ƒç´ ":"é¡µé¢",w=v==="elements"?"elements":"pages",T=`src/${w}/${f.name}`,k=`src/${w}/ref-${f.name}`;return`å°† \`${T}\` è®¾ä¸ºå‚è€ƒæ¡ˆä¾‹ï¼š

1. ç§»åŠ¨åˆ° \`${k}\`
2. å‚è€ƒ \`/rules/development-standards.md\`
3. åœ¨ index.tsx é¡¶éƒ¨æ·»åŠ ï¼š
\`\`\`typescript
/**
 * @name ${f.displayName}
 * æœ¬æ–‡ä»¶æ˜¯æ¼”ç¤ºæ–‡ä»¶ï¼Œå±•ç¤ºæœ¬é¡¹ç›®${c}å¼€å‘è§„èŒƒ
 * å®žé™…å¼€å‘æ—¶åªéœ€ä¿ç•™ @name æ³¨é‡Šï¼Œä¸éœ€è¦è¯¦ç»†çš„è§„èŒƒè¯´æ˜Ž
 */
\`\`\`
4. åœ¨å…³é”®ä»£ç æ®µæ·»åŠ  \`// ã€è§„èŒƒè¯´æ˜Žã€‘\` æ³¨é‡Šï¼šå¯¼å…¥é¡ºåºã€Propså¤„ç†ã€Stateç®¡ç†ã€äº‹ä»¶å¤„ç†ã€useImperativeHandleã€JSXæ¸²æŸ“
5. æ³¨é‡Šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œéž"åšä»€ä¹ˆ"ï¼Œé‡ç‚¹è¯´æ˜Žæ˜“é”™ç‚¹å’Œæœ€ä½³å®žè·µ`}function xr(f){return Object.prototype.hasOwnProperty.call(At,f)}function gr(f){const{hasName:v,displayName:c,itemType:w,hasReference:T,referenceDisplayName:k}=f,S=T&&k?`
å‚è€ƒæ¡ˆä¾‹ï¼š${k}`:"";return v?`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åŽï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›žå¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›žå¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®žçŽ°å†…å®¹

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º **${c}** ${w}ã€‚${S}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼š
\`\`\``:`**ç³»ç»Ÿäº¤äº’è¦æ±‚**ï¼š
- æ”¶åˆ°æœ¬æ¡ç³»ç»ŸæŒ‡ä»¤åŽï¼Œå¿…é¡»å…ˆå‘ç”¨æˆ·å›žå¤ä¸€æ¬¡ï¼Œå¹¶ç­‰å¾…ç”¨æˆ·è¡¥å……ä¿¡æ¯/ç¡®è®¤ï¼›æœªå®Œæˆå¯¹é½å‰ä¸è¦ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€ä»£ç æˆ–æ–‡æ¡£
- é¦–æ¬¡å›žå¤å¿…é¡»ä¸¥æ ¼ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ï¼Œä¸è¦è¾“å‡ºå®žçŽ°å†…å®¹

**é¦–æ¬¡å›žå¤æ¨¡æ¿**ï¼š
\`\`\`
æ”¶åˆ°ï¼Œå‡†å¤‡åˆ›å»º${w}ã€‚${S}

è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼ˆå¦‚éœ€åˆ›å»ºå¤šä¸ª${w}ï¼Œè¯·ä¸€å¹¶è¯´æ˜Žï¼‰ï¼š
\`\`\``}function yr(f){return f?`

**Axure API**ï¼šâœ… å·²å¯ç”¨
- éœ€è¦ä½¿ç”¨ Axure API å®žçŽ°ç»„ä»¶äº¤äº’åŠŸèƒ½
- **âš ï¸ å¿…é¡»å®Œæ•´é˜…è¯» \`/rules/axure-api-guide.md\`ï¼Œä¸è¦è·³è¿‡ï¼**
- è¯¥æ–‡æ¡£åŒ…å«å®Œæ•´çš„ Axure API æŽ¥å£è§„èŒƒã€ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ`:`

**Axure API**ï¼šâŒ æœªå¯ç”¨
- æœ¬æ¬¡ä½¿ç”¨æ ‡å‡† React ç»„ä»¶å³å¯ï¼Œä¸éœ€è¦ Axure API`}function As(){return`   - æ–‡ä»¶ç»“æž„ã€ä¾èµ–å¼•ç”¨ã€æ ·å¼è§„èŒƒã€å¯¼å‡ºè§„èŒƒ
   - âš ï¸ **éªŒæ”¶æ ‡å‡†**ï¼šå®ŒæˆåŽå¿…é¡»å¯¹ç…§æ­¤æ–‡æ¡£æ£€æŸ¥å®žçŽ°`}function Bs(f){const{createMode:v,modeConfig:c,generateAxure:w}=f;return v==="simultaneous"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${c.description}

**ðŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

2. **\`/rules/development-standards.md\`**
${As()}

3. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${w?`

4. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æŽ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}`:v==="specFirst"?`

**æ ¸å¿ƒæµç¨‹**ï¼šæ”¶åˆ°ç”¨æˆ·éœ€æ±‚ â†’ ${c.description}

**ðŸ“‹ å¿…è¯»è§„èŒƒæ–‡æ¡£**ï¼š
1. **\`/rules/requirements-alignment.md\`** â­ï¸ éœ€æ±‚å¯¹é½ï¼ˆç¬¬ä¸€æ­¥ï¼‰
   - éœ€æ±‚ç¡®è®¤æ¸…å•ã€æ²Ÿé€šç­–ç•¥ã€å¯è§†åŒ–æµç¨‹

2. **\`/rules/design-guide.md\`** â­ï¸ è®¾è®¡æµç¨‹ï¼ˆç¬¬äºŒæ­¥ï¼Œå¿…é¡»å®Œæˆï¼‰
   - èµ„æ–™æ”¶é›†ã€ä¸šåŠ¡åœºæ™¯è¯†åˆ«ã€æ•°æ®æºæŸ¥æ‰¾ã€å†…å®¹è§„åˆ’ã€è§†è§‰è®¾è®¡

3. **\`/rules/development-standards.md\`**
${As()}

4. **\`/assets/templates/spec-template.md\`**
   - spec.md æ–‡æ¡£æ¨¡æ¿ï¼Œä½¿ç”¨æ­¤æ¨¡æ¿ç”Ÿæˆè§„æ ¼æ–‡æ¡£${w?`

5. **\`/rules/axure-api-guide.md\`** âš ï¸ Axure API å¿…è¯»ï¼
   - æŽ¥å£è§„èŒƒã€Props å¤„ç†ã€äº‹ä»¶å¤„ç†ã€Container ä½¿ç”¨`:""}

**ç¡®è®¤æµç¨‹**ï¼š
- å®Œæˆ spec.md åŽï¼Œå‘ŠçŸ¥ç”¨æˆ·ï¼š"spec.md å·²å®Œæˆï¼Œè¯·ç¡®è®¤æ˜¯å¦æ»¡è¶³éœ€æ±‚ã€‚ç¡®è®¤åŽå°†ç”Ÿæˆä»£ç å®žçŽ°ã€‚"
- ç­‰å¾…ç”¨æˆ·ç¡®è®¤åŽå†ç”Ÿæˆ index.tsx`:Bs({createMode:"simultaneous",modeConfig:At.simultaneous,generateAxure:w})}function wr(f){const{referencePath:v,referenceDisplayName:c}=f;return v?`

**ðŸ“ å‚è€ƒæ¡ˆä¾‹**ï¼ˆâ­ï¸ ä¼˜å…ˆå‚è€ƒï¼‰ï¼š
- è·¯å¾„ï¼š\`${v}\`
- åç§°ï¼š${c}
- **è¯·ä¼˜å…ˆå‚è€ƒæ­¤æ¡ˆä¾‹çš„ä»£ç ç»“æž„å’Œå®žçŽ°æ–¹å¼**
- å­¦ä¹ å…¶æ–‡ä»¶ç»„ç»‡ã€å‘½åè§„èŒƒã€ä»£ç é£Žæ ¼`:""}function vt(f){const{title:v,selected:c,available:w,toLine:T}=f;return c.length===0?"":`

${v}${c.map(k=>{const S=w.find(D=>D.name===k);return`
${T(k,S)}`}).join("")}`}function br(f,v,c,w,T,k=[],S=[],D=[],B=[],ie=[],G=[],Z=[],U=[],ne=!0){const Q=v==="elements",y=Q?"å…ƒç´ ":"é¡µé¢",u=Q?"elements":"pages",H=f.trim().length>0,d=f.trim(),N=w?T.find(_=>_.name===w):null,K=N?`src/${u}/${N.name}`:null,J=xr(c)?At[c]:At.simultaneous,de=H?`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼Œåˆ›å»º ${y}ã€Œ**${d}**ã€åŽŸåž‹`:`**ç³»ç»ŸæŒ‡ä»¤**ï¼šä½ å°†ä½œä¸ºUI/UX è®¾è®¡æž¶æž„å¸ˆ Ã— å‰ç«¯å·¥ç¨‹å¸ˆï¼ˆå¤åˆåž‹ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª${y}åŽŸåž‹`,z=gr({hasName:H,displayName:d,itemType:y,hasReference:!!N,referenceDisplayName:N==null?void 0:N.displayName}),L=yr(ne),ee=Bs({createMode:c,modeConfig:J,generateAxure:ne}),ae=wr({referencePath:K,referenceDisplayName:N==null?void 0:N.displayName}),R=vt({title:"**ðŸ“š å‚è€ƒæ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/docs/ï¼‰ï¼š",selected:k,available:S,toLine:(_,o)=>`- **\`/assets/docs/${_}\`** - ${(o==null?void 0:o.displayName)||_}`}),F=vt({title:"**ðŸŽ¨ ä¸»é¢˜é…ç½®**ï¼ˆç›¸å¯¹è·¯å¾„ /src/themes/ï¼Œåªæä¾›è·¯å¾„ï¼Œä¸å±•å¼€æ–‡ä»¶å†…å®¹ï¼‰ï¼š",selected:D,available:B,toLine:(_,o)=>`- ${(o==null?void 0:o.displayName)||_}
  - \`/src/themes/${_}/DESIGN-SPEC.md\`ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  - \`/src/themes/${_}/designToken.json\`
  - \`/src/themes/${_}/globals.css\` æˆ– \`/src/themes/${_}/style.css\`ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰
  - \`/src/themes/${_}/index.tsx\``}),le=vt({title:"**ðŸ“¦ å‰ç«¯åº“æ–‡æ¡£**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/libraries/ï¼‰ï¼š",selected:ie,available:G,toLine:(_,o)=>`- **\`/assets/libraries/${_}\`** - ${(o==null?void 0:o.displayName)||_}`}),M=vt({title:"**ðŸ“Š å‚è€ƒæ•°æ®**ï¼ˆç›¸å¯¹è·¯å¾„ /assets/database/ï¼‰ï¼š",selected:Z,available:U,toLine:(_,o)=>`- **\`/assets/database/${_}\`** - ${(o==null?void 0:o.displayName)||_}`});return`${de}

âš ï¸ **é‡è¦æç¤º**ï¼šè¯·åŠ¡å¿…å®Œæ•´é˜…è¯»ä»¥ä¸‹æ‰€æœ‰è§„èŒƒæ–‡æ¡£å’Œå‚è€ƒèµ„æ–™ï¼Œä¸è¦å·æ‡’ï¼è¿™äº›æ–‡æ¡£åŒ…å«äº†å…³é”®çš„å¼€å‘è§„èŒƒå’Œæœ€ä½³å®žè·µã€‚
${ee}${ae}${F}${M}${le}${R}${L}

${z}`}function jr(f,v,c,w){if(!f)return"";const T=window.location.origin+(v==="demo"?f.demoUrl:f.specUrl),k=new URL(T,window.location.origin);return v==="demo"&&c==="webEditorV2"?k.searchParams.set("editor","webEditorV2"):k.searchParams.delete("editor"),w!=null&&w.width&&Number.isFinite(w.width)?k.searchParams.set("width",String(Math.round(w.width))):k.searchParams.delete("width"),k.toString()}function Sr(f,v){const[c,w]=r.useState(!1),[T,k]=r.useState(""),[S,D]=r.useState(()=>localStorage.getItem(xs)||""),[B,ie]=r.useState(()=>localStorage.getItem(gs)||"simultaneous"),[G,Z]=r.useState(()=>localStorage.getItem(ys)==="true"),[U,ne]=r.useState([]),[Q,y]=r.useState([]),[u,H]=r.useState([]),[d,N]=r.useState([]),[K,J]=r.useState([]),[de,z]=r.useState([]),[L,ee]=r.useState([]),[ae,R]=r.useState([]),[F,le]=r.useState(!1);r.useEffect(()=>{localStorage.setItem(gs,B)},[B]),r.useEffect(()=>{localStorage.setItem(ys,String(G))},[G]),r.useEffect(()=>{localStorage.setItem(xs,S)},[S]);const M=r.useMemo(()=>(f==="elements"?v.elements:v.pages).filter(j=>j.isReference),[v,f]);return r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/docs");if(j.ok){const C=await j.json();z(C)}}catch(j){console.error("Failed to load docs:",j)}})()},[F]),r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/themes");if(j.ok){const C=await j.json();y(C)}}catch(j){console.error("Failed to load themes:",j)}})()},[F]),r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/libraries");if(j.ok){const C=await j.json();N(C);const oe=C.find(V=>V.name==="tailwind-css.md"||V.name.startsWith("tailwind-css"));oe&&u.length===0&&H([oe.name])}}catch(j){console.error("Failed to load libraries:",j)}})()},[F]),r.useEffect(()=>{if(!F)return;(async()=>{try{const j=await fetch("/api/data/tables");if(j.ok){const oe=(await j.json()).map(V=>({name:`${V.fileName}.json`,displayName:V.tableName}));R(oe)}}catch(j){console.error("Failed to load data assets:",j)}})()},[F]),r.useEffect(()=>{c&&(S&&(M.some(j=>j.name===S)||D("")),le(!0))},[c,M,S]),{createDialogVisible:c,createName:T,createReference:S,createMode:B,generateAxure:G,referenceItems:M,selectedThemes:U,availableThemes:Q,selectedLibraries:u,availableLibraries:d,selectedDocs:K,availableDocs:de,selectedDataAssets:L,availableDataAssets:ae,setCreateDialogVisible:w,setCreateName:k,setCreateReference:D,setCreateMode:ie,setGenerateAxure:Z,setSelectedThemes:ne,setSelectedLibraries:H,setSelectedDocs:J,setSelectedDataAssets:ee,buildPrompt:async()=>br(T,f,B,S,M,K,de,U,Q,u,d,L,ae,G),clearCreateDialogState:()=>{w(!1),k(""),J([]),ne([]),H([]),ee([]),le(!1),z([]),y([]),N([]),R([])},handleCreateCancel:()=>{w(!1),k(""),J([]),ne([]),H([]),ee([]),le(!1),z([]),y([]),N([]),R([])}}}function vr(f,v){const c=Array.isArray(f)?f:[],w=Array.isArray(v)?v:[],T=[...c],k=new Set(T.map(S=>String((S==null?void 0:S.selector)||"").trim()).filter(Boolean));for(const S of w){const D=String((S==null?void 0:S.selector)||"").trim();!D||k.has(D)||(T.push(S),k.add(D))}return T}function Cr(f){const v=Array.isArray(f)?f:[],c=[],w=new Set;for(const T of v){const k=String((T==null?void 0:T.tag)||"").trim(),S=String((T==null?void 0:T.selector)||"").trim(),D=String((T==null?void 0:T.label)||"").trim();if(!k||!S||!D)continue;const B=`${k}::${S}::${D}`;w.has(B)||(w.add(B),c.push({tag:k,selector:S,label:D}))}return c}function Er({isDarkMode:f,setIsDarkMode:v}){const c="[assistant-runtime-ui]",w="http://localhost:32123",T=/mac/i.test(navigator.platform)?"sudo npm install -g @axhub/genie":"npm install -g @axhub/genie",k={webBaseUrl:w,apiBaseUrl:`${w}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"åŠ©æ‰‹è¿è¡Œæ—¶ä¸å¯ç”¨ï¼Œè¯·å…ˆå¯åŠ¨ Axhub Genieã€‚",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:T,start:"axhub-genie",status:"axhub-genie status"}}},S=320,D=320,B=640,{token:ie}=at.useToken(),[G,Z]=r.useState(!0),[U,ne]=r.useState({elements:[],pages:[]}),[Q,y]=r.useState(!1),[u,H]=r.useState(()=>{const t=localStorage.getItem(bs);return t==="elements"||t==="pages"?t:"pages"}),[d,N]=r.useState(null),[K,J]=r.useState("desktop"),[de,z]=r.useState(1),L=Se.useRef(null),ee=Se.useRef(null),[ae,R]=r.useState(!1),F=Se.useRef(null),le=Se.useRef(null),[M,_]=r.useState(""),[o,b]=W.useMessage(),[p,j]=$t.useModal(),[C,oe]=r.useState({enabled:!1,editedCount:0}),[V,ce]=r.useState({mode:"none",webEditor:{active:!1,undoCount:0,redoCount:0},textEdit:{enabled:!1,editedCount:0},inspecta:{enabled:!1}}),me=Se.useRef(!1),[$e,ve]=r.useState({width:600,height:400}),[Ue,tt]=r.useState(0),[Fe,Te]=r.useState(!1),[Ce,Ae]=r.useState(null),[we,Re]=r.useState(null),[X,Pe]=r.useState(!1),[te,pe]=r.useState(null),[Ye,Ze]=r.useState(!1),[Qe,g]=r.useState(()=>{const t=localStorage.getItem(js),s=t?Number(t):NaN;return Number.isFinite(s)&&s>=D?Math.min(s,B):S}),m=r.useRef(null),[I,P]=r.useState(!1),[ye,se]=r.useState(null),[q,be]=r.useState(null),it=r.useRef(!1),[ue,Fs]=r.useState("demo"),[lt,Rt]=r.useState("spec"),We=Se.useRef(null),{createDialogVisible:Ws,createName:Hs,createReference:Vs,createMode:Gs,generateAxure:Ks,referenceItems:Js,selectedThemes:Xs,availableThemes:qs,selectedLibraries:Ys,availableLibraries:Zs,selectedDocs:Qs,availableDocs:en,selectedDataAssets:tn,availableDataAssets:sn,setCreateDialogVisible:nn,setCreateName:on,setCreateReference:rn,setCreateMode:an,setGenerateAxure:ln,setSelectedThemes:cn,setSelectedLibraries:dn,setSelectedDocs:un,setSelectedDataAssets:hn,buildPrompt:pn,clearCreateDialogState:fn,handleCreateCancel:mn}=Sr(u,U);r.useEffect(()=>{let t=!1;return Xe.getConfig().then(s=>{var n,i;t||(Ae(It((n=s==null?void 0:s.automation)==null?void 0:n.defaultPromptClient)),Re(((i=s==null?void 0:s.automation)==null?void 0:i.defaultIDE)||null))}).catch(()=>{t||(Ae(null),Re(null))}),()=>{t=!0}},[]);const He=r.useMemo(()=>oo(Ce),[Ce]);r.useEffect(()=>{let t=!1;return Xe.getAssistantRuntime({autoStart:!1}).then(s=>{t||pe(s)}).catch(()=>{t||pe(k)}),()=>{t=!0}},[]),r.useEffect(()=>{localStorage.setItem(js,String(Math.round(Qe)))},[Qe]);const Pt=B,ct=r.useCallback((t,s)=>{try{const n=new URL(t,window.location.origin);return n.searchParams.set("context",JSON.stringify(s)),n.toString()}catch(n){return console.warn("Failed to serialize assistant context into URL:",n),t}},[]),dt=r.useMemo(()=>{const t=((te==null?void 0:te.webBaseUrl)||w).replace(/\/+$/g,""),s=new URL(`${t}/`),n=(te==null?void 0:te.projectPath)||"";return n&&s.searchParams.set("cwd",n),He&&s.searchParams.set("provider",He),s.toString()},[te,He]),ze=ye||dt;r.useEffect(()=>{P(!1)},[ze]),r.useEffect(()=>{it.current=I},[I]);const De=r.useMemo(()=>{const t=d?pt(d):null,s=lt==="prd"?"prd":"spec",i=t?ue==="spec"?`${t}/${s==="prd"?"prd.md":"spec.md"}`:`${t}/index.tsx`:null,a={version:"1",systemContext:"",currentFile:i||"",selectedElements:[],extensions:{source:"axhub-runtime",projectPath:(te==null?void 0:te.projectPath)||"",provider:He,viewMode:ue,activeTab:u,currentSpecDocKey:s,selectedItem:d?{name:d.name,displayName:d.displayName,demoUrl:d.demoUrl,specUrl:d.specUrl}:null,paths:{itemSourcePath:t,currentFilePath:i,currentFileDirectory:t},updatedAt:new Date().toISOString()}};return q?{...a,systemContext:q.systemContext||a.systemContext,currentFile:q.currentFile||a.currentFile,selectedElements:Array.isArray(q.selectedElements)?q.selectedElements:a.selectedElements,extensions:{...a.extensions||{},...q.extensions||{}}}:a},[te==null?void 0:te.projectPath,He,ue,u,lt,d,q]),ss=r.useCallback(()=>{const t=m.current;if(!t||!t.contentWindow)return;let s="*";try{s=new URL(ze).origin}catch{s="*"}const n={type:"update_context",context:De};t.contentWindow.postMessage(n,s)},[ze,De]);r.useEffect(()=>{!X||!I||ss()},[X,I,ss]),r.useEffect(()=>{X||(P(!1),se(null))},[X]);const yt=r.useCallback((t,s)=>{const n=t||dt;let i=n;try{const l=new URL(n,window.location.origin),a=(te==null?void 0:te.projectPath)||"";!l.searchParams.get("cwd")&&a&&l.searchParams.set("cwd",a),!l.searchParams.get("provider")&&He&&l.searchParams.set("provider",He),s&&!l.searchParams.get("targetPath")&&l.searchParams.set("targetPath",s),l.searchParams.get("context")?i=l.toString():i=ct(l.toString(),De)}catch{i=ct(n,De)}return i},[te==null?void 0:te.projectPath,He,dt,De,ct]),ns=r.useCallback((t,s)=>{const n=yt(t,s);Pe(!0),P(!1),se(n)},[yt]),os=r.useCallback((t,s)=>{const n=yt(t,s);window.open(n,"_blank","noopener,noreferrer")},[yt]),ut=r.useCallback((t,s="replace")=>{const n=m.current;if(!n||!n.contentWindow)return!1;let i="*";try{i=new URL(ze).origin}catch{i="*"}const l={type:"update_context",mode:s,context:{version:t.version,systemContext:t.systemContext,currentFile:t.currentFile,selectedElements:t.selectedElements,extensions:t.extensions}};return n.contentWindow.postMessage(l,i),!0},[ze]),wt=r.useCallback((t,s="replace")=>{ut(t,s),s==="replace"&&(window.setTimeout(()=>ut(t,s),160),window.setTimeout(()=>ut(t,s),520))},[ut]),rs=r.useCallback((t,s)=>{const n=m.current;if(!n||!n.contentWindow)return!1;let i="*";try{i=new URL(ze).origin}catch{i="*"}const l={type:"update_prompt",prompt:t,autoSend:s};return n.contentWindow.postMessage(l,i),!0},[ze]),as=r.useCallback(async(t=8e3)=>{var n;const s=Date.now();for(;Date.now()-s<t;){if((n=m.current)!=null&&n.contentWindow&&it.current)return!0;await new Promise(i=>setTimeout(i,120))}return!1},[]),Dt=r.useCallback((t,s,n,i,l="iframe")=>{const a=t.health.hints;p.confirm({title:"Axhub Genie æœªå°±ç»ª",width:620,content:e.jsxs("div",{children:[e.jsx("p",{children:t.health.message}),e.jsxs(Me.Paragraph,{style:{marginBottom:8},copyable:{text:a.installGlobal,tooltips:["å¤åˆ¶å‘½ä»¤","å·²å¤åˆ¶"],onCopy:()=>o.success("å…¨å±€å®‰è£…å‘½ä»¤å·²å¤åˆ¶")},children:["å…¨å±€å®‰è£…ï¼š",e.jsx(Me.Text,{code:!0,children:a.installGlobal})]}),e.jsxs(Me.Paragraph,{style:{marginBottom:0},copyable:{text:a.start,tooltips:["å¤åˆ¶å‘½ä»¤","å·²å¤åˆ¶"],onCopy:()=>o.success("å¯åŠ¨å‘½ä»¤å·²å¤åˆ¶")},children:["å¯åŠ¨å‘½ä»¤ï¼š",e.jsx(Me.Text,{code:!0,children:a.start})]})]}),cancelText:"å…³é—­",footer:(h,{CancelBtn:x})=>e.jsx(x,{})}),s==="event"&&o.warning("Genie æœªå°±ç»ªï¼Œå·²å›žé€€ä¸ºå®‰è£…å¼•å¯¼ã€‚")},[o,p]),is=r.useCallback(async t=>{if(t.health.status!=="runtime_unreachable")return t;let s=t;const n=5,i=700;for(let l=0;l<n;l+=1){await new Promise(a=>setTimeout(a,i));try{const a=await Xe.getAssistantRuntime({autoStart:!1});if(s=a,pe(a),a.health.status==="ready"||a.health.status==="missing_cli"||a.health.status==="needs_update"||a.health.status==="cli_error")return a}catch(a){console.warn(`${c} runtime poll failed`,a);break}}return s},[]),et=r.useCallback(async(t,s,n,i="iframe")=>{if(Ye)return!1;Ze(!0);const l=o.loading("æ­£åœ¨å¯åŠ¨å¹¶æ£€æµ‹ Axhub Genie...",0);console.info(`${c} begin runtime check`,{trigger:t,openTarget:i,targetUrl:s||null,targetPath:n||null});try{const a=await Xe.getAssistantRuntime();pe(a),console.info(`${c} runtime response`,{status:a.health.status,message:a.health.message,source:a.source,commandSource:a.health.commandSource,webBaseUrl:a.webBaseUrl,apiBaseUrl:a.apiBaseUrl});const h=await is(a);if(h.health.status==="ready")return i==="window"?os(s,n):ns(s,n),!0;console.warn(`${c} runtime not ready`,{status:h.health.status,message:h.health.message,hints:h.health.hints}),Dt(h,t,s,n,i)}catch(a){const h=te||k;pe(h),console.error(`${c} runtime check failed`,a),o.error((a==null?void 0:a.message)||"æ£€æµ‹ Axhub Genie çŠ¶æ€å¤±è´¥"),Dt(h,t,s,n,i)}finally{l(),Ze(!1)}return!1},[Ye,te,o,ns,os,Dt,is]),ls=r.useCallback(async t=>{var A,re;const s=((A=t.targetPath)==null?void 0:A.trim())||void 0,n=t.context,i=String(t.prompt||"").trim(),l=t.mode==="selection_context",a=(()=>{if(!n)return q;const O=q??{systemContext:"",currentFile:"",selectedElements:[],extensions:{}},fe=vr(O.selectedElements,n.selectedElements);return{version:"1",systemContext:n.systemContext||O.systemContext,currentFile:n.currentFile||O.currentFile,selectedElements:Cr(fe),extensions:{...O.extensions||{},...n.extensions||{}}}})();a&&be(a);let h=X&&I&&!!((re=m.current)!=null&&re.contentWindow),x=!1;if(!h){const O=l?n:a,fe=O?ct(dt,O):void 0;if(!await et("event",fe,s))return;if(x=!!O,h=await as(8e3),!h){o.warning("åŠ©æ‰‹é¢æ¿å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åŽå†è¯•ã€‚");return}}if(a){const O=l?"append":"replace",fe=l?n:a;fe&&!(l&&x)&&wt(fe,O)}if(l)return;if(!i){o.warning("ç¼ºå°‘å‘é€å†…å®¹");return}rs(i,!0)||o.error("å‘é€å¤±è´¥ï¼šæ— æ³•å†™å…¥åŠ©æ‰‹è¾“å…¥æ¡†")},[q,X,I,ut,wt,rs,et,as,o,ct,dt]),xn=r.useCallback(()=>{if(X){Pe(!1);return}et("button")},[X,et]);r.useEffect(()=>{const t=s=>{const n=s,i=n.detail,l=i==null?void 0:i.url;!l||typeof l!="string"||(et("event",l,i==null?void 0:i.targetPath),n.preventDefault())};return window.addEventListener(Ss,t),()=>{window.removeEventListener(Ss,t)}},[et]);const gn=()=>{const t=`${window.location.protocol}//${window.location.hostname}:${window.location.port}${(d==null?void 0:d.demoUrl)||""}`;navigator.clipboard.writeText(t).then(()=>{o.success("æœ¬åœ°é“¾æŽ¥å·²å¤åˆ¶")}).catch(s=>{o.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),Te(!1)},yn=()=>{const t=ps();navigator.clipboard.writeText(t).then(()=>{o.success("å±€åŸŸç½‘é“¾æŽ¥å·²å¤åˆ¶")}).catch(s=>{o.error("å¤åˆ¶å¤±è´¥"),console.error("å¤åˆ¶å¤±è´¥:",s)}),Te(!1)},wn=()=>{window.open("/api/download-dist","_blank"),Te(!1)},bn=async()=>{let t="",s="";const n=[...Rs];if(d){const l=d;if(ue==="spec"){const a=lt==="prd"?"prd.md":"spec.md";t=`src/${u}/${d.name}/${a}`,s=`[${d.displayName} - ${a==="prd.md"?"PRD":"SPEC"}](${pt(d)}/${a})`}else{if(l.filePath){const a=l.filePath.indexOf("src/");a>=0?t=l.filePath.substring(a):t=l.filePath}else t=`src/${u}/${d.name}/index.tsx`;s=`[${d.displayName}](${pt(d)})`}}else{o.warning("è¯·å…ˆé€‰æ‹©æ¡ç›®");return}const i=o.loading("æ­£åœ¨å‘é€åˆ° IDE...",0);try{s&&await navigator.clipboard.writeText(s);const l=await vs({preferredIDE:we,targetPath:t}),a=l?10:1;let h=!1;for(let A=0;A<a;A+=1){const re=await Xe.sendWsMessage({type:"handshake",payload:"prototype-admin",targetClientTypes:n});if(re!=null&&re.sent){h=!0;break}A<a-1&&await new Promise(O=>setTimeout(O,500))}if(!h){o.info("ç¼–è¾‘å™¨æ­£åœ¨å¯åŠ¨ä¸­ï¼Œå·²å¤åˆ¶æ–‡ä»¶æ ‡é¢˜ï¼Œå¯ç¨åŽåœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€");return}const x=l?3:1;let E=!1;for(let A=0;A<x;A+=1){const re=await Xe.sendWsMessage({type:"open-file",payload:t,targetClientTypes:n});if(re!=null&&re.sent){E=!0;break}A<x-1&&await new Promise(O=>setTimeout(O,300))}if(!E){o.warning("ç¼–è¾‘å™¨æœªè¿žæŽ¥ï¼Œå·²å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ä½¿ç”¨");return}o.success("å·²åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œå¹¶å¤åˆ¶äº†æ–‡ä»¶æ ‡é¢˜ï¼Œå¯å‰å¾€ç¼–è¾‘")}catch(l){o.error((l==null?void 0:l.message)||"å‘é€å¤±è´¥")}finally{i()}},jn=async t=>vs({preferredIDE:t||we}),Sn=async t=>{let s="";if(ue==="spec"){const n=lt==="prd"?"prd.md":"spec.md";s=`[${t.displayName} - ${n==="prd.md"?"PRD":"SPEC"}](${pt(t)}/${n})`}else s=`[${t.displayName}](${pt(t)})`;if(!s){o.warning("æ— æ³•èŽ·å–è·¯å¾„");return}try{await navigator.clipboard.writeText(s),o.success("è·¯å¾„å·²å¤åˆ¶")}catch(n){console.error("Failed to copy: ",n),o.error("å¤åˆ¶å¤±è´¥")}},vn=r.useMemo(()=>[{value:"desktop",icon:e.jsx(Ho,{})},{value:"mobile",icon:e.jsx(Vo,{})},{value:"tablet",icon:e.jsx(Go,{})}],[]),[st,Nt]=r.useState(!1),[Cn,Lt]=r.useState(!1),[$,_e]=r.useState({width:1920,height:1080,includeConfig:"code",contentType:"title",rawScreenshotUrl:"",screenshotWidth:0,screenshotHeight:0,previewUrl:""});r.useEffect(()=>{ht()},[]),r.useEffect(()=>{const t=s=>{var l;const n=(l=le.current)==null?void 0:l.contentWindow;if(!n||s.source!==n)return;const i=ft();if(!(i!=="*"&&s.origin!==i))if(s.data&&s.data.type==="SCREENSHOT_CAPTURED")_e(a=>({...a,rawScreenshotUrl:s.data.dataUrl,screenshotWidth:s.data.width,screenshotHeight:s.data.height}));else if(s.data&&s.data.type==="spec-doc-changed"){console.log("Spec document changed:",s.data.activeDocKey);const a=s.data.activeDocKey==="prd"?"prd":"spec";Rt(a)}else if(s.data&&s.data.type==="TEXT_EDIT_STATUS")oe({enabled:!!s.data.enabled,editedCount:Number(s.data.editedCount||0)});else if(s.data&&s.data.type==="TEXT_EDIT_NOTICE"){const a=s.data.level||"info",h=s.data.message||"";h&&(o[a]||o.info)(h)}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_CONFIRM_REQUEST"){const a=Number(s.data.totalCount||0),h=Number(s.data.changedCount||0),x=!!s.data.exitAfterSave;p.confirm({title:"ç¡®è®¤ä¿å­˜æ–‡æœ¬æ›´æ”¹",content:e.jsxs("div",{children:[e.jsxs("div",{children:["æ£€æµ‹åˆ° ",h," å¤„æ–‡æœ¬æ›´æ”¹ã€‚"]}),e.jsxs("div",{children:["é¢„è®¡å°†æ›¿æ¢é¡¹ç›®ä¸­çš„ ",a," å¤„åŒ¹é…æ–‡æœ¬ã€‚"]}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"ä¿å­˜åŽå°†æ‰¹é‡ä¿®æ”¹ç›¸å…³æ–‡ä»¶å†…å®¹ã€‚"})]}),okText:"ç¡®è®¤ä¿å­˜",cancelText:"å–æ¶ˆ",onOk:()=>{Oe({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!0,exitAfterSave:x})},onCancel:()=>{Oe({type:"TEXT_EDIT_SAVE_CONFIRM",confirmed:!1,exitAfterSave:x})}})}else if(s.data&&s.data.type==="TEXT_EDIT_SAVE_RESULT"){const a=!!s.data.success;if(me.current&&(me.current=!1,a)){const h=Ve();h!=null&&h.disable&&(h.disable(),Ge())}}else if(s.data&&s.data.type==="TEXT_EDIT_CONFLICT"){const a=Array.isArray(s.data.conflicts)?s.data.conflicts:[];p.warning({title:"å­˜åœ¨å†²çªçš„æ–‡æœ¬ä¿®æ”¹",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"æ£€æµ‹åˆ°ç›¸åŒåŽŸæ–‡è¢«ä¿®æ”¹æˆä¸åŒå†…å®¹ï¼Œæ— æ³•æ‰¹é‡ä¿å­˜ã€‚"}),e.jsx("div",{style:{maxHeight:200,overflow:"auto",fontSize:12,color:"#555"},children:a.map((h,x)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{fontWeight:600},children:["åŽŸæ–‡ï¼š",h.original]}),e.jsxs("div",{children:["ä¿®æ”¹ä¸ºï¼š",(h.currents||[]).join(" / ")]})]},`${h.original}-${x}`))}),e.jsx("div",{style:{marginTop:8,color:"#999",fontSize:12},children:"è¯·ç¡®ä¿ç›¸åŒåŽŸæ–‡åªä¿®æ”¹ä¸ºä¸€ç§ç»“æžœï¼Œæˆ–åˆ†æ‰¹ä¿å­˜ã€‚"})]}),okText:"çŸ¥é“äº†"})}else Jo(s.data)&&ls(s.data.payload)};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)},[ls]),r.useEffect(()=>{oe({enabled:!1,editedCount:0})},[d,ue,Ue]),r.useEffect(()=>{if(!d)return;if($.contentType==="screenshot"&&!$.rawScreenshotUrl){_e(s=>({...s,previewUrl:""}));return}(async()=>{const s=u==="elements"?"å…ƒç´ ":"é¡µé¢",n=Ut($.rawScreenshotUrl,$,d.displayName,s),i=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(i);_e(a=>({...a,previewUrl:l}))})()},[$.rawScreenshotUrl,$.width,$.height,$.contentType,d,u]);const Ut=(t,s,n,i)=>{if(s.contentType==="title"){const l=s.width,a=s.height,h=l/2,x=a/2;return`<svg width="${l}" height="${a}" viewBox="0 0 ${l} ${a}" xmlns="http://www.w3.org/2000/svg" role="img">
              <rect width="100%" height="100%" fill="transparent" />
              <g id="textGroup" transform="translate(${h},${x})">
                <!-- Main Title -->
                <text id="mainTitle"
                      x="0" y="-12"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="28"
                      font-weight="700"
                      fill="#333">
                  ${n}
                </text>

                <!-- Description -->
                <text id="description"
                      x="0" y="18"
                      text-anchor="middle"
                      font-family="Arial, Helvetica, sans-serif"
                      font-size="14"
                      font-weight="400"
                      fill="#999">
                  Axhub Runtime ${i}
                </text>
              </g>
            </svg>`}else return`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${s.width}" height="${s.height}" viewBox="0 0 ${s.width} ${s.height}">
                <rect width="100%" height="100%" fill="transparent" />
                <image x="0" y="0" width="${s.width}" height="${s.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${t}"/>
            </svg>`},bt=Se.useRef(!1);r.useEffect(()=>{if(bt.current=!1,$.contentType==="screenshot"){const t=u==="pages"?1920:500,s=u==="pages"?1080:300;_e(n=>({...n,width:t,height:s,screenshotWidth:0,screenshotHeight:0,rawScreenshotUrl:""}))}else $.contentType==="title"&&_e(t=>({...t,width:500,height:300}))},[u,$.contentType]),r.useEffect(()=>{bt.current||$.contentType==="screenshot"&&(!$.screenshotWidth||!$.screenshotHeight||_e(t=>({...t,width:$.screenshotWidth,height:$.screenshotHeight})))},[$.screenshotWidth,$.screenshotHeight]);const En=(t,s)=>{bt.current=!0,_e(n=>({...n,[t]:s||0}))},In=()=>{$.contentType==="screenshot"&&st&&_t()},$n=()=>{bt.current=!0;const t=$.width,s=$.height;_e(n=>({...n,width:s,height:t})),setTimeout(()=>{$.contentType==="screenshot"&&st&&_t(s,t)},0)};r.useEffect(()=>{localStorage.setItem(bs,u)},[u]),r.useEffect(()=>{if(!G&&U){const t=u==="elements"?U.elements:U.pages;t.length>0?(N(t[0]),u==="elements"&&ve({width:600,height:400})):N(null)}},[G,U,u]);async function ht(){var t,s;try{const n=await fetch("/api/entries.json");if(!n.ok)throw new Error("Failed to fetch data");const i=await n.json();console.log("Loaded data:",i),console.log("Reference elements:",(t=i.elements)==null?void 0:t.filter(l=>l.isReference)),console.log("Reference pages:",(s=i.pages)==null?void 0:s.filter(l=>l.isReference)),ne(i)}catch(n){o.error("åŠ è½½æ•°æ®å¤±è´¥: "+n.message)}finally{Z(!1)}}function pt(t){const s=t;if(s.filePath){const i=s.filePath.indexOf("src/");if(i>=0){let l=s.filePath.substring(i);return l=l.replace(/\/index\.(t|j)sx?$/i,""),l}return s.filePath}return`${u==="pages"?"src/pages":"src/elements"}/${t.name}`}const Tn=t=>{const s=`${u}/${t.name}`,n=`/api/zip?path=${encodeURIComponent(s)}`;window.open(n,"_blank")},kn=t=>{const s=mr(t,u);p.info({title:`è®¾ç½®ä¸ºå‚è€ƒ - ${t.displayName}`,okText:"å…³é—­",width:560,content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:12,color:"#8c8c8c"},children:"å¯ç›´æŽ¥å¤åˆ¶ Promptï¼Œæˆ–é€‰æ‹©å®¢æˆ·ç«¯è‡ªåŠ¨æ‰§è¡Œã€‚"}),e.jsx(ot,{type:"primary",preferredClient:Ce,preferredIDE:we,getIdeTargetPath:()=>`src/${u}/${t.name}`,scene:`set-reference-${u}`,buildPrompt:()=>s,copySuccessMessage:"è®¾ç½®ä¸ºå‚è€ƒçš„ Prompt å·²å¤åˆ¶ï¼Œè¯·è¿”å›ž IDE å‘é€ç»™ AI",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})]})})},An=t=>{const s=u==="elements"?`elements/${t.name}`:`pages/${t.name}`;p.confirm({title:`ç¡®å®šè¦å–æ¶ˆ "${t.displayName}" çš„å‚è€ƒçŠ¶æ€å—ï¼Ÿ`,content:"å–æ¶ˆåŽè¯¥é¡¹ç›®å°†ä¸å†æ˜¯å‚è€ƒé¡¹ç›®ã€‚",okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const n=o.loading("æ­£åœ¨å–æ¶ˆå‚è€ƒ...",0);try{const i=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})});if(!i.ok){const l=await i.json();throw new Error(l.error||"å–æ¶ˆå‚è€ƒå¤±è´¥")}o.success("å·²å–æ¶ˆå‚è€ƒ"),N(null),ht()}catch(i){o.error(i.message||"å–æ¶ˆå‚è€ƒå¤±è´¥")}finally{n()}}})},Rn=t=>{const s=u==="elements"?"å…ƒç´ ":"é¡µé¢",n=u==="elements"?`elements/${t.name}`:`pages/${t.name}`;let i=t.displayName;p.confirm({title:`é‡å‘½å${s}`,content:e.jsx("div",{children:e.jsx(Be,{autoFocus:!0,defaultValue:t.displayName,placeholder:"è¯·è¾“å…¥æ–°çš„æ˜¾ç¤ºåç§°ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰",onChange:l=>{i=l.target.value}})}),okText:"ç¡®è®¤",cancelText:"å–æ¶ˆ",async onOk(){const l=i.trim();if(!l)return o.error("è¯·è¾“å…¥æ–°çš„åç§°"),Promise.reject();if(l===t.displayName)return;const a=o.loading("æ­£åœ¨é‡å‘½å...",0);try{const h=await fetch("/api/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:n,newName:l})});if(!h.ok){const x=await h.json().catch(()=>({}));throw new Error(x.error||"é‡å‘½åå¤±è´¥")}o.success("é‡å‘½åæˆåŠŸ"),N(null),ht()}catch(h){return o.error(h.message||"é‡å‘½åå¤±è´¥"),Promise.reject()}finally{a()}}})},Pn=async(t,s)=>{const n=await fetch("/api/items/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemType:t,itemName:s})});if(!n.ok){const i=await n.json().catch(()=>({}));throw new Error(i.error||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}return n.json()},Dn=t=>{if(t.isReference){o.error("å‚è€ƒé¡¹ç›®æ— æ³•åˆ é™¤ï¼Œè¯·å…ˆå–æ¶ˆå‚è€ƒçŠ¶æ€");return}const s=u,n=u==="elements"?"å…ƒç´ ":"é¡µé¢",i=`${s}/${t.name}`,l=async()=>{const h=o.loading("æ­£åœ¨åˆ é™¤...",0);try{const x=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:i})});if(!x.ok){const E=await x.json();throw new Error(E.error||"åˆ é™¤å¤±è´¥")}o.success("åˆ é™¤æˆåŠŸ"),N(null),ht()}catch(x){o.error(x.message||"åˆ é™¤å¤±è´¥")}finally{h()}};(async()=>{const h=o.loading("æ­£åœ¨æ£€æŸ¥å¼•ç”¨...",0);try{const x=await Pn(s,t.name),E=Array.isArray(x==null?void 0:x.references)?x.references:[];if(E.length>0){const A=E.map(O=>`- ${O}`).join(`
`),re=`æˆ‘å¸Œæœ›åˆ é™¤${n} "${t.displayName}" (${t.name})ã€‚
è¯¥${n}ä½äºŽé¡¹ç›®ä¸­çš„ç›¸å¯¹è·¯å¾„ä¸ºï¼š\`src/${s}/${t.name}\`

å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥${n}ï¼š
${A}

è¯·å¸®æˆ‘æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥å’Œæ“ä½œï¼š
1. æ ¸å¯¹ä¸Šè¿°å¼•ç”¨æ˜¯å¦å‡†ç¡®ï¼Œå¹¶è¡¥å……é—æ¼çš„å¼•ç”¨æ–‡ä»¶ï¼ˆä¼˜å…ˆæ£€æŸ¥ \`src/elements/\` ä¸Ž \`src/pages/\`ï¼‰ã€‚
2. å¦‚æžœç¡®è®¤ç»§ç»­åˆ é™¤ï¼Œè¯·ååŠ©æˆ‘å°†è¯¥${n}åœ¨å¼•ç”¨å¤„æ›¿æ¢ä¸ºåˆé€‚çš„å®žçŽ°ï¼Œå¹¶æ›´æ–°å¼•ç”¨è·¯å¾„ï¼Œä½¿è¿™äº›åŽŸåž‹ä¸å†ä¾èµ–è¯¥ç›®å½•ã€‚
3. å®Œæˆä¸Šè¿°è§£è€¦æ“ä½œåŽï¼Œå†å½»åº•åˆ é™¤ç›®å½• \`src/${s}/${t.name}\`ã€‚`;p.confirm({title:`æ£€æµ‹åˆ°${n}å¼•ç”¨`,width:720,okText:"å…³é—­",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:8},children:["å·²æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¼•ç”¨äº†è¯¥",n,"ï¼š"]}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:A}),e.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:e.jsx(ot,{type:"primary",preferredClient:Ce,preferredIDE:we,getIdeTargetPath:()=>`src/${s}/${t.name}`,scene:`delete-ref-fix-${s}`,buildPrompt:()=>re,copySuccessMessage:"å·²å¤åˆ¶å¤„ç†æç¤ºï¼Œè¯·è¿”å›žç¼–è¾‘å™¨è®© AI å¤„ç†ã€‚",executeSuccessMessage:"å·²æ‰“å¼€æ–°ä¼šè¯",fallbackMessage:"è‡ªåŠ¨æ‰§è¡Œå¤±è´¥ï¼Œå·²å›žé€€ä¸ºå¤åˆ¶ Prompt"})})]})})}else p.confirm({title:`ç¡®å®šè¦åˆ é™¤${n} "${t.displayName}" å—ï¼Ÿ`,content:"æœªæ£€æµ‹åˆ°å¼•ç”¨æ–‡ä»¶ã€‚åˆ é™¤åŽæ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…Žæ“ä½œã€‚",okText:"ç¡®è®¤åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",onOk:l})}catch(x){o.error(x.message||"æ£€æŸ¥å¼•ç”¨å¤±è´¥")}finally{h()}})()},Nn=async t=>{const s=u==="elements"?"elements":"pages",n=`src/${s}/${t.name}`,i=(a,h)=>{let x=`${a}-copy`,E=1;for(;h.includes(x);)E++,x=`${a}-copy${E}`;return x},l=o.loading("æ­£åœ¨åˆ›å»ºå‰¯æœ¬...",0);try{const a=(u==="elements"?U.elements:U.pages).map(A=>A.name),h=i(t.name,a),x=`src/${s}/${h}`,E=await fetch("/api/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourcePath:n,targetPath:x})});if(!E.ok){const A=await E.json();throw new Error(A.error||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}o.success(`å‰¯æœ¬ "${h}" åˆ›å»ºæˆåŠŸ`),ht()}catch(a){o.error(a.message||"åˆ›å»ºå‰¯æœ¬å¤±è´¥")}finally{l()}},jt=r.useMemo(()=>{const t=u==="elements"?U.elements:U.pages;if(!M)return t;const s=M.toLowerCase();return t.filter(n=>n.displayName.toLowerCase().includes(s)||n.name.toLowerCase().includes(s))},[U,u,M]),Ln=async({key:t})=>{V.mode==="webEditorV2"&&await ds({restoreDevice:!1});const s=jt.find(n=>n.name===t);s&&(N(s),Rt("spec"),u==="elements"&&ve({width:600,height:400}))},cs=t=>{H(t),_(""),N(null),Rt("spec")},Un=()=>{tt(t=>t+1)},Ve=t=>{var n,i;const s=t??Ke();return(i=(n=s==null?void 0:s.contentWindow)==null?void 0:n.DevTemplateBootstrap)==null?void 0:i.editors},Ge=()=>{var n;const t=Ve(),s=(n=t==null?void 0:t.getStatus)==null?void 0:n.call(t);s&&ce(s)},zn=()=>{if(!d)return"";const t=window.location.origin+d.demoUrl,s=new URL(t,window.location.origin);if(s.searchParams.set("editor","inspecta"),Ee.id!=="desktop"){const n=mt.width?Math.round(mt.width):Ee.width;n&&s.searchParams.set("width",String(n))}return s.toString()},_n=()=>Ee.id==="desktop"?null:(mt.width?Math.round(mt.width):Ee.width)||null,On=()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}const t=zn();if(!t)return;const s=Ve();if(s!=null&&s.disable)try{s.disable(),V.mode==="webEditorV2"&&zt(),Ge()}catch(n){console.error("[Axhub] é€€å‡ºå½“å‰ç¼–è¾‘æ¨¡å¼å¤±è´¥:",n)}window.open(t,"_blank")},Mn=!!d&&ue!=="spec",Ke=()=>le.current,ft=t=>{const s=t??Ke();if(!s)return window.location.origin;const n=s.getAttribute("src")||s.src;if(!n)return window.location.origin;try{return new URL(n,window.location.origin).origin}catch{return window.location.origin}},Bn=t=>{const s=Date.now(),n=(t==null?void 0:t.timeoutMs)??5e3,i=t==null?void 0:t.expectedEditor;return new Promise(l=>{const a=x=>{const E=x.getAttribute("src")||x.src;if(!E)return!1;try{return new URL(E,window.location.origin).searchParams.get("editor")===i}catch{return!1}},h=()=>{var A;const x=Ke();if(!x||!x.isConnected){if(Date.now()-s>=n){l(null);return}setTimeout(h,50);return}if(!a(x)){if(Date.now()-s>=n){l(null);return}setTimeout(h,50);return}const E=x.contentWindow;if((A=E==null?void 0:E.DevTemplateBootstrap)!=null&&A.editors){l(x);return}if(Date.now()-s>=n){l(null);return}setTimeout(h,50)};h()})},Oe=(t,s)=>{const n=s??Ke();return!n||!n.contentWindow?(o.warning("æœªæ‰¾åˆ°å¯æ“ä½œçš„é¢„è§ˆçª—å£"),!1):(n.contentWindow.postMessage(t,ft(n)),!0)},zt=r.useCallback(()=>{var t;be(s=>s&&{...s,selectedElements:[]}),X&&I&&((t=m.current)!=null&&t.contentWindow)&&wt({version:De.version,systemContext:De.systemContext,currentFile:De.currentFile,selectedElements:[],extensions:De.extensions},"replace")},[X,I,De,wt]),Fn=async()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œç¼–è¾‘");return}try{const t=Ke(),s=_n();ee.current=s??null,R(!0),Ee.id!=="desktop"&&(L.current=K,J("desktop"));const n=await Bn({previousIframe:Ee.id!=="desktop"?t:null,expectedEditor:"webEditorV2"});if(!n){R(!1),o.warning("é¢„è§ˆçª—å£å°šæœªå°±ç»ª");return}const i=Ve(n);if(!(i!=null&&i.enable)){R(!1),o.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨");return}s&&Oe({type:"WEB_EDITOR_SET_ROOT_SIZE",width:s},n),await Promise.resolve(i.enable("webEditorV2")),Ge(),We.current===null&&(We.current=Q),y(!0)}catch(t){console.error("[Axhub] å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥:",t),o.error("å¯åŠ¨ç¼–è¾‘å™¨å¤±è´¥")}},ds=async t=>{const s=Ve();if(!(s!=null&&s.disable)){zt(),o.warning("å½“å‰é¢„è§ˆé¡µæœªå¯ç”¨ç¼–è¾‘å™¨"),R(!1),We.current!==null&&(y(We.current),We.current=null),ee.current&&(Oe({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),ee.current=null),(t==null?void 0:t.restoreDevice)!==!1&&L.current&&J(L.current),L.current=null;return}try{await Promise.resolve(s.disable()),zt(),Ge(),R(!1),We.current!==null&&(y(We.current),We.current=null),ee.current&&(Oe({type:"WEB_EDITOR_RESET_ROOT_SIZE"}),ee.current=null);const n=(t==null?void 0:t.restoreDevice)!==!1;n&&L.current&&J(L.current),L.current=null,n||(L.current=null)}catch(n){console.error("[Axhub] é€€å‡ºç¼–è¾‘å™¨å¤±è´¥:",n),o.error("é€€å‡ºç¼–è¾‘å™¨å¤±è´¥")}},Wn=()=>{},Hn=()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}const t=Ve();if(t!=null&&t.enable){try{t.enable("textEdit"),Ge()}catch(s){console.error("[Axhub] å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥:",s),o.error("å¯åŠ¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥")}return}Oe({type:"TEXT_EDIT_ENABLE"})},us=(t=!1)=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}me.current=t,Oe({type:"TEXT_EDIT_SAVE",exitAfterSave:t})},Vn=()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}if(ue==="spec"){o.warning("æ–‡æ¡£æ¨¡å¼ä¸‹æ— æ³•è¿›è¡Œæ–‡æœ¬ç¼–è¾‘");return}if(C.editedCount>0){p.confirm({title:"é€€å‡ºæ–‡æœ¬ç¼–è¾‘",content:`æ£€æµ‹åˆ° ${C.editedCount} å¤„æœªä¿å­˜çš„æ›´æ”¹ï¼Œæ˜¯å¦ä¿å­˜åŽé€€å‡ºï¼Ÿ`,okText:"ä¿å­˜å¹¶é€€å‡º",cancelText:"ä¸ä¿å­˜é€€å‡º",onOk:()=>us(!0),onCancel:()=>{Oe({type:"TEXT_EDIT_EXIT",discardChanges:!0});const s=Ve();s!=null&&s.disable&&(s.disable(),Ge())}});return}const t=Ve();if(t!=null&&t.disable){t.disable(),Ge();return}Oe({type:"TEXT_EDIT_EXIT",discardChanges:!1})},hs=(t=!0)=>new Promise((s,n)=>{const i=Ke();if(!i||!i.contentWindow){n(new Error("æœªæ‰¾åˆ°å¯å¯¼å‡ºçš„é¢„è§ˆçª—å£"));return}const l=ft(i),a=window.setTimeout(()=>{window.removeEventListener("message",h),n(new Error("å¯¼å‡ºè¶…æ—¶ï¼Œè¯·é‡è¯•"))},15e3),h=x=>{if(x.source===i.contentWindow&&x.origin===l&&!(!x.data||x.data.type!=="FIGMA_JSON_READY"))if(window.removeEventListener("message",h),window.clearTimeout(a),x.data.success){const E=x.data.json??x.data.data??x.data.payload;if(E===void 0){n(new Error("å¯¼å‡ºæˆåŠŸä½†æœªè¿”å›žæ•°æ®ï¼ˆç¼ºå°‘ json/data/payload å­—æ®µï¼‰"));return}const A=Array.isArray(E)?E:E.layers||[];s({layers:A,widgetId:x.data.widgetId,pageId:x.data.pageId})}else n(new Error(x.data.error||"å¯¼å‡ºå¤±è´¥"))};window.addEventListener("message",h),i.contentWindow.postMessage({type:"EXPORT_FIGMA_JSON",rootName:(d==null?void 0:d.displayName)||(d==null?void 0:d.name),enableAutoLayout:t},l)}),Gn=async(t=!0)=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const s=o.loading("æ­£åœ¨ç”Ÿæˆ Figma JSON...",0);try{const{layers:n,widgetId:i,pageId:l}=await hs(t),a={layers:n,...i?{widgetId:i}:{},...l?{pageId:l}:{}},h=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),x=URL.createObjectURL(h),E=document.createElement("a");E.href=x,E.download=`${d.name}-${u}.json`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(x),o.success("JSON å·²ä¸‹è½½")}catch(n){o.error((n==null?void 0:n.message)||"å¯¼å‡ºå¤±è´¥")}finally{s()}},ps=()=>{if(!d)return"";const t=d.demoUrl,s=window.__LOCAL_IP__||"localhost",n=window.location.port||(window.location.protocol==="https:"?"443":"80");return`${window.location.protocol}//${s}:${n}${t}`},Ee=r.useMemo(()=>Bt.find(t=>t.id===K)||Bt[0],[K]);r.useEffect(()=>{Bt.some(s=>s.id===K)||J("desktop")},[K]);const[mt,fs]=r.useState({width:0,height:0});r.useEffect(()=>{if(Ee.id==="desktop"||Ee.width===0||!F.current){fs({width:0,height:0}),z(1);return}const t=()=>{if(!F.current)return;const s=F.current.clientWidth*.9,n=F.current.clientHeight*.9,i=Ee.width,l=Ee.height,x=24+8,E=(s-x)/i,A=(n-x)/l,re=Math.min(E,A),O=i*re,fe=l*re;fs({width:O,height:fe}),z(1)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[Ee,Q]);const _t=(t,s)=>{const n=t??$.width,i=s??$.height,l=Ke();if(l&&l.contentWindow){const a=ft(l);l.contentWindow.postMessage({type:"CAPTURE_SCREENSHOT",targetWidth:n,targetHeight:i},a)}};r.useEffect(()=>{if(st&&$.contentType==="screenshot"){const t=u==="pages"?1920:500,s=u==="pages"?1080:300;$.width===t&&$.height===s&&_t()}if(!st){const t=Ke();if(t&&t.contentWindow){const s=ft(t);t.contentWindow.postMessage({type:"RESET_SCREENSHOT_STYLES"},s)}}},[st,$.contentType,$.width,$.height]);const[Kn,Ot]=r.useState([]),Jn=window.location.port||(window.location.protocol==="https:"?"443":"80"),Mt=async()=>{try{const t=await fetch("/api/ws/clients");if(t.ok){const n=(await t.json()).clients||[];return Ot(n),n}else return Ot([]),[]}catch(t){return console.error("Failed to check WS clients",t),Ot([]),[]}};r.useEffect(()=>{Mt()},[]);const Xn=async()=>{if(!d){o.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¡ç›®");return}const t=o.loading("æ­£åœ¨æ£€æŸ¥è¿žæŽ¥...",0),s=await Mt();t(),s.length===0?p.confirm({title:"æœªæ£€æµ‹åˆ° Figma è¿žæŽ¥",content:e.jsxs("div",{children:[e.jsx("p",{children:"è¯·ç¡®ä¿ Figma æ’ä»¶å·²æ‰“å¼€å¹¶è¿žæŽ¥åˆ°å½“å‰æœåŠ¡ã€‚"}),e.jsxs("p",{style:{color:"#999",fontSize:12},children:["å½“å‰æœåŠ¡ç«¯å£: ",Jn]})]}),okText:"ä»è¦æŽ¨é€",cancelText:"å–æ¶ˆ",onOk:()=>ms()}):ms()},ms=async()=>{const t=o.loading("æ­£åœ¨èŽ·å–æ•°æ®...",0);try{const{layers:s,widgetId:n,pageId:i}=await hs();if(t(),!s||!Array.isArray(s)||s.length===0){o.error("å›¾å±‚æ•°æ®ä¸ºç©ºï¼Œæ— æ³•æŽ¨é€");return}let l;u==="elements"?(n||o.warning("å…ƒç´ ç¼ºå°‘ widgetIdï¼Œå¯èƒ½å¯¼è‡´åŒæ­¥å¤±è´¥"),l={type:"sync-widget-content",widgetId:n||`element-${(d==null?void 0:d.name)||"unknown"}-${Date.now()}`,data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}}):l={type:"sync-page-content",...i?{pageId:i}:{},data:{layers:s},blurImages:!1,metadata:{source:"extension",timestamp:Date.now()}};const a=o.loading("æ­£åœ¨æŽ¨é€åˆ° Figma...",0);try{const h=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(h.ok)await h.json(),o.success("æŽ¨é€æˆåŠŸ");else{const x=await h.text();throw new Error(x||"å‘é€å¤±è´¥")}}catch(h){o.error("æŽ¨é€å¤±è´¥: "+h.message)}finally{a()}}catch(s){t(),o.error((s==null?void 0:s.message)||"èŽ·å–æ•°æ®å¤±è´¥")}},qn=(t,s,n,i=2)=>new Promise((l,a)=>{const h=new Image,x=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),E=URL.createObjectURL(x);h.onload=()=>{const A=document.createElement("canvas");A.width=s*i,A.height=n*i;const re=A.getContext("2d");if(!re){a(new Error("Could not get canvas context"));return}re.drawImage(h,0,0,A.width,A.height),URL.revokeObjectURL(E),l(A.toDataURL("image/png"))},h.onerror=A=>{URL.revokeObjectURL(E),a(A)},h.src=E}),Yn=async()=>{if(d){Lt(!0);try{const t=window.location.origin+d.jsUrl,s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch code: ${s.statusText}`);const n=await s.text();let i="";if(d){const a=`${window.location.origin}/${u}/${d.name}/hack.css`;try{const h=await fetch(a);h.ok&&(i=await h.text())}catch(h){console.warn("fetch hack.css failed",h)}}const l=async(a=!1)=>{const h=`${window.location.origin}/${u}/${d.name}`,x=["spec","prd"],E={};for(const O of x){const fe=`${h}/${O}.md`;try{const je=await fetch(fe);if(je.ok){const ke=await je.text(),Ne={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};E[O]={name:Ne[O],content:ke}}}catch(je){console.warn(`Failed to fetch ${O}.md`,je)}}if(a){const O=`${u}/${d.name}`,fe=`${window.location.origin}/api/source?path=${encodeURIComponent(O)}`;try{const je=await fetch(fe);if(je.ok){const Ne=`\`\`\`tsx
${await je.text()}
\`\`\`
`;E.code={name:"å‚è€ƒä»£ç ",content:Ne}}}catch(je){console.warn("Failed to fetch source code",je)}}const A=Object.keys(E);return A.length>1?E:A.length===1?E[A[0]].content:null};if($.contentType==="screenshot"&&!$.rawScreenshotUrl){o.warning("æ­£åœ¨ç”Ÿæˆæˆªå›¾ï¼Œè¯·ç¨å€™..."),Lt(!1);return}try{let a="",h="";if($.includeConfig!=="none"&&(a=n,$.includeConfig==="codeAndDocs"||$.includeConfig==="codeAndDocsAndSource")){const Le=$.includeConfig==="codeAndDocsAndSource",Je=await l(Le);Je&&(h=Je)}const x=u==="elements"?"å…ƒç´ ":"é¡µé¢";let E="";if($.contentType==="title"){const Le=Ut("",$,d.displayName,x),Je=await qn(Le,$.width,$.height,2);E=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${$.width}" height="${$.height}" viewBox="0 0 ${$.width} ${$.height}">
                            <rect width="100%" height="100%" fill="transparent" />
                            <image x="0" y="0" width="${$.width}" height="${$.height}" preserveAspectRatio="xMidYMin meet" xlink:href="${Je}"/>
                        </svg>`}else E=Ut($.rawScreenshotUrl,$,d.displayName,x);const re=new DOMParser().parseFromString(E,"image/svg+xml"),O=re.querySelector("svg");if(!O)throw new Error("SVG generation failed");if(a||h){const Le={code:a,spec:h};O.setAttribute("AxExtraData",encodeURIComponent(JSON.stringify(Le)))}if($.includeConfig!=="none"){const Le={time:Math.floor(Date.now()/1e3),config:{codeLink:t,...u==="pages"?{isFullScreen:!0}:{},...i?{hackCss:i}:{}}};O.setAttribute("AxData",encodeURIComponent(JSON.stringify(Le)))}const je=new XMLSerializer().serializeToString(re),ke=new Blob([je],{type:"image/svg+xml;charset=utf-8"}),Ne=URL.createObjectURL(ke),xe=document.createElement("a");xe.href=Ne,xe.download=`${d.name}.svg`,document.body.appendChild(xe),xe.click(),document.body.removeChild(xe),URL.revokeObjectURL(Ne),o.success("SVG å¯¼å‡ºæˆåŠŸ"),Nt(!1)}catch(a){console.error("Image export failed:",a),o.error("å›¾ç‰‡å¯¼å‡ºå¤±è´¥")}}catch(t){o.error(`å¯¼å‡ºå¤±è´¥: ${t.message}`),console.error("å¯¼å‡ºå¤±è´¥:",t)}finally{Lt(!1)}}},Zn=async t=>{if(!d)throw new Error("æœªé€‰æ‹©é¡¹ç›®");const s=window.location.origin+d.jsUrl,n=await fetch(s);if(!n.ok)throw new Error(`Failed to fetch code: ${n.statusText}`);const i=await n.text();let l="";const a=`${window.location.origin}/${u}/${d.name}/hack.css`;try{const E=await fetch(a);E.ok&&(l=await E.text())}catch{}const h=async(E=!1)=>{const A=`${window.location.origin}/${u}/${d.name}`,re=["spec","prd"],O={};for(const ke of re){const Ne=`${A}/${ke}.md`;try{const xe=await fetch(Ne);if(xe.ok){const Le=await xe.text(),Je={spec:"è§„æ ¼æ–‡æ¡£",prd:"éœ€æ±‚æ–‡æ¡£"};O[ke]={name:Je[ke],content:Le}}}catch(xe){console.warn(`Failed to fetch ${ke}.md`,xe)}}if(E){const ke=`${u}/${d.name}`,Ne=`${window.location.origin}/api/source?path=${encodeURIComponent(ke)}`;try{const xe=await fetch(Ne);if(xe.ok){const Je=`\`\`\`tsx
${await xe.text()}
\`\`\`
`;O.code={name:"å‚è€ƒä»£ç ",content:Je}}}catch(xe){console.warn("Failed to fetch source code",xe)}}const fe=Object.keys(O);return fe.length>1?O:fe.length===1?O[fe[0]].content:null},x={time:Math.floor(Date.now()/1e3),config:{code:i,...u==="pages"?{isFullScreen:!0}:{},...l?{hackCss:l}:{}}};if(t==="codeAndDocs"||t==="codeAndDocsAndSource"){const A=await h(t==="codeAndDocsAndSource");A&&(x.config.spec=A)}return JSON.stringify(x,null,2)},Qn=ae||V.mode==="webEditorV2"?"webEditorV2":V.mode,eo=ae||V.mode==="webEditorV2"?ee.current??void 0:void 0,to=d?jr(d,ue,Qn,{width:eo}):"",so=t=>{const s=window.location.origin+t.demoUrl;window.open(s,"_blank")},no=()=>{et("button",ze,void 0,"window")};return e.jsxs(gt,{style:{minHeight:"100vh"},children:[b,e.jsx("style",{children:`
                .resize-handle-right {
                    cursor: ew-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-right::before {
                    content: '';
                    position: absolute;
                    right: 50%;
                    top: 50%;
                    transform: translate(50%, -50%);
                    width: 2px;
                    height: 40px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-right:hover::before,
                .resize-handle-right:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 3px;
                    height: 50px;
                }
                .resize-handle-bottom {
                    cursor: ns-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottom::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    bottom: 50%;
                    transform: translate(-50%, 50%);
                    width: 40px;
                    height: 2px;
                    background: var(--ant-color-border);
                    border-radius: 1px;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottom:hover::before,
                .resize-handle-bottom:active::before {
                    background: var(--ant-color-text-secondary);
                    width: 50px;
                    height: 3px;
                }
                .resize-handle-bottomRight {
                    cursor: nwse-resize !important;
                    z-index: 100 !important;
                }
                .resize-handle-bottomRight::before {
                    content: '';
                    position: absolute;
                    right: 0;
                    bottom: 0;
                    width: 12px;
                    height: 12px;
                    background: var(--ant-color-border);
                    border-radius: 0 0 6px 0;
                    transition: all 0.2s;
                    z-index: 100;
                }
                .resize-handle-bottomRight:hover::before,
                .resize-handle-bottomRight:active::before {
                    background: var(--ant-color-border-secondary);
                    width: 16px;
                    height: 16px;
                }
                /* å®¹å™¨æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹æŸ„ */
                .ant-card-hoverable:hover .resize-handle-right::before,
                .ant-card-hoverable:hover .resize-handle-bottom::before,
                .ant-card-hoverable:hover .resize-handle-bottomRight::before {
                    background: var(--ant-color-border-secondary);
                }

                /* èœå•é¡¹ hover æ—¶æ˜¾ç¤ºæ›´å¤šæŒ‰é’® */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }

                /* ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ */
                @media (max-width: 768px) {
                    /* éšè— PC ç«¯çš„å®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: none !important;
                    }
                    
                    /* æ˜¾ç¤ºç§»åŠ¨ç«¯ç®€åŒ–å¸ƒå±€ */
                    .mobile-layout {
                        display: block !important;
                    }
                }

                @media (min-width: 769px) {
                    /* PC ç«¯æ˜¾ç¤ºå®Œæ•´å¸ƒå±€ */
                    .pc-layout {
                        display: block !important;
                    }
                    
                    /* éšè—ç§»åŠ¨ç«¯å¸ƒå±€ */
                    .mobile-layout {
                        display: none !important;
                    }
                }

                /* ç§»åŠ¨ç«¯åˆ—è¡¨æ ·å¼ */
                .mobile-item-card {
                    background: ${f?"#1f1f1f":"#fff"};
                    border: 1px solid ${f?"#303030":"#f0f0f0"};
                    border-radius: 8px;
                    padding: 16px;
                    margin-bottom: 12px;
                    cursor: pointer;
                    transition: all 0.2s;
                }

                .mobile-item-card:hover {
                    border-color: ${f?"#177ddc":"#1890ff"};
                    box-shadow: 0 2px 8px ${f?"rgba(0,0,0,0.3)":"rgba(0,0,0,0.1)"};
                }

                .mobile-item-card:active {
                    transform: scale(0.98);
                }

                .mobile-item-title {
                    font-size: 16px;
                    font-weight: 500;
                    color: ${f?"#fff":"#000"};
                    margin-bottom: 4px;
                }

                .mobile-item-name {
                    font-size: 12px;
                    color: ${f?"#8c8c8c":"#999"};
                }
            `}),e.jsxs("div",{className:"pc-layout",children:[e.jsx(ir,{collapsed:Q,setCollapsed:y,selectedItem:d,viewMode:ue,setViewMode:Fs,activeTab:u,selectedDeviceId:K,setSelectedDeviceId:J,deviceSegmentOptions:vn,handleOpenInspect:On,handleOpenWebEditor:Fn,handleExitWebEditor:ds,handleSaveWebEditor:Wn,handleEnableTextEdit:Hn,handleSaveTextEdit:()=>us(!1),handleExitTextEdit:Vn,handleRefreshElement:Un,handleCopyLocalLink:gn,handleCopyLANLink:yn,handleDownloadZip:wn,getLANUrl:ps,qrCodeVisible:Fe,setQrCodeVisible:Te,wsClients:Kn,checkConnection:Mt,handlePushToFigma:Xn,handleDownloadFigmaJson:Gn,setIsExportModalOpen:Nt,handleOpenIdeFile:bn,handleOpenProjectInIDE:jn,preferredIDE:we,onPreferredIDEChange:Re,isDarkMode:f,setIsDarkMode:v,currentSpecDocKey:lt,textEditState:C,textEditAvailable:Mn,editorMode:V.mode,handleRefreshEditorStatus:Ge,onSettingsSaved:()=>{Xe.getConfig().then(t=>{var s,n;Ae(It((s=t==null?void 0:t.automation)==null?void 0:s.defaultPromptClient)),Re(((n=t==null?void 0:t.automation)==null?void 0:n.defaultIDE)||null)}).catch(()=>{Ae(null),Re(null)})},assistantEnabled:!0,assistantVisible:X,onToggleAssistant:xn}),e.jsxs(gt,{children:[e.jsx(tr,{collapsed:Q,loading:G,activeTab:u,handleTabChange:cs,data:U,searchText:M,setSearchText:_,filteredItems:jt,selectedItem:d,handleMenuClick:Ln,handleDownloadItemSource:Tn,handleRenameItem:Rn,handleSetReference:kn,handleUnsetReference:An,handleDuplicateItem:Nn,handleDeleteItem:Dn,handleCopyItemPath:Sn,setCreateDialogVisible:nn,preferredPromptClient:Ce,preferredIDE:we}),e.jsxs("div",{style:{display:"flex",flex:1,minWidth:0},children:[e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(ur,{containerRef:F,previewIframeRef:le,selectedItem:d,activeTab:u,currentDevice:Ee,displaySize:mt,scale:de,elementIframeKey:Ue,iframeUrl:to,elementIframeSize:$e,setElementIframeSize:ve,viewMode:ue})}),X&&e.jsx(Os,{size:{width:Math.min(Math.max(Qe,D),Pt),height:"100%"},minWidth:D,maxWidth:Pt,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(t,s,n)=>{const i=Math.min(Math.max(n.getBoundingClientRect().width,D),Pt);g(i)},style:{borderLeft:`1px solid ${ie.colorBorderSecondary}`,background:ie.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:m,src:ze,title:"Axhub Genie",onLoad:()=>P(!0),style:{border:"none",width:"100%",height:"100%"}})})]})]}),e.jsx(fr,{visible:Ws,onClose:mn,activeTab:u,createName:Hs,setCreateName:on,createReference:Vs,setCreateReference:rn,createMode:Gs,setCreateMode:an,generateAxure:Ks,setGenerateAxure:ln,referenceItems:Js,selectedDocs:Qs,setSelectedDocs:un,availableDocs:en,selectedThemes:Xs,setSelectedThemes:cn,availableThemes:qs,selectedDataAssets:tn,setSelectedDataAssets:hn,availableDataAssets:sn,selectedLibraries:Ys,setSelectedLibraries:dn,availableLibraries:Zs,preferredPromptClient:Ce,preferredIDE:we,buildCreatePrompt:pn,onAfterCreatePromptAction:fn}),e.jsx(qo,{open:st,onClose:()=>Nt(!1),imageConfig:$,setImageConfig:_e,onDimensionChange:En,onSwapDimensions:$n,onDimensionBlur:In,isExporting:Cn,onExport:Yn,onCopyConfig:Zn,activeTab:u,itemName:d==null?void 0:d.name,preferredPromptClient:Ce,preferredIDE:we})]}),e.jsx("div",{className:"mobile-layout",style:{display:"none"},children:e.jsxs("div",{style:{padding:"16px",minHeight:"100vh",background:f?"#141414":"#f5f5f5"},children:[e.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{children:e.jsxs("h1",{style:{margin:0,fontSize:"24px",fontWeight:600,color:f?"#fff":"#000"},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]})}),e.jsx(Y,{type:"default",icon:e.jsx(ts,{}),onClick:no,children:"ç½‘é¡µåŠ©æ‰‹"})]}),e.jsx(es,{activeKey:u,onChange:t=>cs(t),style:{marginBottom:"16px"},items:[{key:"pages",label:`é¡µé¢ (${U.pages.length})`,icon:e.jsx(rt,{})},{key:"elements",label:`å…ƒç´  (${U.elements.length})`,icon:e.jsx(Yt,{})}]}),e.jsx(Be,{placeholder:"æœç´¢...",prefix:e.jsx(Ls,{}),value:M,onChange:t=>_(t.target.value),allowClear:!0,style:{marginBottom:"16px"}}),G?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(xt,{tip:"åŠ è½½ä¸­..."})}):e.jsx("div",{children:jt.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:f?"#8c8c8c":"#999"},children:["æš‚æ— ",u==="elements"?"å…ƒç´ ":"é¡µé¢"]}):jt.map(t=>e.jsxs("div",{className:"mobile-item-card",onClick:()=>so(t),children:[e.jsx("div",{className:"mobile-item-title",children:t.displayName}),e.jsx("div",{className:"mobile-item-name",children:t.name})]},t.name))})]})}),b,j]})}function Ir(){const[f,v]=r.useState(()=>{try{return localStorage.getItem(ws)==="true"}catch{return!1}}),c=w=>{v(w);try{localStorage.setItem(ws,String(w))}catch(T){console.error("Failed to save dark mode preference:",T)}};return e.jsx(Fo,{theme:Ko(f),children:e.jsx(Wo,{children:e.jsx(Er,{isDarkMode:f,setIsDarkMode:c})})})}const $r=Bo.createRoot(document.getElementById("root"));$r.render(e.jsx(Ir,{}));
