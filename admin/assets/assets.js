import{P as _e,o as Qe,S as et,a as We,n as Lt,t as Dt,A as tt}from"./chunks/PromptActionButton.js";import{T as Ee,U as xe,s as Pe,t as Ae,r as n,j as e,M as Se,R as at,C as it,B as lt,a as Ve,S as be,b as X,c as ct,d as Ut,e as dt,f as ut,g as _t,L as ve,h as pe,i as Mt,k as Ot,l as Ft,m as Bt,n as ft,o as Ge,p as He,q as mt,u as we,v as ht,w as zt,D as Ke,x as Wt,y as Vt,z as Gt,A as Ht,E as Kt,F as Jt,G as Je,I as me,H as Xt,J as pt,K as re,N as qt,O as xt,P as Zt,Q as gt,V as yt,W as jt,X as st,Y as Yt,Z as De,_ as Qt,$ as es,a0 as ts,a1 as ss,a2 as wt,a3 as ns,a4 as os,a5 as rs,a6 as as,a7 as is,a8 as ls,a9 as cs,aa as ds}from"./chunks/vendor.js";import{g as us}from"./chunks/index.js";import"./chunks/execute.js";const{Text:Ue}=Ee,{Dragger:nt}=xe,fs=({open:S,onCancel:F,preferredPromptClient:i,preferredIDE:l})=>{const[j,k]=Pe.useMessage(),{token:D}=Ae.useToken(),[d,P]=n.useState(null),[W,E]=n.useState([]),[M,L]=n.useState(!1),[B,U]=n.useState(null),[I,h]=n.useState([]),[z,f]=n.useState(!1),[K,N]=n.useState(null),[J,A]=n.useState(null);n.useEffect(()=>{S||(P(null),E([]),L(!1),U(null),h([]),f(!1),N(null),A(null))},[S]);const ee=[{key:"local_axure",title:"本地 Axure 文件导入",icon:e.jsx(ct,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePaths:["/skills/local-axure-workflow/SKILL.md"],disabled:!1,recommended:!0},{key:"axure_prototype",title:"Axure 原型链接导入",icon:e.jsx(Ut,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePaths:["/skills/axure-prototype-workflow/SKILL.md","/skills/axure-prototype-workflow/asset-extraction.md","/skills/axure-prototype-workflow/page-restoration.md"],disabled:!1},{key:"web_page",title:"产品网页链接导入",icon:e.jsx(dt,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePaths:["/skills/web-page-workflow/SKILL.md","/skills/web-page-workflow/asset-extraction.md","/skills/web-page-workflow/page-restoration.md"],disabled:!1},{key:"screenshot",title:"App/小程序/网页截图导入",icon:e.jsx(ut,{style:{fontSize:24,color:"#faad14"}}),desc:"上传多张截图，提取结构/交互/状态数据，并生成页面/元素",rulePaths:["skills/screen-to-code/SKILL.md","skills/screen-to-code/screenshot-collection.md"],disabled:!1},{key:"app_direct",title:"App/小程序直接导入",icon:e.jsx(_t,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePaths:[],disabled:!0}],r=d&&ee.find(a=>a.key===d)||null,T=(a,y)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「${a}」设计资产。

请认真阅读规则文档：
${y.map(G=>`- \`${G}\``).join(`
`)}
并按文档定义的交互指南回复用户。`,t=(a,y)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「基于${a}导入资产」。

**交互要求**：
- 收到本条系统指令后，先根据 skill 的用户交互指南用简短中文回复一次，确认需求，并引导用户提供 ${a}（URL）
- 未拿到链接前，不要生成任何文件
- 参考下方文档，按流程逐步引导用户完成导入与还原/优化

**📋 参考文档（必须阅读）**：
${y.map(G=>`- \`${G}\``).join(`
`)}`,C=a=>{P(a),E([]),U(null),h([]),N(null),A(null)},_=async a=>{const{file:y,onSuccess:G,onError:se}=a,q=y instanceof File?y:y.originFileObj,oe=new FormData;oe.append("file",q,q.name),oe.append("uploadType","local_axure"),L(!0);try{const H=await fetch("/api/upload",{method:"POST",body:oe}),Z=await H.json();H.ok&&Z.success?(U(Z),j.success(Z.message||"文件已解压，请复制 Prompt 交给 AI 处理"),G(null,y)):(j.error(Z.error||"上传失败"),se(new Error(Z.error||"上传失败")))}catch(H){j.error("上传失败: "+((H==null?void 0:H.message)||"Unknown error")),se(H)}finally{L(!1)}},u=async a=>{const{file:y,onSuccess:G,onError:se}=a,q=y instanceof File?y:y.originFileObj,oe=new FormData;oe.append("file",q,q.name),J&&oe.append("batchId",J),f(!0);try{const H=await fetch("/api/upload-screenshots",{method:"POST",body:oe}),Z=await H.json();H.ok&&Z.success?(N(Z),A(Z.batchId||J),j.success(Z.message||"截图已上传，请复制 Prompt 交给 AI 处理"),G(null,y)):(j.error(Z.error||"上传失败"),se(new Error(Z.error||"上传失败")))}catch(H){j.error("上传失败: "+((H==null?void 0:H.message)||"Unknown error")),se(H)}finally{f(!1)}},v=!r||r.disabled?!1:r.key==="local_axure"?!!(B!=null&&B.prompt):r.key==="screenshot"?!!(K!=null&&K.prompt):!0,w=()=>!r||r.disabled?"":r.key==="local_axure"?(B==null?void 0:B.prompt)||"":r.key==="screenshot"?(K==null?void 0:K.prompt)||"":r.key==="axure_prototype"?t("Axure 原型链接",r.rulePaths):r.key==="web_page"?t("网页链接",r.rulePaths):T(r.title,r.rulePaths);return e.jsxs(Se,{title:"智能导入资产",open:S,onCancel:F,footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:8,width:"100%"},children:[e.jsx(X,{onClick:F,children:"取消"},"cancel"),e.jsx(_e,{preferredClient:i,preferredIDE:l,scene:`assets-smart-import-${(r==null?void 0:r.key)||"unknown"}`,buildPrompt:w,disabled:!v,copyLabel:"复制新建 Prompt",style:{flex:"0 0 auto"},executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy")]}),width:800,destroyOnClose:!0,children:[k,e.jsx(at,{gutter:[16,16],children:ee.map((a,y)=>e.jsx(it,{span:12,children:e.jsx(lt.Ribbon,{text:"推荐",color:"#008F5D",style:{display:a.recommended?"block":"none"},children:e.jsx(Ve,{hoverable:!a.disabled,style:{height:"100%",cursor:a.disabled?"not-allowed":"pointer",opacity:a.disabled?.6:1,background:a.disabled?"#f5f5f5":d===a.key?D.colorFillAlter:void 0,borderColor:d===a.key?D.colorInfo:void 0},onClick:()=>{a.disabled||C(a.key)},children:e.jsxs(be,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:a.disabled?"#e8e8e8":a.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:a.icon}),e.jsxs("div",{children:[e.jsx(Ue,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:a.title}),e.jsx(Ue,{type:"secondary",style:{fontSize:13},children:a.desc})]})]})})})},y))}),d==="local_axure"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(nt,{name:"file",multiple:!1,fileList:W,customRequest:_,beforeUpload:a=>{var G;return a.type==="application/zip"||a.type==="application/x-zip-compressed"||((G=a.name)==null?void 0:G.endsWith(".zip"))?!0:(j.error("请上传 ZIP 格式的文件"),xe.LIST_IGNORE)},onChange:a=>E(a.fileList.slice(-1)),onRemove:()=>{E([]),U(null)},accept:".zip",disabled:M,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽 ZIP 文件上传"}),e.jsx(Ue,{type:"secondary",style:{fontSize:12},children:"上传后会解压到本地 temp 目录，并生成可复制的 Prompt"})]})})}),d==="screenshot"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(nt,{name:"file",multiple:!0,fileList:I,customRequest:u,beforeUpload:a=>typeof(a==null?void 0:a.type)=="string"&&a.type.startsWith("image/")?!0:(j.error("请上传图片格式的文件（png/jpg/webp 等）"),xe.LIST_IGNORE),onChange:a=>h(a.fileList),onRemove:()=>{h([]),N(null),A(null)},accept:"image/*",disabled:z,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽多张截图上传"}),e.jsx(Ue,{type:"secondary",style:{fontSize:12},children:"上传完成后点击底部「复制 Prompt」，让 AI 按文档流程完成截图转代码"})]})})})]})},{Header:ms}=ve,{useToken:hs}=Ae,ps=({collapsed:S,setCollapsed:F,activeTab:i,onTabChange:l,counts:j,isDarkMode:k,setIsDarkMode:D,assistantEnabled:d=!1,assistantVisible:P=!1,onToggleAssistant:W,preferredPromptClient:E,preferredIDE:M})=>{const[L,B]=pe.useState(null),[U,I]=pe.useState(!1),{token:h}=hs();return pe.useEffect(()=>{let z=!1;return fetch("/api/version").then(f=>f.ok?f.json():Promise.reject(new Error("Request failed"))).then(f=>{if(z)return;const K=typeof(f==null?void 0:f.version)=="string"?f.version:null;B(K)}).catch(()=>{z||B(null)}),()=>{z=!0}},[]),e.jsxs(ms,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:h.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${h.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[i!=="media"&&e.jsx(X,{type:"text",icon:S?e.jsx(Mt,{}):e.jsx(Ot,{}),onClick:()=>F(!S),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:i==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:h.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(Ft,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Bt,{value:i,size:"small",shape:"round",style:{fontSize:"12px"},onChange:z=>l(z),options:[{label:`主题 (${j.themes})`,value:"themes",icon:e.jsx(ft,{})},{label:`文档 (${j.docs})`,value:"docs",icon:e.jsx(Ge,{})},{label:`前端库 (${j.libraries})`,value:"libraries",icon:e.jsx(He,{})},{label:`数据 (${j.data})`,value:"data",icon:e.jsx(mt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(we,{title:"使用 AI 智能导入资产",children:e.jsx(X,{size:"small",icon:e.jsx(ht,{}),onClick:()=>I(!0),children:"智能导入资产"})}),e.jsx(fs,{open:U,onCancel:()=>I(!1),preferredPromptClient:E??null,preferredIDE:M??null}),d&&e.jsx(we,{title:P?"关闭 Axhub Genie":"打开 Axhub Genie",children:e.jsx(lt,{dot:!0,status:P?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:P?"inline-flex":"none"}},children:e.jsx(X,{type:"text",size:"small",icon:e.jsx(zt,{}),onClick:W})})}),e.jsx(Ke,{menu:{items:[{key:"theme",label:k?"浅色模式":"深色模式",icon:k?e.jsx(Vt,{}):e.jsx(Gt,{}),onClick:()=>D(!k)},{type:"divider"},{key:"help",label:"帮助中心",icon:e.jsx(Ht,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(Kt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(dt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(Jt,{}),extra:e.jsx("span",{style:{fontSize:12,color:h.colorTextSecondary},children:L?`v${L}`:"-"})}]},placement:"bottomRight",children:e.jsx(X,{type:"text",icon:e.jsx(Wt,{})})})]})]})},{Sider:xs}=ve,{useToken:gs}=Ae,ys=({collapsed:S,loading:F,activeTab:i,themes:l,docs:j,libraries:k,dataTables:D,selectedTheme:d,selectedDoc:P,selectedLibrary:W,selectedDataTable:E,onThemeSelect:M,onDocSelect:L,onLibrarySelect:B,onDataTableSelect:U,onDeleteAsset:I,onRenameAsset:h,onCreateClick:z,searchText:f,setSearchText:K,preferredPromptClient:N,preferredIDE:J,createPromptConfig:A})=>{const{token:ee}=gs(),{message:r,modal:T}=Je.useApp(),t=async o=>{const p=await fetch("/api/themes/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:o})});if(!p.ok){const b=await p.json().catch(()=>({}));throw new Error(b.error||"检查主题引用失败")}return p.json()},C=pe.useMemo(()=>{if(!f)return l;const o=f.toLowerCase();return l.filter(p=>p.displayName.toLowerCase().includes(o)||p.name.toLowerCase().includes(o))},[l,f]),_=pe.useMemo(()=>{if(!f)return j;const o=f.toLowerCase();return j.filter(p=>p.displayName.toLowerCase().includes(o)||p.name.toLowerCase().includes(o))},[j,f]),u=pe.useMemo(()=>{if(!f)return k;const o=f.toLowerCase();return k.filter(p=>p.displayName.toLowerCase().includes(o)||p.name.toLowerCase().includes(o))},[k,f]),v=pe.useMemo(()=>{if(!f)return D;const o=f.toLowerCase();return D.filter(p=>p.tableName.toLowerCase().includes(o)||p.fileName.toLowerCase().includes(o))},[D,f]),w=["vscode","cursor"],a=o=>new Promise(p=>setTimeout(p,o)),y=async(o,p)=>{const b=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:o,payload:p,targetClientTypes:w})}),Y=await b.json().catch(()=>null);return b.ok&&!!(Y!=null&&Y.sent)},G=async(o,p,b=!1)=>{const Y=b?10:1;let Q=!1;for(let O=0;O<Y;O+=1){if(await y("handshake","prototype-admin")){Q=!0;break}O<Y-1&&await a(500)}if(!Q)return!1;const ne=b?3:1;for(let O=0;O<ne;O+=1){if(await y("open-file",o)||p&&await y("open-file",p))return!0;O<ne-1&&await a(300)}return!1},se=async o=>{let p="",b="";const Y="tableName"in o?o.tableName:o.displayName,Q="fileName"in o?o.fileName:o.name;if(i==="docs"?(p=`assets/docs/${Q}`,b=`[${Y}](assets/docs/${Q})`):i==="themes"?(p=`src/themes/${Q}/index.tsx`,b=`[${Y}](src/themes/${Q})`):i==="libraries"?(p=`assets/libraries/${Q}.md`,b=`[${Y}](assets/libraries/${Q}.md)`):i==="data"&&(p=`assets/database/${Q}.json`,b=`[${Y}](assets/database/${Q}.json)`),!p){r.warning("无法获取文件路径");return}const ne=r.loading("正在发送到 IDE...",0);try{b&&await navigator.clipboard.writeText(b);const O=await Qe({preferredIDE:J,targetPath:p});if(!await G(p,void 0,O)){r.info("编辑器正在启动中，已复制文件标题，可稍后在编辑器中打开");return}r.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(O){console.error("Failed to open in IDE:",O),r.error((O==null?void 0:O.message)||"发送失败")}finally{ne()}},q=(o,p)=>{const b=i==="themes"&&"name"in o&&(d==null?void 0:d.name)===o.name||i==="docs"&&"name"in o&&(P==null?void 0:P.name)===o.name||i==="libraries"&&"name"in o&&(W==null?void 0:W.name)===o.name||i==="data"&&"fileName"in o&&(E==null?void 0:E.fileName)===o.fileName,Y=i==="themes"&&"hasDoc"in o&&o.hasDoc,Q=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(He,{})},{key:"delete",label:`删除${i==="themes"?"主题":i==="docs"?"文档":i==="data"?"数据表":"前端库"}`,icon:e.jsx(Zt,{}),danger:!0}];Y&&Q.splice(1,0,{key:"open-doc-in-ide",label:"在编辑器中打开规范文档",icon:e.jsx(Ge,{}),danger:!1}),(i==="data"||i==="themes"||i==="docs")&&Q.unshift({key:"rename",label:"重命名",icon:e.jsx(gt,{}),danger:!1});const ne="tableName"in o?o.tableName:o.displayName,O="fileName"in o?o.fileName:o.name;return{key:O,icon:p,label:e.jsxs("div",{className:`menu-item-wrapper ${b?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:ne})}),e.jsx(Ke,{trigger:["click"],menu:{items:Q,onClick:async({key:ie})=>{if(ie==="open-in-ide")se(o);else if(ie==="open-doc-in-ide"){const de="name"in o?o.name:"";if(!de)return;const ue=`src/themes/${de}/README.md`,ye=`src/themes/${de}/DESIGN-SPEC.md`,Ce=`[${ne} 规范文档](${ue})`,te=r.loading("正在发送到 IDE...",0);try{await navigator.clipboard.writeText(Ce);const le=await Qe({preferredIDE:J,targetPath:ue});if(!await G(ue,ye,le)){r.info("编辑器正在启动中，已复制文件标题，可稍后在编辑器中打开");return}r.success("已在编辑器中打开规范文档，并复制了文件标题")}catch(le){console.error("Failed to open doc in IDE:",le),r.error((le==null?void 0:le.message)||"发送失败")}finally{te()}}else if(ie==="rename")h==null||h(i,o);else if(ie==="delete")if(i==="themes"){const de=r.loading("正在检查主题引用...",0);try{const ce=await t(O),ue=Array.isArray(ce==null?void 0:ce.references)?ce.references:[];if(ue.length>0){const ye=ue.map(te=>`- ${te}`).join(`
`),Ce=`我希望删除主题 "${ne}" (${O})。
该主题位于项目中的相对路径为：\`src/themes/${O}\`

已检测到以下文件引用了该主题的 \`designToken.json\` 或 \`globals.css\`：
${ye}

请帮我执行以下检查和操作：
1. 核对上述引用是否准确，并补充遗漏的引用文件（优先检查 \`src/elements/\` 与 \`src/pages/\`）。
2. 如果确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 或 \`globals.css\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，使这些原型脱离对该主题目录的依赖。
3. 完成上述解耦操作后，再彻底删除主题目录 \`src/themes/${O}\`。

主题目录内容规范（至少包含 globals.css 或 designToken.json 其中之一）：
\`\`\`
src/themes/<theme-key>/
├── globals.css
├── designToken.json
└── index.tsx
\`\`\``;T.confirm({title:"检测到主题引用",width:720,cancelText:"取消",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"已检测到以下文件引用了该主题："}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:ye}),e.jsx("div",{style:{marginTop:12},children:e.jsx(_e,{preferredClient:N,preferredIDE:J,scene:"assets-theme-delete-ref-fix",buildPrompt:()=>Ce,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"})})]}),footer:(te,{CancelBtn:le})=>e.jsx(le,{})})}else T.confirm({title:`确认删除主题 "${ne}" 吗？`,content:"未检测到引用文件。删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk(){I(i,O,ne)}})}catch(ce){r.error(ce.message||"检查主题引用失败")}finally{de()}}else I(i,O,ne)}},children:e.jsx(X,{type:"text",size:"small",className:"more-btn",icon:e.jsx(xt,{}),onClick:ie=>{ie.stopPropagation()}})})]})}},oe=C.map(o=>q(o,e.jsx(ft,{}))),H=_.map(o=>q(o,e.jsx(Ge,{}))),Z=u.map(o=>q(o,e.jsx(He,{}))),he=v.map(o=>q(o,e.jsx(mt,{}))),Te=({key:o})=>{if(i==="themes"){const p=l.find(b=>b.name===o);p&&M(p)}else if(i==="docs"){const p=j.find(b=>b.name===o);p&&L(p)}else if(i==="libraries"){const p=k.find(b=>b.name===o);p&&B(p)}else if(i==="data"){const p=D.find(b=>b.fileName===o);p&&U(p)}},ge=i==="themes"?oe:i==="docs"?H:i==="data"?he:Z,ke=i==="themes"?d==null?void 0:d.name:i==="docs"?P==null?void 0:P.name:i==="data"?E==null?void 0:E.fileName:W==null?void 0:W.name;return e.jsx(xs,{trigger:null,collapsible:!0,collapsed:S||i==="media",width:240,collapsedWidth:0,style:{background:ee.colorBgContainer,borderRight:`1px solid ${ee.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:i==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!S&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(me,{placeholder:"搜索...",prefix:e.jsx(Xt,{}),value:f,onChange:o=>K(o.target.value),allowClear:!0,style:{flex:1}})})})}),F?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(pt,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[ge.length===0?e.jsx(re,{image:re.PRESENTED_IMAGE_SIMPLE,description:f?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(qt,{mode:"inline",selectedKeys:ke?[ke]:[],items:ge,onClick:Te,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!S&&e.jsx("div",{style:{position:"absolute",left:16,right:16,bottom:20},children:A?e.jsx(_e,{preferredClient:N,preferredIDE:J,scene:A.scene,buildPrompt:A.buildPrompt,type:"primary",block:!0,copyLabel:"复制新建 Prompt",executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"}):e.jsx(X,{type:"primary",block:!0,onClick:z,children:`新建${i==="data"?"数据表":i==="docs"?"文档":i==="themes"?"主题":"前端库"}`})})]})})};function js({fileName:S,tableName:F,onImportComplete:i}){const[l,j]=n.useState(!1),[k,D]=n.useState(null),[d,P]=n.useState(null),[W,E]=n.useState([]),[M,L]=n.useState([]),[B,U]=n.useState(!1),[I,h]=Pe.useMessage(),z=()=>{j(!0),D(null),P(null),E([]),L([])},f=()=>{j(!1),D(null),P(null),E([]),L([])},K=r=>r.length>=3&&r[0]===239&&r[1]===187&&r[2]===191?{encoding:"utf-8",offset:3}:r.length>=2&&r[0]===255&&r[1]===254?{encoding:"utf-16le",offset:2}:r.length>=2&&r[0]===254&&r[1]===255?{encoding:"utf-16be",offset:2}:null,N=async r=>{const T=await r.arrayBuffer(),t=new Uint8Array(T),C=K(t);if(C)return new TextDecoder(C.encoding).decode(t.subarray(C.offset));try{return new TextDecoder("utf-8",{fatal:!0}).decode(t)}catch{const u=["gb18030","gbk"];for(const v of u)try{return new TextDecoder(v).decode(t)}catch{continue}}return new TextDecoder("utf-8").decode(t)},J=(r,T,t)=>{st.parse(r,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:T,error:t})},A=async r=>{D(r),P(null);try{const T=await N(r);P(T),J(T,t=>{if(t.errors.length>0){I.error("CSV解析失败: "+t.errors[0].message);return}const C=t.data.slice(0,10);if(E(C),t.data.length>0){const _=t.data[0],u=Object.keys(_).map(v=>({title:v,dataIndex:v,key:v,ellipsis:!0,render:w=>w==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof w=="object"?JSON.stringify(w):String(w)}));L(u)}},t=>{I.error("CSV解析失败: "+t.message)})}catch(T){I.error((T==null?void 0:T.message)||"CSV读取失败")}return!1},ee=async()=>{if(!k){I.error("请先选择CSV文件");return}U(!0);const r=I.loading("正在导入数据...",0);try{const T=d??await N(k);J(T,async t=>{try{if(t.errors.length>0)throw new Error("CSV解析失败: "+t.errors[0].message);const C=st.unparse(t.data,{quotes:!0,header:!0}),_=await fetch(`/api/data/${encodeURIComponent(S)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:C})});if(!_.ok){const v=await _.json();throw new Error(v.error||"导入失败")}const u=await _.json();I.success(`导入成功！共导入 ${u.recordCount} 条记录`),j(!1),D(null),P(null),E([]),L([]),i()}catch(C){I.error(C.message||"导入失败")}finally{r(),U(!1)}},t=>{I.error("CSV解析失败: "+t.message),r(),U(!1)})}catch(T){I.error(T.message||"导入失败"),r(),U(!1)}};return e.jsxs(e.Fragment,{children:[h,e.jsx(X,{icon:e.jsx(ht,{}),onClick:z,size:"small",children:"导入CSV"}),e.jsx(Se,{title:`导入CSV到 "${F}"`,open:l,onCancel:f,onOk:ee,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:B,okButtonProps:{disabled:!k},children:e.jsxs(be,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(xe,{accept:".csv",beforeUpload:A,maxCount:1,fileList:k?[{uid:"-1",name:k.name,status:"done"}]:[],onRemove:()=>{D(null),P(null),E([]),L([])},children:e.jsx(X,{icon:e.jsx(yt,{}),children:"选择CSV文件"})})}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(jt,{columns:M,dataSource:W,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(r,T)=>(T==null?void 0:T.toString())||"0"}),W.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function ws({fileName:S}){const[F,i]=n.useState(!1),[l,j]=Pe.useMessage(),k=async()=>{i(!0);const D=l.loading("正在导出数据...",0);try{const d=await fetch(`/api/data/${encodeURIComponent(S)}/export`);if(!d.ok){const L=await d.json();throw new Error(L.error||"导出失败")}const P=await d.text(),W=new Blob([P],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(W),M=document.createElement("a");M.href=E,M.download=`${S}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(E),l.success("导出成功")}catch(d){l.error(d.message||"导出失败")}finally{D(),i(!1)}};return e.jsxs(e.Fragment,{children:[j,e.jsx(X,{icon:e.jsx(Yt,{}),onClick:k,loading:F,size:"small",children:"导出CSV"})]})}function bs({fileName:S,tableName:F,onRefresh:i}){const[l,j]=n.useState(!1),[k,D]=n.useState([]),[d,P]=n.useState(null),[W,E]=n.useState(null),[M,L]=n.useState(null),[B,U]=n.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:u=>`共 ${u} 条记录`,size:"small"}),[I,h]=Pe.useMessage(),[z]=De.useForm();n.useEffect(()=>{f()},[S]);const f=async()=>{j(!0);try{const u=await fetch(`/api/data/${encodeURIComponent(S)}`);if(!u.ok)throw new Error("Failed to fetch data");const v=await u.json();D(v),U(w=>({...w,total:v.length}))}catch(u){I.error("加载数据失败: "+u.message)}finally{j(!1)}},K=async u=>{const v=I.loading("正在删除...",0);try{const w=await fetch(`/api/data/${encodeURIComponent(S)}/${encodeURIComponent(String(u))}`,{method:"DELETE"});if(!w.ok){const a=await w.json();throw new Error(a.error||"删除失败")}I.success("删除成功"),f()}catch(w){I.error(w.message||"删除失败")}finally{v()}},N=u=>{P(u.id),E({...u}),L({...u}),z.setFieldsValue(u)},J=()=>{M&&d&&z.setFieldsValue(M),P(null),E(null),L(null),z.resetFields()},A=(u,v)=>u==="id"?"ID字段不可编辑":(v==null||typeof v=="string"&&v.trim()==="",null),ee=async()=>{if(!(!d||!W))try{const u=z.getFieldsValue();for(const[w,a]of Object.entries(u)){const y=A(w,a);if(y){I.error(y);return}}const v=I.loading("正在保存...",0);try{const{id:w,...a}=u,y=await fetch(`/api/data/${encodeURIComponent(S)}/${encodeURIComponent(String(d))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!y.ok){const G=await y.json();throw new Error(G.error||"保存失败")}I.success("保存成功"),P(null),E(null),L(null),z.resetFields(),f()}catch(w){I.error(w.message||"保存失败"),M&&(z.setFieldsValue(M),I.info("已恢复到原始数据"))}finally{v()}}catch(u){I.error("验证失败: "+u.message),M&&(z.setFieldsValue(M),I.info("已恢复到原始数据"))}},r=u=>{U(u)},T=()=>{f(),i&&i()},t=(u,v,w)=>d==v.id?w==="id"?e.jsx(me,{value:u,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof u==="number"?e.jsx(De.Item,{name:w,style:{margin:0},rules:[{validator:(G,se)=>{const q=A(w,se);return q?Promise.reject(q):Promise.resolve()}}],children:e.jsx(ns,{style:{width:"100%"},size:"small"})}):e.jsx(De.Item,{name:w,style:{margin:0},rules:[{validator:(G,se)=>{const q=A(w,se);return q?Promise.reject(q):Promise.resolve()}}],children:e.jsx(me,{size:"small"})}):u==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof u=="object"?JSON.stringify(u):String(u),_=(()=>{if(k.length===0)return[];const u=new Set;k.forEach(a=>{Object.keys(a).forEach(y=>u.add(y))});const w=Array.from(u).sort((a,y)=>a==="id"?-1:y==="id"?1:a.localeCompare(y)).map(a=>({title:a,dataIndex:a,key:a,ellipsis:!0,render:(y,G)=>t(y,G,a)}));return w.push({title:"操作",key:"action",fixed:"right",width:80,render:(a,y)=>d==y.id?e.jsxs(be,{size:"small",children:[e.jsx(we,{title:"保存",children:e.jsx(X,{type:"link",size:"small",icon:e.jsx(es,{}),onClick:ee})}),e.jsx(we,{title:"取消",children:e.jsx(X,{type:"link",size:"small",icon:e.jsx(ts,{}),onClick:J})})]}):e.jsxs(be,{size:"small",children:[e.jsx(we,{title:"编辑",children:e.jsx(X,{type:"link",size:"small",icon:e.jsx(gt,{}),onClick:()=>N(y),disabled:d!==null})}),e.jsx(ss,{title:"确定要删除这条记录吗？",onConfirm:()=>K(y.id),okText:"确定",cancelText:"取消",children:e.jsx(we,{title:"删除",children:e.jsx(X,{type:"link",danger:!0,size:"small",icon:e.jsx(wt,{}),disabled:d!==null})})})]})}),w})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[h,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",F]}),e.jsxs(be,{children:[e.jsx(js,{fileName:S,tableName:F,onImportComplete:T}),e.jsx(ws,{fileName:S,tableName:F}),e.jsx(X,{icon:e.jsx(Qt,{}),onClick:T,disabled:d!==null,size:"small",children:"刷新"})]})]}),e.jsx(De,{form:z,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(jt,{columns:_,dataSource:k,rowKey:u=>String(u.id),loading:l,pagination:B,onChange:r,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(re,{description:"暂无数据，请导入 CSV 或添加记录",image:re.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function Ss({onRefresh:S}){const[F,i]=n.useState(!1),[l,j]=n.useState([]),[k,D]=n.useState(""),[d,P]=Pe.useMessage(),[W,E]=Se.useModal(),[M,L]=n.useState(!1),[B,U]=n.useState(""),I=k==="";n.useEffect(()=>{h()},[k]);const h=async()=>{i(!0);try{const t=k?`/api/media?path=${encodeURIComponent(k)}`:"/api/media",C=await fetch(t);if(!C.ok)throw new Error("Failed to fetch media assets");const _=await C.json();j(Array.isArray(_)?_:[])}catch(t){d.error("加载素材失败: "+t.message),j([])}finally{i(!1)}},z=async t=>{const{file:C,onSuccess:_,onError:u}=t,v=new FormData;v.append("file",C),k&&v.append("path",k);try{const w=await fetch("/api/media/upload",{method:"POST",body:v});if(!w.ok){const a=await w.json();throw new Error(a.error||"上传失败")}d.success(`${C.name} 上传成功`),_(null,C),h(),S&&S()}catch(w){d.error(w.message||"上传失败"),u(w)}},f=t=>{W.confirm({title:`确定要删除 "${t.name}" 吗？`,content:t.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const C=d.loading("正在删除...",0);try{const _=await fetch(`/api/media/${encodeURIComponent(t.path)}`,{method:"DELETE"});if(!_.ok){const u=await _.json();throw new Error(u.error||"删除失败")}d.success("删除成功"),h(),S&&S()}catch(_){d.error(_.message||"删除失败")}finally{C()}}})},K=t=>{t.type==="folder"&&D(t.path)},N=t=>{D(t)},J=()=>{L(!0),U("")},A=async()=>{if(!B.trim()){d.error("请输入文件夹名称");return}const t=d.loading("正在创建文件夹...",0);try{const C=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:B.trim(),parentPath:k||void 0})});if(!C.ok){const _=await C.json();throw new Error(_.error||"创建文件夹失败")}d.success("文件夹创建成功"),L(!1),h(),S&&S()}catch(C){d.error(C.message||"创建文件夹失败")}finally{t()}},ee=()=>{const t=k?k.split("/"):[],C=[{title:e.jsxs("a",{onClick:()=>N(""),children:[e.jsx(os,{})," 根目录"]})},...t.map((_,u)=>{const v=t.slice(0,u+1).join("/");return{title:e.jsx("a",{onClick:()=>N(v),children:_})}})];return e.jsx(rs,{items:C,style:{marginBottom:16}})},r=t=>t.type==="folder"?e.jsx(as,{style:{fontSize:48,color:"#faad14"}}):t.type==="image"?e.jsx(ut,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(is,{style:{fontSize:48,color:"#1890ff"}}),T=t=>{const C=()=>[{key:"delete",label:"删除",icon:e.jsx(wt,{}),danger:!0,onClick:()=>f(t)}];return e.jsx(Ve,{hoverable:!0,style:{height:"100%"},cover:t.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>K(t),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(t.path)}`,alt:t.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:t.type==="folder"?"pointer":"default"},onClick:()=>K(t),children:r(t)}),actions:[e.jsx(Ke,{menu:{items:C()},trigger:["click"],children:e.jsx(X,{type:"text",icon:e.jsx(xt,{})})})],children:e.jsx(Ve.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:t.type==="folder"?"文件夹":t.size?`${(t.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[P,E,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(be,{children:[e.jsx(X,{icon:e.jsx(ct,{}),onClick:J,children:"新建文件夹"}),!I&&e.jsx(xe,{customRequest:z,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(X,{type:"primary",icon:e.jsx(yt,{}),children:"上传文件"})})]})]}),ee(),F?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(pt,{size:"large",tip:"加载中..."})}):l.length===0?e.jsx(re,{description:I?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(at,{gutter:[16,16],children:l.map(t=>e.jsx(it,{xs:12,sm:8,md:6,lg:4,xl:4,children:T(t)},t.id))}),e.jsx(Se,{title:"新建文件夹",open:M,onOk:A,onCancel:()=>L(!1),okText:"创建",cancelText:"取消",children:e.jsx(me,{placeholder:"请输入文件夹名称",value:B,onChange:t=>U(t.target.value),onPressEnter:A})})]})}const{Content:ks}=ve,{useToken:Cs}=Ae,Is=({activeTab:S,selectedTheme:F,selectedDoc:i,selectedLibrary:l,selectedDataTable:j,onRefreshDataTables:k,onRefreshMedia:D})=>{const{token:d}=Cs(),P=()=>{if(!F)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个主题",image:re.PRESENTED_IMAGE_SIMPLE})});const U=`/themes/${encodeURIComponent(F.name)}`;return e.jsx("iframe",{src:U,style:{width:"100%",flex:1,border:"none",background:d.colorBgContainer},title:F.displayName})},W=()=>{if(!i)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个文档",image:re.PRESENTED_IMAGE_SIMPLE})});const U=i.name.replace(/\.md$/i,""),I=`/assets/docs/${encodeURIComponent(U)}`;return e.jsx("iframe",{src:I,style:{width:"100%",flex:1,border:"none",background:d.colorBgContainer},title:i.displayName})},E=()=>{if(!l)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个前端库",image:re.PRESENTED_IMAGE_SIMPLE})});const U=`/assets/libraries/${l.name}`;return e.jsx("iframe",{src:U,style:{width:"100%",flex:1,border:"none",background:d.colorBgContainer},title:l.displayName})},M=()=>j?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:d.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(bs,{fileName:j.fileName,tableName:j.tableName,onRefresh:k})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个数据表",image:re.PRESENTED_IMAGE_SIMPLE})}),L=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:d.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(Ss,{onRefresh:D})}),B=()=>{switch(S){case"themes":return P();case"docs":return W();case"libraries":return E();case"data":return M();case"media":return L();default:return null}};return e.jsx(ks,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:d.colorBgContainer,display:"flex",flexDirection:"column"},children:B()})},ot="axhub-assets-active-tab",Es="/api/themes",vs="/api/docs",Ps="/api/libraries",rt="axhub-make-dark-mode";function As({isDarkMode:S,setIsDarkMode:F}){const i="[assistant-runtime-ui]",{message:l,modal:j}=Je.useApp(),{token:k}=Ae.useToken(),D="http://localhost:32123",d=/mac/i.test(navigator.platform)?"sudo npm install -g @axhub/genie":"npm install -g @axhub/genie",P={webBaseUrl:D,apiBaseUrl:`${D}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"助手运行时不可用，请先启动 Axhub Genie。",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:d,start:"axhub-genie",status:"axhub-genie status"}}},W=320,E=320,M=640,[L,B]=n.useState(!0),[U,I]=n.useState(!1),[h,z]=n.useState(()=>{const s=localStorage.getItem(ot);return s==="themes"||s==="docs"||s==="libraries"||s==="data"||s==="media"?s:"themes"}),[f,K]=n.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[N,J]=n.useState(null),[A,ee]=n.useState(null),[r,T]=n.useState(null),[t,C]=n.useState(null),[_,u]=n.useState(""),[v,w]=n.useState(!1),[a,y]=n.useState([]),[G,se]=n.useState(!1),[q,oe]=n.useState(!1),[H,Z]=n.useState(""),[he,Te]=n.useState(null),[ge,ke]=n.useState(null),[o,p]=n.useState(!1),[b,Y]=n.useState(null),[Q,ne]=n.useState(!1),[O,ie]=n.useState(()=>{const s=localStorage.getItem(et),c=s?Number(s):NaN;return Number.isFinite(c)&&c>=E?Math.min(c,M):W}),de=n.useRef(null),[ce,ue]=n.useState(!1),[ye,Ce]=n.useState(null);n.useEffect(()=>{localStorage.setItem(ot,h)},[h]),n.useEffect(()=>{te()},[]),n.useEffect(()=>{let s=!1;return We.getConfig().then(c=>{var g,$;if(s)return;const x=(g=c==null?void 0:c.automation)==null?void 0:g.defaultPromptClient;Te(Lt(x)),ke((($=c==null?void 0:c.automation)==null?void 0:$.defaultIDE)||null)}).catch(()=>{s||(Te(null),ke(null))}),()=>{s=!0}},[]),n.useEffect(()=>{let s=!1;return We.getAssistantRuntime({autoStart:!1}).then(c=>{s||Y(c)}).catch(()=>{s||Y(P)}),()=>{s=!0}},[]),n.useEffect(()=>{localStorage.setItem(et,String(Math.round(O)))},[O]),n.useEffect(()=>{!L&&f&&(h==="themes"&&f.themes.length>0&&!N?J(f.themes[0]):h==="docs"&&f.docs.length>0&&!A?ee(f.docs[0]):h==="libraries"&&f.libraries.length>0&&!r?T(f.libraries[0]):h==="data"&&f.dataTables.length>0&&!t&&C(f.dataTables[0]))},[L,f,h,N,A,r,t]);const te=async()=>{B(!0);try{const[s,c,x,g,$]=await Promise.all([fetch(Es),fetch(vs),fetch(Ps),fetch("/api/data/tables"),fetch("/api/media")]);if(!s.ok||!c.ok||!x.ok||!g.ok||!$.ok)throw new Error("Failed to fetch data");const m=await s.json(),R=await c.json(),ae=await x.json(),V=await g.json(),fe=await $.json();K({themes:m||[],docs:R||[],libraries:ae||[],dataTables:Array.isArray(V)?V:[],mediaAssets:Array.isArray(fe)?fe:[]})}catch(s){l.error("加载数据失败: "+s.message),K({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{B(!1)}},le=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个主题」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件
- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力
- 告知：已经准备好开始新建主题
- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以
- 若信息不足，再用 2-4 个简短问题收集关键输入即可

**📋 必读规范文档**：
- **\`/rules/theme-generation-guide.md\`** ⭐️ 主题生成完整规范！
  - 请完整阅读此文档，了解主题生成的所有要求和约束
  - 文档包含：交付物规范、文件结构、生成策略、验收流程等

**提示**：如果用户没给 \`<theme-key>\` / \`name\` / \`description\`，先给出你建议的 \`<theme-key>\`，并让用户一键确认即可`,[]),Me=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，优先使用 DeepWiki MCP 或 Context7 MCP 获取最新官方文档与版本信息
- 若 MCP 不可用，再提示用户补充链接或版本

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`,[]),Oe=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`,[]),bt=n.useMemo(()=>h==="themes"?{scene:"assets-create-theme",buildPrompt:le}:h==="libraries"?{scene:"assets-create-library",buildPrompt:Me}:h==="docs"?{scene:"assets-create-doc",buildPrompt:Oe}:null,[h,le,Me,Oe]),je=n.useMemo(()=>({version:"1",systemContext:"",currentFile:h==="themes"&&N?`src/themes/${N.name}/index.tsx`:h==="docs"&&A?`assets/docs/${A.name}`:h==="libraries"&&r?`assets/libraries/${r.name}.md`:h==="data"&&t?`assets/database/${t.fileName}.json`:"",selectedElements:[],extensions:{source:"axhub-runtime-assets",projectPath:(b==null?void 0:b.projectPath)||"",activeTab:h,selectedAsset:h==="themes"?N:h==="docs"?A:h==="libraries"?r:t,updatedAt:new Date().toISOString()}}),[h,N,A,r,t,b==null?void 0:b.projectPath]),$e=n.useCallback((s,c)=>{try{const x=new URL(s,window.location.origin);return x.searchParams.set("context",JSON.stringify(c)),x.toString()}catch(x){return console.warn("Failed to serialize assistant context into URL:",x),s}},[]),Fe=n.useMemo(()=>Dt(he),[he]),Ie=n.useMemo(()=>{const s=((b==null?void 0:b.webBaseUrl)||D).replace(/\/+$/g,""),c=new URL(`${s}/`),x=(b==null?void 0:b.projectPath)||"";return x&&c.searchParams.set("cwd",x),Fe&&c.searchParams.set("provider",Fe),c.toString()},[b,Fe]),Ne=ye||Ie,Be=M;n.useEffect(()=>{ue(!1)},[Ne]);const Xe=n.useCallback(()=>{const s=de.current;if(!s||!s.contentWindow)return;let c="*";try{c=new URL(Ne).origin}catch{c="*"}const x={type:"update_context",mode:"replace",context:je};s.contentWindow.postMessage(x,c)},[Ne,je]);n.useEffect(()=>{!o||!ce||Xe()},[o,ce,Xe]);const qe=n.useCallback((s,c)=>{const g=$e(s||Ie,je);Ce(g),p(!0)},[Ie,$e,je]),Ze=n.useCallback((s,c)=>{const g=$e(s||Ie,je);window.open(g,"_blank")},[Ie,$e,je]),ze=n.useCallback((s,c,x,g,$="iframe")=>{const m=s.health.hints;j.confirm({title:"Axhub Genie 未就绪",width:620,content:e.jsxs("div",{children:[e.jsx("p",{children:s.health.message}),e.jsxs(Ee.Paragraph,{style:{marginBottom:8},copyable:{text:m.installGlobal,tooltips:["复制命令","已复制"],onCopy:()=>l.success("全局安装命令已复制")},children:["全局安装：",e.jsx(Ee.Text,{code:!0,children:m.installGlobal})]}),e.jsxs(Ee.Paragraph,{style:{marginBottom:0},copyable:{text:m.start,tooltips:["复制命令","已复制"],onCopy:()=>l.success("启动命令已复制")},children:["启动命令：",e.jsx(Ee.Text,{code:!0,children:m.start})]})]}),cancelText:"关闭",footer:(R,{CancelBtn:ae})=>e.jsx(ae,{})}),c==="event"&&l.warning("Genie 未就绪，已回退为安装引导。")},[l,j]),Re=n.useCallback(async(s,c,x,g="iframe")=>{if(Q)return!1;ne(!0);const $=l.loading("正在启动并检测 Axhub Genie...",0);console.info(`${i} begin runtime check`,{trigger:s,openTarget:g,targetUrl:c||null,targetPath:x||null});try{const m=await We.getAssistantRuntime();if(Y(m),console.info(`${i} runtime response`,{status:m.health.status,message:m.health.message,source:m.source,commandSource:m.health.commandSource,webBaseUrl:m.webBaseUrl,apiBaseUrl:m.apiBaseUrl}),m.health.status==="ready")return g==="window"?Ze(c,x):qe(c,x),!0;console.warn(`${i} runtime not ready`,{status:m.health.status,message:m.health.message,hints:m.health.hints}),ze(m,s,c,x,g)}catch(m){const R=b||P;Y(R),console.error(`${i} runtime check failed`,m),l.error((m==null?void 0:m.message)||"检测 Axhub Genie 状态失败"),ze(R,s,c,x,g)}finally{$(),ne(!1)}return!1},[Q,b,l,qe,Ze,ze]),St=n.useCallback(()=>{if(o){p(!1);return}Re("button")},[o,Re]);n.useEffect(()=>{const s=c=>{const x=c,g=x.detail,$=g==null?void 0:g.url;!$||typeof $!="string"||(Re("event",$,g==null?void 0:g.targetPath),x.preventDefault())};return window.addEventListener(tt,s),()=>{window.removeEventListener(tt,s)}},[Re]);const kt=s=>{z(s),u("")},Ct=s=>{J(s)},It=s=>{ee(s)},Et=s=>{T(s)},vt=s=>{C(s)},Pt=async(s,c)=>{if(s==="data"){const x=c,g=x.fileName,$=x.tableName;let m=$;j.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",g,".json (不可修改)"]}),e.jsx(me,{autoFocus:!0,defaultValue:$,placeholder:"请输入新的表名称",onChange:R=>{m=R.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const R=m==null?void 0:m.trim();if(!R)return l.error("表名称不能为空"),Promise.reject();if(R===$)return;const ae=l.loading("正在重命名...",0);try{const V=await fetch(`/api/data/tables/${encodeURIComponent(g)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:R})});if(!V.ok){const fe=await V.json();throw new Error(fe.error||"重命名失败")}l.success("重命名成功"),(t==null?void 0:t.fileName)===g&&C({...t,tableName:R}),await te()}catch(V){return l.error(V.message||"重命名失败"),Promise.reject()}finally{ae()}}});return}if(s==="docs"){const g=c.name,$=g.lastIndexOf("."),m=$>0?g.slice(0,$):g,R=$>0?g.slice($):"";let ae=m;j.confirm({title:"重命名文档",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["扩展名: ",R||"无"]}),e.jsx(me,{autoFocus:!0,defaultValue:m,placeholder:"请输入新的文档名称",onChange:V=>{ae=V.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){let V=ae==null?void 0:ae.trim();if(!V||(R&&V.endsWith(R)&&(V=V.slice(0,-R.length).trim()),!V))return l.error("文档名称不能为空"),Promise.reject();if(V===m)return;const fe=l.loading("正在重命名...",0);try{const Le=await fetch(`/api/docs/${encodeURIComponent(g)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBaseName:V})});if(!Le.ok){const Rt=await Le.json();throw new Error(Rt.error||"重命名失败")}l.success("重命名成功");const Ye=`${V}${R}`;(A==null?void 0:A.name)===g&&ee({...A,name:Ye,displayName:Ye}),await te()}catch(Le){return l.error(Le.message||"重命名失败"),Promise.reject()}finally{fe()}}});return}if(s==="themes"){const x=c,g=x.name,$=x.displayName||x.name;let m=$;j.confirm({title:"重命名主题",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["主题目录: ",g," (不可修改)"]}),e.jsx(me,{autoFocus:!0,defaultValue:$,placeholder:"请输入新的主题名称",onChange:R=>{m=R.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const R=m==null?void 0:m.trim();if(!R)return l.error("主题名称不能为空"),Promise.reject();if(R===$)return;const ae=l.loading("正在重命名...",0);try{const V=await fetch(`/api/themes/${encodeURIComponent(g)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:R})});if(!V.ok){const fe=await V.json();throw new Error(fe.error||"重命名失败")}l.success("重命名成功"),(N==null?void 0:N.name)===g&&J({...N,displayName:R}),await te()}catch(V){return l.error(V.message||"重命名失败"),Promise.reject()}finally{ae()}}})}},At=async(s,c,x)=>{const g={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};if(s==="themes"){const $=l.loading("正在删除...",0);try{const m=await fetch(`/api/themes/${c}`,{method:"DELETE"});if(!m.ok){const R=await m.json();throw new Error(R.error||"删除失败")}l.success("删除成功"),(N==null?void 0:N.name)===c&&J(null),te()}catch(m){l.error(m.message||"删除失败")}finally{$()}return}j.confirm({title:`确定要删除${g[s]} "${x}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const $=l.loading("正在删除...",0);try{let m;if(s==="data")m=await fetch(`/api/data/tables/${c}`,{method:"DELETE"});else if(s==="docs")m=await fetch(`/api/docs/${encodeURIComponent(c)}`,{method:"DELETE"});else if(s==="libraries")m=await fetch(`/api/libraries/${c}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!m.ok){const R=await m.json();throw new Error(R.error||"删除失败")}l.success("删除成功"),s==="docs"&&(A==null?void 0:A.name)===c?ee(null):s==="libraries"&&(r==null?void 0:r.name)===c?T(null):s==="data"&&(t==null?void 0:t.fileName)===c&&C(null),te()}catch(m){l.error(m.message||"删除失败")}finally{$()}}})},Tt=()=>{if(h==="docs"){w(!0);return}if(h==="data"){oe(!0);return}l.info("新建功能开发中...")},$t=async()=>{if(a.length===0){l.warning("请先上传文件");return}se(!0);try{const s=await Promise.all(a.map(async x=>{const g=x.originFileObj;if(!g)throw new Error("文件读取失败，请重新选择文件");const $=g.name,m=$.toLowerCase();if(!m.endsWith(".md")&&!m.endsWith(".csv")&&!m.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(g.size>5242880)throw new Error("单个文件大小不能超过 5MB");const R=await g.text();return{name:$,content:R}})),c=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:s})});if(!c.ok){const x=await c.json().catch(()=>null);throw new Error((x==null?void 0:x.error)||"上传失败")}l.success("上传成功"),w(!1),y([]),te()}catch(s){l.error((s==null?void 0:s.message)||"上传失败")}finally{se(!1)}},Nt=async()=>{if(!H.trim()){l.error("请输入表名");return}const s=l.loading("正在创建表...",0);try{const c=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:H.trim()})});if(!c.ok){const x=await c.json();throw new Error(x.error||"创建表失败")}l.success("表创建成功"),oe(!1),Z(""),te()}catch(c){l.error(c.message||"创建表失败")}finally{s()}};return e.jsxs(ve,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(ps,{collapsed:U,setCollapsed:I,activeTab:h,onTabChange:kt,counts:{themes:f.themes.length,docs:f.docs.length,libraries:f.libraries.length,data:f.dataTables.length,media:f.mediaAssets.length},isDarkMode:S,setIsDarkMode:F,assistantEnabled:!0,assistantVisible:o,onToggleAssistant:St,preferredPromptClient:he,preferredIDE:ge}),e.jsxs(ve,{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx(ys,{collapsed:U,loading:L,activeTab:h,themes:f.themes,docs:f.docs,libraries:f.libraries,dataTables:f.dataTables,selectedTheme:N,selectedDoc:A,selectedLibrary:r,selectedDataTable:t,onThemeSelect:Ct,onDocSelect:It,onLibrarySelect:Et,onDataTableSelect:vt,onDeleteAsset:At,onRenameAsset:Pt,onCreateClick:Tt,searchText:_,setSearchText:u,preferredPromptClient:he,preferredIDE:ge,createPromptConfig:bt}),e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(Is,{activeTab:h,selectedTheme:N,selectedDoc:A,selectedLibrary:r,selectedDataTable:t,onRefreshDataTables:te,onRefreshMedia:te})}),o&&e.jsx(ds,{size:{width:Math.min(Math.max(O,E),Be),height:"calc(100vh - 48px)"},minWidth:E,maxWidth:Be,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(s,c,x)=>{const g=Math.min(Math.max(x.getBoundingClientRect().width,E),Be);ie(g)},style:{borderLeft:`1px solid ${k.colorBorderSecondary}`,background:k.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:de,src:Ne,title:"Axhub Genie",onLoad:()=>ue(!0),style:{border:"none",width:"100%",height:"100%"}})})]}),e.jsx(Se,{title:"新建文档",open:v,onCancel:()=>{w(!1),y([])},footer:[e.jsx(_e,{preferredClient:he,preferredIDE:ge,scene:"assets-create-doc",buildPrompt:Oe,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy"),e.jsx(X,{type:"primary",loading:G,onClick:$t,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(xe.Dragger,{multiple:!0,accept:".md",fileList:a,beforeUpload:s=>(s.name||"").toLowerCase().endsWith(".md")?!1:(l.error("仅支持上传 .md 文件"),xe.LIST_IGNORE),onChange:s=>y(s.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"仅支持 .md 文件，支持批量上传"})]})})}),e.jsx(Se,{title:"新建数据表",open:q,onOk:Nt,onCancel:()=>{oe(!1),Z("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(me,{placeholder:"例如: 用户表, 产品列表",value:H,onChange:s=>Z(s.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function Ts(){const[S,F]=n.useState(()=>localStorage.getItem(rt)==="true");return n.useEffect(()=>{localStorage.setItem(rt,String(S))},[S]),e.jsx(cs,{theme:us(S),children:e.jsx(Je,{children:e.jsx(As,{isDarkMode:S,setIsDarkMode:F})})})}const $s=ls.createRoot(document.getElementById("root"));$s.render(e.jsx(Ts,{}));
