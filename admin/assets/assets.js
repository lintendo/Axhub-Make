import{P as _e,S as Ye,a as ve,A as Qe}from"./chunks/PromptActionButton.js";import{T as Rt,U as ye,s as Pe,t as Te,r as n,j as e,M as Ce,R as ot,C as rt,B as at,a as Be,S as ke,b as J,c as it,d as Nt,e as lt,f as ct,g as Lt,L as Ae,h as ge,i as Dt,k as Ut,l as Ot,m as Mt,n as dt,o as We,p as Ve,q as ut,u as Se,v as ft,w as _t,D as Ge,x as Ft,y as zt,z as Bt,A as Wt,E as Vt,F as Gt,G as He,I as pe,H as Ht,J as ht,K as ie,N as Kt,O as mt,P as Jt,Q as pt,V as xt,W as gt,X as et,Y as qt,Z as Oe,_ as Xt,$ as Zt,a0 as Yt,a1 as Qt,a2 as yt,a3 as es,a4 as ts,a5 as ss,a6 as ns,a7 as os,a8 as rs,a9 as as,aa as is}from"./chunks/vendor.js";import{g as ls}from"./chunks/index.js";import"./chunks/execute.js";const{Text:Me}=Rt,{Dragger:tt}=ye,cs=({open:p,onCancel:W,preferredPromptClient:t,preferredIDE:$})=>{const[S,j]=Pe.useMessage(),{token:D}=Te.useToken(),[u,E]=n.useState(null),[V,A]=n.useState([]),[M,R]=n.useState(!1),[G,f]=n.useState(null),[C,x]=n.useState([]),[F,h]=n.useState(!1),[H,T]=n.useState(null),[q,N]=n.useState(null);n.useEffect(()=>{p||(E(null),A([]),R(!1),f(null),x([]),h(!1),T(null),N(null))},[p]);const se=[{key:"local_axure",title:"本地 Axure 文件导入",icon:e.jsx(it,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePaths:["/skills/local-axure-workflow/SKILL.md"],disabled:!1,recommended:!0},{key:"axure_prototype",title:"Axure 原型链接导入",icon:e.jsx(Nt,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePaths:["/skills/axure-prototype-workflow/SKILL.md","/skills/axure-prototype-workflow/asset-extraction.md","/skills/axure-prototype-workflow/page-restoration.md"],disabled:!1},{key:"web_page",title:"产品网页链接导入",icon:e.jsx(lt,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePaths:["/skills/web-page-workflow/SKILL.md","/skills/web-page-workflow/asset-extraction.md","/skills/web-page-workflow/page-restoration.md"],disabled:!1},{key:"screenshot",title:"App/小程序/网页截图导入",icon:e.jsx(ct,{style:{fontSize:24,color:"#faad14"}}),desc:"上传多张截图，提取结构/交互/状态数据，并生成页面/元素",rulePaths:["skills/screen-to-code/SKILL.md","skills/screen-to-code/screenshot-collection.md"],disabled:!1},{key:"app_direct",title:"App/小程序直接导入",icon:e.jsx(Lt,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePaths:[],disabled:!0}],o=u&&se.find(i=>i.key===u)||null,P=(i,y)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「${i}」设计资产。

请认真阅读规则文档：
${y.map(K=>`- \`${K}\``).join(`
`)}
并按文档定义的交互指南回复用户。`,r=(i,y)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「基于${i}导入资产」。

**交互要求**：
- 收到本条系统指令后，先根据 skill 的用户交互指南用简短中文回复一次，确认需求，并引导用户提供 ${i}（URL）
- 未拿到链接前，不要生成任何文件
- 参考下方文档，按流程逐步引导用户完成导入与还原/优化

**📋 参考文档（必须阅读）**：
${y.map(K=>`- \`${K}\``).join(`
`)}`,v=i=>{E(i),A([]),f(null),x([]),T(null),N(null)},U=async i=>{const{file:y,onSuccess:K,onError:ne}=i,Q=y instanceof File?y:y.originFileObj,oe=new FormData;oe.append("file",Q,Q.name),oe.append("uploadType","local_axure"),R(!0);try{const z=await fetch("/api/upload",{method:"POST",body:oe}),X=await z.json();z.ok&&X.success?(f(X),S.success(X.message||"文件已解压，请复制 Prompt 交给 AI 处理"),K(null,y)):(S.error(X.error||"上传失败"),ne(new Error(X.error||"上传失败")))}catch(z){S.error("上传失败: "+((z==null?void 0:z.message)||"Unknown error")),ne(z)}finally{R(!1)}},d=async i=>{const{file:y,onSuccess:K,onError:ne}=i,Q=y instanceof File?y:y.originFileObj,oe=new FormData;oe.append("file",Q,Q.name),q&&oe.append("batchId",q),h(!0);try{const z=await fetch("/api/upload-screenshots",{method:"POST",body:oe}),X=await z.json();z.ok&&X.success?(T(X),N(X.batchId||q),S.success(X.message||"截图已上传，请复制 Prompt 交给 AI 处理"),K(null,y)):(S.error(X.error||"上传失败"),ne(new Error(X.error||"上传失败")))}catch(z){S.error("上传失败: "+((z==null?void 0:z.message)||"Unknown error")),ne(z)}finally{h(!1)}},I=!o||o.disabled?!1:o.key==="local_axure"?!!(G!=null&&G.prompt):o.key==="screenshot"?!!(H!=null&&H.prompt):!0,g=()=>!o||o.disabled?"":o.key==="local_axure"?(G==null?void 0:G.prompt)||"":o.key==="screenshot"?(H==null?void 0:H.prompt)||"":o.key==="axure_prototype"?r("Axure 原型链接",o.rulePaths):o.key==="web_page"?r("网页链接",o.rulePaths):P(o.title,o.rulePaths);return e.jsxs(Ce,{title:"智能导入资产",open:p,onCancel:W,footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:8,width:"100%"},children:[e.jsx(J,{onClick:W,children:"取消"},"cancel"),e.jsx(_e,{preferredClient:t,preferredIDE:$,scene:`assets-smart-import-${(o==null?void 0:o.key)||"unknown"}`,buildPrompt:g,disabled:!I,copyLabel:"复制新建 Prompt",style:{flex:"0 0 auto"},executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy")]}),width:800,destroyOnClose:!0,children:[j,e.jsx(ot,{gutter:[16,16],children:se.map((i,y)=>e.jsx(rt,{span:12,children:e.jsx(at.Ribbon,{text:"推荐",color:"#008F5D",style:{display:i.recommended?"block":"none"},children:e.jsx(Be,{hoverable:!i.disabled,style:{height:"100%",cursor:i.disabled?"not-allowed":"pointer",opacity:i.disabled?.6:1,background:i.disabled?"#f5f5f5":u===i.key?D.colorFillAlter:void 0,borderColor:u===i.key?D.colorInfo:void 0},onClick:()=>{i.disabled||v(i.key)},children:e.jsxs(ke,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:i.disabled?"#e8e8e8":i.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:i.icon}),e.jsxs("div",{children:[e.jsx(Me,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:i.title}),e.jsx(Me,{type:"secondary",style:{fontSize:13},children:i.desc})]})]})})})},y))}),u==="local_axure"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(tt,{name:"file",multiple:!1,fileList:V,customRequest:U,beforeUpload:i=>{var K;return i.type==="application/zip"||i.type==="application/x-zip-compressed"||((K=i.name)==null?void 0:K.endsWith(".zip"))?!0:(S.error("请上传 ZIP 格式的文件"),ye.LIST_IGNORE)},onChange:i=>A(i.fileList.slice(-1)),onRemove:()=>{A([]),f(null)},accept:".zip",disabled:M,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽 ZIP 文件上传"}),e.jsx(Me,{type:"secondary",style:{fontSize:12},children:"上传后会解压到本地 temp 目录，并生成可复制的 Prompt"})]})})}),u==="screenshot"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(tt,{name:"file",multiple:!0,fileList:C,customRequest:d,beforeUpload:i=>typeof(i==null?void 0:i.type)=="string"&&i.type.startsWith("image/")?!0:(S.error("请上传图片格式的文件（png/jpg/webp 等）"),ye.LIST_IGNORE),onChange:i=>x(i.fileList),onRemove:()=>{x([]),T(null),N(null)},accept:"image/*",disabled:F,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽多张截图上传"}),e.jsx(Me,{type:"secondary",style:{fontSize:12},children:"上传完成后点击底部「复制 Prompt」，让 AI 按文档流程完成截图转代码"})]})})})]})},{Header:ds}=Ae,{useToken:us}=Te,fs=({collapsed:p,setCollapsed:W,activeTab:t,onTabChange:$,counts:S,isDarkMode:j,setIsDarkMode:D,assistantEnabled:u=!1,assistantVisible:E=!1,onToggleAssistant:V,preferredPromptClient:A,preferredIDE:M})=>{const[R,G]=ge.useState(null),[f,C]=ge.useState(!1),{token:x}=us();return ge.useEffect(()=>{let F=!1;return fetch("/api/version").then(h=>h.ok?h.json():Promise.reject(new Error("Request failed"))).then(h=>{if(F)return;const H=typeof(h==null?void 0:h.version)=="string"?h.version:null;G(H)}).catch(()=>{F||G(null)}),()=>{F=!0}},[]),e.jsxs(ds,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:x.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${x.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[t!=="media"&&e.jsx(J,{type:"text",icon:p?e.jsx(Dt,{}):e.jsx(Ut,{}),onClick:()=>W(!p),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:t==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:x.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(Ot,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Mt,{value:t,size:"small",shape:"round",style:{fontSize:"12px"},onChange:F=>$(F),options:[{label:`主题 (${S.themes})`,value:"themes",icon:e.jsx(dt,{})},{label:`文档 (${S.docs})`,value:"docs",icon:e.jsx(We,{})},{label:`前端库 (${S.libraries})`,value:"libraries",icon:e.jsx(Ve,{})},{label:`数据 (${S.data})`,value:"data",icon:e.jsx(ut,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Se,{title:"使用 AI 智能导入资产",children:e.jsx(J,{size:"small",icon:e.jsx(ft,{}),onClick:()=>C(!0),children:"智能导入资产"})}),e.jsx(cs,{open:f,onCancel:()=>C(!1),preferredPromptClient:A??null,preferredIDE:M??null}),u&&e.jsx(Se,{title:E?"关闭 Axhub Genie":"打开 Axhub Genie",children:e.jsx(at,{dot:!0,status:E?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:E?"inline-flex":"none"}},children:e.jsx(J,{type:"text",size:"small",icon:e.jsx(_t,{}),onClick:V})})}),e.jsx(Ge,{menu:{items:[{key:"theme",label:j?"浅色模式":"深色模式",icon:j?e.jsx(zt,{}):e.jsx(Bt,{}),onClick:()=>D(!j)},{type:"divider"},{key:"help",label:"帮助中心",icon:e.jsx(Wt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(Vt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(lt,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(Gt,{}),extra:e.jsx("span",{style:{fontSize:12,color:x.colorTextSecondary},children:R?`v${R}`:"-"})}]},placement:"bottomRight",children:e.jsx(J,{type:"text",icon:e.jsx(Ft,{})})})]})]})},{Sider:hs}=Ae,{useToken:ms}=Te,ps=({collapsed:p,loading:W,activeTab:t,themes:$,docs:S,libraries:j,dataTables:D,selectedTheme:u,selectedDoc:E,selectedLibrary:V,selectedDataTable:A,onThemeSelect:M,onDocSelect:R,onLibrarySelect:G,onDataTableSelect:f,onDeleteAsset:C,onRenameAsset:x,onCreateClick:F,searchText:h,setSearchText:H,preferredPromptClient:T,preferredIDE:q,createPromptConfig:N})=>{const{token:se}=ms(),{message:o,modal:P}=He.useApp(),r=async l=>{const w=await fetch("/api/themes/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:l})});if(!w.ok){const B=await w.json().catch(()=>({}));throw new Error(B.error||"检查主题引用失败")}return w.json()},v=ge.useMemo(()=>{if(!h)return $;const l=h.toLowerCase();return $.filter(w=>w.displayName.toLowerCase().includes(l)||w.name.toLowerCase().includes(l))},[$,h]),U=ge.useMemo(()=>{if(!h)return S;const l=h.toLowerCase();return S.filter(w=>w.displayName.toLowerCase().includes(l)||w.name.toLowerCase().includes(l))},[S,h]),d=ge.useMemo(()=>{if(!h)return j;const l=h.toLowerCase();return j.filter(w=>w.displayName.toLowerCase().includes(l)||w.name.toLowerCase().includes(l))},[j,h]),I=ge.useMemo(()=>{if(!h)return D;const l=h.toLowerCase();return D.filter(w=>w.tableName.toLowerCase().includes(l)||w.fileName.toLowerCase().includes(l))},[D,h]),g=async l=>{let w="",B="";const fe="tableName"in l?l.tableName:l.displayName,O="fileName"in l?l.fileName:l.name;if(t==="docs"?(w=`assets/docs/${O}`,B=`[${fe}](assets/docs/${O})`):t==="themes"?(w=`src/themes/${O}/index.tsx`,B=`[${fe}](src/themes/${O})`):t==="libraries"?(w=`assets/libraries/${O}.md`,B=`[${fe}](assets/libraries/${O}.md)`):t==="data"&&(w=`assets/database/${O}.json`,B=`[${fe}](assets/database/${O}.json)`),!w){o.warning("无法获取文件路径");return}const te=["vscode","cursor"],le=o.loading("正在发送到 IDE...",0);try{B&&await navigator.clipboard.writeText(B);const ee=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:te})}),re=await ee.json().catch(()=>null);if(!ee.ok||!(re!=null&&re.sent)){o.warning("编辑器未连接，已复制了文件标题，可前往使用");return}const ce=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:w,targetClientTypes:te})}),de=await ce.json().catch(()=>null);if(!ce.ok||!(de!=null&&de.sent)){o.warning("编辑器未连接，已复制了文件标题，可前往使用");return}o.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(ee){console.error("Failed to open in IDE:",ee),o.error((ee==null?void 0:ee.message)||"发送失败")}finally{le()}},i=(l,w)=>{const B=t==="themes"&&"name"in l&&(u==null?void 0:u.name)===l.name||t==="docs"&&"name"in l&&(E==null?void 0:E.name)===l.name||t==="libraries"&&"name"in l&&(V==null?void 0:V.name)===l.name||t==="data"&&"fileName"in l&&(A==null?void 0:A.fileName)===l.fileName,fe=t==="themes"&&"hasDoc"in l&&l.hasDoc,O=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(Ve,{})},{key:"delete",label:`删除${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`,icon:e.jsx(Jt,{}),danger:!0}];fe&&O.splice(1,0,{key:"open-doc-in-ide",label:"在编辑器中打开规范文档",icon:e.jsx(We,{}),danger:!1}),(t==="data"||t==="themes"||t==="docs")&&O.unshift({key:"rename",label:"重命名",icon:e.jsx(pt,{}),danger:!1});const te="tableName"in l?l.tableName:l.displayName,le="fileName"in l?l.fileName:l.name;return{key:le,icon:w,label:e.jsxs("div",{className:`menu-item-wrapper ${B?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:te})}),e.jsx(Ge,{trigger:["click"],menu:{items:O,onClick:async({key:ee})=>{if(ee==="open-in-ide")g(l);else if(ee==="open-doc-in-ide"){const re="name"in l?l.name:"";if(!re)return;const de=`src/themes/${re}/README.md`,xe=`src/themes/${re}/DESIGN-SPEC.md`,je=`[${te} 规范文档](${de})`,he=["vscode","cursor"],Ie=o.loading("正在发送到 IDE...",0);try{await navigator.clipboard.writeText(je);const Z=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:he})}),we=await Z.json().catch(()=>null);if(!Z.ok||!(we!=null&&we.sent)){o.warning("编辑器未连接，已复制了文件标题，可前往使用");return}let me=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:de,targetClientTypes:he})}),ue=await me.json().catch(()=>null);if((!me.ok||!(ue!=null&&ue.sent))&&(me=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:xe,targetClientTypes:he})}),ue=await me.json().catch(()=>null)),!me.ok||!(ue!=null&&ue.sent)){o.warning("编辑器未连接，已复制了文件标题，可前往使用");return}o.success("已在编辑器中打开规范文档，并复制了文件标题")}catch(Z){console.error("Failed to open doc in IDE:",Z),o.error((Z==null?void 0:Z.message)||"发送失败")}finally{Ie()}}else if(ee==="rename")x==null||x(t,l);else if(ee==="delete")if(t==="themes"){const re=o.loading("正在检查主题引用...",0);try{const ce=await r(le),de=Array.isArray(ce==null?void 0:ce.references)?ce.references:[];if(de.length>0){const xe=de.map(he=>`- ${he}`).join(`
`),je=`我希望删除主题 "${te}" (${le})。
该主题位于项目中的相对路径为：\`src/themes/${le}\`

已检测到以下文件引用了该主题的 \`designToken.json\` 或 \`globals.css\`：
${xe}

请帮我执行以下检查和操作：
1. 核对上述引用是否准确，并补充遗漏的引用文件（优先检查 \`src/elements/\` 与 \`src/pages/\`）。
2. 如果确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 或 \`globals.css\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，使这些原型脱离对该主题目录的依赖。
3. 完成上述解耦操作后，再彻底删除主题目录 \`src/themes/${le}\`。

主题目录内容规范（至少包含 globals.css 或 designToken.json 其中之一）：
\`\`\`
src/themes/<theme-key>/
├── globals.css
├── designToken.json
└── index.tsx
\`\`\``;P.confirm({title:"检测到主题引用",width:720,cancelText:"取消",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"已检测到以下文件引用了该主题："}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:xe}),e.jsx("div",{style:{marginTop:12},children:e.jsx(_e,{preferredClient:T,preferredIDE:q,scene:"assets-theme-delete-ref-fix",buildPrompt:()=>je,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"})})]}),footer:(he,{CancelBtn:Ie})=>e.jsx(Ie,{})})}else P.confirm({title:`确认删除主题 "${te}" 吗？`,content:"未检测到引用文件。删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk(){C(t,le,te)}})}catch(ce){o.error(ce.message||"检查主题引用失败")}finally{re()}}else C(t,le,te)}},children:e.jsx(J,{type:"text",size:"small",className:"more-btn",icon:e.jsx(mt,{}),onClick:ee=>{ee.stopPropagation()}})})]})}},y=v.map(l=>i(l,e.jsx(dt,{}))),K=U.map(l=>i(l,e.jsx(We,{}))),ne=d.map(l=>i(l,e.jsx(Ve,{}))),Q=I.map(l=>i(l,e.jsx(ut,{}))),oe=({key:l})=>{if(t==="themes"){const w=$.find(B=>B.name===l);w&&M(w)}else if(t==="docs"){const w=S.find(B=>B.name===l);w&&R(w)}else if(t==="libraries"){const w=j.find(B=>B.name===l);w&&G(w)}else if(t==="data"){const w=D.find(B=>B.fileName===l);w&&f(w)}},z=t==="themes"?y:t==="docs"?K:t==="data"?Q:ne,X=t==="themes"?u==null?void 0:u.name:t==="docs"?E==null?void 0:E.name:t==="data"?A==null?void 0:A.fileName:V==null?void 0:V.name;return e.jsx(hs,{trigger:null,collapsible:!0,collapsed:p||t==="media",width:240,collapsedWidth:0,style:{background:se.colorBgContainer,borderRight:`1px solid ${se.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:t==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!p&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(pe,{placeholder:"搜索...",prefix:e.jsx(Ht,{}),value:h,onChange:l=>H(l.target.value),allowClear:!0,style:{flex:1}})})})}),W?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(ht,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[z.length===0?e.jsx(ie,{image:ie.PRESENTED_IMAGE_SIMPLE,description:h?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(Kt,{mode:"inline",selectedKeys:X?[X]:[],items:z,onClick:oe,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!p&&e.jsx("div",{style:{position:"absolute",left:16,right:16,bottom:20},children:N?e.jsx(_e,{preferredClient:T,preferredIDE:q,scene:N.scene,buildPrompt:N.buildPrompt,type:"primary",block:!0,copyLabel:"复制新建 Prompt",executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"}):e.jsx(J,{type:"primary",block:!0,onClick:F,children:`新建${t==="data"?"数据表":t==="docs"?"文档":t==="themes"?"主题":"前端库"}`})})]})})};function xs({fileName:p,tableName:W,onImportComplete:t}){const[$,S]=n.useState(!1),[j,D]=n.useState(null),[u,E]=n.useState(null),[V,A]=n.useState([]),[M,R]=n.useState([]),[G,f]=n.useState(!1),[C,x]=Pe.useMessage(),F=()=>{S(!0),D(null),E(null),A([]),R([])},h=()=>{S(!1),D(null),E(null),A([]),R([])},H=o=>o.length>=3&&o[0]===239&&o[1]===187&&o[2]===191?{encoding:"utf-8",offset:3}:o.length>=2&&o[0]===255&&o[1]===254?{encoding:"utf-16le",offset:2}:o.length>=2&&o[0]===254&&o[1]===255?{encoding:"utf-16be",offset:2}:null,T=async o=>{const P=await o.arrayBuffer(),r=new Uint8Array(P),v=H(r);if(v)return new TextDecoder(v.encoding).decode(r.subarray(v.offset));try{return new TextDecoder("utf-8",{fatal:!0}).decode(r)}catch{const d=["gb18030","gbk"];for(const I of d)try{return new TextDecoder(I).decode(r)}catch{continue}}return new TextDecoder("utf-8").decode(r)},q=(o,P,r)=>{et.parse(o,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:P,error:r})},N=async o=>{D(o),E(null);try{const P=await T(o);E(P),q(P,r=>{if(r.errors.length>0){C.error("CSV解析失败: "+r.errors[0].message);return}const v=r.data.slice(0,10);if(A(v),r.data.length>0){const U=r.data[0],d=Object.keys(U).map(I=>({title:I,dataIndex:I,key:I,ellipsis:!0,render:g=>g==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof g=="object"?JSON.stringify(g):String(g)}));R(d)}},r=>{C.error("CSV解析失败: "+r.message)})}catch(P){C.error((P==null?void 0:P.message)||"CSV读取失败")}return!1},se=async()=>{if(!j){C.error("请先选择CSV文件");return}f(!0);const o=C.loading("正在导入数据...",0);try{const P=u??await T(j);q(P,async r=>{try{if(r.errors.length>0)throw new Error("CSV解析失败: "+r.errors[0].message);const v=et.unparse(r.data,{quotes:!0,header:!0}),U=await fetch(`/api/data/${encodeURIComponent(p)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:v})});if(!U.ok){const I=await U.json();throw new Error(I.error||"导入失败")}const d=await U.json();C.success(`导入成功！共导入 ${d.recordCount} 条记录`),S(!1),D(null),E(null),A([]),R([]),t()}catch(v){C.error(v.message||"导入失败")}finally{o(),f(!1)}},r=>{C.error("CSV解析失败: "+r.message),o(),f(!1)})}catch(P){C.error(P.message||"导入失败"),o(),f(!1)}};return e.jsxs(e.Fragment,{children:[x,e.jsx(J,{icon:e.jsx(ft,{}),onClick:F,size:"small",children:"导入CSV"}),e.jsx(Ce,{title:`导入CSV到 "${W}"`,open:$,onCancel:h,onOk:se,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:G,okButtonProps:{disabled:!j},children:e.jsxs(ke,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(ye,{accept:".csv",beforeUpload:N,maxCount:1,fileList:j?[{uid:"-1",name:j.name,status:"done"}]:[],onRemove:()=>{D(null),E(null),A([]),R([])},children:e.jsx(J,{icon:e.jsx(xt,{}),children:"选择CSV文件"})})}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(gt,{columns:M,dataSource:V,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(o,P)=>(P==null?void 0:P.toString())||"0"}),V.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function gs({fileName:p}){const[W,t]=n.useState(!1),[$,S]=Pe.useMessage(),j=async()=>{t(!0);const D=$.loading("正在导出数据...",0);try{const u=await fetch(`/api/data/${encodeURIComponent(p)}/export`);if(!u.ok){const R=await u.json();throw new Error(R.error||"导出失败")}const E=await u.text(),V=new Blob([E],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(V),M=document.createElement("a");M.href=A,M.download=`${p}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(A),$.success("导出成功")}catch(u){$.error(u.message||"导出失败")}finally{D(),t(!1)}};return e.jsxs(e.Fragment,{children:[S,e.jsx(J,{icon:e.jsx(qt,{}),onClick:j,loading:W,size:"small",children:"导出CSV"})]})}function ys({fileName:p,tableName:W,onRefresh:t}){const[$,S]=n.useState(!1),[j,D]=n.useState([]),[u,E]=n.useState(null),[V,A]=n.useState(null),[M,R]=n.useState(null),[G,f]=n.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:d=>`共 ${d} 条记录`,size:"small"}),[C,x]=Pe.useMessage(),[F]=Oe.useForm();n.useEffect(()=>{h()},[p]);const h=async()=>{S(!0);try{const d=await fetch(`/api/data/${encodeURIComponent(p)}`);if(!d.ok)throw new Error("Failed to fetch data");const I=await d.json();D(I),f(g=>({...g,total:I.length}))}catch(d){C.error("加载数据失败: "+d.message)}finally{S(!1)}},H=async d=>{const I=C.loading("正在删除...",0);try{const g=await fetch(`/api/data/${encodeURIComponent(p)}/${encodeURIComponent(String(d))}`,{method:"DELETE"});if(!g.ok){const i=await g.json();throw new Error(i.error||"删除失败")}C.success("删除成功"),h()}catch(g){C.error(g.message||"删除失败")}finally{I()}},T=d=>{E(d.id),A({...d}),R({...d}),F.setFieldsValue(d)},q=()=>{M&&u&&F.setFieldsValue(M),E(null),A(null),R(null),F.resetFields()},N=(d,I)=>d==="id"?"ID字段不可编辑":(I==null||typeof I=="string"&&I.trim()==="",null),se=async()=>{if(!(!u||!V))try{const d=F.getFieldsValue();for(const[g,i]of Object.entries(d)){const y=N(g,i);if(y){C.error(y);return}}const I=C.loading("正在保存...",0);try{const{id:g,...i}=d,y=await fetch(`/api/data/${encodeURIComponent(p)}/${encodeURIComponent(String(u))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!y.ok){const K=await y.json();throw new Error(K.error||"保存失败")}C.success("保存成功"),E(null),A(null),R(null),F.resetFields(),h()}catch(g){C.error(g.message||"保存失败"),M&&(F.setFieldsValue(M),C.info("已恢复到原始数据"))}finally{I()}}catch(d){C.error("验证失败: "+d.message),M&&(F.setFieldsValue(M),C.info("已恢复到原始数据"))}},o=d=>{f(d)},P=()=>{h(),t&&t()},r=(d,I,g)=>u==I.id?g==="id"?e.jsx(pe,{value:d,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof d==="number"?e.jsx(Oe.Item,{name:g,style:{margin:0},rules:[{validator:(K,ne)=>{const Q=N(g,ne);return Q?Promise.reject(Q):Promise.resolve()}}],children:e.jsx(es,{style:{width:"100%"},size:"small"})}):e.jsx(Oe.Item,{name:g,style:{margin:0},rules:[{validator:(K,ne)=>{const Q=N(g,ne);return Q?Promise.reject(Q):Promise.resolve()}}],children:e.jsx(pe,{size:"small"})}):d==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof d=="object"?JSON.stringify(d):String(d),U=(()=>{if(j.length===0)return[];const d=new Set;j.forEach(i=>{Object.keys(i).forEach(y=>d.add(y))});const g=Array.from(d).sort((i,y)=>i==="id"?-1:y==="id"?1:i.localeCompare(y)).map(i=>({title:i,dataIndex:i,key:i,ellipsis:!0,render:(y,K)=>r(y,K,i)}));return g.push({title:"操作",key:"action",fixed:"right",width:80,render:(i,y)=>u==y.id?e.jsxs(ke,{size:"small",children:[e.jsx(Se,{title:"保存",children:e.jsx(J,{type:"link",size:"small",icon:e.jsx(Zt,{}),onClick:se})}),e.jsx(Se,{title:"取消",children:e.jsx(J,{type:"link",size:"small",icon:e.jsx(Yt,{}),onClick:q})})]}):e.jsxs(ke,{size:"small",children:[e.jsx(Se,{title:"编辑",children:e.jsx(J,{type:"link",size:"small",icon:e.jsx(pt,{}),onClick:()=>T(y),disabled:u!==null})}),e.jsx(Qt,{title:"确定要删除这条记录吗？",onConfirm:()=>H(y.id),okText:"确定",cancelText:"取消",children:e.jsx(Se,{title:"删除",children:e.jsx(J,{type:"link",danger:!0,size:"small",icon:e.jsx(yt,{}),disabled:u!==null})})})]})}),g})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[x,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",W]}),e.jsxs(ke,{children:[e.jsx(xs,{fileName:p,tableName:W,onImportComplete:P}),e.jsx(gs,{fileName:p,tableName:W}),e.jsx(J,{icon:e.jsx(Xt,{}),onClick:P,disabled:u!==null,size:"small",children:"刷新"})]})]}),e.jsx(Oe,{form:F,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(gt,{columns:U,dataSource:j,rowKey:d=>String(d.id),loading:$,pagination:G,onChange:o,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(ie,{description:"暂无数据，请导入 CSV 或添加记录",image:ie.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function js({onRefresh:p}){const[W,t]=n.useState(!1),[$,S]=n.useState([]),[j,D]=n.useState(""),[u,E]=Pe.useMessage(),[V,A]=Ce.useModal(),[M,R]=n.useState(!1),[G,f]=n.useState(""),C=j==="";n.useEffect(()=>{x()},[j]);const x=async()=>{t(!0);try{const r=j?`/api/media?path=${encodeURIComponent(j)}`:"/api/media",v=await fetch(r);if(!v.ok)throw new Error("Failed to fetch media assets");const U=await v.json();S(Array.isArray(U)?U:[])}catch(r){u.error("加载素材失败: "+r.message),S([])}finally{t(!1)}},F=async r=>{const{file:v,onSuccess:U,onError:d}=r,I=new FormData;I.append("file",v),j&&I.append("path",j);try{const g=await fetch("/api/media/upload",{method:"POST",body:I});if(!g.ok){const i=await g.json();throw new Error(i.error||"上传失败")}u.success(`${v.name} 上传成功`),U(null,v),x(),p&&p()}catch(g){u.error(g.message||"上传失败"),d(g)}},h=r=>{V.confirm({title:`确定要删除 "${r.name}" 吗？`,content:r.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const v=u.loading("正在删除...",0);try{const U=await fetch(`/api/media/${encodeURIComponent(r.path)}`,{method:"DELETE"});if(!U.ok){const d=await U.json();throw new Error(d.error||"删除失败")}u.success("删除成功"),x(),p&&p()}catch(U){u.error(U.message||"删除失败")}finally{v()}}})},H=r=>{r.type==="folder"&&D(r.path)},T=r=>{D(r)},q=()=>{R(!0),f("")},N=async()=>{if(!G.trim()){u.error("请输入文件夹名称");return}const r=u.loading("正在创建文件夹...",0);try{const v=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:G.trim(),parentPath:j||void 0})});if(!v.ok){const U=await v.json();throw new Error(U.error||"创建文件夹失败")}u.success("文件夹创建成功"),R(!1),x(),p&&p()}catch(v){u.error(v.message||"创建文件夹失败")}finally{r()}},se=()=>{const r=j?j.split("/"):[],v=[{title:e.jsxs("a",{onClick:()=>T(""),children:[e.jsx(ts,{})," 根目录"]})},...r.map((U,d)=>{const I=r.slice(0,d+1).join("/");return{title:e.jsx("a",{onClick:()=>T(I),children:U})}})];return e.jsx(ss,{items:v,style:{marginBottom:16}})},o=r=>r.type==="folder"?e.jsx(ns,{style:{fontSize:48,color:"#faad14"}}):r.type==="image"?e.jsx(ct,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(os,{style:{fontSize:48,color:"#1890ff"}}),P=r=>{const v=()=>[{key:"delete",label:"删除",icon:e.jsx(yt,{}),danger:!0,onClick:()=>h(r)}];return e.jsx(Be,{hoverable:!0,style:{height:"100%"},cover:r.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>H(r),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(r.path)}`,alt:r.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:r.type==="folder"?"pointer":"default"},onClick:()=>H(r),children:o(r)}),actions:[e.jsx(Ge,{menu:{items:v()},trigger:["click"],children:e.jsx(J,{type:"text",icon:e.jsx(mt,{})})})],children:e.jsx(Be.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:r.type==="folder"?"文件夹":r.size?`${(r.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[E,A,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(ke,{children:[e.jsx(J,{icon:e.jsx(it,{}),onClick:q,children:"新建文件夹"}),!C&&e.jsx(ye,{customRequest:F,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(J,{type:"primary",icon:e.jsx(xt,{}),children:"上传文件"})})]})]}),se(),W?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(ht,{size:"large",tip:"加载中..."})}):$.length===0?e.jsx(ie,{description:C?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(ot,{gutter:[16,16],children:$.map(r=>e.jsx(rt,{xs:12,sm:8,md:6,lg:4,xl:4,children:P(r)},r.id))}),e.jsx(Ce,{title:"新建文件夹",open:M,onOk:N,onCancel:()=>R(!1),okText:"创建",cancelText:"取消",children:e.jsx(pe,{placeholder:"请输入文件夹名称",value:G,onChange:r=>f(r.target.value),onPressEnter:N})})]})}const{Content:ws}=Ae,{useToken:bs}=Te,Ss=({activeTab:p,selectedTheme:W,selectedDoc:t,selectedLibrary:$,selectedDataTable:S,onRefreshDataTables:j,onRefreshMedia:D})=>{const{token:u}=bs(),E=()=>{if(!W)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个主题",image:ie.PRESENTED_IMAGE_SIMPLE})});const f=`/themes/${encodeURIComponent(W.name)}`;return e.jsx("iframe",{src:f,style:{width:"100%",flex:1,border:"none",background:u.colorBgContainer},title:W.displayName})},V=()=>{if(!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个文档",image:ie.PRESENTED_IMAGE_SIMPLE})});const f=t.name.replace(/\.md$/i,""),C=`/assets/docs/${encodeURIComponent(f)}`;return e.jsx("iframe",{src:C,style:{width:"100%",flex:1,border:"none",background:u.colorBgContainer},title:t.displayName})},A=()=>{if(!$)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个前端库",image:ie.PRESENTED_IMAGE_SIMPLE})});const f=`/assets/libraries/${$.name}`;return e.jsx("iframe",{src:f,style:{width:"100%",flex:1,border:"none",background:u.colorBgContainer},title:$.displayName})},M=()=>S?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:u.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(ys,{fileName:S.fileName,tableName:S.tableName,onRefresh:j})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个数据表",image:ie.PRESENTED_IMAGE_SIMPLE})}),R=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:u.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(js,{onRefresh:D})}),G=()=>{switch(p){case"themes":return E();case"docs":return V();case"libraries":return A();case"data":return M();case"media":return R();default:return null}};return e.jsx(ws,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:u.colorBgContainer,display:"flex",flexDirection:"column"},children:G()})},st="axhub-assets-active-tab",ks="/api/themes",Cs="/api/docs",Is="/api/libraries",nt="axhub-make-dark-mode";function Es(p){return p==="claude"||p==="cursor"||p==="codex"}function vs({isDarkMode:p,setIsDarkMode:W}){const{message:t,modal:$}=He.useApp(),{token:S}=Te.useToken(),j="http://localhost:32123",D={webBaseUrl:j,apiBaseUrl:`${j}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"助手运行时不可用，请先启动 Axhub Genie。",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:"npm install -g @axhub/genie",start:"axhub-genie",status:"axhub-genie status"}}},u=320,E=320,V=640,[A,M]=n.useState(!0),[R,G]=n.useState(!1),[f,C]=n.useState(()=>{const s=localStorage.getItem(st);return s==="themes"||s==="docs"||s==="libraries"||s==="data"||s==="media"?s:"themes"}),[x,F]=n.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[h,H]=n.useState(null),[T,q]=n.useState(null),[N,se]=n.useState(null),[o,P]=n.useState(null),[r,v]=n.useState(""),[U,d]=n.useState(!1),[I,g]=n.useState([]),[i,y]=n.useState(!1),[K,ne]=n.useState(!1),[Q,oe]=n.useState(""),[z,X]=n.useState(null),[l,w]=n.useState(null),[B,fe]=n.useState(!1),[O,te]=n.useState(null),[le,ee]=n.useState(!1),[re,ce]=n.useState(()=>{const s=localStorage.getItem(Ye),a=s?Number(s):NaN;return Number.isFinite(a)&&a>=E?Math.min(a,V):u}),de=n.useRef(null),[xe,je]=n.useState(!1),[he,Ie]=n.useState(null);n.useEffect(()=>{localStorage.setItem(st,f)},[f]),n.useEffect(()=>{Z()},[]),n.useEffect(()=>{let s=!1;return ve.getConfig().then(a=>{var m,b;if(s)return;const c=(m=a==null?void 0:a.automation)==null?void 0:m.defaultPromptClient;X(Es(c)?c:null),w(((b=a==null?void 0:a.automation)==null?void 0:b.defaultIDE)||null)}).catch(()=>{s||(X(null),w(null))}),()=>{s=!0}},[]),n.useEffect(()=>{let s=!1;return ve.getAssistantRuntime().then(a=>{s||te(a)}).catch(()=>{s||te(D)}),()=>{s=!0}},[]),n.useEffect(()=>{localStorage.setItem(Ye,String(Math.round(re)))},[re]),n.useEffect(()=>{!A&&x&&(f==="themes"&&x.themes.length>0&&!h?H(x.themes[0]):f==="docs"&&x.docs.length>0&&!T?q(x.docs[0]):f==="libraries"&&x.libraries.length>0&&!N?se(x.libraries[0]):f==="data"&&x.dataTables.length>0&&!o&&P(x.dataTables[0]))},[A,x,f,h,T,N,o]);const Z=async()=>{M(!0);try{const[s,a,c,m,b]=await Promise.all([fetch(ks),fetch(Cs),fetch(Is),fetch("/api/data/tables"),fetch("/api/media")]);if(!s.ok||!a.ok||!c.ok||!m.ok||!b.ok)throw new Error("Failed to fetch data");const k=await s.json(),L=await a.json(),ae=await c.json(),_=await m.json(),Y=await b.json();F({themes:k||[],docs:L||[],libraries:ae||[],dataTables:Array.isArray(_)?_:[],mediaAssets:Array.isArray(Y)?Y:[]})}catch(s){t.error("加载数据失败: "+s.message),F({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{M(!1)}},we=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个主题」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件
- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力
- 告知：已经准备好开始新建主题
- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以
- 若信息不足，再用 2-4 个简短问题收集关键输入即可

**📋 必读规范文档**：
- **\`/rules/theme-generation-guide.md\`** ⭐️ 主题生成完整规范！
  - 请完整阅读此文档，了解主题生成的所有要求和约束
  - 文档包含：交付物规范、文件结构、生成策略、验收流程等

**提示**：如果用户没给 \`<theme-key>\` / \`name\` / \`description\`，先给出你建议的 \`<theme-key>\`，并让用户一键确认即可`,[]),me=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，优先使用 DeepWiki MCP 或 Context7 MCP 获取最新官方文档与版本信息
- 若 MCP 不可用，再提示用户补充链接或版本

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`,[]),ue=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`,[]),jt=n.useMemo(()=>f==="themes"?{scene:"assets-create-theme",buildPrompt:we}:f==="libraries"?{scene:"assets-create-library",buildPrompt:me}:f==="docs"?{scene:"assets-create-doc",buildPrompt:ue}:null,[f,we,me,ue]),be=n.useMemo(()=>({version:"1",systemContext:"",currentFile:f==="themes"&&h?`src/themes/${h.name}/index.tsx`:f==="docs"&&T?`assets/docs/${T.name}`:f==="libraries"&&N?`assets/libraries/${N.name}.md`:f==="data"&&o?`assets/database/${o.fileName}.json`:"",selectedElements:[],extensions:{source:"axhub-runtime-assets",projectPath:(O==null?void 0:O.projectPath)||"",activeTab:f,selectedAsset:f==="themes"?h:f==="docs"?T:f==="libraries"?N:o,updatedAt:new Date().toISOString()}}),[f,h,T,N,o,O==null?void 0:O.projectPath]),$e=n.useCallback((s,a)=>{try{const c=new URL(s,window.location.origin);return c.searchParams.set("context",JSON.stringify(a)),c.toString()}catch(c){return console.warn("Failed to serialize assistant context into URL:",c),s}},[]),Ee=n.useMemo(()=>{const s=((O==null?void 0:O.webBaseUrl)||j).replace(/\/+$/g,""),a=new URL(`${s}/`),c=(O==null?void 0:O.projectPath)||"";return c&&a.searchParams.set("cwd",c),z&&a.searchParams.set("provider",z),a.toString()},[O,z]),Re=he||Ee,Fe=V;n.useEffect(()=>{je(!1)},[Re]);const Ke=n.useCallback(()=>{const s=de.current;if(!s||!s.contentWindow)return;let a="*";try{a=new URL(Re).origin}catch{a="*"}const c={type:"update_context",mode:"replace",context:be};s.contentWindow.postMessage(c,a)},[Re,be]);n.useEffect(()=>{!B||!xe||Ke()},[B,xe,Ke]);const Ne=n.useCallback((s,a)=>{const m=$e(s||Ee,be);Ie(m),fe(!0)},[Ee,$e,be]),Le=n.useCallback((s,a)=>{const m=$e(s||Ee,be);window.open(m,"_blank")},[Ee,$e,be]),Je=n.useCallback(async s=>{const a=s.health.hints,c=[s.health.message,a.installGlobal,a.start,a.status];await navigator.clipboard.writeText(c.join(`
`))},[]),qe=n.useCallback(async(s=15e3)=>{const a=Date.now();for(;Date.now()-a<s;){try{const c=await ve.getAssistantRuntime();if(te(c),c.health.status==="ready")return c}catch{}await new Promise(c=>setTimeout(c,1e3))}return null},[]),Xe=n.useCallback(async s=>{const a=await ve.bootstrapAssistant({mode:s}),c=(a==null?void 0:a.runtime)||D;return te(c),c},[]),ze=n.useCallback((s,a,c,m,b="iframe")=>{const k=s.health.hints,L=async ae=>{const _=t.loading("正在启动 Axhub Genie...",0);try{await Xe(ae);const Y=await qe(15e3);(Y==null?void 0:Y.health.status)==="ready"?(t.success("Axhub Genie 已就绪，正在打开。"),b==="window"?Le(c,m):Ne(c,m)):t.warning("尚未就绪，请稍后重试，或手动执行提示命令。")}catch(Y){t.error((Y==null?void 0:Y.message)||"自动启动失败，请手动执行命令。")}finally{_()}};$.confirm({title:"Axhub Genie 未就绪",content:e.jsxs("div",{children:[e.jsx("p",{children:s.health.message}),e.jsx("p",{style:{marginBottom:6},children:"推荐命令："}),e.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:k.installGlobal})]}),okText:"自动安装并启动",cancelText:"关闭",onOk:()=>L("install_global"),footer:(ae,{OkBtn:_,CancelBtn:Y})=>e.jsxs(e.Fragment,{children:[e.jsx(J,{onClick:async()=>{try{await Je(s),t.success("命令已复制到剪贴板")}catch{t.error("复制失败，请手动复制")}},children:"复制命令"}),e.jsx(Y,{}),e.jsx(_,{})]})}),a==="event"&&t.warning("Genie 未就绪，已回退为安装引导。")},[t,$,Xe,qe,Ne,Le,Je]),De=n.useCallback(async(s,a,c,m="iframe")=>{if(le)return!1;ee(!0);try{const b=await ve.getAssistantRuntime();if(te(b),b.health.status==="ready")return m==="window"?Le(a,c):Ne(a,c),!0;ze(b,s,a,c,m)}catch(b){const k=O||D;te(k),t.error((b==null?void 0:b.message)||"检测 Axhub Genie 状态失败"),ze(k,s,a,c,m)}finally{ee(!1)}return!1},[le,O,t,Ne,Le,ze]),wt=n.useCallback(()=>{if(B){fe(!1);return}De("button")},[B,De]);n.useEffect(()=>{const s=a=>{const c=a,m=c.detail,b=m==null?void 0:m.url;!b||typeof b!="string"||(De("event",b,m==null?void 0:m.targetPath),c.preventDefault())};return window.addEventListener(Qe,s),()=>{window.removeEventListener(Qe,s)}},[De]);const bt=s=>{C(s),v("")},St=s=>{H(s)},kt=s=>{q(s)},Ct=s=>{se(s)},It=s=>{P(s)},Et=async(s,a)=>{if(s==="data"){const c=a,m=c.fileName,b=c.tableName;let k=b;$.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",m,".json (不可修改)"]}),e.jsx(pe,{autoFocus:!0,defaultValue:b,placeholder:"请输入新的表名称",onChange:L=>{k=L.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const L=k==null?void 0:k.trim();if(!L)return t.error("表名称不能为空"),Promise.reject();if(L===b)return;const ae=t.loading("正在重命名...",0);try{const _=await fetch(`/api/data/tables/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:L})});if(!_.ok){const Y=await _.json();throw new Error(Y.error||"重命名失败")}t.success("重命名成功"),(o==null?void 0:o.fileName)===m&&P({...o,tableName:L}),await Z()}catch(_){return t.error(_.message||"重命名失败"),Promise.reject()}finally{ae()}}});return}if(s==="docs"){const m=a.name,b=m.lastIndexOf("."),k=b>0?m.slice(0,b):m,L=b>0?m.slice(b):"";let ae=k;$.confirm({title:"重命名文档",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["扩展名: ",L||"无"]}),e.jsx(pe,{autoFocus:!0,defaultValue:k,placeholder:"请输入新的文档名称",onChange:_=>{ae=_.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){let _=ae==null?void 0:ae.trim();if(!_||(L&&_.endsWith(L)&&(_=_.slice(0,-L.length).trim()),!_))return t.error("文档名称不能为空"),Promise.reject();if(_===k)return;const Y=t.loading("正在重命名...",0);try{const Ue=await fetch(`/api/docs/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBaseName:_})});if(!Ue.ok){const $t=await Ue.json();throw new Error($t.error||"重命名失败")}t.success("重命名成功");const Ze=`${_}${L}`;(T==null?void 0:T.name)===m&&q({...T,name:Ze,displayName:Ze}),await Z()}catch(Ue){return t.error(Ue.message||"重命名失败"),Promise.reject()}finally{Y()}}});return}if(s==="themes"){const c=a,m=c.name,b=c.displayName||c.name;let k=b;$.confirm({title:"重命名主题",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["主题目录: ",m," (不可修改)"]}),e.jsx(pe,{autoFocus:!0,defaultValue:b,placeholder:"请输入新的主题名称",onChange:L=>{k=L.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const L=k==null?void 0:k.trim();if(!L)return t.error("主题名称不能为空"),Promise.reject();if(L===b)return;const ae=t.loading("正在重命名...",0);try{const _=await fetch(`/api/themes/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:L})});if(!_.ok){const Y=await _.json();throw new Error(Y.error||"重命名失败")}t.success("重命名成功"),(h==null?void 0:h.name)===m&&H({...h,displayName:L}),await Z()}catch(_){return t.error(_.message||"重命名失败"),Promise.reject()}finally{ae()}}})}},vt=async(s,a,c)=>{const m={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};if(s==="themes"){const b=t.loading("正在删除...",0);try{const k=await fetch(`/api/themes/${a}`,{method:"DELETE"});if(!k.ok){const L=await k.json();throw new Error(L.error||"删除失败")}t.success("删除成功"),(h==null?void 0:h.name)===a&&H(null),Z()}catch(k){t.error(k.message||"删除失败")}finally{b()}return}$.confirm({title:`确定要删除${m[s]} "${c}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const b=t.loading("正在删除...",0);try{let k;if(s==="data")k=await fetch(`/api/data/tables/${a}`,{method:"DELETE"});else if(s==="docs")k=await fetch(`/api/docs/${encodeURIComponent(a)}`,{method:"DELETE"});else if(s==="libraries")k=await fetch(`/api/libraries/${a}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!k.ok){const L=await k.json();throw new Error(L.error||"删除失败")}t.success("删除成功"),s==="docs"&&(T==null?void 0:T.name)===a?q(null):s==="libraries"&&(N==null?void 0:N.name)===a?se(null):s==="data"&&(o==null?void 0:o.fileName)===a&&P(null),Z()}catch(k){t.error(k.message||"删除失败")}finally{b()}}})},At=()=>{if(f==="docs"){d(!0);return}if(f==="data"){ne(!0);return}t.info("新建功能开发中...")},Pt=async()=>{if(I.length===0){t.warning("请先上传文件");return}y(!0);try{const s=await Promise.all(I.map(async c=>{const m=c.originFileObj;if(!m)throw new Error("文件读取失败，请重新选择文件");const b=m.name,k=b.toLowerCase();if(!k.endsWith(".md")&&!k.endsWith(".csv")&&!k.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(m.size>5242880)throw new Error("单个文件大小不能超过 5MB");const L=await m.text();return{name:b,content:L}})),a=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:s})});if(!a.ok){const c=await a.json().catch(()=>null);throw new Error((c==null?void 0:c.error)||"上传失败")}t.success("上传成功"),d(!1),g([]),Z()}catch(s){t.error((s==null?void 0:s.message)||"上传失败")}finally{y(!1)}},Tt=async()=>{if(!Q.trim()){t.error("请输入表名");return}const s=t.loading("正在创建表...",0);try{const a=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:Q.trim()})});if(!a.ok){const c=await a.json();throw new Error(c.error||"创建表失败")}t.success("表创建成功"),ne(!1),oe(""),Z()}catch(a){t.error(a.message||"创建表失败")}finally{s()}};return e.jsxs(Ae,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(fs,{collapsed:R,setCollapsed:G,activeTab:f,onTabChange:bt,counts:{themes:x.themes.length,docs:x.docs.length,libraries:x.libraries.length,data:x.dataTables.length,media:x.mediaAssets.length},isDarkMode:p,setIsDarkMode:W,assistantEnabled:!0,assistantVisible:B,onToggleAssistant:wt,preferredPromptClient:z,preferredIDE:l}),e.jsxs(Ae,{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx(ps,{collapsed:R,loading:A,activeTab:f,themes:x.themes,docs:x.docs,libraries:x.libraries,dataTables:x.dataTables,selectedTheme:h,selectedDoc:T,selectedLibrary:N,selectedDataTable:o,onThemeSelect:St,onDocSelect:kt,onLibrarySelect:Ct,onDataTableSelect:It,onDeleteAsset:vt,onRenameAsset:Et,onCreateClick:At,searchText:r,setSearchText:v,preferredPromptClient:z,preferredIDE:l,createPromptConfig:jt}),e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(Ss,{activeTab:f,selectedTheme:h,selectedDoc:T,selectedLibrary:N,selectedDataTable:o,onRefreshDataTables:Z,onRefreshMedia:Z})}),B&&e.jsx(is,{size:{width:Math.min(Math.max(re,E),Fe),height:"calc(100vh - 48px)"},minWidth:E,maxWidth:Fe,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(s,a,c)=>{const m=Math.min(Math.max(c.getBoundingClientRect().width,E),Fe);ce(m)},style:{borderLeft:`1px solid ${S.colorBorderSecondary}`,background:S.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:de,src:Re,title:"Axhub Genie",onLoad:()=>je(!0),style:{border:"none",width:"100%",height:"100%"}})})]}),e.jsx(Ce,{title:"新建文档",open:U,onCancel:()=>{d(!1),g([])},footer:[e.jsx(_e,{preferredClient:z,preferredIDE:l,scene:"assets-create-doc",buildPrompt:ue,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy"),e.jsx(J,{type:"primary",loading:i,onClick:Pt,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(ye.Dragger,{multiple:!0,accept:".md",fileList:I,beforeUpload:s=>(s.name||"").toLowerCase().endsWith(".md")?!1:(t.error("仅支持上传 .md 文件"),ye.LIST_IGNORE),onChange:s=>g(s.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"仅支持 .md 文件，支持批量上传"})]})})}),e.jsx(Ce,{title:"新建数据表",open:K,onOk:Tt,onCancel:()=>{ne(!1),oe("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(pe,{placeholder:"例如: 用户表, 产品列表",value:Q,onChange:s=>oe(s.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function As(){const[p,W]=n.useState(()=>localStorage.getItem(nt)==="true");return n.useEffect(()=>{localStorage.setItem(nt,String(p))},[p]),e.jsx(as,{theme:ls(p),children:e.jsx(He,{children:e.jsx(vs,{isDarkMode:p,setIsDarkMode:W})})})}const Ps=rs.createRoot(document.getElementById("root"));Ps.render(e.jsx(As,{}));
