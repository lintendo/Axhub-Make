import{P as Me,o as et,S as tt,a as De,n as Dt,t as Ut,A as st}from"./chunks/PromptActionButton.js";import{T as Ee,U as xe,s as Ae,t as Pe,r as n,j as e,M as Se,R as it,C as lt,B as ct,a as Ve,S as be,b as q,c as dt,d as _t,e as ut,f as ft,g as Mt,L as ve,h as pe,i as Ot,k as Ft,l as Bt,m as zt,n as mt,o as Ge,p as He,q as ht,u as we,v as pt,w as Wt,D as Ke,x as Vt,y as Gt,z as Ht,A as Kt,E as Jt,F as Xt,G as Je,I as me,H as qt,J as xt,K as re,N as Zt,O as gt,P as Yt,Q as yt,V as jt,W as wt,X as nt,Y as Qt,Z as Ue,_ as es,$ as ts,a0 as ss,a1 as ns,a2 as bt,a3 as os,a4 as rs,a5 as as,a6 as is,a7 as ls,a8 as cs,a9 as ds,aa as us}from"./chunks/vendor.js";import{g as fs}from"./chunks/index.js";import"./chunks/execute.js";const{Text:_e}=Ee,{Dragger:ot}=xe,ms=({open:S,onCancel:F,preferredPromptClient:c,preferredIDE:d})=>{const[j,k]=Ae.useMessage(),{token:D}=Pe.useToken(),[u,T]=n.useState(null),[W,v]=n.useState([]),[M,L]=n.useState(!1),[B,U]=n.useState(null),[E,p]=n.useState([]),[z,m]=n.useState(!1),[K,N]=n.useState(null),[J,$]=n.useState(null);n.useEffect(()=>{S||(T(null),v([]),L(!1),U(null),p([]),m(!1),N(null),$(null))},[S]);const ee=[{key:"local_axure",title:"本地 Axure 文件导入",icon:e.jsx(dt,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePaths:["/skills/local-axure-workflow/SKILL.md"],disabled:!1,recommended:!0},{key:"axure_prototype",title:"Axure 原型链接导入",icon:e.jsx(_t,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePaths:["/skills/axure-prototype-workflow/SKILL.md","/skills/axure-prototype-workflow/asset-extraction.md","/skills/axure-prototype-workflow/page-restoration.md"],disabled:!1},{key:"web_page",title:"产品网页链接导入",icon:e.jsx(ut,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePaths:["/skills/web-page-workflow/SKILL.md","/skills/web-page-workflow/asset-extraction.md","/skills/web-page-workflow/page-restoration.md"],disabled:!1},{key:"screenshot",title:"App/小程序/网页截图导入",icon:e.jsx(ft,{style:{fontSize:24,color:"#faad14"}}),desc:"上传多张截图，提取结构/交互/状态数据，并生成页面/元素",rulePaths:["skills/screen-to-code/SKILL.md","skills/screen-to-code/screenshot-collection.md"],disabled:!1},{key:"app_direct",title:"App/小程序直接导入",icon:e.jsx(Mt,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePaths:[],disabled:!0}],r=u&&ee.find(a=>a.key===u)||null,R=(a,y)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「${a}」设计资产。

请认真阅读规则文档：
${y.map(G=>`- \`${G}\``).join(`
`)}
并按文档定义的交互指南回复用户。`,s=(a,y)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「基于${a}导入资产」。

**交互要求**：
- 收到本条系统指令后，先根据 skill 的用户交互指南用简短中文回复一次，确认需求，并引导用户提供 ${a}（URL）
- 未拿到链接前，不要生成任何文件
- 参考下方文档，按流程逐步引导用户完成导入与还原/优化

**📋 参考文档（必须阅读）**：
${y.map(G=>`- \`${G}\``).join(`
`)}`,C=a=>{T(a),v([]),U(null),p([]),N(null),$(null)},_=async a=>{const{file:y,onSuccess:G,onError:se}=a,Z=y instanceof File?y:y.originFileObj,oe=new FormData;oe.append("file",Z,Z.name),oe.append("uploadType","local_axure"),L(!0);try{const H=await fetch("/api/upload",{method:"POST",body:oe}),Y=await H.json();H.ok&&Y.success?(U(Y),j.success(Y.message||"文件已解压，请复制 Prompt 交给 AI 处理"),G(null,y)):(j.error(Y.error||"上传失败"),se(new Error(Y.error||"上传失败")))}catch(H){j.error("上传失败: "+((H==null?void 0:H.message)||"Unknown error")),se(H)}finally{L(!1)}},f=async a=>{const{file:y,onSuccess:G,onError:se}=a,Z=y instanceof File?y:y.originFileObj,oe=new FormData;oe.append("file",Z,Z.name),J&&oe.append("batchId",J),m(!0);try{const H=await fetch("/api/upload-screenshots",{method:"POST",body:oe}),Y=await H.json();H.ok&&Y.success?(N(Y),$(Y.batchId||J),j.success(Y.message||"截图已上传，请复制 Prompt 交给 AI 处理"),G(null,y)):(j.error(Y.error||"上传失败"),se(new Error(Y.error||"上传失败")))}catch(H){j.error("上传失败: "+((H==null?void 0:H.message)||"Unknown error")),se(H)}finally{m(!1)}},P=!r||r.disabled?!1:r.key==="local_axure"?!!(B!=null&&B.prompt):r.key==="screenshot"?!!(K!=null&&K.prompt):!0,w=()=>!r||r.disabled?"":r.key==="local_axure"?(B==null?void 0:B.prompt)||"":r.key==="screenshot"?(K==null?void 0:K.prompt)||"":r.key==="axure_prototype"?s("Axure 原型链接",r.rulePaths):r.key==="web_page"?s("网页链接",r.rulePaths):R(r.title,r.rulePaths);return e.jsxs(Se,{title:"智能导入资产",open:S,onCancel:F,footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:8,width:"100%"},children:[e.jsx(q,{onClick:F,children:"取消"},"cancel"),e.jsx(Me,{preferredClient:c,preferredIDE:d,scene:`assets-smart-import-${(r==null?void 0:r.key)||"unknown"}`,buildPrompt:w,disabled:!P,copyLabel:"复制新建 Prompt",style:{flex:"0 0 auto"},executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy")]}),width:800,destroyOnClose:!0,children:[k,e.jsx(it,{gutter:[16,16],children:ee.map((a,y)=>e.jsx(lt,{span:12,children:e.jsx(ct.Ribbon,{text:"推荐",color:"#008F5D",style:{display:a.recommended?"block":"none"},children:e.jsx(Ve,{hoverable:!a.disabled,style:{height:"100%",cursor:a.disabled?"not-allowed":"pointer",opacity:a.disabled?.6:1,background:a.disabled?"#f5f5f5":u===a.key?D.colorFillAlter:void 0,borderColor:u===a.key?D.colorInfo:void 0},onClick:()=>{a.disabled||C(a.key)},children:e.jsxs(be,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:a.disabled?"#e8e8e8":a.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:a.icon}),e.jsxs("div",{children:[e.jsx(_e,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:a.title}),e.jsx(_e,{type:"secondary",style:{fontSize:13},children:a.desc})]})]})})})},y))}),u==="local_axure"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(ot,{name:"file",multiple:!1,fileList:W,customRequest:_,beforeUpload:a=>{var G;return a.type==="application/zip"||a.type==="application/x-zip-compressed"||((G=a.name)==null?void 0:G.endsWith(".zip"))?!0:(j.error("请上传 ZIP 格式的文件"),xe.LIST_IGNORE)},onChange:a=>v(a.fileList.slice(-1)),onRemove:()=>{v([]),U(null)},accept:".zip",disabled:M,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽 ZIP 文件上传"}),e.jsx(_e,{type:"secondary",style:{fontSize:12},children:"上传后会解压到本地 temp 目录，并生成可复制的 Prompt"})]})})}),u==="screenshot"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(ot,{name:"file",multiple:!0,fileList:E,customRequest:f,beforeUpload:a=>typeof(a==null?void 0:a.type)=="string"&&a.type.startsWith("image/")?!0:(j.error("请上传图片格式的文件（png/jpg/webp 等）"),xe.LIST_IGNORE),onChange:a=>p(a.fileList),onRemove:()=>{p([]),N(null),$(null)},accept:"image/*",disabled:z,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽多张截图上传"}),e.jsx(_e,{type:"secondary",style:{fontSize:12},children:"上传完成后点击底部「复制 Prompt」，让 AI 按文档流程完成截图转代码"})]})})})]})},{Header:hs}=ve,{useToken:ps}=Pe,xs=({collapsed:S,setCollapsed:F,activeTab:c,onTabChange:d,counts:j,isDarkMode:k,setIsDarkMode:D,assistantEnabled:u=!1,assistantVisible:T=!1,onToggleAssistant:W,preferredPromptClient:v,preferredIDE:M})=>{const[L,B]=pe.useState(null),[U,E]=pe.useState(!1),{token:p}=ps();return pe.useEffect(()=>{let z=!1;return fetch("/api/version").then(m=>m.ok?m.json():Promise.reject(new Error("Request failed"))).then(m=>{if(z)return;const K=typeof(m==null?void 0:m.version)=="string"?m.version:null;B(K)}).catch(()=>{z||B(null)}),()=>{z=!0}},[]),e.jsxs(hs,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:p.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${p.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[c!=="media"&&e.jsx(q,{type:"text",icon:S?e.jsx(Ot,{}):e.jsx(Ft,{}),onClick:()=>F(!S),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:c==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:p.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(Bt,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(zt,{value:c,size:"small",shape:"round",style:{fontSize:"12px"},onChange:z=>d(z),options:[{label:`主题 (${j.themes})`,value:"themes",icon:e.jsx(mt,{})},{label:`文档 (${j.docs})`,value:"docs",icon:e.jsx(Ge,{})},{label:`前端库 (${j.libraries})`,value:"libraries",icon:e.jsx(He,{})},{label:`数据 (${j.data})`,value:"data",icon:e.jsx(ht,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(we,{title:"使用 AI 智能导入资产",children:e.jsx(q,{size:"small",icon:e.jsx(pt,{}),onClick:()=>E(!0),children:"智能导入资产"})}),e.jsx(ms,{open:U,onCancel:()=>E(!1),preferredPromptClient:v??null,preferredIDE:M??null}),u&&e.jsx(we,{title:T?"关闭 Axhub Genie":"打开 Axhub Genie",children:e.jsx(ct,{dot:!0,status:T?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:T?"inline-flex":"none"}},children:e.jsx(q,{type:"text",size:"small",icon:e.jsx(Wt,{}),onClick:W})})}),e.jsx(Ke,{menu:{items:[{key:"theme",label:k?"浅色模式":"深色模式",icon:k?e.jsx(Gt,{}):e.jsx(Ht,{}),onClick:()=>D(!k)},{type:"divider"},{key:"help",label:"帮助中心",icon:e.jsx(Kt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(Jt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(ut,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(Xt,{}),extra:e.jsx("span",{style:{fontSize:12,color:p.colorTextSecondary},children:L?`v${L}`:"-"})}]},placement:"bottomRight",children:e.jsx(q,{type:"text",icon:e.jsx(Vt,{})})})]})]})},{Sider:gs}=ve,{useToken:ys}=Pe,js=({collapsed:S,loading:F,activeTab:c,themes:d,docs:j,libraries:k,dataTables:D,selectedTheme:u,selectedDoc:T,selectedLibrary:W,selectedDataTable:v,onThemeSelect:M,onDocSelect:L,onLibrarySelect:B,onDataTableSelect:U,onDeleteAsset:E,onRenameAsset:p,onCreateClick:z,searchText:m,setSearchText:K,preferredPromptClient:N,preferredIDE:J,createPromptConfig:$})=>{const{token:ee}=ys(),{message:r,modal:R}=Je.useApp(),s=async o=>{const g=await fetch("/api/themes/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:o})});if(!g.ok){const b=await g.json().catch(()=>({}));throw new Error(b.error||"检查主题引用失败")}return g.json()},C=pe.useMemo(()=>{if(!m)return d;const o=m.toLowerCase();return d.filter(g=>g.displayName.toLowerCase().includes(o)||g.name.toLowerCase().includes(o))},[d,m]),_=pe.useMemo(()=>{if(!m)return j;const o=m.toLowerCase();return j.filter(g=>g.displayName.toLowerCase().includes(o)||g.name.toLowerCase().includes(o))},[j,m]),f=pe.useMemo(()=>{if(!m)return k;const o=m.toLowerCase();return k.filter(g=>g.displayName.toLowerCase().includes(o)||g.name.toLowerCase().includes(o))},[k,m]),P=pe.useMemo(()=>{if(!m)return D;const o=m.toLowerCase();return D.filter(g=>g.tableName.toLowerCase().includes(o)||g.fileName.toLowerCase().includes(o))},[D,m]),w=["vscode","cursor"],a=o=>new Promise(g=>setTimeout(g,o)),y=async(o,g)=>{const b=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:o,payload:g,targetClientTypes:w})}),X=await b.json().catch(()=>null);return b.ok&&!!(X!=null&&X.sent)},G=async(o,g,b=!1)=>{const X=b?10:1;let Q=!1;for(let O=0;O<X;O+=1){if(await y("handshake","prototype-admin")){Q=!0;break}O<X-1&&await a(500)}if(!Q)return!1;const ne=b?3:1;for(let O=0;O<ne;O+=1){if(await y("open-file",o)||g&&await y("open-file",g))return!0;O<ne-1&&await a(300)}return!1},se=async o=>{let g="",b="";const X="tableName"in o?o.tableName:o.displayName,Q="fileName"in o?o.fileName:o.name;if(c==="docs"?(g=`assets/docs/${Q}`,b=`[${X}](assets/docs/${Q})`):c==="themes"?(g=`src/themes/${Q}/index.tsx`,b=`[${X}](src/themes/${Q})`):c==="libraries"?(g=`assets/libraries/${Q}.md`,b=`[${X}](assets/libraries/${Q}.md)`):c==="data"&&(g=`assets/database/${Q}.json`,b=`[${X}](assets/database/${Q}.json)`),!g){r.warning("无法获取文件路径");return}const ne=r.loading("正在发送到 IDE...",0);try{b&&await navigator.clipboard.writeText(b);const O=await et({preferredIDE:J,targetPath:g});if(!await G(g,void 0,O)){r.info("编辑器正在启动中，已复制文件标题，可稍后在编辑器中打开");return}r.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(O){console.error("Failed to open in IDE:",O),r.error((O==null?void 0:O.message)||"发送失败")}finally{ne()}},Z=(o,g)=>{const b=c==="themes"&&"name"in o&&(u==null?void 0:u.name)===o.name||c==="docs"&&"name"in o&&(T==null?void 0:T.name)===o.name||c==="libraries"&&"name"in o&&(W==null?void 0:W.name)===o.name||c==="data"&&"fileName"in o&&(v==null?void 0:v.fileName)===o.fileName,X=c==="themes"&&"hasDoc"in o&&o.hasDoc,Q=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(He,{})},{key:"delete",label:`删除${c==="themes"?"主题":c==="docs"?"文档":c==="data"?"数据表":"前端库"}`,icon:e.jsx(Yt,{}),danger:!0}];X&&Q.splice(1,0,{key:"open-doc-in-ide",label:"在编辑器中打开规范文档",icon:e.jsx(Ge,{}),danger:!1}),(c==="data"||c==="themes"||c==="docs")&&Q.unshift({key:"rename",label:"重命名",icon:e.jsx(yt,{}),danger:!1});const ne="tableName"in o?o.tableName:o.displayName,O="fileName"in o?o.fileName:o.name;return{key:O,icon:g,label:e.jsxs("div",{className:`menu-item-wrapper ${b?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:ne})}),e.jsx(Ke,{trigger:["click"],menu:{items:Q,onClick:async({key:ie})=>{if(ie==="open-in-ide")se(o);else if(ie==="open-doc-in-ide"){const de="name"in o?o.name:"";if(!de)return;const ue=`src/themes/${de}/README.md`,ye=`src/themes/${de}/DESIGN-SPEC.md`,Ce=`[${ne} 规范文档](${ue})`,te=r.loading("正在发送到 IDE...",0);try{await navigator.clipboard.writeText(Ce);const le=await et({preferredIDE:J,targetPath:ue});if(!await G(ue,ye,le)){r.info("编辑器正在启动中，已复制文件标题，可稍后在编辑器中打开");return}r.success("已在编辑器中打开规范文档，并复制了文件标题")}catch(le){console.error("Failed to open doc in IDE:",le),r.error((le==null?void 0:le.message)||"发送失败")}finally{te()}}else if(ie==="rename")p==null||p(c,o);else if(ie==="delete")if(c==="themes"){const de=r.loading("正在检查主题引用...",0);try{const ce=await s(O),ue=Array.isArray(ce==null?void 0:ce.references)?ce.references:[];if(ue.length>0){const ye=ue.map(te=>`- ${te}`).join(`
`),Ce=`我希望删除主题 "${ne}" (${O})。
该主题位于项目中的相对路径为：\`src/themes/${O}\`

已检测到以下文件引用了该主题的 \`designToken.json\` 或 \`globals.css\`：
${ye}

请帮我执行以下检查和操作：
1. 核对上述引用是否准确，并补充遗漏的引用文件（优先检查 \`src/elements/\` 与 \`src/pages/\`）。
2. 如果确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 或 \`globals.css\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，使这些原型脱离对该主题目录的依赖。
3. 完成上述解耦操作后，再彻底删除主题目录 \`src/themes/${O}\`。

主题目录内容规范（至少包含 globals.css 或 designToken.json 其中之一）：
\`\`\`
src/themes/<theme-key>/
├── globals.css
├── designToken.json
└── index.tsx
\`\`\``;R.confirm({title:"检测到主题引用",width:720,cancelText:"取消",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"已检测到以下文件引用了该主题："}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:ye}),e.jsx("div",{style:{marginTop:12},children:e.jsx(Me,{preferredClient:N,preferredIDE:J,scene:"assets-theme-delete-ref-fix",buildPrompt:()=>Ce,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"})})]}),footer:(te,{CancelBtn:le})=>e.jsx(le,{})})}else R.confirm({title:`确认删除主题 "${ne}" 吗？`,content:"未检测到引用文件。删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk(){E(c,O,ne)}})}catch(ce){r.error(ce.message||"检查主题引用失败")}finally{de()}}else E(c,O,ne)}},children:e.jsx(q,{type:"text",size:"small",className:"more-btn",icon:e.jsx(gt,{}),onClick:ie=>{ie.stopPropagation()}})})]})}},oe=C.map(o=>Z(o,e.jsx(mt,{}))),H=_.map(o=>Z(o,e.jsx(Ge,{}))),Y=f.map(o=>Z(o,e.jsx(He,{}))),he=P.map(o=>Z(o,e.jsx(ht,{}))),Te=({key:o})=>{if(c==="themes"){const g=d.find(b=>b.name===o);g&&M(g)}else if(c==="docs"){const g=j.find(b=>b.name===o);g&&L(g)}else if(c==="libraries"){const g=k.find(b=>b.name===o);g&&B(g)}else if(c==="data"){const g=D.find(b=>b.fileName===o);g&&U(g)}},ge=c==="themes"?oe:c==="docs"?H:c==="data"?he:Y,ke=c==="themes"?u==null?void 0:u.name:c==="docs"?T==null?void 0:T.name:c==="data"?v==null?void 0:v.fileName:W==null?void 0:W.name;return e.jsx(gs,{trigger:null,collapsible:!0,collapsed:S||c==="media",width:240,collapsedWidth:0,style:{background:ee.colorBgContainer,borderRight:`1px solid ${ee.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:c==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!S&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(me,{placeholder:"搜索...",prefix:e.jsx(qt,{}),value:m,onChange:o=>K(o.target.value),allowClear:!0,style:{flex:1}})})})}),F?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(xt,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[ge.length===0?e.jsx(re,{image:re.PRESENTED_IMAGE_SIMPLE,description:m?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(Zt,{mode:"inline",selectedKeys:ke?[ke]:[],items:ge,onClick:Te,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!S&&e.jsx("div",{style:{position:"absolute",left:16,right:16,bottom:20},children:$?e.jsx(Me,{preferredClient:N,preferredIDE:J,scene:$.scene,buildPrompt:$.buildPrompt,type:"primary",block:!0,copyLabel:"复制新建 Prompt",executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"}):e.jsx(q,{type:"primary",block:!0,onClick:z,children:`新建${c==="data"?"数据表":c==="docs"?"文档":c==="themes"?"主题":"前端库"}`})})]})})};function ws({fileName:S,tableName:F,onImportComplete:c}){const[d,j]=n.useState(!1),[k,D]=n.useState(null),[u,T]=n.useState(null),[W,v]=n.useState([]),[M,L]=n.useState([]),[B,U]=n.useState(!1),[E,p]=Ae.useMessage(),z=()=>{j(!0),D(null),T(null),v([]),L([])},m=()=>{j(!1),D(null),T(null),v([]),L([])},K=r=>r.length>=3&&r[0]===239&&r[1]===187&&r[2]===191?{encoding:"utf-8",offset:3}:r.length>=2&&r[0]===255&&r[1]===254?{encoding:"utf-16le",offset:2}:r.length>=2&&r[0]===254&&r[1]===255?{encoding:"utf-16be",offset:2}:null,N=async r=>{const R=await r.arrayBuffer(),s=new Uint8Array(R),C=K(s);if(C)return new TextDecoder(C.encoding).decode(s.subarray(C.offset));try{return new TextDecoder("utf-8",{fatal:!0}).decode(s)}catch{const f=["gb18030","gbk"];for(const P of f)try{return new TextDecoder(P).decode(s)}catch{continue}}return new TextDecoder("utf-8").decode(s)},J=(r,R,s)=>{nt.parse(r,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:R,error:s})},$=async r=>{D(r),T(null);try{const R=await N(r);T(R),J(R,s=>{if(s.errors.length>0){E.error("CSV解析失败: "+s.errors[0].message);return}const C=s.data.slice(0,10);if(v(C),s.data.length>0){const _=s.data[0],f=Object.keys(_).map(P=>({title:P,dataIndex:P,key:P,ellipsis:!0,render:w=>w==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof w=="object"?JSON.stringify(w):String(w)}));L(f)}},s=>{E.error("CSV解析失败: "+s.message)})}catch(R){E.error((R==null?void 0:R.message)||"CSV读取失败")}return!1},ee=async()=>{if(!k){E.error("请先选择CSV文件");return}U(!0);const r=E.loading("正在导入数据...",0);try{const R=u??await N(k);J(R,async s=>{try{if(s.errors.length>0)throw new Error("CSV解析失败: "+s.errors[0].message);const C=nt.unparse(s.data,{quotes:!0,header:!0}),_=await fetch(`/api/data/${encodeURIComponent(S)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:C})});if(!_.ok){const P=await _.json();throw new Error(P.error||"导入失败")}const f=await _.json();E.success(`导入成功！共导入 ${f.recordCount} 条记录`),j(!1),D(null),T(null),v([]),L([]),c()}catch(C){E.error(C.message||"导入失败")}finally{r(),U(!1)}},s=>{E.error("CSV解析失败: "+s.message),r(),U(!1)})}catch(R){E.error(R.message||"导入失败"),r(),U(!1)}};return e.jsxs(e.Fragment,{children:[p,e.jsx(q,{icon:e.jsx(pt,{}),onClick:z,size:"small",children:"导入CSV"}),e.jsx(Se,{title:`导入CSV到 "${F}"`,open:d,onCancel:m,onOk:ee,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:B,okButtonProps:{disabled:!k},children:e.jsxs(be,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(xe,{accept:".csv",beforeUpload:$,maxCount:1,fileList:k?[{uid:"-1",name:k.name,status:"done"}]:[],onRemove:()=>{D(null),T(null),v([]),L([])},children:e.jsx(q,{icon:e.jsx(jt,{}),children:"选择CSV文件"})})}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(wt,{columns:M,dataSource:W,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(r,R)=>(R==null?void 0:R.toString())||"0"}),W.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function bs({fileName:S}){const[F,c]=n.useState(!1),[d,j]=Ae.useMessage(),k=async()=>{c(!0);const D=d.loading("正在导出数据...",0);try{const u=await fetch(`/api/data/${encodeURIComponent(S)}/export`);if(!u.ok){const L=await u.json();throw new Error(L.error||"导出失败")}const T=await u.text(),W=new Blob([T],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(W),M=document.createElement("a");M.href=v,M.download=`${S}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(v),d.success("导出成功")}catch(u){d.error(u.message||"导出失败")}finally{D(),c(!1)}};return e.jsxs(e.Fragment,{children:[j,e.jsx(q,{icon:e.jsx(Qt,{}),onClick:k,loading:F,size:"small",children:"导出CSV"})]})}function Ss({fileName:S,tableName:F,onRefresh:c}){const[d,j]=n.useState(!1),[k,D]=n.useState([]),[u,T]=n.useState(null),[W,v]=n.useState(null),[M,L]=n.useState(null),[B,U]=n.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:f=>`共 ${f} 条记录`,size:"small"}),[E,p]=Ae.useMessage(),[z]=Ue.useForm();n.useEffect(()=>{m()},[S]);const m=async()=>{j(!0);try{const f=await fetch(`/api/data/${encodeURIComponent(S)}`);if(!f.ok)throw new Error("Failed to fetch data");const P=await f.json();D(P),U(w=>({...w,total:P.length}))}catch(f){E.error("加载数据失败: "+f.message)}finally{j(!1)}},K=async f=>{const P=E.loading("正在删除...",0);try{const w=await fetch(`/api/data/${encodeURIComponent(S)}/${encodeURIComponent(String(f))}`,{method:"DELETE"});if(!w.ok){const a=await w.json();throw new Error(a.error||"删除失败")}E.success("删除成功"),m()}catch(w){E.error(w.message||"删除失败")}finally{P()}},N=f=>{T(f.id),v({...f}),L({...f}),z.setFieldsValue(f)},J=()=>{M&&u&&z.setFieldsValue(M),T(null),v(null),L(null),z.resetFields()},$=(f,P)=>f==="id"?"ID字段不可编辑":(P==null||typeof P=="string"&&P.trim()==="",null),ee=async()=>{if(!(!u||!W))try{const f=z.getFieldsValue();for(const[w,a]of Object.entries(f)){const y=$(w,a);if(y){E.error(y);return}}const P=E.loading("正在保存...",0);try{const{id:w,...a}=f,y=await fetch(`/api/data/${encodeURIComponent(S)}/${encodeURIComponent(String(u))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!y.ok){const G=await y.json();throw new Error(G.error||"保存失败")}E.success("保存成功"),T(null),v(null),L(null),z.resetFields(),m()}catch(w){E.error(w.message||"保存失败"),M&&(z.setFieldsValue(M),E.info("已恢复到原始数据"))}finally{P()}}catch(f){E.error("验证失败: "+f.message),M&&(z.setFieldsValue(M),E.info("已恢复到原始数据"))}},r=f=>{U(f)},R=()=>{m(),c&&c()},s=(f,P,w)=>u==P.id?w==="id"?e.jsx(me,{value:f,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof f==="number"?e.jsx(Ue.Item,{name:w,style:{margin:0},rules:[{validator:(G,se)=>{const Z=$(w,se);return Z?Promise.reject(Z):Promise.resolve()}}],children:e.jsx(os,{style:{width:"100%"},size:"small"})}):e.jsx(Ue.Item,{name:w,style:{margin:0},rules:[{validator:(G,se)=>{const Z=$(w,se);return Z?Promise.reject(Z):Promise.resolve()}}],children:e.jsx(me,{size:"small"})}):f==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof f=="object"?JSON.stringify(f):String(f),_=(()=>{if(k.length===0)return[];const f=new Set;k.forEach(a=>{Object.keys(a).forEach(y=>f.add(y))});const w=Array.from(f).sort((a,y)=>a==="id"?-1:y==="id"?1:a.localeCompare(y)).map(a=>({title:a,dataIndex:a,key:a,ellipsis:!0,render:(y,G)=>s(y,G,a)}));return w.push({title:"操作",key:"action",fixed:"right",width:80,render:(a,y)=>u==y.id?e.jsxs(be,{size:"small",children:[e.jsx(we,{title:"保存",children:e.jsx(q,{type:"link",size:"small",icon:e.jsx(ts,{}),onClick:ee})}),e.jsx(we,{title:"取消",children:e.jsx(q,{type:"link",size:"small",icon:e.jsx(ss,{}),onClick:J})})]}):e.jsxs(be,{size:"small",children:[e.jsx(we,{title:"编辑",children:e.jsx(q,{type:"link",size:"small",icon:e.jsx(yt,{}),onClick:()=>N(y),disabled:u!==null})}),e.jsx(ns,{title:"确定要删除这条记录吗？",onConfirm:()=>K(y.id),okText:"确定",cancelText:"取消",children:e.jsx(we,{title:"删除",children:e.jsx(q,{type:"link",danger:!0,size:"small",icon:e.jsx(bt,{}),disabled:u!==null})})})]})}),w})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[p,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",F]}),e.jsxs(be,{children:[e.jsx(ws,{fileName:S,tableName:F,onImportComplete:R}),e.jsx(bs,{fileName:S,tableName:F}),e.jsx(q,{icon:e.jsx(es,{}),onClick:R,disabled:u!==null,size:"small",children:"刷新"})]})]}),e.jsx(Ue,{form:z,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(wt,{columns:_,dataSource:k,rowKey:f=>String(f.id),loading:d,pagination:B,onChange:r,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(re,{description:"暂无数据，请导入 CSV 或添加记录",image:re.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function ks({onRefresh:S}){const[F,c]=n.useState(!1),[d,j]=n.useState([]),[k,D]=n.useState(""),[u,T]=Ae.useMessage(),[W,v]=Se.useModal(),[M,L]=n.useState(!1),[B,U]=n.useState(""),E=k==="";n.useEffect(()=>{p()},[k]);const p=async()=>{c(!0);try{const s=k?`/api/media?path=${encodeURIComponent(k)}`:"/api/media",C=await fetch(s);if(!C.ok)throw new Error("Failed to fetch media assets");const _=await C.json();j(Array.isArray(_)?_:[])}catch(s){u.error("加载素材失败: "+s.message),j([])}finally{c(!1)}},z=async s=>{const{file:C,onSuccess:_,onError:f}=s,P=new FormData;P.append("file",C),k&&P.append("path",k);try{const w=await fetch("/api/media/upload",{method:"POST",body:P});if(!w.ok){const a=await w.json();throw new Error(a.error||"上传失败")}u.success(`${C.name} 上传成功`),_(null,C),p(),S&&S()}catch(w){u.error(w.message||"上传失败"),f(w)}},m=s=>{W.confirm({title:`确定要删除 "${s.name}" 吗？`,content:s.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const C=u.loading("正在删除...",0);try{const _=await fetch(`/api/media/${encodeURIComponent(s.path)}`,{method:"DELETE"});if(!_.ok){const f=await _.json();throw new Error(f.error||"删除失败")}u.success("删除成功"),p(),S&&S()}catch(_){u.error(_.message||"删除失败")}finally{C()}}})},K=s=>{s.type==="folder"&&D(s.path)},N=s=>{D(s)},J=()=>{L(!0),U("")},$=async()=>{if(!B.trim()){u.error("请输入文件夹名称");return}const s=u.loading("正在创建文件夹...",0);try{const C=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:B.trim(),parentPath:k||void 0})});if(!C.ok){const _=await C.json();throw new Error(_.error||"创建文件夹失败")}u.success("文件夹创建成功"),L(!1),p(),S&&S()}catch(C){u.error(C.message||"创建文件夹失败")}finally{s()}},ee=()=>{const s=k?k.split("/"):[],C=[{title:e.jsxs("a",{onClick:()=>N(""),children:[e.jsx(rs,{})," 根目录"]})},...s.map((_,f)=>{const P=s.slice(0,f+1).join("/");return{title:e.jsx("a",{onClick:()=>N(P),children:_})}})];return e.jsx(as,{items:C,style:{marginBottom:16}})},r=s=>s.type==="folder"?e.jsx(is,{style:{fontSize:48,color:"#faad14"}}):s.type==="image"?e.jsx(ft,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(ls,{style:{fontSize:48,color:"#1890ff"}}),R=s=>{const C=()=>[{key:"delete",label:"删除",icon:e.jsx(bt,{}),danger:!0,onClick:()=>m(s)}];return e.jsx(Ve,{hoverable:!0,style:{height:"100%"},cover:s.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>K(s),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(s.path)}`,alt:s.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:s.type==="folder"?"pointer":"default"},onClick:()=>K(s),children:r(s)}),actions:[e.jsx(Ke,{menu:{items:C()},trigger:["click"],children:e.jsx(q,{type:"text",icon:e.jsx(gt,{})})})],children:e.jsx(Ve.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:s.type==="folder"?"文件夹":s.size?`${(s.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[T,v,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(be,{children:[e.jsx(q,{icon:e.jsx(dt,{}),onClick:J,children:"新建文件夹"}),!E&&e.jsx(xe,{customRequest:z,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(q,{type:"primary",icon:e.jsx(jt,{}),children:"上传文件"})})]})]}),ee(),F?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(xt,{size:"large",tip:"加载中..."})}):d.length===0?e.jsx(re,{description:E?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(it,{gutter:[16,16],children:d.map(s=>e.jsx(lt,{xs:12,sm:8,md:6,lg:4,xl:4,children:R(s)},s.id))}),e.jsx(Se,{title:"新建文件夹",open:M,onOk:$,onCancel:()=>L(!1),okText:"创建",cancelText:"取消",children:e.jsx(me,{placeholder:"请输入文件夹名称",value:B,onChange:s=>U(s.target.value),onPressEnter:$})})]})}const{Content:Cs}=ve,{useToken:Is}=Pe,Es=({activeTab:S,selectedTheme:F,selectedDoc:c,selectedLibrary:d,selectedDataTable:j,onRefreshDataTables:k,onRefreshMedia:D})=>{const{token:u}=Is(),T=()=>{if(!F)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个主题",image:re.PRESENTED_IMAGE_SIMPLE})});const U=`/themes/${encodeURIComponent(F.name)}`;return e.jsx("iframe",{src:U,style:{width:"100%",flex:1,border:"none",background:u.colorBgContainer},title:F.displayName})},W=()=>{if(!c)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个文档",image:re.PRESENTED_IMAGE_SIMPLE})});const U=c.name.replace(/\.md$/i,""),E=`/assets/docs/${encodeURIComponent(U)}`;return e.jsx("iframe",{src:E,style:{width:"100%",flex:1,border:"none",background:u.colorBgContainer},title:c.displayName})},v=()=>{if(!d)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个前端库",image:re.PRESENTED_IMAGE_SIMPLE})});const U=`/assets/libraries/${d.name}`;return e.jsx("iframe",{src:U,style:{width:"100%",flex:1,border:"none",background:u.colorBgContainer},title:d.displayName})},M=()=>j?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:u.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(Ss,{fileName:j.fileName,tableName:j.tableName,onRefresh:k})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:u.colorBgContainer},children:e.jsx(re,{description:"请从左侧选择一个数据表",image:re.PRESENTED_IMAGE_SIMPLE})}),L=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:u.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(ks,{onRefresh:D})}),B=()=>{switch(S){case"themes":return T();case"docs":return W();case"libraries":return v();case"data":return M();case"media":return L();default:return null}};return e.jsx(Cs,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:u.colorBgContainer,display:"flex",flexDirection:"column"},children:B()})},rt="axhub-assets-active-tab",vs="/api/themes",As="/api/docs",Ps="/api/libraries",at="axhub-make-dark-mode";function Ts({isDarkMode:S,setIsDarkMode:F}){const c="[assistant-runtime-ui]",{message:d,modal:j}=Je.useApp(),{token:k}=Pe.useToken(),D="http://localhost:32123",u=/mac/i.test(navigator.platform)?"sudo npm install -g @axhub/genie":"npm install -g @axhub/genie",T={webBaseUrl:D,apiBaseUrl:`${D}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"助手运行时不可用，请先启动 Axhub Genie。",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:u,start:"axhub-genie",status:"axhub-genie status"}}},W=320,v=320,M=640,[L,B]=n.useState(!0),[U,E]=n.useState(!1),[p,z]=n.useState(()=>{const t=localStorage.getItem(rt);return t==="themes"||t==="docs"||t==="libraries"||t==="data"||t==="media"?t:"themes"}),[m,K]=n.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[N,J]=n.useState(null),[$,ee]=n.useState(null),[r,R]=n.useState(null),[s,C]=n.useState(null),[_,f]=n.useState(""),[P,w]=n.useState(!1),[a,y]=n.useState([]),[G,se]=n.useState(!1),[Z,oe]=n.useState(!1),[H,Y]=n.useState(""),[he,Te]=n.useState(null),[ge,ke]=n.useState(null),[o,g]=n.useState(!1),[b,X]=n.useState(null),[Q,ne]=n.useState(!1),[O,ie]=n.useState(()=>{const t=localStorage.getItem(tt),l=t?Number(t):NaN;return Number.isFinite(l)&&l>=v?Math.min(l,M):W}),de=n.useRef(null),[ce,ue]=n.useState(!1),[ye,Ce]=n.useState(null);n.useEffect(()=>{localStorage.setItem(rt,p)},[p]),n.useEffect(()=>{te()},[]),n.useEffect(()=>{let t=!1;return De.getConfig().then(l=>{var x,A;if(t)return;const h=(x=l==null?void 0:l.automation)==null?void 0:x.defaultPromptClient;Te(Dt(h)),ke(((A=l==null?void 0:l.automation)==null?void 0:A.defaultIDE)||null)}).catch(()=>{t||(Te(null),ke(null))}),()=>{t=!0}},[]),n.useEffect(()=>{let t=!1;return De.getAssistantRuntime({autoStart:!1}).then(l=>{t||X(l)}).catch(()=>{t||X(T)}),()=>{t=!0}},[]),n.useEffect(()=>{localStorage.setItem(tt,String(Math.round(O)))},[O]),n.useEffect(()=>{!L&&m&&(p==="themes"&&m.themes.length>0&&!N?J(m.themes[0]):p==="docs"&&m.docs.length>0&&!$?ee(m.docs[0]):p==="libraries"&&m.libraries.length>0&&!r?R(m.libraries[0]):p==="data"&&m.dataTables.length>0&&!s&&C(m.dataTables[0]))},[L,m,p,N,$,r,s]);const te=async()=>{B(!0);try{const[t,l,h,x,A]=await Promise.all([fetch(vs),fetch(As),fetch(Ps),fetch("/api/data/tables"),fetch("/api/media")]);if(!t.ok||!l.ok||!h.ok||!x.ok||!A.ok)throw new Error("Failed to fetch data");const i=await t.json(),I=await l.json(),ae=await h.json(),V=await x.json(),fe=await A.json();K({themes:i||[],docs:I||[],libraries:ae||[],dataTables:Array.isArray(V)?V:[],mediaAssets:Array.isArray(fe)?fe:[]})}catch(t){d.error("加载数据失败: "+t.message),K({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{B(!1)}},le=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个主题」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件
- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力
- 告知：已经准备好开始新建主题
- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以
- 若信息不足，再用 2-4 个简短问题收集关键输入即可

**📋 必读规范文档**：
- **\`/rules/theme-generation-guide.md\`** ⭐️ 主题生成完整规范！
  - 请完整阅读此文档，了解主题生成的所有要求和约束
  - 文档包含：交付物规范、文件结构、生成策略、验收流程等

**提示**：如果用户没给 \`<theme-key>\` / \`name\` / \`description\`，先给出你建议的 \`<theme-key>\`，并让用户一键确认即可`,[]),Oe=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，优先使用 DeepWiki MCP 或 Context7 MCP 获取最新官方文档与版本信息
- 若 MCP 不可用，再提示用户补充链接或版本

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`,[]),Fe=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`,[]),St=n.useMemo(()=>p==="themes"?{scene:"assets-create-theme",buildPrompt:le}:p==="libraries"?{scene:"assets-create-library",buildPrompt:Oe}:p==="docs"?{scene:"assets-create-doc",buildPrompt:Fe}:null,[p,le,Oe,Fe]),je=n.useMemo(()=>({version:"1",systemContext:"",currentFile:p==="themes"&&N?`src/themes/${N.name}/index.tsx`:p==="docs"&&$?`assets/docs/${$.name}`:p==="libraries"&&r?`assets/libraries/${r.name}.md`:p==="data"&&s?`assets/database/${s.fileName}.json`:"",selectedElements:[],extensions:{source:"axhub-runtime-assets",projectPath:(b==null?void 0:b.projectPath)||"",activeTab:p,selectedAsset:p==="themes"?N:p==="docs"?$:p==="libraries"?r:s,updatedAt:new Date().toISOString()}}),[p,N,$,r,s,b==null?void 0:b.projectPath]),$e=n.useCallback((t,l)=>{try{const h=new URL(t,window.location.origin);return h.searchParams.set("context",JSON.stringify(l)),h.toString()}catch(h){return console.warn("Failed to serialize assistant context into URL:",h),t}},[]),Be=n.useMemo(()=>Ut(he),[he]),Ie=n.useMemo(()=>{const t=((b==null?void 0:b.webBaseUrl)||D).replace(/\/+$/g,""),l=new URL(`${t}/`),h=(b==null?void 0:b.projectPath)||"";return h&&l.searchParams.set("cwd",h),Be&&l.searchParams.set("provider",Be),l.toString()},[b,Be]),Re=ye||Ie,ze=M;n.useEffect(()=>{ue(!1)},[Re]);const Xe=n.useCallback(()=>{const t=de.current;if(!t||!t.contentWindow)return;let l="*";try{l=new URL(Re).origin}catch{l="*"}const h={type:"update_context",mode:"replace",context:je};t.contentWindow.postMessage(h,l)},[Re,je]);n.useEffect(()=>{!o||!ce||Xe()},[o,ce,Xe]);const qe=n.useCallback((t,l)=>{const x=$e(t||Ie,je);Ce(x),g(!0)},[Ie,$e,je]),Ze=n.useCallback((t,l)=>{const x=$e(t||Ie,je);window.open(x,"_blank")},[Ie,$e,je]),We=n.useCallback((t,l,h,x,A="iframe")=>{const i=t.health.hints;j.confirm({title:"Axhub Genie 未就绪",width:620,content:e.jsxs("div",{children:[e.jsx("p",{children:t.health.message}),e.jsxs(Ee.Paragraph,{style:{marginBottom:8},copyable:{text:i.installGlobal,tooltips:["复制命令","已复制"],onCopy:()=>d.success("全局安装命令已复制")},children:["全局安装：",e.jsx(Ee.Text,{code:!0,children:i.installGlobal})]}),e.jsxs(Ee.Paragraph,{style:{marginBottom:0},copyable:{text:i.start,tooltips:["复制命令","已复制"],onCopy:()=>d.success("启动命令已复制")},children:["启动命令：",e.jsx(Ee.Text,{code:!0,children:i.start})]})]}),cancelText:"关闭",footer:(I,{CancelBtn:ae})=>e.jsx(ae,{})}),l==="event"&&d.warning("Genie 未就绪，已回退为安装引导。")},[d,j]),Ye=n.useCallback(async t=>{if(t.health.status!=="runtime_unreachable")return t;let l=t;const h=5,x=700;for(let A=0;A<h;A+=1){await new Promise(i=>setTimeout(i,x));try{const i=await De.getAssistantRuntime({autoStart:!1});if(l=i,X(i),i.health.status==="ready"||i.health.status==="missing_cli"||i.health.status==="needs_update"||i.health.status==="cli_error")return i}catch(i){console.warn(`${c} runtime poll failed`,i);break}}return l},[]),Ne=n.useCallback(async(t,l,h,x="iframe")=>{if(Q)return!1;ne(!0);const A=d.loading("正在启动并检测 Axhub Genie...",0);console.info(`${c} begin runtime check`,{trigger:t,openTarget:x,targetUrl:l||null,targetPath:h||null});try{const i=await De.getAssistantRuntime();X(i),console.info(`${c} runtime response`,{status:i.health.status,message:i.health.message,source:i.source,commandSource:i.health.commandSource,webBaseUrl:i.webBaseUrl,apiBaseUrl:i.apiBaseUrl});const I=await Ye(i);if(I.health.status==="ready")return x==="window"?Ze(l,h):qe(l,h),!0;console.warn(`${c} runtime not ready`,{status:I.health.status,message:I.health.message,hints:I.health.hints}),We(I,t,l,h,x)}catch(i){const I=b||T;X(I),console.error(`${c} runtime check failed`,i),d.error((i==null?void 0:i.message)||"检测 Axhub Genie 状态失败"),We(I,t,l,h,x)}finally{A(),ne(!1)}return!1},[Q,b,d,qe,Ze,We,Ye]),kt=n.useCallback(()=>{if(o){g(!1);return}Ne("button")},[o,Ne]);n.useEffect(()=>{const t=l=>{const h=l,x=h.detail,A=x==null?void 0:x.url;!A||typeof A!="string"||(Ne("event",A,x==null?void 0:x.targetPath),h.preventDefault())};return window.addEventListener(st,t),()=>{window.removeEventListener(st,t)}},[Ne]);const Ct=t=>{z(t),f("")},It=t=>{J(t)},Et=t=>{ee(t)},vt=t=>{R(t)},At=t=>{C(t)},Pt=async(t,l)=>{if(t==="data"){const h=l,x=h.fileName,A=h.tableName;let i=A;j.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",x,".json (不可修改)"]}),e.jsx(me,{autoFocus:!0,defaultValue:A,placeholder:"请输入新的表名称",onChange:I=>{i=I.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const I=i==null?void 0:i.trim();if(!I)return d.error("表名称不能为空"),Promise.reject();if(I===A)return;const ae=d.loading("正在重命名...",0);try{const V=await fetch(`/api/data/tables/${encodeURIComponent(x)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:I})});if(!V.ok){const fe=await V.json();throw new Error(fe.error||"重命名失败")}d.success("重命名成功"),(s==null?void 0:s.fileName)===x&&C({...s,tableName:I}),await te()}catch(V){return d.error(V.message||"重命名失败"),Promise.reject()}finally{ae()}}});return}if(t==="docs"){const x=l.name,A=x.lastIndexOf("."),i=A>0?x.slice(0,A):x,I=A>0?x.slice(A):"";let ae=i;j.confirm({title:"重命名文档",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["扩展名: ",I||"无"]}),e.jsx(me,{autoFocus:!0,defaultValue:i,placeholder:"请输入新的文档名称",onChange:V=>{ae=V.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){let V=ae==null?void 0:ae.trim();if(!V||(I&&V.endsWith(I)&&(V=V.slice(0,-I.length).trim()),!V))return d.error("文档名称不能为空"),Promise.reject();if(V===i)return;const fe=d.loading("正在重命名...",0);try{const Le=await fetch(`/api/docs/${encodeURIComponent(x)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBaseName:V})});if(!Le.ok){const Lt=await Le.json();throw new Error(Lt.error||"重命名失败")}d.success("重命名成功");const Qe=`${V}${I}`;($==null?void 0:$.name)===x&&ee({...$,name:Qe,displayName:Qe}),await te()}catch(Le){return d.error(Le.message||"重命名失败"),Promise.reject()}finally{fe()}}});return}if(t==="themes"){const h=l,x=h.name,A=h.displayName||h.name;let i=A;j.confirm({title:"重命名主题",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["主题目录: ",x," (不可修改)"]}),e.jsx(me,{autoFocus:!0,defaultValue:A,placeholder:"请输入新的主题名称",onChange:I=>{i=I.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const I=i==null?void 0:i.trim();if(!I)return d.error("主题名称不能为空"),Promise.reject();if(I===A)return;const ae=d.loading("正在重命名...",0);try{const V=await fetch(`/api/themes/${encodeURIComponent(x)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:I})});if(!V.ok){const fe=await V.json();throw new Error(fe.error||"重命名失败")}d.success("重命名成功"),(N==null?void 0:N.name)===x&&J({...N,displayName:I}),await te()}catch(V){return d.error(V.message||"重命名失败"),Promise.reject()}finally{ae()}}})}},Tt=async(t,l,h)=>{const x={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};if(t==="themes"){const A=d.loading("正在删除...",0);try{const i=await fetch(`/api/themes/${l}`,{method:"DELETE"});if(!i.ok){const I=await i.json();throw new Error(I.error||"删除失败")}d.success("删除成功"),(N==null?void 0:N.name)===l&&J(null),te()}catch(i){d.error(i.message||"删除失败")}finally{A()}return}j.confirm({title:`确定要删除${x[t]} "${h}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const A=d.loading("正在删除...",0);try{let i;if(t==="data")i=await fetch(`/api/data/tables/${l}`,{method:"DELETE"});else if(t==="docs")i=await fetch(`/api/docs/${encodeURIComponent(l)}`,{method:"DELETE"});else if(t==="libraries")i=await fetch(`/api/libraries/${l}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!i.ok){const I=await i.json();throw new Error(I.error||"删除失败")}d.success("删除成功"),t==="docs"&&($==null?void 0:$.name)===l?ee(null):t==="libraries"&&(r==null?void 0:r.name)===l?R(null):t==="data"&&(s==null?void 0:s.fileName)===l&&C(null),te()}catch(i){d.error(i.message||"删除失败")}finally{A()}}})},$t=()=>{if(p==="docs"){w(!0);return}if(p==="data"){oe(!0);return}d.info("新建功能开发中...")},Rt=async()=>{if(a.length===0){d.warning("请先上传文件");return}se(!0);try{const t=await Promise.all(a.map(async h=>{const x=h.originFileObj;if(!x)throw new Error("文件读取失败，请重新选择文件");const A=x.name,i=A.toLowerCase();if(!i.endsWith(".md")&&!i.endsWith(".csv")&&!i.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(x.size>5242880)throw new Error("单个文件大小不能超过 5MB");const I=await x.text();return{name:A,content:I}})),l=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:t})});if(!l.ok){const h=await l.json().catch(()=>null);throw new Error((h==null?void 0:h.error)||"上传失败")}d.success("上传成功"),w(!1),y([]),te()}catch(t){d.error((t==null?void 0:t.message)||"上传失败")}finally{se(!1)}},Nt=async()=>{if(!H.trim()){d.error("请输入表名");return}const t=d.loading("正在创建表...",0);try{const l=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:H.trim()})});if(!l.ok){const h=await l.json();throw new Error(h.error||"创建表失败")}d.success("表创建成功"),oe(!1),Y(""),te()}catch(l){d.error(l.message||"创建表失败")}finally{t()}};return e.jsxs(ve,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(xs,{collapsed:U,setCollapsed:E,activeTab:p,onTabChange:Ct,counts:{themes:m.themes.length,docs:m.docs.length,libraries:m.libraries.length,data:m.dataTables.length,media:m.mediaAssets.length},isDarkMode:S,setIsDarkMode:F,assistantEnabled:!0,assistantVisible:o,onToggleAssistant:kt,preferredPromptClient:he,preferredIDE:ge}),e.jsxs(ve,{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx(js,{collapsed:U,loading:L,activeTab:p,themes:m.themes,docs:m.docs,libraries:m.libraries,dataTables:m.dataTables,selectedTheme:N,selectedDoc:$,selectedLibrary:r,selectedDataTable:s,onThemeSelect:It,onDocSelect:Et,onLibrarySelect:vt,onDataTableSelect:At,onDeleteAsset:Tt,onRenameAsset:Pt,onCreateClick:$t,searchText:_,setSearchText:f,preferredPromptClient:he,preferredIDE:ge,createPromptConfig:St}),e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(Es,{activeTab:p,selectedTheme:N,selectedDoc:$,selectedLibrary:r,selectedDataTable:s,onRefreshDataTables:te,onRefreshMedia:te})}),o&&e.jsx(us,{size:{width:Math.min(Math.max(O,v),ze),height:"calc(100vh - 48px)"},minWidth:v,maxWidth:ze,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(t,l,h)=>{const x=Math.min(Math.max(h.getBoundingClientRect().width,v),ze);ie(x)},style:{borderLeft:`1px solid ${k.colorBorderSecondary}`,background:k.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:de,src:Re,title:"Axhub Genie",onLoad:()=>ue(!0),style:{border:"none",width:"100%",height:"100%"}})})]}),e.jsx(Se,{title:"新建文档",open:P,onCancel:()=>{w(!1),y([])},footer:[e.jsx(Me,{preferredClient:he,preferredIDE:ge,scene:"assets-create-doc",buildPrompt:Fe,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy"),e.jsx(q,{type:"primary",loading:G,onClick:Rt,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(xe.Dragger,{multiple:!0,accept:".md",fileList:a,beforeUpload:t=>(t.name||"").toLowerCase().endsWith(".md")?!1:(d.error("仅支持上传 .md 文件"),xe.LIST_IGNORE),onChange:t=>y(t.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"仅支持 .md 文件，支持批量上传"})]})})}),e.jsx(Se,{title:"新建数据表",open:Z,onOk:Nt,onCancel:()=>{oe(!1),Y("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(me,{placeholder:"例如: 用户表, 产品列表",value:H,onChange:t=>Y(t.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function $s(){const[S,F]=n.useState(()=>localStorage.getItem(at)==="true");return n.useEffect(()=>{localStorage.setItem(at,String(S))},[S]),e.jsx(ds,{theme:fs(S),children:e.jsx(Je,{children:e.jsx(Ts,{isDarkMode:S,setIsDarkMode:F})})})}const Rs=cs.createRoot(document.getElementById("root"));Rs.render(e.jsx($s,{}));
