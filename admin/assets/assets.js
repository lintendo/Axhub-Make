import"./chunks/modulepreload-polyfill.js";import{T as Be,s as he,j as e,M as ce,R as Ie,C as Ee,B as Le,a as ue,S as le,b as _,c as ve,d as $e,e as Ue,f as Re,g as Pe,h as _e,L as fe,i as ae,t as ye,k as Ve,l as Je,m as We,n as He,o as Te,p as xe,q as ge,r as Ae,u as ie,v as Ge,w as Ke,x as qe,D as je,y as Ye,z as Qe,A as Ze,E as we,I as te,F as Xe,G as Ne,H as G,J as et,K as tt,N as nt,O as De,P as st,Q as Me,U as f,V as ot,W as pe,X as Oe,Y as ze,Z as Ce,_ as rt,$ as me,a0 as at,a1 as it,a2 as lt,a3 as ct,a4 as Fe,a5 as dt,a6 as ft,a7 as ht,a8 as mt,a9 as pt,aa as ut,ab as xt}from"./chunks/vendor.js";import{g as gt}from"./chunks/index.js";const{Text:be}=Be,yt=({open:u,onCancel:D})=>{const[t,E]=he.useMessage(),S=(c,a)=>{const l=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「${c}」设计资产。

请认真阅读规则文档 \`${a}\`，并按文档定义的交互指南回复用户。`;navigator.clipboard.writeText(l).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始"),D()}).catch(()=>{t.error("复制失败，请手动复制")})},h=[{title:"本地 Axure 文件导入",icon:e.jsx($e,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePath:"./rules/local-axure-assistant.md",disabled:!1,recommended:!0},{title:"Axure 原型链接导入",icon:e.jsx(Ue,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePath:"./rules/axure-prototype-assistant.md",disabled:!1},{title:"产品网页链接导入",icon:e.jsx(Re,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePath:"./rules/web-page-assistant.md",disabled:!1},{title:"App/小程序/网页截图导入",icon:e.jsx(Pe,{style:{fontSize:24,color:"#faad14"}}),desc:"提取颜色主题与 OCR 文本；如支持视觉再分析布局与组件，还原页面",rulePath:"./rules/screenshot-page-assistant.md",disabled:!1},{title:"App/小程序直接导入",icon:e.jsx(_e,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePath:"",disabled:!0}];return e.jsxs(ce,{title:"智能导入资产",open:u,onCancel:D,footer:null,width:800,children:[E,e.jsx(Ie,{gutter:[16,16],children:h.map((c,a)=>e.jsx(Ee,{span:12,children:e.jsx(Le.Ribbon,{text:"推荐",color:"#008F5D",style:{display:c.recommended?"block":"none"},children:e.jsx(ue,{hoverable:!c.disabled,style:{height:"100%",cursor:c.disabled?"not-allowed":"pointer",opacity:c.disabled?.6:1,background:c.disabled?"#f5f5f5":void 0},onClick:()=>!c.disabled&&S(c.title,c.rulePath),children:e.jsxs(le,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:c.disabled?"#e8e8e8":c.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:c.icon}),e.jsxs("div",{children:[e.jsx(be,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:c.title}),e.jsx(be,{type:"secondary",style:{fontSize:13},children:c.desc})]})]})})})},a))}),e.jsx("div",{style:{marginTop:24,textAlign:"center"},children:e.jsx(_,{type:"link",icon:e.jsx(ve,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank"),children:"查看更多资产导入技巧与帮助"})})]})},{Header:jt}=fe,{useToken:wt}=ye,Ct=({collapsed:u,setCollapsed:D,activeTab:t,onTabChange:E,counts:S,isDarkMode:h,setIsDarkMode:c})=>{const[a,l]=ae.useState(null),[z,i]=ae.useState(!1),{token:R}=wt();return ae.useEffect(()=>{let p=!1;return fetch("/api/version").then(M=>M.ok?M.json():Promise.reject(new Error("Request failed"))).then(M=>{if(p)return;const P=typeof(M==null?void 0:M.version)=="string"?M.version:null;l(P)}).catch(()=>{p||l(null)}),()=>{p=!0}},[]),e.jsxs(jt,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:R.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${R.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[t!=="media"&&e.jsx(_,{type:"text",icon:u?e.jsx(Ve,{}):e.jsx(Je,{}),onClick:()=>D(!u),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:t==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:R.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(We,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(He,{value:t,size:"small",shape:"round",style:{fontSize:"12px"},onChange:p=>E(p),options:[{label:`主题 (${S.themes})`,value:"themes",icon:e.jsx(Te,{})},{label:`文档 (${S.docs})`,value:"docs",icon:e.jsx(xe,{})},{label:`前端库 (${S.libraries})`,value:"libraries",icon:e.jsx(ge,{})},{label:`数据 (${S.data})`,value:"data",icon:e.jsx(Ae,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ie,{title:"使用 AI 智能导入资产",children:e.jsx(_,{size:"small",icon:e.jsx(Ge,{}),onClick:()=>i(!0),children:"智能导入资产"})}),e.jsx(yt,{open:z,onCancel:()=>i(!1)}),e.jsx(ie,{title:h?"切换到浅色模式":"切换到深色模式",children:e.jsx(_,{type:"text",icon:h?e.jsx(Ke,{}):e.jsx(qe,{}),onClick:()=>c(!h)})}),e.jsx(je,{menu:{items:[{key:"help",label:"帮助中心",icon:e.jsx(Qe,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(ve,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(Re,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(Ze,{}),extra:e.jsx("span",{style:{fontSize:12,color:R.colorTextSecondary},children:a?`v${a}`:"-"})}]},placement:"bottomRight",children:e.jsx(_,{type:"text",icon:e.jsx(Ye,{})})})]})]})},{Sider:bt}=fe,{useToken:St}=ye,kt=({collapsed:u,loading:D,activeTab:t,themes:E,docs:S,libraries:h,dataTables:c,selectedTheme:a,selectedDoc:l,selectedLibrary:z,selectedDataTable:i,onThemeSelect:R,onDocSelect:p,onLibrarySelect:M,onDataTableSelect:P,onDeleteAsset:y,onRenameAsset:B,onCreateClick:V,searchText:x,setSearchText:W})=>{const{token:K}=St(),{message:N,modal:H}=we.useApp(),q=async r=>{const m=await fetch("/api/themes/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:r})});if(!m.ok){const L=await m.json().catch(()=>({}));throw new Error(L.error||"检查主题引用失败")}return m.json()},C=ae.useMemo(()=>{if(!x)return E;const r=x.toLowerCase();return E.filter(m=>m.displayName.toLowerCase().includes(r)||m.name.toLowerCase().includes(r))},[E,x]),v=ae.useMemo(()=>{if(!x)return S;const r=x.toLowerCase();return S.filter(m=>m.displayName.toLowerCase().includes(r)||m.name.toLowerCase().includes(r))},[S,x]),s=ae.useMemo(()=>{if(!x)return h;const r=x.toLowerCase();return h.filter(m=>m.displayName.toLowerCase().includes(r)||m.name.toLowerCase().includes(r))},[h,x]),j=ae.useMemo(()=>{if(!x)return c;const r=x.toLowerCase();return c.filter(m=>m.tableName.toLowerCase().includes(r)||m.fileName.toLowerCase().includes(r))},[c,x]),A=async r=>{let m="",L="";const se="tableName"in r?r.tableName:r.displayName,J="fileName"in r?r.fileName:r.name;if(t==="docs"?(m=`assets/docs/${J}`,L=`[${se}](assets/docs/${J})`):t==="themes"?(m=`src/themes/${J}/index.tsx`,L=`[${se}](src/themes/${J})`):t==="libraries"?(m=`assets/libraries/${J}.md`,L=`[${se}](assets/libraries/${J}.md)`):t==="data"&&(m=`assets/database/${J}.json`,L=`[${se}](assets/database/${J}.json)`),!m){N.warning("无法获取文件路径");return}const Y=["vscode","cursor"],Q=N.loading("正在发送到 IDE...",0);try{L&&await navigator.clipboard.writeText(L);const n=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:Y})}),w=await n.json().catch(()=>null);if(!n.ok||!(w!=null&&w.sent)){N.warning("编辑器未连接，已复制了文件标题，可前往使用");return}const I=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:m,targetClientTypes:Y})}),T=await I.json().catch(()=>null);if(!I.ok||!(T!=null&&T.sent)){N.warning("编辑器未连接，已复制了文件标题，可前往使用");return}N.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(n){console.error("Failed to open in IDE:",n),N.error((n==null?void 0:n.message)||"发送失败")}finally{Q()}},o=(r,m)=>{const L=t==="themes"&&"name"in r&&(a==null?void 0:a.name)===r.name||t==="docs"&&"name"in r&&(l==null?void 0:l.name)===r.name||t==="libraries"&&"name"in r&&(z==null?void 0:z.name)===r.name||t==="data"&&"fileName"in r&&(i==null?void 0:i.fileName)===r.fileName,se=t==="themes"&&"hasDoc"in r&&r.hasDoc,J=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(ge,{})},{key:"delete",label:`删除${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`,icon:e.jsx(st,{}),danger:!0}];se&&J.splice(1,0,{key:"open-doc-in-ide",label:"在编辑器中打开规范文档",icon:e.jsx(xe,{}),danger:!1}),(t==="data"||t==="themes")&&J.unshift({key:"rename",label:"重命名",icon:e.jsx(Me,{}),danger:!1});const Y="tableName"in r?r.tableName:r.displayName,Q="fileName"in r?r.fileName:r.name;return{key:Q,icon:m,label:e.jsxs("div",{className:`menu-item-wrapper ${L?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Y})}),e.jsx(je,{trigger:["click"],menu:{items:J,onClick:async({key:n})=>{if(n==="open-in-ide")A(r);else if(n==="open-doc-in-ide"){const w="name"in r?r.name:"";if(!w)return;const T=`src/themes/${w}/README.md`,O=`src/themes/${w}/DESIGN-SPEC.md`,b=`[${Y} 规范文档](${T})`,$=["vscode","cursor"],oe=N.loading("正在发送到 IDE...",0);try{await navigator.clipboard.writeText(b);const U=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:$})}),ee=await U.json().catch(()=>null);if(!U.ok||!(ee!=null&&ee.sent)){N.warning("编辑器未连接，已复制了文件标题，可前往使用");return}let de=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:T,targetClientTypes:$})}),re=await de.json().catch(()=>null);if((!de.ok||!(re!=null&&re.sent))&&(de=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:O,targetClientTypes:$})}),re=await de.json().catch(()=>null)),!de.ok||!(re!=null&&re.sent)){N.warning("编辑器未连接，已复制了文件标题，可前往使用");return}N.success("已在编辑器中打开规范文档，并复制了文件标题")}catch(U){console.error("Failed to open doc in IDE:",U),N.error((U==null?void 0:U.message)||"发送失败")}finally{oe()}}else if(n==="rename")B==null||B(t,r);else if(n==="delete")if(t==="themes"){const w=N.loading("正在检查主题引用...",0);try{const I=await q(Q),T=Array.isArray(I==null?void 0:I.references)?I.references:[];if(T.length>0){const O=T.map($=>`- ${$}`).join(`
`),b=`我希望删除主题 "${Y}" (${Q})。
该主题位于项目中的相对路径为：\`src/themes/${Q}\`

已检测到以下文件引用了该主题的 \`designToken.json\` 或 \`globals.css\`：
${O}

请帮我执行以下检查和操作：
1. 核对上述引用是否准确，并补充遗漏的引用文件（优先检查 \`src/elements/\` 与 \`src/pages/\`）。
2. 如果确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 或 \`globals.css\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，使这些原型脱离对该主题目录的依赖。
3. 完成上述解耦操作后，再彻底删除主题目录 \`src/themes/${Q}\`。

主题目录内容规范（至少包含 globals.css 或 designToken.json 其中之一）：
\`\`\`
src/themes/<theme-key>/
├── globals.css
├── designToken.json
└── index.tsx
\`\`\``;H.confirm({title:"检测到主题引用",width:720,okText:"复制提示",cancelText:"取消",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"已检测到以下文件引用了该主题："}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:O})]}),async onOk(){try{await navigator.clipboard.writeText(b),N.success("已复制处理提示，请返回编辑器让 AI 处理。")}catch($){console.error("Failed to copy: ",$),N.error("复制失败，请手动处理")}}})}else H.confirm({title:`确认删除主题 "${Y}" 吗？`,content:"未检测到引用文件。删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk(){y(t,Q,Y)}})}catch(I){N.error(I.message||"检查主题引用失败")}finally{w()}}else y(t,Q,Y)}},children:e.jsx(_,{type:"text",size:"small",className:"more-btn",icon:e.jsx(De,{}),onClick:n=>{n.stopPropagation()}})})]})}},g=C.map(r=>o(r,e.jsx(Te,{}))),d=v.map(r=>o(r,e.jsx(xe,{}))),k=s.map(r=>o(r,e.jsx(ge,{}))),F=j.map(r=>o(r,e.jsx(Ae,{}))),Z=({key:r})=>{if(t==="themes"){const m=E.find(L=>L.name===r);m&&R(m)}else if(t==="docs"){const m=S.find(L=>L.name===r);m&&p(m)}else if(t==="libraries"){const m=h.find(L=>L.name===r);m&&M(m)}else if(t==="data"){const m=c.find(L=>L.fileName===r);m&&P(m)}},ne=t==="themes"?g:t==="docs"?d:t==="data"?F:k,X=t==="themes"?a==null?void 0:a.name:t==="docs"?l==null?void 0:l.name:t==="data"?i==null?void 0:i.fileName:z==null?void 0:z.name;return e.jsx(bt,{trigger:null,collapsible:!0,collapsed:u||t==="media",width:240,collapsedWidth:0,style:{background:K.colorBgContainer,borderRight:`1px solid ${K.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:t==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!u&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(te,{placeholder:"搜索...",prefix:e.jsx(Xe,{}),value:x,onChange:r=>W(r.target.value),allowClear:!0,style:{flex:1}})})})}),D?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(Ne,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[ne.length===0?e.jsx(G,{image:G.PRESENTED_IMAGE_SIMPLE,description:x?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(et,{mode:"inline",selectedKeys:X?[X]:[],items:ne,onClick:Z,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!u&&e.jsx(tt,{icon:e.jsx(nt,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:V,tooltip:`新建${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`})]})})};function It({fileName:u,tableName:D,onImportComplete:t}){const[E,S]=f.useState(!1),[h,c]=f.useState(null),[a,l]=f.useState(null),[z,i]=f.useState([]),[R,p]=f.useState([]),[M,P]=f.useState(!1),[y,B]=he.useMessage(),V=()=>{S(!0),c(null),l(null),i([]),p([])},x=()=>{S(!1),c(null),l(null),i([]),p([])},W=C=>C.length>=3&&C[0]===239&&C[1]===187&&C[2]===191?{encoding:"utf-8",offset:3}:C.length>=2&&C[0]===255&&C[1]===254?{encoding:"utf-16le",offset:2}:C.length>=2&&C[0]===254&&C[1]===255?{encoding:"utf-16be",offset:2}:null,K=async C=>{const v=await C.arrayBuffer(),s=new Uint8Array(v),j=W(s);if(j)return new TextDecoder(j.encoding).decode(s.subarray(j.offset));try{return new TextDecoder("utf-8",{fatal:!0}).decode(s)}catch{const o=["gb18030","gbk"];for(const g of o)try{return new TextDecoder(g).decode(s)}catch{continue}}return new TextDecoder("utf-8").decode(s)},N=(C,v,s)=>{Ce.parse(C,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:v,error:s})},H=async C=>{c(C),l(null);try{const v=await K(C);l(v),N(v,s=>{if(s.errors.length>0){y.error("CSV解析失败: "+s.errors[0].message);return}const j=s.data.slice(0,10);if(i(j),s.data.length>0){const A=s.data[0],o=Object.keys(A).map(g=>({title:g,dataIndex:g,key:g,ellipsis:!0,render:d=>d==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof d=="object"?JSON.stringify(d):String(d)}));p(o)}},s=>{y.error("CSV解析失败: "+s.message)})}catch(v){y.error((v==null?void 0:v.message)||"CSV读取失败")}return!1},q=async()=>{if(!h){y.error("请先选择CSV文件");return}P(!0);const C=y.loading("正在导入数据...",0);try{const v=a??await K(h);N(v,async s=>{try{if(s.errors.length>0)throw new Error("CSV解析失败: "+s.errors[0].message);const j=Ce.unparse(s.data,{quotes:!0,header:!0}),A=await fetch(`/api/data/${encodeURIComponent(u)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:j})});if(!A.ok){const g=await A.json();throw new Error(g.error||"导入失败")}const o=await A.json();y.success(`导入成功！共导入 ${o.recordCount} 条记录`),S(!1),c(null),l(null),i([]),p([]),t()}catch(j){y.error(j.message||"导入失败")}finally{C(),P(!1)}},s=>{y.error("CSV解析失败: "+s.message),C(),P(!1)})}catch(v){y.error(v.message||"导入失败"),C(),P(!1)}};return e.jsxs(e.Fragment,{children:[B,e.jsx(_,{icon:e.jsx(ot,{}),onClick:V,size:"small",children:"导入CSV"}),e.jsx(ce,{title:`导入CSV到 "${D}"`,open:E,onCancel:x,onOk:q,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:M,okButtonProps:{disabled:!h},children:e.jsxs(le,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(pe,{accept:".csv",beforeUpload:H,maxCount:1,fileList:h?[{uid:"-1",name:h.name,status:"done"}]:[],onRemove:()=>{c(null),l(null),i([]),p([])},children:e.jsx(_,{icon:e.jsx(Oe,{}),children:"选择CSV文件"})})}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(ze,{columns:R,dataSource:z,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(C,v)=>(v==null?void 0:v.toString())||"0"}),z.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function Et({fileName:u}){const[D,t]=f.useState(!1),[E,S]=he.useMessage(),h=async()=>{t(!0);const c=E.loading("正在导出数据...",0);try{const a=await fetch(`/api/data/${encodeURIComponent(u)}/export`);if(!a.ok){const p=await a.json();throw new Error(p.error||"导出失败")}const l=await a.text(),z=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(z),R=document.createElement("a");R.href=i,R.download=`${u}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(i),E.success("导出成功")}catch(a){E.error(a.message||"导出失败")}finally{c(),t(!1)}};return e.jsxs(e.Fragment,{children:[S,e.jsx(_,{icon:e.jsx(rt,{}),onClick:h,loading:D,size:"small",children:"导出CSV"})]})}function vt({fileName:u,tableName:D,onRefresh:t}){const[E,S]=f.useState(!1),[h,c]=f.useState([]),[a,l]=f.useState(null),[z,i]=f.useState(null),[R,p]=f.useState(null),[M,P]=f.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:o=>`共 ${o} 条记录`,size:"small"}),[y,B]=he.useMessage(),[V]=me.useForm();f.useEffect(()=>{x()},[u]);const x=async()=>{S(!0);try{const o=await fetch(`/api/data/${encodeURIComponent(u)}`);if(!o.ok)throw new Error("Failed to fetch data");const g=await o.json();c(g),P(d=>({...d,total:g.length}))}catch(o){y.error("加载数据失败: "+o.message)}finally{S(!1)}},W=async o=>{const g=y.loading("正在删除...",0);try{const d=await fetch(`/api/data/${encodeURIComponent(u)}/${encodeURIComponent(String(o))}`,{method:"DELETE"});if(!d.ok){const k=await d.json();throw new Error(k.error||"删除失败")}y.success("删除成功"),x()}catch(d){y.error(d.message||"删除失败")}finally{g()}},K=o=>{l(o.id),i({...o}),p({...o}),V.setFieldsValue(o)},N=()=>{R&&a&&V.setFieldsValue(R),l(null),i(null),p(null),V.resetFields()},H=(o,g)=>o==="id"?"ID字段不可编辑":(g==null||typeof g=="string"&&g.trim()==="",null),q=async()=>{if(!(!a||!z))try{const o=V.getFieldsValue();for(const[d,k]of Object.entries(o)){const F=H(d,k);if(F){y.error(F);return}}const g=y.loading("正在保存...",0);try{const{id:d,...k}=o,F=await fetch(`/api/data/${encodeURIComponent(u)}/${encodeURIComponent(String(a))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!F.ok){const Z=await F.json();throw new Error(Z.error||"保存失败")}y.success("保存成功"),l(null),i(null),p(null),V.resetFields(),x()}catch(d){y.error(d.message||"保存失败"),R&&(V.setFieldsValue(R),y.info("已恢复到原始数据"))}finally{g()}}catch(o){y.error("验证失败: "+o.message),R&&(V.setFieldsValue(R),y.info("已恢复到原始数据"))}},C=o=>{P(o)},v=()=>{x(),t&&t()},s=(o,g,d)=>a==g.id?d==="id"?e.jsx(te,{value:o,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof o==="number"?e.jsx(me.Item,{name:d,style:{margin:0},rules:[{validator:(Z,ne)=>{const X=H(d,ne);return X?Promise.reject(X):Promise.resolve()}}],children:e.jsx(dt,{style:{width:"100%"},size:"small"})}):e.jsx(me.Item,{name:d,style:{margin:0},rules:[{validator:(Z,ne)=>{const X=H(d,ne);return X?Promise.reject(X):Promise.resolve()}}],children:e.jsx(te,{size:"small"})}):o==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof o=="object"?JSON.stringify(o):String(o),A=(()=>{if(h.length===0)return[];const o=new Set;h.forEach(k=>{Object.keys(k).forEach(F=>o.add(F))});const d=Array.from(o).sort((k,F)=>k==="id"?-1:F==="id"?1:k.localeCompare(F)).map(k=>({title:k,dataIndex:k,key:k,ellipsis:!0,render:(F,Z)=>s(F,Z,k)}));return d.push({title:"操作",key:"action",fixed:"right",width:80,render:(k,F)=>a==F.id?e.jsxs(le,{size:"small",children:[e.jsx(ie,{title:"保存",children:e.jsx(_,{type:"link",size:"small",icon:e.jsx(it,{}),onClick:q})}),e.jsx(ie,{title:"取消",children:e.jsx(_,{type:"link",size:"small",icon:e.jsx(lt,{}),onClick:N})})]}):e.jsxs(le,{size:"small",children:[e.jsx(ie,{title:"编辑",children:e.jsx(_,{type:"link",size:"small",icon:e.jsx(Me,{}),onClick:()=>K(F),disabled:a!==null})}),e.jsx(ct,{title:"确定要删除这条记录吗？",onConfirm:()=>W(F.id),okText:"确定",cancelText:"取消",children:e.jsx(ie,{title:"删除",children:e.jsx(_,{type:"link",danger:!0,size:"small",icon:e.jsx(Fe,{}),disabled:a!==null})})})]})}),d})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[B,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",D]}),e.jsxs(le,{children:[e.jsx(It,{fileName:u,tableName:D,onImportComplete:v}),e.jsx(Et,{fileName:u,tableName:D}),e.jsx(_,{icon:e.jsx(at,{}),onClick:v,disabled:a!==null,size:"small",children:"刷新"})]})]}),e.jsx(me,{form:V,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(ze,{columns:A,dataSource:h,rowKey:o=>String(o.id),loading:E,pagination:M,onChange:C,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(G,{description:"暂无数据，请导入 CSV 或添加记录",image:G.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function $t({onRefresh:u}){const[D,t]=f.useState(!1),[E,S]=f.useState([]),[h,c]=f.useState(""),[a,l]=he.useMessage(),[z,i]=ce.useModal(),[R,p]=f.useState(!1),[M,P]=f.useState(""),y=h==="";f.useEffect(()=>{B()},[h]);const B=async()=>{t(!0);try{const s=h?`/api/media?path=${encodeURIComponent(h)}`:"/api/media",j=await fetch(s);if(!j.ok)throw new Error("Failed to fetch media assets");const A=await j.json();S(Array.isArray(A)?A:[])}catch(s){a.error("加载素材失败: "+s.message),S([])}finally{t(!1)}},V=async s=>{const{file:j,onSuccess:A,onError:o}=s,g=new FormData;g.append("file",j),h&&g.append("path",h);try{const d=await fetch("/api/media/upload",{method:"POST",body:g});if(!d.ok){const k=await d.json();throw new Error(k.error||"上传失败")}a.success(`${j.name} 上传成功`),A(null,j),B(),u&&u()}catch(d){a.error(d.message||"上传失败"),o(d)}},x=s=>{z.confirm({title:`确定要删除 "${s.name}" 吗？`,content:s.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const j=a.loading("正在删除...",0);try{const A=await fetch(`/api/media/${encodeURIComponent(s.path)}`,{method:"DELETE"});if(!A.ok){const o=await A.json();throw new Error(o.error||"删除失败")}a.success("删除成功"),B(),u&&u()}catch(A){a.error(A.message||"删除失败")}finally{j()}}})},W=s=>{s.type==="folder"&&c(s.path)},K=s=>{c(s)},N=()=>{p(!0),P("")},H=async()=>{if(!M.trim()){a.error("请输入文件夹名称");return}const s=a.loading("正在创建文件夹...",0);try{const j=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:M.trim(),parentPath:h||void 0})});if(!j.ok){const A=await j.json();throw new Error(A.error||"创建文件夹失败")}a.success("文件夹创建成功"),p(!1),B(),u&&u()}catch(j){a.error(j.message||"创建文件夹失败")}finally{s()}},q=()=>{const s=h?h.split("/"):[],j=[{title:e.jsxs("a",{onClick:()=>K(""),children:[e.jsx(ft,{})," 根目录"]})},...s.map((A,o)=>{const g=s.slice(0,o+1).join("/");return{title:e.jsx("a",{onClick:()=>K(g),children:A})}})];return e.jsx(ht,{items:j,style:{marginBottom:16}})},C=s=>s.type==="folder"?e.jsx(mt,{style:{fontSize:48,color:"#faad14"}}):s.type==="image"?e.jsx(Pe,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(pt,{style:{fontSize:48,color:"#1890ff"}}),v=s=>{const j=()=>[{key:"delete",label:"删除",icon:e.jsx(Fe,{}),danger:!0,onClick:()=>x(s)}];return e.jsx(ue,{hoverable:!0,style:{height:"100%"},cover:s.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>W(s),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(s.path)}`,alt:s.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:s.type==="folder"?"pointer":"default"},onClick:()=>W(s),children:C(s)}),actions:[e.jsx(je,{menu:{items:j()},trigger:["click"],children:e.jsx(_,{type:"text",icon:e.jsx(De,{})})})],children:e.jsx(ue.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:s.type==="folder"?"文件夹":s.size?`${(s.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[l,i,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(le,{children:[e.jsx(_,{icon:e.jsx($e,{}),onClick:N,children:"新建文件夹"}),!y&&e.jsx(pe,{customRequest:V,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(_,{type:"primary",icon:e.jsx(Oe,{}),children:"上传文件"})})]})]}),q(),D?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(Ne,{size:"large",tip:"加载中..."})}):E.length===0?e.jsx(G,{description:y?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(Ie,{gutter:[16,16],children:E.map(s=>e.jsx(Ee,{xs:12,sm:8,md:6,lg:4,xl:4,children:v(s)},s.id))}),e.jsx(ce,{title:"新建文件夹",open:R,onOk:H,onCancel:()=>p(!1),okText:"创建",cancelText:"取消",children:e.jsx(te,{placeholder:"请输入文件夹名称",value:M,onChange:s=>P(s.target.value),onPressEnter:H})})]})}const{Content:Rt}=fe,{useToken:Pt}=ye,Tt=({activeTab:u,selectedTheme:D,selectedDoc:t,selectedLibrary:E,selectedDataTable:S,onRefreshDataTables:h,onRefreshMedia:c})=>{const{token:a}=Pt(),l=()=>{if(!D)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:a.colorBgContainer},children:e.jsx(G,{description:"请从左侧选择一个主题",image:G.PRESENTED_IMAGE_SIMPLE})});const P=`/themes/${encodeURIComponent(D.name)}`;return e.jsx("iframe",{src:P,style:{width:"100%",flex:1,border:"none",background:a.colorBgContainer},title:D.displayName})},z=()=>{if(!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:a.colorBgContainer},children:e.jsx(G,{description:"请从左侧选择一个文档",image:G.PRESENTED_IMAGE_SIMPLE})});const P=t.name.replace(/\.md$/i,""),y=`/assets/docs/${encodeURIComponent(P)}`;return e.jsx("iframe",{src:y,style:{width:"100%",flex:1,border:"none",background:a.colorBgContainer},title:t.displayName})},i=()=>{if(!E)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:a.colorBgContainer},children:e.jsx(G,{description:"请从左侧选择一个前端库",image:G.PRESENTED_IMAGE_SIMPLE})});const P=`/assets/libraries/${E.name}`;return e.jsx("iframe",{src:P,style:{width:"100%",flex:1,border:"none",background:a.colorBgContainer},title:E.displayName})},R=()=>S?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:a.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(vt,{fileName:S.fileName,tableName:S.tableName,onRefresh:h})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:a.colorBgContainer},children:e.jsx(G,{description:"请从左侧选择一个数据表",image:G.PRESENTED_IMAGE_SIMPLE})}),p=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:a.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx($t,{onRefresh:c})}),M=()=>{switch(u){case"themes":return l();case"docs":return z();case"libraries":return i();case"data":return R();case"media":return p();default:return null}};return e.jsx(Rt,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:a.colorBgContainer,display:"flex",flexDirection:"column"},children:M()})},Se="axhub-assets-active-tab",At="/api/themes",Nt="/api/docs",Dt="/api/libraries",ke="axhub-make-dark-mode";function Mt({isDarkMode:u,setIsDarkMode:D}){const{message:t,modal:E}=we.useApp(),[S,h]=f.useState(!0),[c,a]=f.useState(!1),[l,z]=f.useState(()=>{const n=localStorage.getItem(Se);return n==="themes"||n==="docs"||n==="libraries"||n==="data"||n==="media"?n:"themes"}),[i,R]=f.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[p,M]=f.useState(null),[P,y]=f.useState(null),[B,V]=f.useState(null),[x,W]=f.useState(null),[K,N]=f.useState(""),[H,q]=f.useState(!1),[C,v]=f.useState([]),[s,j]=f.useState(!1),[A,o]=f.useState(!1),[g,d]=f.useState("");f.useEffect(()=>{localStorage.setItem(Se,l)},[l]),f.useEffect(()=>{k()},[]),f.useEffect(()=>{!S&&i&&(l==="themes"&&i.themes.length>0&&!p?M(i.themes[0]):l==="docs"&&i.docs.length>0&&!P?y(i.docs[0]):l==="libraries"&&i.libraries.length>0&&!B?V(i.libraries[0]):l==="data"&&i.dataTables.length>0&&!x&&W(i.dataTables[0]))},[S,i,l,p,P,B,x]);const k=async()=>{h(!0);try{const[n,w,I,T,O]=await Promise.all([fetch(At),fetch(Nt),fetch(Dt),fetch("/api/data/tables"),fetch("/api/media")]);if(!n.ok||!w.ok||!I.ok||!T.ok||!O.ok)throw new Error("Failed to fetch data");const b=await n.json(),$=await w.json(),oe=await I.json(),U=await T.json(),ee=await O.json();R({themes:b||[],docs:$||[],libraries:oe||[],dataTables:Array.isArray(U)?U:[],mediaAssets:Array.isArray(ee)?ee:[]})}catch(n){t.error("加载数据失败: "+n.message),R({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{h(!1)}},F=n=>{z(n),N("")},Z=n=>{M(n)},ne=n=>{y(n)},X=n=>{V(n)},r=n=>{W(n)},m=async(n,w)=>{if(n==="data"){const I=w,T=I.fileName,O=I.tableName;let b=O;E.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",T,".json (不可修改)"]}),e.jsx(te,{autoFocus:!0,defaultValue:O,placeholder:"请输入新的表名称",onChange:$=>{b=$.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const $=b==null?void 0:b.trim();if(!$)return t.error("表名称不能为空"),Promise.reject();if($===O)return;const oe=t.loading("正在重命名...",0);try{const U=await fetch(`/api/data/tables/${encodeURIComponent(T)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:$})});if(!U.ok){const ee=await U.json();throw new Error(ee.error||"重命名失败")}t.success("重命名成功"),(x==null?void 0:x.fileName)===T&&W({...x,tableName:$}),await k()}catch(U){return t.error(U.message||"重命名失败"),Promise.reject()}finally{oe()}}});return}if(n==="themes"){const I=w,T=I.name,O=I.displayName||I.name;let b=O;E.confirm({title:"重命名主题",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["主题目录: ",T," (不可修改)"]}),e.jsx(te,{autoFocus:!0,defaultValue:O,placeholder:"请输入新的主题名称",onChange:$=>{b=$.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const $=b==null?void 0:b.trim();if(!$)return t.error("主题名称不能为空"),Promise.reject();if($===O)return;const oe=t.loading("正在重命名...",0);try{const U=await fetch(`/api/themes/${encodeURIComponent(T)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:$})});if(!U.ok){const ee=await U.json();throw new Error(ee.error||"重命名失败")}t.success("重命名成功"),(p==null?void 0:p.name)===T&&M({...p,displayName:$}),await k()}catch(U){return t.error(U.message||"重命名失败"),Promise.reject()}finally{oe()}}})}},L=async(n,w,I)=>{const T={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};if(n==="themes"){const O=t.loading("正在删除...",0);try{const b=await fetch(`/api/themes/${w}`,{method:"DELETE"});if(!b.ok){const $=await b.json();throw new Error($.error||"删除失败")}t.success("删除成功"),(p==null?void 0:p.name)===w&&M(null),k()}catch(b){t.error(b.message||"删除失败")}finally{O()}return}E.confirm({title:`确定要删除${T[n]} "${I}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const O=t.loading("正在删除...",0);try{let b;if(n==="data")b=await fetch(`/api/data/tables/${w}`,{method:"DELETE"});else if(n==="docs")b=await fetch(`/api/docs/${encodeURIComponent(w)}`,{method:"DELETE"});else if(n==="libraries")b=await fetch(`/api/libraries/${w}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!b.ok){const $=await b.json();throw new Error($.error||"删除失败")}t.success("删除成功"),n==="docs"&&(P==null?void 0:P.name)===w?y(null):n==="libraries"&&(B==null?void 0:B.name)===w?V(null):n==="data"&&(x==null?void 0:x.fileName)===w&&W(null),k()}catch(b){t.error(b.message||"删除失败")}finally{O()}}})},se=()=>{if(l==="themes"){const n=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「新建一个主题」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件
- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力
- 告知：已经准备好开始新建主题
- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以
- 若信息不足，再用 2-4 个简短问题收集关键输入即可

**📋 必读规范文档**：
- **\`/rules/theme-generation-guide.md\`** ⭐️ 主题生成完整规范！
  - 请完整阅读此文档，了解主题生成的所有要求和约束
  - 文档包含：交付物规范、文件结构、生成策略、验收流程等

**提示**：如果用户没给 \`<theme-key>\` / \`name\` / \`description\`，先给出你建议的 \`<theme-key>\`，并让用户一键确认即可`;navigator.clipboard.writeText(n).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),E.info({title:"新建主题 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(te.TextArea,{value:n,rows:16,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})});return}if(l==="docs"){q(!0);return}if(l==="libraries"){const n=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，如果用户配置了 DeepWiki MCP 或 Context7 MCP 工具，你必须优先使用这些工具来获取和核实库的信息
- 使用 MCP 工具获取：官方文档、版本信息、API 说明、使用示例等
- 通过 MCP 工具核实：库的兼容性、依赖要求、与当前项目环境的匹配度
- 确保获取的信息准确且与当前开发环境兼容
- 如果 MCP 工具不可用，再使用其他方式获取信息，并在文档中标注信息来源

处理策略（按情况选择）：

1) 用户只给包名
- 优先使用 DeepWiki MCP 或 Context7 MCP 获取该库的完整信息
- 核实版本兼容性和依赖要求
- 推断名称
- 若用户未提供文档链接且 MCP 工具不可用，请在 Markdown 的「文档」字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档（用于后续 AI 按此方式读取文档）

2) 用户只给链接
- 使用 MCP 工具核实链接对应的库信息
- 识别对应包名/名称/版本信息；不确定就问用户
- 检查与当前项目环境的兼容性

3) 用户只描述需求
- 使用 MCP 工具搜索和比较相关库
- 给出 2-5 个候选库供用户选，并简要说明差异、兼容性和推荐理由
- 确认后再写入文档

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`;navigator.clipboard.writeText(n).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),E.info({title:"新建前端库 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(te.TextArea,{value:n,rows:18,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})});return}if(l==="data"){o(!0);return}t.info("新建功能开发中...")},J=async()=>{if(C.length===0){t.warning("请先上传文件");return}j(!0);try{const n=await Promise.all(C.map(async I=>{const T=I.originFileObj;if(!T)throw new Error("文件读取失败，请重新选择文件");const O=T.name,b=O.toLowerCase();if(!b.endsWith(".md")&&!b.endsWith(".csv")&&!b.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(T.size>5242880)throw new Error("单个文件大小不能超过 5MB");const $=await T.text();return{name:O,content:$}})),w=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:n})});if(!w.ok){const I=await w.json().catch(()=>null);throw new Error((I==null?void 0:I.error)||"上传失败")}t.success("上传成功"),q(!1),v([]),k()}catch(n){t.error((n==null?void 0:n.message)||"上传失败")}finally{j(!1)}},Y=()=>{const n=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`;navigator.clipboard.writeText(n).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),E.info({title:"新建文档 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(te.TextArea,{value:n,rows:18,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})})},Q=async()=>{if(!g.trim()){t.error("请输入表名");return}const n=t.loading("正在创建表...",0);try{const w=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:g.trim()})});if(!w.ok){const I=await w.json();throw new Error(I.error||"创建表失败")}t.success("表创建成功"),o(!1),d(""),k()}catch(w){t.error(w.message||"创建表失败")}finally{n()}};return e.jsxs(fe,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(Ct,{collapsed:c,setCollapsed:a,activeTab:l,onTabChange:F,counts:{themes:i.themes.length,docs:i.docs.length,libraries:i.libraries.length,data:i.dataTables.length,media:i.mediaAssets.length},isDarkMode:u,setIsDarkMode:D}),e.jsxs(fe,{children:[e.jsx(kt,{collapsed:c,loading:S,activeTab:l,themes:i.themes,docs:i.docs,libraries:i.libraries,dataTables:i.dataTables,selectedTheme:p,selectedDoc:P,selectedLibrary:B,selectedDataTable:x,onThemeSelect:Z,onDocSelect:ne,onLibrarySelect:X,onDataTableSelect:r,onDeleteAsset:L,onRenameAsset:m,onCreateClick:se,searchText:K,setSearchText:N}),e.jsx(Tt,{activeTab:l,selectedTheme:p,selectedDoc:P,selectedLibrary:B,selectedDataTable:x,onRefreshDataTables:k,onRefreshMedia:k})]}),e.jsx(ce,{title:"新建文档",open:H,onCancel:()=>{q(!1),v([])},footer:[e.jsx(_,{onClick:Y,children:"复制 Prompt 新建"},"copy"),e.jsx(_,{type:"primary",loading:s,onClick:J,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(pe.Dragger,{multiple:!0,accept:".md",fileList:C,beforeUpload:n=>(n.name||"").toLowerCase().endsWith(".md")?!1:(t.error("仅支持上传 .md 文件"),pe.LIST_IGNORE),onChange:n=>v(n.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"仅支持 .md 文件，支持批量上传"})]})})}),e.jsx(ce,{title:"新建数据表",open:A,onOk:Q,onCancel:()=>{o(!1),d("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(te,{placeholder:"例如: 用户表, 产品列表",value:g,onChange:n=>d(n.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function Ot(){const[u,D]=f.useState(()=>localStorage.getItem(ke)==="true");return f.useEffect(()=>{localStorage.setItem(ke,String(u))},[u]),e.jsx(xt,{theme:gt(u),children:e.jsx(we,{children:e.jsx(Mt,{isDarkMode:u,setIsDarkMode:D})})})}const zt=ut.createRoot(document.getElementById("root"));zt.render(e.jsx(Ot,{}));
