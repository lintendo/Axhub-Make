import"./chunks/modulepreload-polyfill.js";import{T as Ue,U as le,s as pe,t as xe,r as f,j as e,M as fe,R as Ee,C as ve,B as Be,a as ge,S as de,b as K,c as $e,d as _e,e as Pe,f as Re,g as Ve,L as me,h as ie,i as Ke,k as We,l as Je,m as Ge,n as Te,o as ye,p as je,q as Ne,u as ce,v as He,w as qe,x as Xe,D as we,y as Ze,z as Ye,A as Qe,E as et,F as be,I as se,G as tt,H as Ae,J as Y,K as nt,N as st,O as ot,P as De,Q as rt,V as Oe,W as at,X as Le,Y as Fe,Z as Ce,_ as it,$ as he,a0 as lt,a1 as ct,a2 as dt,a3 as ft,a4 as Me,a5 as mt,a6 as pt,a7 as ht,a8 as ut,a9 as xt,aa as gt,ab as yt}from"./chunks/vendor.js";import{g as jt}from"./chunks/index.js";const{Text:ue}=Ue,{Dragger:ke}=le,wt=({open:x,onCancel:z})=>{const[t,T]=pe.useMessage(),{token:v}=xe.useToken(),[p,L]=f.useState(null),[i,m]=f.useState([]),[B,d]=f.useState(!1),[b,h]=f.useState(null),[M,g]=f.useState([]),[y,_]=f.useState(!1),[U,u]=f.useState(null),[J,G]=f.useState(null);f.useEffect(()=>{x||(L(null),m([]),d(!1),h(null),g([]),_(!1),u(null),G(null))},[x]);const A=[{key:"local_axure",title:"本地 Axure 文件导入",icon:e.jsx($e,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePaths:["/skills/local-axure-workflow/SKILL.md"],disabled:!1,recommended:!0},{key:"axure_prototype",title:"Axure 原型链接导入",icon:e.jsx(_e,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePaths:["/skills/axure-prototype-workflow/SKILL.md","/skills/axure-prototype-workflow/asset-extraction.md","/skills/axure-prototype-workflow/page-restoration.md"],disabled:!1},{key:"web_page",title:"产品网页链接导入",icon:e.jsx(Pe,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePaths:["/skills/web-page-workflow/SKILL.md","/skills/web-page-workflow/asset-extraction.md","/skills/web-page-workflow/page-restoration.md"],disabled:!1},{key:"screenshot",title:"App/小程序/网页截图导入",icon:e.jsx(Re,{style:{fontSize:24,color:"#faad14"}}),desc:"上传多张截图，提取结构/交互/状态数据，并生成页面/元素",rulePaths:["skills/screen-to-code/SKILL.md","skills/screen-to-code/screenshot-collection.md"],disabled:!1},{key:"app_direct",title:"App/小程序直接导入",icon:e.jsx(Ve,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePaths:[],disabled:!0}],D=p&&A.find(n=>n.key===p)||null,Z=(n,l)=>{navigator.clipboard.writeText(n).then(()=>{t.success(l),z()}).catch(()=>{t.error("复制失败，请手动复制")})},S=(n,l)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「${n}」设计资产。

请认真阅读规则文档：
${l.map(P=>`- \`${P}\``).join(`
`)}
并按文档定义的交互指南回复用户。`,$=(n,l)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「基于${n}导入资产」。

**交互要求**：
- 收到本条系统指令后，先用简短中文回复一次，并引导用户提供 ${n}（URL）
- 未拿到链接前，不要生成任何文件
- 参考下方文档，按流程逐步引导用户完成导入与还原/优化

**📋 参考文档（必须阅读）**：
${l.map(P=>`- \`${P}\``).join(`
`)}`,r=n=>{L(n),m([]),h(null),g([]),u(null),G(null)},C=async n=>{const{file:l,onSuccess:P,onError:H}=n,q=l instanceof File?l:l.originFileObj,W=new FormData;W.append("file",q,q.name),W.append("uploadType","local_axure"),d(!0);try{const s=await fetch("/api/upload",{method:"POST",body:W}),c=await s.json();s.ok&&c.success?(h(c),t.success(c.message||"文件已解压，请复制 Prompt 交给 AI 处理"),P(null,l)):(t.error(c.error||"上传失败"),H(new Error(c.error||"上传失败")))}catch(s){t.error("上传失败: "+((s==null?void 0:s.message)||"Unknown error")),H(s)}finally{d(!1)}},O=async n=>{const{file:l,onSuccess:P,onError:H}=n,q=l instanceof File?l:l.originFileObj,W=new FormData;W.append("file",q,q.name),J&&W.append("batchId",J),_(!0);try{const s=await fetch("/api/upload-screenshots",{method:"POST",body:W}),c=await s.json();s.ok&&c.success?(u(c),G(c.batchId||J),t.success(c.message||"截图已上传，请复制 Prompt 交给 AI 处理"),P(null,l)):(t.error(c.error||"上传失败"),H(new Error(c.error||"上传失败")))}catch(s){t.error("上传失败: "+((s==null?void 0:s.message)||"Unknown error")),H(s)}finally{_(!1)}},a=!D||D.disabled?!1:D.key==="local_axure"?!!(b!=null&&b.prompt):D.key==="screenshot"?!!(U!=null&&U.prompt):!0,j=()=>{if(!D){t.warning("请先选择导入方式");return}if(D.disabled)return;let n="";if(D.key==="local_axure"?n=(b==null?void 0:b.prompt)||"":D.key==="screenshot"?n=(U==null?void 0:U.prompt)||"":D.key==="axure_prototype"?n=$("Axure 原型链接",D.rulePaths):D.key==="web_page"?n=$("网页链接",D.rulePaths):n=S(D.title,D.rulePaths),!n){t.error("没有可复制的 Prompt");return}Z(n,"Prompt 已复制到剪贴板，请粘贴给 AI 完成导入")};return e.jsxs(fe,{title:"智能导入资产",open:x,onCancel:z,footer:[e.jsx(K,{onClick:z,children:"取消"},"cancel"),e.jsx(K,{type:"primary",onClick:j,disabled:!a,loading:B||y,children:"复制 Prompt"},"copy")],width:800,destroyOnClose:!0,children:[T,e.jsx(Ee,{gutter:[16,16],children:A.map((n,l)=>e.jsx(ve,{span:12,children:e.jsx(Be.Ribbon,{text:"推荐",color:"#008F5D",style:{display:n.recommended?"block":"none"},children:e.jsx(ge,{hoverable:!n.disabled,style:{height:"100%",cursor:n.disabled?"not-allowed":"pointer",opacity:n.disabled?.6:1,background:n.disabled?"#f5f5f5":p===n.key?v.colorFillAlter:void 0,borderColor:p===n.key?v.colorInfo:void 0},onClick:()=>{n.disabled||r(n.key)},children:e.jsxs(de,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:n.disabled?"#e8e8e8":n.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:n.icon}),e.jsxs("div",{children:[e.jsx(ue,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:n.title}),e.jsx(ue,{type:"secondary",style:{fontSize:13},children:n.desc})]})]})})})},l))}),p==="local_axure"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(ke,{name:"file",multiple:!1,fileList:i,customRequest:C,beforeUpload:n=>{var P;return n.type==="application/zip"||n.type==="application/x-zip-compressed"||((P=n.name)==null?void 0:P.endsWith(".zip"))?!0:(t.error("请上传 ZIP 格式的文件"),le.LIST_IGNORE)},onChange:n=>m(n.fileList.slice(-1)),onRemove:()=>{m([]),h(null)},accept:".zip",disabled:B,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽 ZIP 文件上传"}),e.jsx(ue,{type:"secondary",style:{fontSize:12},children:"上传后会解压到本地 temp 目录，并生成可复制的 Prompt"})]})})}),p==="screenshot"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(ke,{name:"file",multiple:!0,fileList:M,customRequest:O,beforeUpload:n=>typeof(n==null?void 0:n.type)=="string"&&n.type.startsWith("image/")?!0:(t.error("请上传图片格式的文件（png/jpg/webp 等）"),le.LIST_IGNORE),onChange:n=>g(n.fileList),onRemove:()=>{g([]),u(null),G(null)},accept:"image/*",disabled:y,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽多张截图上传"}),e.jsx(ue,{type:"secondary",style:{fontSize:12},children:"上传完成后点击底部「复制 Prompt」，让 AI 按文档流程完成截图转代码"})]})})})]})},{Header:bt}=me,{useToken:Ct}=xe,kt=({collapsed:x,setCollapsed:z,activeTab:t,onTabChange:T,counts:v,isDarkMode:p,setIsDarkMode:L})=>{const[i,m]=ie.useState(null),[B,d]=ie.useState(!1),{token:b}=Ct();return ie.useEffect(()=>{let h=!1;return fetch("/api/version").then(M=>M.ok?M.json():Promise.reject(new Error("Request failed"))).then(M=>{if(h)return;const g=typeof(M==null?void 0:M.version)=="string"?M.version:null;m(g)}).catch(()=>{h||m(null)}),()=>{h=!0}},[]),e.jsxs(bt,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:b.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${b.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[t!=="media"&&e.jsx(K,{type:"text",icon:x?e.jsx(Ke,{}):e.jsx(We,{}),onClick:()=>z(!x),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:t==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:b.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(Je,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ge,{value:t,size:"small",shape:"round",style:{fontSize:"12px"},onChange:h=>T(h),options:[{label:`主题 (${v.themes})`,value:"themes",icon:e.jsx(Te,{})},{label:`文档 (${v.docs})`,value:"docs",icon:e.jsx(ye,{})},{label:`前端库 (${v.libraries})`,value:"libraries",icon:e.jsx(je,{})},{label:`数据 (${v.data})`,value:"data",icon:e.jsx(Ne,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ce,{title:"使用 AI 智能导入资产",children:e.jsx(K,{size:"small",icon:e.jsx(He,{}),onClick:()=>d(!0),children:"智能导入资产"})}),e.jsx(wt,{open:B,onCancel:()=>d(!1)}),e.jsx(ce,{title:p?"切换到浅色模式":"切换到深色模式",children:e.jsx(K,{type:"text",icon:p?e.jsx(qe,{}):e.jsx(Xe,{}),onClick:()=>L(!p)})}),e.jsx(we,{menu:{items:[{key:"help",label:"帮助中心",icon:e.jsx(Ye,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(Qe,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(Pe,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(et,{}),extra:e.jsx("span",{style:{fontSize:12,color:b.colorTextSecondary},children:i?`v${i}`:"-"})}]},placement:"bottomRight",children:e.jsx(K,{type:"text",icon:e.jsx(Ze,{})})})]})]})},{Sider:St}=me,{useToken:It}=xe,Et=({collapsed:x,loading:z,activeTab:t,themes:T,docs:v,libraries:p,dataTables:L,selectedTheme:i,selectedDoc:m,selectedLibrary:B,selectedDataTable:d,onThemeSelect:b,onDocSelect:h,onLibrarySelect:M,onDataTableSelect:g,onDeleteAsset:y,onRenameAsset:_,onCreateClick:U,searchText:u,setSearchText:J})=>{const{token:G}=It(),{message:A,modal:D}=be.useApp(),Z=async s=>{const c=await fetch("/api/themes/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:s})});if(!c.ok){const V=await c.json().catch(()=>({}));throw new Error(V.error||"检查主题引用失败")}return c.json()},S=ie.useMemo(()=>{if(!u)return T;const s=u.toLowerCase();return T.filter(c=>c.displayName.toLowerCase().includes(s)||c.name.toLowerCase().includes(s))},[T,u]),$=ie.useMemo(()=>{if(!u)return v;const s=u.toLowerCase();return v.filter(c=>c.displayName.toLowerCase().includes(s)||c.name.toLowerCase().includes(s))},[v,u]),r=ie.useMemo(()=>{if(!u)return p;const s=u.toLowerCase();return p.filter(c=>c.displayName.toLowerCase().includes(s)||c.name.toLowerCase().includes(s))},[p,u]),C=ie.useMemo(()=>{if(!u)return L;const s=u.toLowerCase();return L.filter(c=>c.tableName.toLowerCase().includes(s)||c.fileName.toLowerCase().includes(s))},[L,u]),O=async s=>{let c="",V="";const ae="tableName"in s?s.tableName:s.displayName,X="fileName"in s?s.fileName:s.name;if(t==="docs"?(c=`assets/docs/${X}`,V=`[${ae}](assets/docs/${X})`):t==="themes"?(c=`src/themes/${X}/index.tsx`,V=`[${ae}](src/themes/${X})`):t==="libraries"?(c=`assets/libraries/${X}.md`,V=`[${ae}](assets/libraries/${X}.md)`):t==="data"&&(c=`assets/database/${X}.json`,V=`[${ae}](assets/database/${X}.json)`),!c){A.warning("无法获取文件路径");return}const te=["vscode","cursor"],ne=A.loading("正在发送到 IDE...",0);try{V&&await navigator.clipboard.writeText(V);const o=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:te})}),I=await o.json().catch(()=>null);if(!o.ok||!(I!=null&&I.sent)){A.warning("编辑器未连接，已复制了文件标题，可前往使用");return}const R=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:c,targetClientTypes:te})}),E=await R.json().catch(()=>null);if(!R.ok||!(E!=null&&E.sent)){A.warning("编辑器未连接，已复制了文件标题，可前往使用");return}A.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(o){console.error("Failed to open in IDE:",o),A.error((o==null?void 0:o.message)||"发送失败")}finally{ne()}},a=(s,c)=>{const V=t==="themes"&&"name"in s&&(i==null?void 0:i.name)===s.name||t==="docs"&&"name"in s&&(m==null?void 0:m.name)===s.name||t==="libraries"&&"name"in s&&(B==null?void 0:B.name)===s.name||t==="data"&&"fileName"in s&&(d==null?void 0:d.fileName)===s.fileName,ae=t==="themes"&&"hasDoc"in s&&s.hasDoc,X=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(je,{})},{key:"delete",label:`删除${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`,icon:e.jsx(rt,{}),danger:!0}];ae&&X.splice(1,0,{key:"open-doc-in-ide",label:"在编辑器中打开规范文档",icon:e.jsx(ye,{}),danger:!1}),(t==="data"||t==="themes"||t==="docs")&&X.unshift({key:"rename",label:"重命名",icon:e.jsx(Oe,{}),danger:!1});const te="tableName"in s?s.tableName:s.displayName,ne="fileName"in s?s.fileName:s.name;return{key:ne,icon:c,label:e.jsxs("div",{className:`menu-item-wrapper ${V?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:te})}),e.jsx(we,{trigger:["click"],menu:{items:X,onClick:async({key:o})=>{if(o==="open-in-ide")O(s);else if(o==="open-doc-in-ide"){const I="name"in s?s.name:"";if(!I)return;const E=`src/themes/${I}/README.md`,F=`src/themes/${I}/DESIGN-SPEC.md`,w=`[${te} 规范文档](${E})`,k=["vscode","cursor"],Q=A.loading("正在发送到 IDE...",0);try{await navigator.clipboard.writeText(w);const N=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:k})}),ee=await N.json().catch(()=>null);if(!N.ok||!(ee!=null&&ee.sent)){A.warning("编辑器未连接，已复制了文件标题，可前往使用");return}let oe=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:E,targetClientTypes:k})}),re=await oe.json().catch(()=>null);if((!oe.ok||!(re!=null&&re.sent))&&(oe=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:F,targetClientTypes:k})}),re=await oe.json().catch(()=>null)),!oe.ok||!(re!=null&&re.sent)){A.warning("编辑器未连接，已复制了文件标题，可前往使用");return}A.success("已在编辑器中打开规范文档，并复制了文件标题")}catch(N){console.error("Failed to open doc in IDE:",N),A.error((N==null?void 0:N.message)||"发送失败")}finally{Q()}}else if(o==="rename")_==null||_(t,s);else if(o==="delete")if(t==="themes"){const I=A.loading("正在检查主题引用...",0);try{const R=await Z(ne),E=Array.isArray(R==null?void 0:R.references)?R.references:[];if(E.length>0){const F=E.map(k=>`- ${k}`).join(`
`),w=`我希望删除主题 "${te}" (${ne})。
该主题位于项目中的相对路径为：\`src/themes/${ne}\`

已检测到以下文件引用了该主题的 \`designToken.json\` 或 \`globals.css\`：
${F}

请帮我执行以下检查和操作：
1. 核对上述引用是否准确，并补充遗漏的引用文件（优先检查 \`src/elements/\` 与 \`src/pages/\`）。
2. 如果确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 或 \`globals.css\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，使这些原型脱离对该主题目录的依赖。
3. 完成上述解耦操作后，再彻底删除主题目录 \`src/themes/${ne}\`。

主题目录内容规范（至少包含 globals.css 或 designToken.json 其中之一）：
\`\`\`
src/themes/<theme-key>/
├── globals.css
├── designToken.json
└── index.tsx
\`\`\``;D.confirm({title:"检测到主题引用",width:720,okText:"复制提示",cancelText:"取消",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"已检测到以下文件引用了该主题："}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:F})]}),async onOk(){try{await navigator.clipboard.writeText(w),A.success("已复制处理提示，请返回编辑器让 AI 处理。")}catch(k){console.error("Failed to copy: ",k),A.error("复制失败，请手动处理")}}})}else D.confirm({title:`确认删除主题 "${te}" 吗？`,content:"未检测到引用文件。删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk(){y(t,ne,te)}})}catch(R){A.error(R.message||"检查主题引用失败")}finally{I()}}else y(t,ne,te)}},children:e.jsx(K,{type:"text",size:"small",className:"more-btn",icon:e.jsx(De,{}),onClick:o=>{o.stopPropagation()}})})]})}},j=S.map(s=>a(s,e.jsx(Te,{}))),n=$.map(s=>a(s,e.jsx(ye,{}))),l=r.map(s=>a(s,e.jsx(je,{}))),P=C.map(s=>a(s,e.jsx(Ne,{}))),H=({key:s})=>{if(t==="themes"){const c=T.find(V=>V.name===s);c&&b(c)}else if(t==="docs"){const c=v.find(V=>V.name===s);c&&h(c)}else if(t==="libraries"){const c=p.find(V=>V.name===s);c&&M(c)}else if(t==="data"){const c=L.find(V=>V.fileName===s);c&&g(c)}},q=t==="themes"?j:t==="docs"?n:t==="data"?P:l,W=t==="themes"?i==null?void 0:i.name:t==="docs"?m==null?void 0:m.name:t==="data"?d==null?void 0:d.fileName:B==null?void 0:B.name;return e.jsx(St,{trigger:null,collapsible:!0,collapsed:x||t==="media",width:240,collapsedWidth:0,style:{background:G.colorBgContainer,borderRight:`1px solid ${G.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:t==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!x&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(se,{placeholder:"搜索...",prefix:e.jsx(tt,{}),value:u,onChange:s=>J(s.target.value),allowClear:!0,style:{flex:1}})})})}),z?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(Ae,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[q.length===0?e.jsx(Y,{image:Y.PRESENTED_IMAGE_SIMPLE,description:u?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(nt,{mode:"inline",selectedKeys:W?[W]:[],items:q,onClick:H,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!x&&e.jsx(st,{icon:e.jsx(ot,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:U,tooltip:`新建${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`})]})})};function vt({fileName:x,tableName:z,onImportComplete:t}){const[T,v]=f.useState(!1),[p,L]=f.useState(null),[i,m]=f.useState(null),[B,d]=f.useState([]),[b,h]=f.useState([]),[M,g]=f.useState(!1),[y,_]=pe.useMessage(),U=()=>{v(!0),L(null),m(null),d([]),h([])},u=()=>{v(!1),L(null),m(null),d([]),h([])},J=S=>S.length>=3&&S[0]===239&&S[1]===187&&S[2]===191?{encoding:"utf-8",offset:3}:S.length>=2&&S[0]===255&&S[1]===254?{encoding:"utf-16le",offset:2}:S.length>=2&&S[0]===254&&S[1]===255?{encoding:"utf-16be",offset:2}:null,G=async S=>{const $=await S.arrayBuffer(),r=new Uint8Array($),C=J(r);if(C)return new TextDecoder(C.encoding).decode(r.subarray(C.offset));try{return new TextDecoder("utf-8",{fatal:!0}).decode(r)}catch{const a=["gb18030","gbk"];for(const j of a)try{return new TextDecoder(j).decode(r)}catch{continue}}return new TextDecoder("utf-8").decode(r)},A=(S,$,r)=>{Ce.parse(S,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:$,error:r})},D=async S=>{L(S),m(null);try{const $=await G(S);m($),A($,r=>{if(r.errors.length>0){y.error("CSV解析失败: "+r.errors[0].message);return}const C=r.data.slice(0,10);if(d(C),r.data.length>0){const O=r.data[0],a=Object.keys(O).map(j=>({title:j,dataIndex:j,key:j,ellipsis:!0,render:n=>n==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof n=="object"?JSON.stringify(n):String(n)}));h(a)}},r=>{y.error("CSV解析失败: "+r.message)})}catch($){y.error(($==null?void 0:$.message)||"CSV读取失败")}return!1},Z=async()=>{if(!p){y.error("请先选择CSV文件");return}g(!0);const S=y.loading("正在导入数据...",0);try{const $=i??await G(p);A($,async r=>{try{if(r.errors.length>0)throw new Error("CSV解析失败: "+r.errors[0].message);const C=Ce.unparse(r.data,{quotes:!0,header:!0}),O=await fetch(`/api/data/${encodeURIComponent(x)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:C})});if(!O.ok){const j=await O.json();throw new Error(j.error||"导入失败")}const a=await O.json();y.success(`导入成功！共导入 ${a.recordCount} 条记录`),v(!1),L(null),m(null),d([]),h([]),t()}catch(C){y.error(C.message||"导入失败")}finally{S(),g(!1)}},r=>{y.error("CSV解析失败: "+r.message),S(),g(!1)})}catch($){y.error($.message||"导入失败"),S(),g(!1)}};return e.jsxs(e.Fragment,{children:[_,e.jsx(K,{icon:e.jsx(at,{}),onClick:U,size:"small",children:"导入CSV"}),e.jsx(fe,{title:`导入CSV到 "${z}"`,open:T,onCancel:u,onOk:Z,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:M,okButtonProps:{disabled:!p},children:e.jsxs(de,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(le,{accept:".csv",beforeUpload:D,maxCount:1,fileList:p?[{uid:"-1",name:p.name,status:"done"}]:[],onRemove:()=>{L(null),m(null),d([]),h([])},children:e.jsx(K,{icon:e.jsx(Le,{}),children:"选择CSV文件"})})}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(Fe,{columns:b,dataSource:B,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(S,$)=>($==null?void 0:$.toString())||"0"}),B.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function $t({fileName:x}){const[z,t]=f.useState(!1),[T,v]=pe.useMessage(),p=async()=>{t(!0);const L=T.loading("正在导出数据...",0);try{const i=await fetch(`/api/data/${encodeURIComponent(x)}/export`);if(!i.ok){const h=await i.json();throw new Error(h.error||"导出失败")}const m=await i.text(),B=new Blob([m],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(B),b=document.createElement("a");b.href=d,b.download=`${x}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(d),T.success("导出成功")}catch(i){T.error(i.message||"导出失败")}finally{L(),t(!1)}};return e.jsxs(e.Fragment,{children:[v,e.jsx(K,{icon:e.jsx(it,{}),onClick:p,loading:z,size:"small",children:"导出CSV"})]})}function Pt({fileName:x,tableName:z,onRefresh:t}){const[T,v]=f.useState(!1),[p,L]=f.useState([]),[i,m]=f.useState(null),[B,d]=f.useState(null),[b,h]=f.useState(null),[M,g]=f.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:a=>`共 ${a} 条记录`,size:"small"}),[y,_]=pe.useMessage(),[U]=he.useForm();f.useEffect(()=>{u()},[x]);const u=async()=>{v(!0);try{const a=await fetch(`/api/data/${encodeURIComponent(x)}`);if(!a.ok)throw new Error("Failed to fetch data");const j=await a.json();L(j),g(n=>({...n,total:j.length}))}catch(a){y.error("加载数据失败: "+a.message)}finally{v(!1)}},J=async a=>{const j=y.loading("正在删除...",0);try{const n=await fetch(`/api/data/${encodeURIComponent(x)}/${encodeURIComponent(String(a))}`,{method:"DELETE"});if(!n.ok){const l=await n.json();throw new Error(l.error||"删除失败")}y.success("删除成功"),u()}catch(n){y.error(n.message||"删除失败")}finally{j()}},G=a=>{m(a.id),d({...a}),h({...a}),U.setFieldsValue(a)},A=()=>{b&&i&&U.setFieldsValue(b),m(null),d(null),h(null),U.resetFields()},D=(a,j)=>a==="id"?"ID字段不可编辑":(j==null||typeof j=="string"&&j.trim()==="",null),Z=async()=>{if(!(!i||!B))try{const a=U.getFieldsValue();for(const[n,l]of Object.entries(a)){const P=D(n,l);if(P){y.error(P);return}}const j=y.loading("正在保存...",0);try{const{id:n,...l}=a,P=await fetch(`/api/data/${encodeURIComponent(x)}/${encodeURIComponent(String(i))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!P.ok){const H=await P.json();throw new Error(H.error||"保存失败")}y.success("保存成功"),m(null),d(null),h(null),U.resetFields(),u()}catch(n){y.error(n.message||"保存失败"),b&&(U.setFieldsValue(b),y.info("已恢复到原始数据"))}finally{j()}}catch(a){y.error("验证失败: "+a.message),b&&(U.setFieldsValue(b),y.info("已恢复到原始数据"))}},S=a=>{g(a)},$=()=>{u(),t&&t()},r=(a,j,n)=>i==j.id?n==="id"?e.jsx(se,{value:a,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof a==="number"?e.jsx(he.Item,{name:n,style:{margin:0},rules:[{validator:(H,q)=>{const W=D(n,q);return W?Promise.reject(W):Promise.resolve()}}],children:e.jsx(mt,{style:{width:"100%"},size:"small"})}):e.jsx(he.Item,{name:n,style:{margin:0},rules:[{validator:(H,q)=>{const W=D(n,q);return W?Promise.reject(W):Promise.resolve()}}],children:e.jsx(se,{size:"small"})}):a==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof a=="object"?JSON.stringify(a):String(a),O=(()=>{if(p.length===0)return[];const a=new Set;p.forEach(l=>{Object.keys(l).forEach(P=>a.add(P))});const n=Array.from(a).sort((l,P)=>l==="id"?-1:P==="id"?1:l.localeCompare(P)).map(l=>({title:l,dataIndex:l,key:l,ellipsis:!0,render:(P,H)=>r(P,H,l)}));return n.push({title:"操作",key:"action",fixed:"right",width:80,render:(l,P)=>i==P.id?e.jsxs(de,{size:"small",children:[e.jsx(ce,{title:"保存",children:e.jsx(K,{type:"link",size:"small",icon:e.jsx(ct,{}),onClick:Z})}),e.jsx(ce,{title:"取消",children:e.jsx(K,{type:"link",size:"small",icon:e.jsx(dt,{}),onClick:A})})]}):e.jsxs(de,{size:"small",children:[e.jsx(ce,{title:"编辑",children:e.jsx(K,{type:"link",size:"small",icon:e.jsx(Oe,{}),onClick:()=>G(P),disabled:i!==null})}),e.jsx(ft,{title:"确定要删除这条记录吗？",onConfirm:()=>J(P.id),okText:"确定",cancelText:"取消",children:e.jsx(ce,{title:"删除",children:e.jsx(K,{type:"link",danger:!0,size:"small",icon:e.jsx(Me,{}),disabled:i!==null})})})]})}),n})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[_,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",z]}),e.jsxs(de,{children:[e.jsx(vt,{fileName:x,tableName:z,onImportComplete:$}),e.jsx($t,{fileName:x,tableName:z}),e.jsx(K,{icon:e.jsx(lt,{}),onClick:$,disabled:i!==null,size:"small",children:"刷新"})]})]}),e.jsx(he,{form:U,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(Fe,{columns:O,dataSource:p,rowKey:a=>String(a.id),loading:T,pagination:M,onChange:S,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(Y,{description:"暂无数据，请导入 CSV 或添加记录",image:Y.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function Rt({onRefresh:x}){const[z,t]=f.useState(!1),[T,v]=f.useState([]),[p,L]=f.useState(""),[i,m]=pe.useMessage(),[B,d]=fe.useModal(),[b,h]=f.useState(!1),[M,g]=f.useState(""),y=p==="";f.useEffect(()=>{_()},[p]);const _=async()=>{t(!0);try{const r=p?`/api/media?path=${encodeURIComponent(p)}`:"/api/media",C=await fetch(r);if(!C.ok)throw new Error("Failed to fetch media assets");const O=await C.json();v(Array.isArray(O)?O:[])}catch(r){i.error("加载素材失败: "+r.message),v([])}finally{t(!1)}},U=async r=>{const{file:C,onSuccess:O,onError:a}=r,j=new FormData;j.append("file",C),p&&j.append("path",p);try{const n=await fetch("/api/media/upload",{method:"POST",body:j});if(!n.ok){const l=await n.json();throw new Error(l.error||"上传失败")}i.success(`${C.name} 上传成功`),O(null,C),_(),x&&x()}catch(n){i.error(n.message||"上传失败"),a(n)}},u=r=>{B.confirm({title:`确定要删除 "${r.name}" 吗？`,content:r.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const C=i.loading("正在删除...",0);try{const O=await fetch(`/api/media/${encodeURIComponent(r.path)}`,{method:"DELETE"});if(!O.ok){const a=await O.json();throw new Error(a.error||"删除失败")}i.success("删除成功"),_(),x&&x()}catch(O){i.error(O.message||"删除失败")}finally{C()}}})},J=r=>{r.type==="folder"&&L(r.path)},G=r=>{L(r)},A=()=>{h(!0),g("")},D=async()=>{if(!M.trim()){i.error("请输入文件夹名称");return}const r=i.loading("正在创建文件夹...",0);try{const C=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:M.trim(),parentPath:p||void 0})});if(!C.ok){const O=await C.json();throw new Error(O.error||"创建文件夹失败")}i.success("文件夹创建成功"),h(!1),_(),x&&x()}catch(C){i.error(C.message||"创建文件夹失败")}finally{r()}},Z=()=>{const r=p?p.split("/"):[],C=[{title:e.jsxs("a",{onClick:()=>G(""),children:[e.jsx(pt,{})," 根目录"]})},...r.map((O,a)=>{const j=r.slice(0,a+1).join("/");return{title:e.jsx("a",{onClick:()=>G(j),children:O})}})];return e.jsx(ht,{items:C,style:{marginBottom:16}})},S=r=>r.type==="folder"?e.jsx(ut,{style:{fontSize:48,color:"#faad14"}}):r.type==="image"?e.jsx(Re,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(xt,{style:{fontSize:48,color:"#1890ff"}}),$=r=>{const C=()=>[{key:"delete",label:"删除",icon:e.jsx(Me,{}),danger:!0,onClick:()=>u(r)}];return e.jsx(ge,{hoverable:!0,style:{height:"100%"},cover:r.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>J(r),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(r.path)}`,alt:r.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:r.type==="folder"?"pointer":"default"},onClick:()=>J(r),children:S(r)}),actions:[e.jsx(we,{menu:{items:C()},trigger:["click"],children:e.jsx(K,{type:"text",icon:e.jsx(De,{})})})],children:e.jsx(ge.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:r.type==="folder"?"文件夹":r.size?`${(r.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[m,d,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(de,{children:[e.jsx(K,{icon:e.jsx($e,{}),onClick:A,children:"新建文件夹"}),!y&&e.jsx(le,{customRequest:U,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(K,{type:"primary",icon:e.jsx(Le,{}),children:"上传文件"})})]})]}),Z(),z?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(Ae,{size:"large",tip:"加载中..."})}):T.length===0?e.jsx(Y,{description:y?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(Ee,{gutter:[16,16],children:T.map(r=>e.jsx(ve,{xs:12,sm:8,md:6,lg:4,xl:4,children:$(r)},r.id))}),e.jsx(fe,{title:"新建文件夹",open:b,onOk:D,onCancel:()=>h(!1),okText:"创建",cancelText:"取消",children:e.jsx(se,{placeholder:"请输入文件夹名称",value:M,onChange:r=>g(r.target.value),onPressEnter:D})})]})}const{Content:Tt}=me,{useToken:Nt}=xe,At=({activeTab:x,selectedTheme:z,selectedDoc:t,selectedLibrary:T,selectedDataTable:v,onRefreshDataTables:p,onRefreshMedia:L})=>{const{token:i}=Nt(),m=()=>{if(!z)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:i.colorBgContainer},children:e.jsx(Y,{description:"请从左侧选择一个主题",image:Y.PRESENTED_IMAGE_SIMPLE})});const g=`/themes/${encodeURIComponent(z.name)}`;return e.jsx("iframe",{src:g,style:{width:"100%",flex:1,border:"none",background:i.colorBgContainer},title:z.displayName})},B=()=>{if(!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:i.colorBgContainer},children:e.jsx(Y,{description:"请从左侧选择一个文档",image:Y.PRESENTED_IMAGE_SIMPLE})});const g=t.name.replace(/\.md$/i,""),y=`/assets/docs/${encodeURIComponent(g)}`;return e.jsx("iframe",{src:y,style:{width:"100%",flex:1,border:"none",background:i.colorBgContainer},title:t.displayName})},d=()=>{if(!T)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:i.colorBgContainer},children:e.jsx(Y,{description:"请从左侧选择一个前端库",image:Y.PRESENTED_IMAGE_SIMPLE})});const g=`/assets/libraries/${T.name}`;return e.jsx("iframe",{src:g,style:{width:"100%",flex:1,border:"none",background:i.colorBgContainer},title:T.displayName})},b=()=>v?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:i.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(Pt,{fileName:v.fileName,tableName:v.tableName,onRefresh:p})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:i.colorBgContainer},children:e.jsx(Y,{description:"请从左侧选择一个数据表",image:Y.PRESENTED_IMAGE_SIMPLE})}),h=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:i.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(Rt,{onRefresh:L})}),M=()=>{switch(x){case"themes":return m();case"docs":return B();case"libraries":return d();case"data":return b();case"media":return h();default:return null}};return e.jsx(Tt,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:i.colorBgContainer,display:"flex",flexDirection:"column"},children:M()})},Se="axhub-assets-active-tab",Dt="/api/themes",Ot="/api/docs",Lt="/api/libraries",Ie="axhub-make-dark-mode";function Ft({isDarkMode:x,setIsDarkMode:z}){const{message:t,modal:T}=be.useApp(),[v,p]=f.useState(!0),[L,i]=f.useState(!1),[m,B]=f.useState(()=>{const o=localStorage.getItem(Se);return o==="themes"||o==="docs"||o==="libraries"||o==="data"||o==="media"?o:"themes"}),[d,b]=f.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[h,M]=f.useState(null),[g,y]=f.useState(null),[_,U]=f.useState(null),[u,J]=f.useState(null),[G,A]=f.useState(""),[D,Z]=f.useState(!1),[S,$]=f.useState([]),[r,C]=f.useState(!1),[O,a]=f.useState(!1),[j,n]=f.useState("");f.useEffect(()=>{localStorage.setItem(Se,m)},[m]),f.useEffect(()=>{l()},[]),f.useEffect(()=>{!v&&d&&(m==="themes"&&d.themes.length>0&&!h?M(d.themes[0]):m==="docs"&&d.docs.length>0&&!g?y(d.docs[0]):m==="libraries"&&d.libraries.length>0&&!_?U(d.libraries[0]):m==="data"&&d.dataTables.length>0&&!u&&J(d.dataTables[0]))},[v,d,m,h,g,_,u]);const l=async()=>{p(!0);try{const[o,I,R,E,F]=await Promise.all([fetch(Dt),fetch(Ot),fetch(Lt),fetch("/api/data/tables"),fetch("/api/media")]);if(!o.ok||!I.ok||!R.ok||!E.ok||!F.ok)throw new Error("Failed to fetch data");const w=await o.json(),k=await I.json(),Q=await R.json(),N=await E.json(),ee=await F.json();b({themes:w||[],docs:k||[],libraries:Q||[],dataTables:Array.isArray(N)?N:[],mediaAssets:Array.isArray(ee)?ee:[]})}catch(o){t.error("加载数据失败: "+o.message),b({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{p(!1)}},P=o=>{B(o),A("")},H=o=>{M(o)},q=o=>{y(o)},W=o=>{U(o)},s=o=>{J(o)},c=async(o,I)=>{if(o==="data"){const R=I,E=R.fileName,F=R.tableName;let w=F;T.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",E,".json (不可修改)"]}),e.jsx(se,{autoFocus:!0,defaultValue:F,placeholder:"请输入新的表名称",onChange:k=>{w=k.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const k=w==null?void 0:w.trim();if(!k)return t.error("表名称不能为空"),Promise.reject();if(k===F)return;const Q=t.loading("正在重命名...",0);try{const N=await fetch(`/api/data/tables/${encodeURIComponent(E)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:k})});if(!N.ok){const ee=await N.json();throw new Error(ee.error||"重命名失败")}t.success("重命名成功"),(u==null?void 0:u.fileName)===E&&J({...u,tableName:k}),await l()}catch(N){return t.error(N.message||"重命名失败"),Promise.reject()}finally{Q()}}});return}if(o==="docs"){const E=I.name,F=E.lastIndexOf("."),w=F>0?E.slice(0,F):E,k=F>0?E.slice(F):"";let Q=w;T.confirm({title:"重命名文档",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["扩展名: ",k||"无"]}),e.jsx(se,{autoFocus:!0,defaultValue:w,placeholder:"请输入新的文档名称",onChange:N=>{Q=N.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){let N=Q==null?void 0:Q.trim();if(!N||(k&&N.endsWith(k)&&(N=N.slice(0,-k.length).trim()),!N))return t.error("文档名称不能为空"),Promise.reject();if(N===w)return;const ee=t.loading("正在重命名...",0);try{const oe=await fetch(`/api/docs/${encodeURIComponent(E)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBaseName:N})});if(!oe.ok){const ze=await oe.json();throw new Error(ze.error||"重命名失败")}t.success("重命名成功");const re=`${N}${k}`;(g==null?void 0:g.name)===E&&y({...g,name:re,displayName:re}),await l()}catch(oe){return t.error(oe.message||"重命名失败"),Promise.reject()}finally{ee()}}});return}if(o==="themes"){const R=I,E=R.name,F=R.displayName||R.name;let w=F;T.confirm({title:"重命名主题",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["主题目录: ",E," (不可修改)"]}),e.jsx(se,{autoFocus:!0,defaultValue:F,placeholder:"请输入新的主题名称",onChange:k=>{w=k.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const k=w==null?void 0:w.trim();if(!k)return t.error("主题名称不能为空"),Promise.reject();if(k===F)return;const Q=t.loading("正在重命名...",0);try{const N=await fetch(`/api/themes/${encodeURIComponent(E)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:k})});if(!N.ok){const ee=await N.json();throw new Error(ee.error||"重命名失败")}t.success("重命名成功"),(h==null?void 0:h.name)===E&&M({...h,displayName:k}),await l()}catch(N){return t.error(N.message||"重命名失败"),Promise.reject()}finally{Q()}}})}},V=async(o,I,R)=>{const E={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};if(o==="themes"){const F=t.loading("正在删除...",0);try{const w=await fetch(`/api/themes/${I}`,{method:"DELETE"});if(!w.ok){const k=await w.json();throw new Error(k.error||"删除失败")}t.success("删除成功"),(h==null?void 0:h.name)===I&&M(null),l()}catch(w){t.error(w.message||"删除失败")}finally{F()}return}T.confirm({title:`确定要删除${E[o]} "${R}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const F=t.loading("正在删除...",0);try{let w;if(o==="data")w=await fetch(`/api/data/tables/${I}`,{method:"DELETE"});else if(o==="docs")w=await fetch(`/api/docs/${encodeURIComponent(I)}`,{method:"DELETE"});else if(o==="libraries")w=await fetch(`/api/libraries/${I}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!w.ok){const k=await w.json();throw new Error(k.error||"删除失败")}t.success("删除成功"),o==="docs"&&(g==null?void 0:g.name)===I?y(null):o==="libraries"&&(_==null?void 0:_.name)===I?U(null):o==="data"&&(u==null?void 0:u.fileName)===I&&J(null),l()}catch(w){t.error(w.message||"删除失败")}finally{F()}}})},ae=()=>{if(m==="themes"){const o=`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个主题」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件
- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力
- 告知：已经准备好开始新建主题
- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以
- 若信息不足，再用 2-4 个简短问题收集关键输入即可

**📋 必读规范文档**：
- **\`/rules/theme-generation-guide.md\`** ⭐️ 主题生成完整规范！
  - 请完整阅读此文档，了解主题生成的所有要求和约束
  - 文档包含：交付物规范、文件结构、生成策略、验收流程等

**提示**：如果用户没给 \`<theme-key>\` / \`name\` / \`description\`，先给出你建议的 \`<theme-key>\`，并让用户一键确认即可`;navigator.clipboard.writeText(o).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),T.info({title:"新建主题 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(se.TextArea,{value:o,rows:16,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})});return}if(m==="docs"){Z(!0);return}if(m==="libraries"){const o=`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，如果用户配置了 DeepWiki MCP 或 Context7 MCP 工具，你必须优先使用这些工具来获取和核实库的信息
- 使用 MCP 工具获取：官方文档、版本信息、API 说明、使用示例等
- 通过 MCP 工具核实：库的兼容性、依赖要求、与当前项目环境的匹配度
- 确保获取的信息准确且与当前开发环境兼容
- 如果 MCP 工具不可用，再使用其他方式获取信息，并在文档中标注信息来源

处理策略（按情况选择）：

1) 用户只给包名
- 优先使用 DeepWiki MCP 或 Context7 MCP 获取该库的完整信息
- 核实版本兼容性和依赖要求
- 推断名称
- 若用户未提供文档链接且 MCP 工具不可用，请在 Markdown 的「文档」字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档（用于后续 AI 按此方式读取文档）

2) 用户只给链接
- 使用 MCP 工具核实链接对应的库信息
- 识别对应包名/名称/版本信息；不确定就问用户
- 检查与当前项目环境的兼容性

3) 用户只描述需求
- 使用 MCP 工具搜索和比较相关库
- 给出 2-5 个候选库供用户选，并简要说明差异、兼容性和推荐理由
- 确认后再写入文档

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`;navigator.clipboard.writeText(o).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),T.info({title:"新建前端库 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(se.TextArea,{value:o,rows:18,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})});return}if(m==="data"){a(!0);return}t.info("新建功能开发中...")},X=async()=>{if(S.length===0){t.warning("请先上传文件");return}C(!0);try{const o=await Promise.all(S.map(async R=>{const E=R.originFileObj;if(!E)throw new Error("文件读取失败，请重新选择文件");const F=E.name,w=F.toLowerCase();if(!w.endsWith(".md")&&!w.endsWith(".csv")&&!w.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(E.size>5242880)throw new Error("单个文件大小不能超过 5MB");const k=await E.text();return{name:F,content:k}})),I=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:o})});if(!I.ok){const R=await I.json().catch(()=>null);throw new Error((R==null?void 0:R.error)||"上传失败")}t.success("上传成功"),Z(!1),$([]),l()}catch(o){t.error((o==null?void 0:o.message)||"上传失败")}finally{C(!1)}},te=()=>{const o=`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`;navigator.clipboard.writeText(o).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),T.info({title:"新建文档 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(se.TextArea,{value:o,rows:18,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})})},ne=async()=>{if(!j.trim()){t.error("请输入表名");return}const o=t.loading("正在创建表...",0);try{const I=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:j.trim()})});if(!I.ok){const R=await I.json();throw new Error(R.error||"创建表失败")}t.success("表创建成功"),a(!1),n(""),l()}catch(I){t.error(I.message||"创建表失败")}finally{o()}};return e.jsxs(me,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(kt,{collapsed:L,setCollapsed:i,activeTab:m,onTabChange:P,counts:{themes:d.themes.length,docs:d.docs.length,libraries:d.libraries.length,data:d.dataTables.length,media:d.mediaAssets.length},isDarkMode:x,setIsDarkMode:z}),e.jsxs(me,{children:[e.jsx(Et,{collapsed:L,loading:v,activeTab:m,themes:d.themes,docs:d.docs,libraries:d.libraries,dataTables:d.dataTables,selectedTheme:h,selectedDoc:g,selectedLibrary:_,selectedDataTable:u,onThemeSelect:H,onDocSelect:q,onLibrarySelect:W,onDataTableSelect:s,onDeleteAsset:V,onRenameAsset:c,onCreateClick:ae,searchText:G,setSearchText:A}),e.jsx(At,{activeTab:m,selectedTheme:h,selectedDoc:g,selectedLibrary:_,selectedDataTable:u,onRefreshDataTables:l,onRefreshMedia:l})]}),e.jsx(fe,{title:"新建文档",open:D,onCancel:()=>{Z(!1),$([])},footer:[e.jsx(K,{onClick:te,children:"复制 Prompt 新建"},"copy"),e.jsx(K,{type:"primary",loading:r,onClick:X,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(le.Dragger,{multiple:!0,accept:".md",fileList:S,beforeUpload:o=>(o.name||"").toLowerCase().endsWith(".md")?!1:(t.error("仅支持上传 .md 文件"),le.LIST_IGNORE),onChange:o=>$(o.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"仅支持 .md 文件，支持批量上传"})]})})}),e.jsx(fe,{title:"新建数据表",open:O,onOk:ne,onCancel:()=>{a(!1),n("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(se,{placeholder:"例如: 用户表, 产品列表",value:j,onChange:o=>n(o.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function Mt(){const[x,z]=f.useState(()=>localStorage.getItem(Ie)==="true");return f.useEffect(()=>{localStorage.setItem(Ie,String(x))},[x]),e.jsx(yt,{theme:jt(x),children:e.jsx(be,{children:e.jsx(Ft,{isDarkMode:x,setIsDarkMode:z})})})}const zt=gt.createRoot(document.getElementById("root"));zt.render(e.jsx(Mt,{}));
