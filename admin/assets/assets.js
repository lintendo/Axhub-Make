import{P as Oe,S as Ze,a as ze,A as Ye}from"./chunks/PromptActionButton.js";import{T as ve,U as je,s as Te,t as Ae,r as n,j as e,M as ke,R as nt,C as ot,B as rt,a as Be,S as Ce,b as Z,c as at,d as $t,e as it,f as lt,g as Nt,L as Pe,h as ye,i as Rt,k as Lt,l as Dt,m as Ut,n as ct,o as We,p as Ve,q as dt,u as Se,v as ft,w as Ot,D as Ge,x as _t,y as Mt,z as Ft,A as zt,E as Bt,F as Wt,G as He,I as xe,H as Vt,J as ut,K as ie,N as Gt,O as mt,P as Ht,Q as ht,V as pt,W as xt,X as Qe,Y as Kt,Z as De,_ as Jt,$ as qt,a0 as Xt,a1 as Zt,a2 as gt,a3 as Yt,a4 as Qt,a5 as es,a6 as ts,a7 as ss,a8 as ns,a9 as os,aa as rs}from"./chunks/vendor.js";import{g as as}from"./chunks/index.js";import"./chunks/execute.js";const{Text:Ue}=ve,{Dragger:et}=je,is=({open:p,onCancel:F,preferredPromptClient:t,preferredIDE:A})=>{const[k,w]=Te.useMessage(),{token:O}=Ae.useToken(),[d,T]=n.useState(null),[_,v]=n.useState([]),[L,$]=n.useState(!1),[z,U]=n.useState(null),[i,B]=n.useState([]),[x,S]=n.useState(!1),[P,X]=n.useState(null),[N,G]=n.useState(null);n.useEffect(()=>{p||(T(null),v([]),$(!1),U(null),B([]),S(!1),X(null),G(null))},[p]);const W=[{key:"local_axure",title:"本地 Axure 文件导入",icon:e.jsx(at,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePaths:["/skills/local-axure-workflow/SKILL.md"],disabled:!1,recommended:!0},{key:"axure_prototype",title:"Axure 原型链接导入",icon:e.jsx($t,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePaths:["/skills/axure-prototype-workflow/SKILL.md","/skills/axure-prototype-workflow/asset-extraction.md","/skills/axure-prototype-workflow/page-restoration.md"],disabled:!1},{key:"web_page",title:"产品网页链接导入",icon:e.jsx(it,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePaths:["/skills/web-page-workflow/SKILL.md","/skills/web-page-workflow/asset-extraction.md","/skills/web-page-workflow/page-restoration.md"],disabled:!1},{key:"screenshot",title:"App/小程序/网页截图导入",icon:e.jsx(lt,{style:{fontSize:24,color:"#faad14"}}),desc:"上传多张截图，提取结构/交互/状态数据，并生成页面/元素",rulePaths:["skills/screen-to-code/SKILL.md","skills/screen-to-code/screenshot-collection.md"],disabled:!1},{key:"app_direct",title:"App/小程序直接导入",icon:e.jsx(Nt,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePaths:[],disabled:!0}],a=d&&W.find(r=>r.key===d)||null,h=(r,b)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「${r}」设计资产。

请认真阅读规则文档：
${b.map(H=>`- \`${H}\``).join(`
`)}
并按文档定义的交互指南回复用户。`,o=(r,b)=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「基于${r}导入资产」。

**交互要求**：
- 收到本条系统指令后，先根据 skill 的用户交互指南用简短中文回复一次，确认需求，并引导用户提供 ${r}（URL）
- 未拿到链接前，不要生成任何文件
- 参考下方文档，按流程逐步引导用户完成导入与还原/优化

**📋 参考文档（必须阅读）**：
${b.map(H=>`- \`${H}\``).join(`
`)}`,E=r=>{T(r),v([]),U(null),B([]),X(null),G(null)},R=async r=>{const{file:b,onSuccess:H,onError:oe}=r,Y=b instanceof File?b:b.originFileObj,re=new FormData;re.append("file",Y,Y.name),re.append("uploadType","local_axure"),$(!0);try{const K=await fetch("/api/upload",{method:"POST",body:re}),J=await K.json();K.ok&&J.success?(U(J),k.success(J.message||"文件已解压，请复制 Prompt 交给 AI 处理"),H(null,b)):(k.error(J.error||"上传失败"),oe(new Error(J.error||"上传失败")))}catch(K){k.error("上传失败: "+((K==null?void 0:K.message)||"Unknown error")),oe(K)}finally{$(!1)}},f=async r=>{const{file:b,onSuccess:H,onError:oe}=r,Y=b instanceof File?b:b.originFileObj,re=new FormData;re.append("file",Y,Y.name),N&&re.append("batchId",N),S(!0);try{const K=await fetch("/api/upload-screenshots",{method:"POST",body:re}),J=await K.json();K.ok&&J.success?(X(J),G(J.batchId||N),k.success(J.message||"截图已上传，请复制 Prompt 交给 AI 处理"),H(null,b)):(k.error(J.error||"上传失败"),oe(new Error(J.error||"上传失败")))}catch(K){k.error("上传失败: "+((K==null?void 0:K.message)||"Unknown error")),oe(K)}finally{S(!1)}},I=!a||a.disabled?!1:a.key==="local_axure"?!!(z!=null&&z.prompt):a.key==="screenshot"?!!(P!=null&&P.prompt):!0,g=()=>!a||a.disabled?"":a.key==="local_axure"?(z==null?void 0:z.prompt)||"":a.key==="screenshot"?(P==null?void 0:P.prompt)||"":a.key==="axure_prototype"?o("Axure 原型链接",a.rulePaths):a.key==="web_page"?o("网页链接",a.rulePaths):h(a.title,a.rulePaths);return e.jsxs(ke,{title:"智能导入资产",open:p,onCancel:F,footer:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:8,width:"100%"},children:[e.jsx(Z,{onClick:F,children:"取消"},"cancel"),e.jsx(Oe,{preferredClient:t,preferredIDE:A,scene:`assets-smart-import-${(a==null?void 0:a.key)||"unknown"}`,buildPrompt:g,disabled:!I,copyLabel:"复制新建 Prompt",style:{flex:"0 0 auto"},executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy")]}),width:800,destroyOnClose:!0,children:[w,e.jsx(nt,{gutter:[16,16],children:W.map((r,b)=>e.jsx(ot,{span:12,children:e.jsx(rt.Ribbon,{text:"推荐",color:"#008F5D",style:{display:r.recommended?"block":"none"},children:e.jsx(Be,{hoverable:!r.disabled,style:{height:"100%",cursor:r.disabled?"not-allowed":"pointer",opacity:r.disabled?.6:1,background:r.disabled?"#f5f5f5":d===r.key?O.colorFillAlter:void 0,borderColor:d===r.key?O.colorInfo:void 0},onClick:()=>{r.disabled||E(r.key)},children:e.jsxs(Ce,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:r.disabled?"#e8e8e8":r.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:r.icon}),e.jsxs("div",{children:[e.jsx(Ue,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:r.title}),e.jsx(Ue,{type:"secondary",style:{fontSize:13},children:r.desc})]})]})})})},b))}),d==="local_axure"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(et,{name:"file",multiple:!1,fileList:_,customRequest:R,beforeUpload:r=>{var H;return r.type==="application/zip"||r.type==="application/x-zip-compressed"||((H=r.name)==null?void 0:H.endsWith(".zip"))?!0:(k.error("请上传 ZIP 格式的文件"),je.LIST_IGNORE)},onChange:r=>v(r.fileList.slice(-1)),onRemove:()=>{v([]),U(null)},accept:".zip",disabled:L,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽 ZIP 文件上传"}),e.jsx(Ue,{type:"secondary",style:{fontSize:12},children:"上传后会解压到本地 temp 目录，并生成可复制的 Prompt"})]})})}),d==="screenshot"&&e.jsx("div",{style:{marginTop:16},children:e.jsx(et,{name:"file",multiple:!0,fileList:i,customRequest:f,beforeUpload:r=>typeof(r==null?void 0:r.type)=="string"&&r.type.startsWith("image/")?!0:(k.error("请上传图片格式的文件（png/jpg/webp 等）"),je.LIST_IGNORE),onChange:r=>B(r.fileList),onRemove:()=>{B([]),X(null),G(null)},accept:"image/*",disabled:x,style:{background:"#fafafa",border:"1px dashed #d9d9d9"},children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsx("p",{className:"ant-upload-text",style:{fontSize:14,marginBottom:4},children:"点击或拖拽多张截图上传"}),e.jsx(Ue,{type:"secondary",style:{fontSize:12},children:"上传完成后点击底部「复制 Prompt」，让 AI 按文档流程完成截图转代码"})]})})})]})},{Header:ls}=Pe,{useToken:cs}=Ae,ds=({collapsed:p,setCollapsed:F,activeTab:t,onTabChange:A,counts:k,isDarkMode:w,setIsDarkMode:O,assistantEnabled:d=!1,assistantVisible:T=!1,onToggleAssistant:_,preferredPromptClient:v,preferredIDE:L})=>{const[$,z]=ye.useState(null),[U,i]=ye.useState(!1),{token:B}=cs();return ye.useEffect(()=>{let x=!1;return fetch("/api/version").then(S=>S.ok?S.json():Promise.reject(new Error("Request failed"))).then(S=>{if(x)return;const P=typeof(S==null?void 0:S.version)=="string"?S.version:null;z(P)}).catch(()=>{x||z(null)}),()=>{x=!0}},[]),e.jsxs(ls,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:B.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${B.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[t!=="media"&&e.jsx(Z,{type:"text",icon:p?e.jsx(Rt,{}):e.jsx(Lt,{}),onClick:()=>F(!p),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:t==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:B.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(Dt,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ut,{value:t,size:"small",shape:"round",style:{fontSize:"12px"},onChange:x=>A(x),options:[{label:`主题 (${k.themes})`,value:"themes",icon:e.jsx(ct,{})},{label:`文档 (${k.docs})`,value:"docs",icon:e.jsx(We,{})},{label:`前端库 (${k.libraries})`,value:"libraries",icon:e.jsx(Ve,{})},{label:`数据 (${k.data})`,value:"data",icon:e.jsx(dt,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Se,{title:"使用 AI 智能导入资产",children:e.jsx(Z,{size:"small",icon:e.jsx(ft,{}),onClick:()=>i(!0),children:"智能导入资产"})}),e.jsx(is,{open:U,onCancel:()=>i(!1),preferredPromptClient:v??null,preferredIDE:L??null}),d&&e.jsx(Se,{title:T?"关闭 Axhub Genie":"打开 Axhub Genie",children:e.jsx(rt,{dot:!0,status:T?"processing":"default",styles:{root:{lineHeight:1},indicator:{display:T?"inline-flex":"none"}},children:e.jsx(Z,{type:"text",size:"small",icon:e.jsx(Ot,{}),onClick:_})})}),e.jsx(Ge,{menu:{items:[{key:"theme",label:w?"浅色模式":"深色模式",icon:w?e.jsx(Mt,{}):e.jsx(Ft,{}),onClick:()=>O(!w)},{type:"divider"},{key:"help",label:"帮助中心",icon:e.jsx(zt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(Bt,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(it,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(Wt,{}),extra:e.jsx("span",{style:{fontSize:12,color:B.colorTextSecondary},children:$?`v${$}`:"-"})}]},placement:"bottomRight",children:e.jsx(Z,{type:"text",icon:e.jsx(_t,{})})})]})]})},{Sider:fs}=Pe,{useToken:us}=Ae,ms=({collapsed:p,loading:F,activeTab:t,themes:A,docs:k,libraries:w,dataTables:O,selectedTheme:d,selectedDoc:T,selectedLibrary:_,selectedDataTable:v,onThemeSelect:L,onDocSelect:$,onLibrarySelect:z,onDataTableSelect:U,onDeleteAsset:i,onRenameAsset:B,onCreateClick:x,searchText:S,setSearchText:P,preferredPromptClient:X,preferredIDE:N,createPromptConfig:G})=>{const{token:W}=us(),{message:a,modal:h}=He.useApp(),o=async l=>{const y=await fetch("/api/themes/check-references",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({themeName:l})});if(!y.ok){const q=await y.json().catch(()=>({}));throw new Error(q.error||"检查主题引用失败")}return y.json()},E=ye.useMemo(()=>{if(!S)return A;const l=S.toLowerCase();return A.filter(y=>y.displayName.toLowerCase().includes(l)||y.name.toLowerCase().includes(l))},[A,S]),R=ye.useMemo(()=>{if(!S)return k;const l=S.toLowerCase();return k.filter(y=>y.displayName.toLowerCase().includes(l)||y.name.toLowerCase().includes(l))},[k,S]),f=ye.useMemo(()=>{if(!S)return w;const l=S.toLowerCase();return w.filter(y=>y.displayName.toLowerCase().includes(l)||y.name.toLowerCase().includes(l))},[w,S]),I=ye.useMemo(()=>{if(!S)return O;const l=S.toLowerCase();return O.filter(y=>y.tableName.toLowerCase().includes(l)||y.fileName.toLowerCase().includes(l))},[O,S]),g=async l=>{let y="",q="";const ae="tableName"in l?l.tableName:l.displayName,ee="fileName"in l?l.fileName:l.name;if(t==="docs"?(y=`assets/docs/${ee}`,q=`[${ae}](assets/docs/${ee})`):t==="themes"?(y=`src/themes/${ee}/index.tsx`,q=`[${ae}](src/themes/${ee})`):t==="libraries"?(y=`assets/libraries/${ee}.md`,q=`[${ae}](assets/libraries/${ee}.md)`):t==="data"&&(y=`assets/database/${ee}.json`,q=`[${ae}](assets/database/${ee}.json)`),!y){a.warning("无法获取文件路径");return}const M=["vscode","cursor"],te=a.loading("正在发送到 IDE...",0);try{q&&await navigator.clipboard.writeText(q);const Q=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:M})}),le=await Q.json().catch(()=>null);if(!Q.ok||!(le!=null&&le.sent)){a.warning("编辑器未连接，已复制了文件标题，可前往使用");return}const se=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:y,targetClientTypes:M})}),de=await se.json().catch(()=>null);if(!se.ok||!(de!=null&&de.sent)){a.warning("编辑器未连接，已复制了文件标题，可前往使用");return}a.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(Q){console.error("Failed to open in IDE:",Q),a.error((Q==null?void 0:Q.message)||"发送失败")}finally{te()}},r=(l,y)=>{const q=t==="themes"&&"name"in l&&(d==null?void 0:d.name)===l.name||t==="docs"&&"name"in l&&(T==null?void 0:T.name)===l.name||t==="libraries"&&"name"in l&&(_==null?void 0:_.name)===l.name||t==="data"&&"fileName"in l&&(v==null?void 0:v.fileName)===l.fileName,ae=t==="themes"&&"hasDoc"in l&&l.hasDoc,ee=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(Ve,{})},{key:"delete",label:`删除${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`,icon:e.jsx(Ht,{}),danger:!0}];ae&&ee.splice(1,0,{key:"open-doc-in-ide",label:"在编辑器中打开规范文档",icon:e.jsx(We,{}),danger:!1}),(t==="data"||t==="themes"||t==="docs")&&ee.unshift({key:"rename",label:"重命名",icon:e.jsx(ht,{}),danger:!1});const M="tableName"in l?l.tableName:l.displayName,te="fileName"in l?l.fileName:l.name;return{key:te,icon:y,label:e.jsxs("div",{className:`menu-item-wrapper ${q?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:M})}),e.jsx(Ge,{trigger:["click"],menu:{items:ee,onClick:async({key:Q})=>{if(Q==="open-in-ide")g(l);else if(Q==="open-doc-in-ide"){const le="name"in l?l.name:"";if(!le)return;const de=`src/themes/${le}/README.md`,ge=`src/themes/${le}/DESIGN-SPEC.md`,we=`[${M} 规范文档](${de})`,ue=["vscode","cursor"],Ie=a.loading("正在发送到 IDE...",0);try{await navigator.clipboard.writeText(we);const me=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:ue})}),ne=await me.json().catch(()=>null);if(!me.ok||!(ne!=null&&ne.sent)){a.warning("编辑器未连接，已复制了文件标题，可前往使用");return}let he=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:de,targetClientTypes:ue})}),fe=await he.json().catch(()=>null);if((!he.ok||!(fe!=null&&fe.sent))&&(he=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:ge,targetClientTypes:ue})}),fe=await he.json().catch(()=>null)),!he.ok||!(fe!=null&&fe.sent)){a.warning("编辑器未连接，已复制了文件标题，可前往使用");return}a.success("已在编辑器中打开规范文档，并复制了文件标题")}catch(me){console.error("Failed to open doc in IDE:",me),a.error((me==null?void 0:me.message)||"发送失败")}finally{Ie()}}else if(Q==="rename")B==null||B(t,l);else if(Q==="delete")if(t==="themes"){const le=a.loading("正在检查主题引用...",0);try{const se=await o(te),de=Array.isArray(se==null?void 0:se.references)?se.references:[];if(de.length>0){const ge=de.map(ue=>`- ${ue}`).join(`
`),we=`我希望删除主题 "${M}" (${te})。
该主题位于项目中的相对路径为：\`src/themes/${te}\`

已检测到以下文件引用了该主题的 \`designToken.json\` 或 \`globals.css\`：
${ge}

请帮我执行以下检查和操作：
1. 核对上述引用是否准确，并补充遗漏的引用文件（优先检查 \`src/elements/\` 与 \`src/pages/\`）。
2. 如果确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 或 \`globals.css\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，使这些原型脱离对该主题目录的依赖。
3. 完成上述解耦操作后，再彻底删除主题目录 \`src/themes/${te}\`。

主题目录内容规范（至少包含 globals.css 或 designToken.json 其中之一）：
\`\`\`
src/themes/<theme-key>/
├── globals.css
├── designToken.json
└── index.tsx
\`\`\``;h.confirm({title:"检测到主题引用",width:720,cancelText:"取消",content:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:"已检测到以下文件引用了该主题："}),e.jsx("pre",{style:{maxHeight:260,overflow:"auto",background:"#f6f7f9",padding:12,borderRadius:6},children:ge}),e.jsx("div",{style:{marginTop:12},children:e.jsx(Oe,{preferredClient:X,preferredIDE:N,scene:"assets-theme-delete-ref-fix",buildPrompt:()=>we,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"})})]}),footer:(ue,{CancelBtn:Ie})=>e.jsx(Ie,{})})}else h.confirm({title:`确认删除主题 "${M}" 吗？`,content:"未检测到引用文件。删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",onOk(){i(t,te,M)}})}catch(se){a.error(se.message||"检查主题引用失败")}finally{le()}}else i(t,te,M)}},children:e.jsx(Z,{type:"text",size:"small",className:"more-btn",icon:e.jsx(mt,{}),onClick:Q=>{Q.stopPropagation()}})})]})}},b=E.map(l=>r(l,e.jsx(ct,{}))),H=R.map(l=>r(l,e.jsx(We,{}))),oe=f.map(l=>r(l,e.jsx(Ve,{}))),Y=I.map(l=>r(l,e.jsx(dt,{}))),re=({key:l})=>{if(t==="themes"){const y=A.find(q=>q.name===l);y&&L(y)}else if(t==="docs"){const y=k.find(q=>q.name===l);y&&$(y)}else if(t==="libraries"){const y=w.find(q=>q.name===l);y&&z(y)}else if(t==="data"){const y=O.find(q=>q.fileName===l);y&&U(y)}},K=t==="themes"?b:t==="docs"?H:t==="data"?Y:oe,J=t==="themes"?d==null?void 0:d.name:t==="docs"?T==null?void 0:T.name:t==="data"?v==null?void 0:v.fileName:_==null?void 0:_.name;return e.jsx(fs,{trigger:null,collapsible:!0,collapsed:p||t==="media",width:240,collapsedWidth:0,style:{background:W.colorBgContainer,borderRight:`1px solid ${W.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:t==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!p&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(xe,{placeholder:"搜索...",prefix:e.jsx(Vt,{}),value:S,onChange:l=>P(l.target.value),allowClear:!0,style:{flex:1}})})})}),F?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(ut,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[K.length===0?e.jsx(ie,{image:ie.PRESENTED_IMAGE_SIMPLE,description:S?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(Gt,{mode:"inline",selectedKeys:J?[J]:[],items:K,onClick:re,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!p&&e.jsx("div",{style:{position:"absolute",left:16,right:16,bottom:20},children:G?e.jsx(Oe,{preferredClient:X,preferredIDE:N,scene:G.scene,buildPrompt:G.buildPrompt,type:"primary",block:!0,copyLabel:"复制新建 Prompt",executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"}):e.jsx(Z,{type:"primary",block:!0,onClick:x,children:`新建${t==="data"?"数据表":t==="docs"?"文档":t==="themes"?"主题":"前端库"}`})})]})})};function hs({fileName:p,tableName:F,onImportComplete:t}){const[A,k]=n.useState(!1),[w,O]=n.useState(null),[d,T]=n.useState(null),[_,v]=n.useState([]),[L,$]=n.useState([]),[z,U]=n.useState(!1),[i,B]=Te.useMessage(),x=()=>{k(!0),O(null),T(null),v([]),$([])},S=()=>{k(!1),O(null),T(null),v([]),$([])},P=a=>a.length>=3&&a[0]===239&&a[1]===187&&a[2]===191?{encoding:"utf-8",offset:3}:a.length>=2&&a[0]===255&&a[1]===254?{encoding:"utf-16le",offset:2}:a.length>=2&&a[0]===254&&a[1]===255?{encoding:"utf-16be",offset:2}:null,X=async a=>{const h=await a.arrayBuffer(),o=new Uint8Array(h),E=P(o);if(E)return new TextDecoder(E.encoding).decode(o.subarray(E.offset));try{return new TextDecoder("utf-8",{fatal:!0}).decode(o)}catch{const f=["gb18030","gbk"];for(const I of f)try{return new TextDecoder(I).decode(o)}catch{continue}}return new TextDecoder("utf-8").decode(o)},N=(a,h,o)=>{Qe.parse(a,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:h,error:o})},G=async a=>{O(a),T(null);try{const h=await X(a);T(h),N(h,o=>{if(o.errors.length>0){i.error("CSV解析失败: "+o.errors[0].message);return}const E=o.data.slice(0,10);if(v(E),o.data.length>0){const R=o.data[0],f=Object.keys(R).map(I=>({title:I,dataIndex:I,key:I,ellipsis:!0,render:g=>g==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof g=="object"?JSON.stringify(g):String(g)}));$(f)}},o=>{i.error("CSV解析失败: "+o.message)})}catch(h){i.error((h==null?void 0:h.message)||"CSV读取失败")}return!1},W=async()=>{if(!w){i.error("请先选择CSV文件");return}U(!0);const a=i.loading("正在导入数据...",0);try{const h=d??await X(w);N(h,async o=>{try{if(o.errors.length>0)throw new Error("CSV解析失败: "+o.errors[0].message);const E=Qe.unparse(o.data,{quotes:!0,header:!0}),R=await fetch(`/api/data/${encodeURIComponent(p)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:E})});if(!R.ok){const I=await R.json();throw new Error(I.error||"导入失败")}const f=await R.json();i.success(`导入成功！共导入 ${f.recordCount} 条记录`),k(!1),O(null),T(null),v([]),$([]),t()}catch(E){i.error(E.message||"导入失败")}finally{a(),U(!1)}},o=>{i.error("CSV解析失败: "+o.message),a(),U(!1)})}catch(h){i.error(h.message||"导入失败"),a(),U(!1)}};return e.jsxs(e.Fragment,{children:[B,e.jsx(Z,{icon:e.jsx(ft,{}),onClick:x,size:"small",children:"导入CSV"}),e.jsx(ke,{title:`导入CSV到 "${F}"`,open:A,onCancel:S,onOk:W,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:z,okButtonProps:{disabled:!w},children:e.jsxs(Ce,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(je,{accept:".csv",beforeUpload:G,maxCount:1,fileList:w?[{uid:"-1",name:w.name,status:"done"}]:[],onRemove:()=>{O(null),T(null),v([]),$([])},children:e.jsx(Z,{icon:e.jsx(pt,{}),children:"选择CSV文件"})})}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(xt,{columns:L,dataSource:_,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(a,h)=>(h==null?void 0:h.toString())||"0"}),_.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function ps({fileName:p}){const[F,t]=n.useState(!1),[A,k]=Te.useMessage(),w=async()=>{t(!0);const O=A.loading("正在导出数据...",0);try{const d=await fetch(`/api/data/${encodeURIComponent(p)}/export`);if(!d.ok){const $=await d.json();throw new Error($.error||"导出失败")}const T=await d.text(),_=new Blob([T],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(_),L=document.createElement("a");L.href=v,L.download=`${p}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(v),A.success("导出成功")}catch(d){A.error(d.message||"导出失败")}finally{O(),t(!1)}};return e.jsxs(e.Fragment,{children:[k,e.jsx(Z,{icon:e.jsx(Kt,{}),onClick:w,loading:F,size:"small",children:"导出CSV"})]})}function xs({fileName:p,tableName:F,onRefresh:t}){const[A,k]=n.useState(!1),[w,O]=n.useState([]),[d,T]=n.useState(null),[_,v]=n.useState(null),[L,$]=n.useState(null),[z,U]=n.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:f=>`共 ${f} 条记录`,size:"small"}),[i,B]=Te.useMessage(),[x]=De.useForm();n.useEffect(()=>{S()},[p]);const S=async()=>{k(!0);try{const f=await fetch(`/api/data/${encodeURIComponent(p)}`);if(!f.ok)throw new Error("Failed to fetch data");const I=await f.json();O(I),U(g=>({...g,total:I.length}))}catch(f){i.error("加载数据失败: "+f.message)}finally{k(!1)}},P=async f=>{const I=i.loading("正在删除...",0);try{const g=await fetch(`/api/data/${encodeURIComponent(p)}/${encodeURIComponent(String(f))}`,{method:"DELETE"});if(!g.ok){const r=await g.json();throw new Error(r.error||"删除失败")}i.success("删除成功"),S()}catch(g){i.error(g.message||"删除失败")}finally{I()}},X=f=>{T(f.id),v({...f}),$({...f}),x.setFieldsValue(f)},N=()=>{L&&d&&x.setFieldsValue(L),T(null),v(null),$(null),x.resetFields()},G=(f,I)=>f==="id"?"ID字段不可编辑":(I==null||typeof I=="string"&&I.trim()==="",null),W=async()=>{if(!(!d||!_))try{const f=x.getFieldsValue();for(const[g,r]of Object.entries(f)){const b=G(g,r);if(b){i.error(b);return}}const I=i.loading("正在保存...",0);try{const{id:g,...r}=f,b=await fetch(`/api/data/${encodeURIComponent(p)}/${encodeURIComponent(String(d))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!b.ok){const H=await b.json();throw new Error(H.error||"保存失败")}i.success("保存成功"),T(null),v(null),$(null),x.resetFields(),S()}catch(g){i.error(g.message||"保存失败"),L&&(x.setFieldsValue(L),i.info("已恢复到原始数据"))}finally{I()}}catch(f){i.error("验证失败: "+f.message),L&&(x.setFieldsValue(L),i.info("已恢复到原始数据"))}},a=f=>{U(f)},h=()=>{S(),t&&t()},o=(f,I,g)=>d==I.id?g==="id"?e.jsx(xe,{value:f,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof f==="number"?e.jsx(De.Item,{name:g,style:{margin:0},rules:[{validator:(H,oe)=>{const Y=G(g,oe);return Y?Promise.reject(Y):Promise.resolve()}}],children:e.jsx(Yt,{style:{width:"100%"},size:"small"})}):e.jsx(De.Item,{name:g,style:{margin:0},rules:[{validator:(H,oe)=>{const Y=G(g,oe);return Y?Promise.reject(Y):Promise.resolve()}}],children:e.jsx(xe,{size:"small"})}):f==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof f=="object"?JSON.stringify(f):String(f),R=(()=>{if(w.length===0)return[];const f=new Set;w.forEach(r=>{Object.keys(r).forEach(b=>f.add(b))});const g=Array.from(f).sort((r,b)=>r==="id"?-1:b==="id"?1:r.localeCompare(b)).map(r=>({title:r,dataIndex:r,key:r,ellipsis:!0,render:(b,H)=>o(b,H,r)}));return g.push({title:"操作",key:"action",fixed:"right",width:80,render:(r,b)=>d==b.id?e.jsxs(Ce,{size:"small",children:[e.jsx(Se,{title:"保存",children:e.jsx(Z,{type:"link",size:"small",icon:e.jsx(qt,{}),onClick:W})}),e.jsx(Se,{title:"取消",children:e.jsx(Z,{type:"link",size:"small",icon:e.jsx(Xt,{}),onClick:N})})]}):e.jsxs(Ce,{size:"small",children:[e.jsx(Se,{title:"编辑",children:e.jsx(Z,{type:"link",size:"small",icon:e.jsx(ht,{}),onClick:()=>X(b),disabled:d!==null})}),e.jsx(Zt,{title:"确定要删除这条记录吗？",onConfirm:()=>P(b.id),okText:"确定",cancelText:"取消",children:e.jsx(Se,{title:"删除",children:e.jsx(Z,{type:"link",danger:!0,size:"small",icon:e.jsx(gt,{}),disabled:d!==null})})})]})}),g})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[B,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",F]}),e.jsxs(Ce,{children:[e.jsx(hs,{fileName:p,tableName:F,onImportComplete:h}),e.jsx(ps,{fileName:p,tableName:F}),e.jsx(Z,{icon:e.jsx(Jt,{}),onClick:h,disabled:d!==null,size:"small",children:"刷新"})]})]}),e.jsx(De,{form:x,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(xt,{columns:R,dataSource:w,rowKey:f=>String(f.id),loading:A,pagination:z,onChange:a,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(ie,{description:"暂无数据，请导入 CSV 或添加记录",image:ie.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function gs({onRefresh:p}){const[F,t]=n.useState(!1),[A,k]=n.useState([]),[w,O]=n.useState(""),[d,T]=Te.useMessage(),[_,v]=ke.useModal(),[L,$]=n.useState(!1),[z,U]=n.useState(""),i=w==="";n.useEffect(()=>{B()},[w]);const B=async()=>{t(!0);try{const o=w?`/api/media?path=${encodeURIComponent(w)}`:"/api/media",E=await fetch(o);if(!E.ok)throw new Error("Failed to fetch media assets");const R=await E.json();k(Array.isArray(R)?R:[])}catch(o){d.error("加载素材失败: "+o.message),k([])}finally{t(!1)}},x=async o=>{const{file:E,onSuccess:R,onError:f}=o,I=new FormData;I.append("file",E),w&&I.append("path",w);try{const g=await fetch("/api/media/upload",{method:"POST",body:I});if(!g.ok){const r=await g.json();throw new Error(r.error||"上传失败")}d.success(`${E.name} 上传成功`),R(null,E),B(),p&&p()}catch(g){d.error(g.message||"上传失败"),f(g)}},S=o=>{_.confirm({title:`确定要删除 "${o.name}" 吗？`,content:o.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const E=d.loading("正在删除...",0);try{const R=await fetch(`/api/media/${encodeURIComponent(o.path)}`,{method:"DELETE"});if(!R.ok){const f=await R.json();throw new Error(f.error||"删除失败")}d.success("删除成功"),B(),p&&p()}catch(R){d.error(R.message||"删除失败")}finally{E()}}})},P=o=>{o.type==="folder"&&O(o.path)},X=o=>{O(o)},N=()=>{$(!0),U("")},G=async()=>{if(!z.trim()){d.error("请输入文件夹名称");return}const o=d.loading("正在创建文件夹...",0);try{const E=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:z.trim(),parentPath:w||void 0})});if(!E.ok){const R=await E.json();throw new Error(R.error||"创建文件夹失败")}d.success("文件夹创建成功"),$(!1),B(),p&&p()}catch(E){d.error(E.message||"创建文件夹失败")}finally{o()}},W=()=>{const o=w?w.split("/"):[],E=[{title:e.jsxs("a",{onClick:()=>X(""),children:[e.jsx(Qt,{})," 根目录"]})},...o.map((R,f)=>{const I=o.slice(0,f+1).join("/");return{title:e.jsx("a",{onClick:()=>X(I),children:R})}})];return e.jsx(es,{items:E,style:{marginBottom:16}})},a=o=>o.type==="folder"?e.jsx(ts,{style:{fontSize:48,color:"#faad14"}}):o.type==="image"?e.jsx(lt,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(ss,{style:{fontSize:48,color:"#1890ff"}}),h=o=>{const E=()=>[{key:"delete",label:"删除",icon:e.jsx(gt,{}),danger:!0,onClick:()=>S(o)}];return e.jsx(Be,{hoverable:!0,style:{height:"100%"},cover:o.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>P(o),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(o.path)}`,alt:o.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:o.type==="folder"?"pointer":"default"},onClick:()=>P(o),children:a(o)}),actions:[e.jsx(Ge,{menu:{items:E()},trigger:["click"],children:e.jsx(Z,{type:"text",icon:e.jsx(mt,{})})})],children:e.jsx(Be.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:o.type==="folder"?"文件夹":o.size?`${(o.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[T,v,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(Ce,{children:[e.jsx(Z,{icon:e.jsx(at,{}),onClick:N,children:"新建文件夹"}),!i&&e.jsx(je,{customRequest:x,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(Z,{type:"primary",icon:e.jsx(pt,{}),children:"上传文件"})})]})]}),W(),F?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(ut,{size:"large",tip:"加载中..."})}):A.length===0?e.jsx(ie,{description:i?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(nt,{gutter:[16,16],children:A.map(o=>e.jsx(ot,{xs:12,sm:8,md:6,lg:4,xl:4,children:h(o)},o.id))}),e.jsx(ke,{title:"新建文件夹",open:L,onOk:G,onCancel:()=>$(!1),okText:"创建",cancelText:"取消",children:e.jsx(xe,{placeholder:"请输入文件夹名称",value:z,onChange:o=>U(o.target.value),onPressEnter:G})})]})}const{Content:ys}=Pe,{useToken:js}=Ae,ws=({activeTab:p,selectedTheme:F,selectedDoc:t,selectedLibrary:A,selectedDataTable:k,onRefreshDataTables:w,onRefreshMedia:O})=>{const{token:d}=js(),T=()=>{if(!F)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个主题",image:ie.PRESENTED_IMAGE_SIMPLE})});const U=`/themes/${encodeURIComponent(F.name)}`;return e.jsx("iframe",{src:U,style:{width:"100%",flex:1,border:"none",background:d.colorBgContainer},title:F.displayName})},_=()=>{if(!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个文档",image:ie.PRESENTED_IMAGE_SIMPLE})});const U=t.name.replace(/\.md$/i,""),i=`/assets/docs/${encodeURIComponent(U)}`;return e.jsx("iframe",{src:i,style:{width:"100%",flex:1,border:"none",background:d.colorBgContainer},title:t.displayName})},v=()=>{if(!A)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个前端库",image:ie.PRESENTED_IMAGE_SIMPLE})});const U=`/assets/libraries/${A.name}`;return e.jsx("iframe",{src:U,style:{width:"100%",flex:1,border:"none",background:d.colorBgContainer},title:A.displayName})},L=()=>k?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:d.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(xs,{fileName:k.fileName,tableName:k.tableName,onRefresh:w})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:d.colorBgContainer},children:e.jsx(ie,{description:"请从左侧选择一个数据表",image:ie.PRESENTED_IMAGE_SIMPLE})}),$=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:d.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(gs,{onRefresh:O})}),z=()=>{switch(p){case"themes":return T();case"docs":return _();case"libraries":return v();case"data":return L();case"media":return $();default:return null}};return e.jsx(ys,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:d.colorBgContainer,display:"flex",flexDirection:"column"},children:z()})},tt="axhub-assets-active-tab",bs="/api/themes",Ss="/api/docs",Cs="/api/libraries",st="axhub-make-dark-mode";function ks(p){return p==="claude"||p==="cursor"||p==="codex"}function Is({isDarkMode:p,setIsDarkMode:F}){const{message:t,modal:A}=He.useApp(),{token:k}=Ae.useToken(),w="http://localhost:32123",O=/mac/i.test(navigator.platform)?"sudo npm install -g @axhub/genie":"npm install -g @axhub/genie",d={webBaseUrl:w,apiBaseUrl:`${w}/api`,projectPath:"",source:"default",health:{status:"runtime_unreachable",message:"助手运行时不可用，请先启动 Axhub Genie。",checkedAt:new Date().toISOString(),commandSource:"default",hints:{installGlobal:O,start:"axhub-genie",status:"axhub-genie status"}}},T=320,_=320,v=640,[L,$]=n.useState(!0),[z,U]=n.useState(!1),[i,B]=n.useState(()=>{const s=localStorage.getItem(tt);return s==="themes"||s==="docs"||s==="libraries"||s==="data"||s==="media"?s:"themes"}),[x,S]=n.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[P,X]=n.useState(null),[N,G]=n.useState(null),[W,a]=n.useState(null),[h,o]=n.useState(null),[E,R]=n.useState(""),[f,I]=n.useState(!1),[g,r]=n.useState([]),[b,H]=n.useState(!1),[oe,Y]=n.useState(!1),[re,K]=n.useState(""),[J,l]=n.useState(null),[y,q]=n.useState(null),[ae,ee]=n.useState(!1),[M,te]=n.useState(null),[Q,le]=n.useState(!1),[se,de]=n.useState(()=>{const s=localStorage.getItem(Ze),c=s?Number(s):NaN;return Number.isFinite(c)&&c>=_?Math.min(c,v):T}),ge=n.useRef(null),[we,ue]=n.useState(!1),[Ie,me]=n.useState(null);n.useEffect(()=>{localStorage.setItem(tt,i)},[i]),n.useEffect(()=>{ne()},[]),n.useEffect(()=>{let s=!1;return ze.getConfig().then(c=>{var m,C;if(s)return;const u=(m=c==null?void 0:c.automation)==null?void 0:m.defaultPromptClient;l(ks(u)?u:null),q(((C=c==null?void 0:c.automation)==null?void 0:C.defaultIDE)||null)}).catch(()=>{s||(l(null),q(null))}),()=>{s=!0}},[]),n.useEffect(()=>{let s=!1;return ze.getAssistantRuntime().then(c=>{s||te(c)}).catch(()=>{s||te(d)}),()=>{s=!0}},[]),n.useEffect(()=>{localStorage.setItem(Ze,String(Math.round(se)))},[se]),n.useEffect(()=>{!L&&x&&(i==="themes"&&x.themes.length>0&&!P?X(x.themes[0]):i==="docs"&&x.docs.length>0&&!N?G(x.docs[0]):i==="libraries"&&x.libraries.length>0&&!W?a(x.libraries[0]):i==="data"&&x.dataTables.length>0&&!h&&o(x.dataTables[0]))},[L,x,i,P,N,W,h]);const ne=async()=>{$(!0);try{const[s,c,u,m,C]=await Promise.all([fetch(bs),fetch(Ss),fetch(Cs),fetch("/api/data/tables"),fetch("/api/media")]);if(!s.ok||!c.ok||!u.ok||!m.ok||!C.ok)throw new Error("Failed to fetch data");const j=await s.json(),D=await c.json(),ce=await u.json(),V=await m.json(),pe=await C.json();S({themes:j||[],docs:D||[],libraries:ce||[],dataTables:Array.isArray(V)?V:[],mediaAssets:Array.isArray(pe)?pe:[]})}catch(s){t.error("加载数据失败: "+s.message),S({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{$(!1)}},he=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个主题」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件
- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力
- 告知：已经准备好开始新建主题
- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以
- 若信息不足，再用 2-4 个简短问题收集关键输入即可

**📋 必读规范文档**：
- **\`/rules/theme-generation-guide.md\`** ⭐️ 主题生成完整规范！
  - 请完整阅读此文档，了解主题生成的所有要求和约束
  - 文档包含：交付物规范、文件结构、生成策略、验收流程等

**提示**：如果用户没给 \`<theme-key>\` / \`name\` / \`description\`，先给出你建议的 \`<theme-key>\`，并让用户一键确认即可`,[]),fe=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，优先使用 DeepWiki MCP 或 Context7 MCP 获取最新官方文档与版本信息
- 若 MCP 不可用，再提示用户补充链接或版本

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`,[]),_e=n.useCallback(()=>`**系统指令**：你将作为UI/UX 设计架构师 × 前端工程师（复合型），协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`,[]),yt=n.useMemo(()=>i==="themes"?{scene:"assets-create-theme",buildPrompt:he}:i==="libraries"?{scene:"assets-create-library",buildPrompt:fe}:i==="docs"?{scene:"assets-create-doc",buildPrompt:_e}:null,[i,he,fe,_e]),be=n.useMemo(()=>({version:"1",systemContext:"",currentFile:i==="themes"&&P?`src/themes/${P.name}/index.tsx`:i==="docs"&&N?`assets/docs/${N.name}`:i==="libraries"&&W?`assets/libraries/${W.name}.md`:i==="data"&&h?`assets/database/${h.fileName}.json`:"",selectedElements:[],extensions:{source:"axhub-runtime-assets",projectPath:(M==null?void 0:M.projectPath)||"",activeTab:i,selectedAsset:i==="themes"?P:i==="docs"?N:i==="libraries"?W:h,updatedAt:new Date().toISOString()}}),[i,P,N,W,h,M==null?void 0:M.projectPath]),$e=n.useCallback((s,c)=>{try{const u=new URL(s,window.location.origin);return u.searchParams.set("context",JSON.stringify(c)),u.toString()}catch(u){return console.warn("Failed to serialize assistant context into URL:",u),s}},[]),Ee=n.useMemo(()=>{const s=((M==null?void 0:M.webBaseUrl)||w).replace(/\/+$/g,""),c=new URL(`${s}/`),u=(M==null?void 0:M.projectPath)||"";return u&&c.searchParams.set("cwd",u),J&&c.searchParams.set("provider",J),c.toString()},[M,J]),Ne=Ie||Ee,Me=v;n.useEffect(()=>{ue(!1)},[Ne]);const Ke=n.useCallback(()=>{const s=ge.current;if(!s||!s.contentWindow)return;let c="*";try{c=new URL(Ne).origin}catch{c="*"}const u={type:"update_context",mode:"replace",context:be};s.contentWindow.postMessage(u,c)},[Ne,be]);n.useEffect(()=>{!ae||!we||Ke()},[ae,we,Ke]);const Je=n.useCallback((s,c)=>{const m=$e(s||Ee,be);me(m),ee(!0)},[Ee,$e,be]),qe=n.useCallback((s,c)=>{const m=$e(s||Ee,be);window.open(m,"_blank")},[Ee,$e,be]),Fe=n.useCallback((s,c,u,m,C="iframe")=>{const j=s.health.hints;A.confirm({title:"Axhub Genie 未就绪",content:e.jsxs("div",{children:[e.jsx("p",{children:s.health.message}),e.jsxs(ve.Paragraph,{style:{marginBottom:8},copyable:{text:j.installGlobal,tooltips:["复制命令","已复制"],onCopy:()=>t.success("全局安装命令已复制")},children:["安装：",e.jsx(ve.Text,{code:!0,children:j.installGlobal})]}),e.jsxs(ve.Paragraph,{style:{marginBottom:0},copyable:{text:j.start,tooltips:["复制命令","已复制"],onCopy:()=>t.success("启动命令已复制")},children:["启动：",e.jsx(ve.Text,{code:!0,children:j.start})]})]}),cancelText:"关闭",footer:(D,{CancelBtn:ce})=>e.jsx(ce,{})}),c==="event"&&t.warning("Genie 未就绪，已回退为安装引导。")},[t,A]),Re=n.useCallback(async(s,c,u,m="iframe")=>{if(Q)return!1;le(!0);try{const C=await ze.getAssistantRuntime();if(te(C),C.health.status==="ready")return m==="window"?qe(c,u):Je(c,u),!0;Fe(C,s,c,u,m)}catch(C){const j=M||d;te(j),t.error((C==null?void 0:C.message)||"检测 Axhub Genie 状态失败"),Fe(j,s,c,u,m)}finally{le(!1)}return!1},[Q,M,t,Je,qe,Fe]),jt=n.useCallback(()=>{if(ae){ee(!1);return}Re("button")},[ae,Re]);n.useEffect(()=>{const s=c=>{const u=c,m=u.detail,C=m==null?void 0:m.url;!C||typeof C!="string"||(Re("event",C,m==null?void 0:m.targetPath),u.preventDefault())};return window.addEventListener(Ye,s),()=>{window.removeEventListener(Ye,s)}},[Re]);const wt=s=>{B(s),R("")},bt=s=>{X(s)},St=s=>{G(s)},Ct=s=>{a(s)},kt=s=>{o(s)},It=async(s,c)=>{if(s==="data"){const u=c,m=u.fileName,C=u.tableName;let j=C;A.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",m,".json (不可修改)"]}),e.jsx(xe,{autoFocus:!0,defaultValue:C,placeholder:"请输入新的表名称",onChange:D=>{j=D.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const D=j==null?void 0:j.trim();if(!D)return t.error("表名称不能为空"),Promise.reject();if(D===C)return;const ce=t.loading("正在重命名...",0);try{const V=await fetch(`/api/data/tables/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:D})});if(!V.ok){const pe=await V.json();throw new Error(pe.error||"重命名失败")}t.success("重命名成功"),(h==null?void 0:h.fileName)===m&&o({...h,tableName:D}),await ne()}catch(V){return t.error(V.message||"重命名失败"),Promise.reject()}finally{ce()}}});return}if(s==="docs"){const m=c.name,C=m.lastIndexOf("."),j=C>0?m.slice(0,C):m,D=C>0?m.slice(C):"";let ce=j;A.confirm({title:"重命名文档",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["扩展名: ",D||"无"]}),e.jsx(xe,{autoFocus:!0,defaultValue:j,placeholder:"请输入新的文档名称",onChange:V=>{ce=V.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){let V=ce==null?void 0:ce.trim();if(!V||(D&&V.endsWith(D)&&(V=V.slice(0,-D.length).trim()),!V))return t.error("文档名称不能为空"),Promise.reject();if(V===j)return;const pe=t.loading("正在重命名...",0);try{const Le=await fetch(`/api/docs/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newBaseName:V})});if(!Le.ok){const At=await Le.json();throw new Error(At.error||"重命名失败")}t.success("重命名成功");const Xe=`${V}${D}`;(N==null?void 0:N.name)===m&&G({...N,name:Xe,displayName:Xe}),await ne()}catch(Le){return t.error(Le.message||"重命名失败"),Promise.reject()}finally{pe()}}});return}if(s==="themes"){const u=c,m=u.name,C=u.displayName||u.name;let j=C;A.confirm({title:"重命名主题",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["主题目录: ",m," (不可修改)"]}),e.jsx(xe,{autoFocus:!0,defaultValue:C,placeholder:"请输入新的主题名称",onChange:D=>{j=D.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const D=j==null?void 0:j.trim();if(!D)return t.error("主题名称不能为空"),Promise.reject();if(D===C)return;const ce=t.loading("正在重命名...",0);try{const V=await fetch(`/api/themes/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:D})});if(!V.ok){const pe=await V.json();throw new Error(pe.error||"重命名失败")}t.success("重命名成功"),(P==null?void 0:P.name)===m&&X({...P,displayName:D}),await ne()}catch(V){return t.error(V.message||"重命名失败"),Promise.reject()}finally{ce()}}})}},Et=async(s,c,u)=>{const m={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};if(s==="themes"){const C=t.loading("正在删除...",0);try{const j=await fetch(`/api/themes/${c}`,{method:"DELETE"});if(!j.ok){const D=await j.json();throw new Error(D.error||"删除失败")}t.success("删除成功"),(P==null?void 0:P.name)===c&&X(null),ne()}catch(j){t.error(j.message||"删除失败")}finally{C()}return}A.confirm({title:`确定要删除${m[s]} "${u}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const C=t.loading("正在删除...",0);try{let j;if(s==="data")j=await fetch(`/api/data/tables/${c}`,{method:"DELETE"});else if(s==="docs")j=await fetch(`/api/docs/${encodeURIComponent(c)}`,{method:"DELETE"});else if(s==="libraries")j=await fetch(`/api/libraries/${c}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!j.ok){const D=await j.json();throw new Error(D.error||"删除失败")}t.success("删除成功"),s==="docs"&&(N==null?void 0:N.name)===c?G(null):s==="libraries"&&(W==null?void 0:W.name)===c?a(null):s==="data"&&(h==null?void 0:h.fileName)===c&&o(null),ne()}catch(j){t.error(j.message||"删除失败")}finally{C()}}})},vt=()=>{if(i==="docs"){I(!0);return}if(i==="data"){Y(!0);return}t.info("新建功能开发中...")},Pt=async()=>{if(g.length===0){t.warning("请先上传文件");return}H(!0);try{const s=await Promise.all(g.map(async u=>{const m=u.originFileObj;if(!m)throw new Error("文件读取失败，请重新选择文件");const C=m.name,j=C.toLowerCase();if(!j.endsWith(".md")&&!j.endsWith(".csv")&&!j.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(m.size>5242880)throw new Error("单个文件大小不能超过 5MB");const D=await m.text();return{name:C,content:D}})),c=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:s})});if(!c.ok){const u=await c.json().catch(()=>null);throw new Error((u==null?void 0:u.error)||"上传失败")}t.success("上传成功"),I(!1),r([]),ne()}catch(s){t.error((s==null?void 0:s.message)||"上传失败")}finally{H(!1)}},Tt=async()=>{if(!re.trim()){t.error("请输入表名");return}const s=t.loading("正在创建表...",0);try{const c=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:re.trim()})});if(!c.ok){const u=await c.json();throw new Error(u.error||"创建表失败")}t.success("表创建成功"),Y(!1),K(""),ne()}catch(c){t.error(c.message||"创建表失败")}finally{s()}};return e.jsxs(Pe,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(ds,{collapsed:z,setCollapsed:U,activeTab:i,onTabChange:wt,counts:{themes:x.themes.length,docs:x.docs.length,libraries:x.libraries.length,data:x.dataTables.length,media:x.mediaAssets.length},isDarkMode:p,setIsDarkMode:F,assistantEnabled:!0,assistantVisible:ae,onToggleAssistant:jt,preferredPromptClient:J,preferredIDE:y}),e.jsxs(Pe,{style:{display:"flex",flex:1,minHeight:0},children:[e.jsx(ms,{collapsed:z,loading:L,activeTab:i,themes:x.themes,docs:x.docs,libraries:x.libraries,dataTables:x.dataTables,selectedTheme:P,selectedDoc:N,selectedLibrary:W,selectedDataTable:h,onThemeSelect:bt,onDocSelect:St,onLibrarySelect:Ct,onDataTableSelect:kt,onDeleteAsset:Et,onRenameAsset:It,onCreateClick:vt,searchText:E,setSearchText:R,preferredPromptClient:J,preferredIDE:y,createPromptConfig:yt}),e.jsx("div",{style:{display:"flex",flex:1,minWidth:0},children:e.jsx(ws,{activeTab:i,selectedTheme:P,selectedDoc:N,selectedLibrary:W,selectedDataTable:h,onRefreshDataTables:ne,onRefreshMedia:ne})}),ae&&e.jsx(rs,{size:{width:Math.min(Math.max(se,_),Me),height:"calc(100vh - 48px)"},minWidth:_,maxWidth:Me,enable:{left:!0,right:!1,top:!1,bottom:!1,topLeft:!1,topRight:!1,bottomLeft:!1,bottomRight:!1},onResize:(s,c,u)=>{const m=Math.min(Math.max(u.getBoundingClientRect().width,_),Me);de(m)},style:{borderLeft:`1px solid ${k.colorBorderSecondary}`,background:k.colorBgContainer,display:"flex",flexDirection:"column",height:"calc(100vh - 48px)",minHeight:0},children:e.jsx("iframe",{ref:ge,src:Ne,title:"Axhub Genie",onLoad:()=>ue(!0),style:{border:"none",width:"100%",height:"100%"}})})]}),e.jsx(ke,{title:"新建文档",open:f,onCancel:()=>{I(!1),r([])},footer:[e.jsx(Oe,{preferredClient:J,preferredIDE:y,scene:"assets-create-doc",buildPrompt:_e,executeSuccessMessage:"已打开新会话",fallbackMessage:"自动执行失败，已回退为复制 Prompt"},"copy"),e.jsx(Z,{type:"primary",loading:b,onClick:Pt,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(je.Dragger,{multiple:!0,accept:".md",fileList:g,beforeUpload:s=>(s.name||"").toLowerCase().endsWith(".md")?!1:(t.error("仅支持上传 .md 文件"),je.LIST_IGNORE),onChange:s=>r(s.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"仅支持 .md 文件，支持批量上传"})]})})}),e.jsx(ke,{title:"新建数据表",open:oe,onOk:Tt,onCancel:()=>{Y(!1),K("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(xe,{placeholder:"例如: 用户表, 产品列表",value:re,onChange:s=>K(s.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function Es(){const[p,F]=n.useState(()=>localStorage.getItem(st)==="true");return n.useEffect(()=>{localStorage.setItem(st,String(p))},[p]),e.jsx(os,{theme:as(p),children:e.jsx(He,{children:e.jsx(Is,{isDarkMode:p,setIsDarkMode:F})})})}const vs=ns.createRoot(document.getElementById("root"));vs.render(e.jsx(Es,{}));
