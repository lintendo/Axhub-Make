import"./chunks/modulepreload-polyfill.js";import{T as ze,s as oe,j as e,M as ie,R as Ce,C as Se,B as Fe,a as pe,S as ae,b as z,c as ke,d as Ie,e as Le,f as Ee,g as ve,h as Be,L as le,i as ne,t as xe,k as Ue,l as _e,m as Ve,n as We,o as $e,p as Re,q as ue,r as Pe,u as re,v as He,w as Je,x as Ke,D as ge,y as Ge,z as qe,A as Ye,E as ye,I as ee,F as Qe,G as Ae,H as J,J as Ze,K as Xe,N as et,O as Te,P as tt,Q as Me,U as f,V as st,W as me,X as Ne,Y as De,Z as he,_ as nt,$ as de,a0 as ot,a1 as rt,a2 as at,a3 as it,a4 as Oe,a5 as lt,a6 as ct,a7 as dt,a8 as mt,a9 as ft,aa as ht,ab as pt}from"./chunks/vendor.js";import{g as ut}from"./chunks/index.js";const{Text:je}=ze,xt=({open:h,onCancel:v})=>{const[t,j]=oe.useMessage(),g=(c,o)=>{const l=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「${c}」设计资产。

请认真阅读规则文档 \`${o}\`，并按文档定义的交互指南回复用户。`;navigator.clipboard.writeText(l).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始"),v()}).catch(()=>{t.error("复制失败，请手动复制")})},m=[{title:"本地 Axure 文件导入",icon:e.jsx(Ie,{style:{fontSize:24,color:"#008F5D"}}),desc:"从本地导出的 Axure 资源提取主题/数据模型/文档，并还原页面",rulePath:"./rules/local-axure-assistant.md",disabled:!1,recommended:!0},{title:"Axure 原型链接导入",icon:e.jsx(Le,{style:{fontSize:24,color:"#1890ff"}}),desc:"获取站点地图，提取主题/数据模型/文档，并还原示例页面",rulePath:"./rules/axure-prototype-assistant.md",disabled:!1},{title:"产品网页链接导入",icon:e.jsx(Ee,{style:{fontSize:24,color:"#52c41a"}}),desc:"发现相关页面，提取主题/数据/文档，并还原示例页面",rulePath:"./rules/web-page-assistant.md",disabled:!1},{title:"App/小程序/网页截图导入",icon:e.jsx(ve,{style:{fontSize:24,color:"#faad14"}}),desc:"提取颜色主题与 OCR 文本；如支持视觉再分析布局与组件，还原页面",rulePath:"./rules/screenshot-page-assistant.md",disabled:!1},{title:"App/小程序直接导入",icon:e.jsx(Be,{style:{fontSize:24,color:"#d9d9d9"}}),desc:"功能开发中，敬请期待...",rulePath:"",disabled:!0}];return e.jsxs(ie,{title:"智能导入资产",open:h,onCancel:v,footer:null,width:800,children:[j,e.jsx(Ce,{gutter:[16,16],children:m.map((c,o)=>e.jsx(Se,{span:12,children:e.jsx(Fe.Ribbon,{text:"推荐",color:"#008F5D",style:{display:c.recommended?"block":"none"},children:e.jsx(pe,{hoverable:!c.disabled,style:{height:"100%",cursor:c.disabled?"not-allowed":"pointer",opacity:c.disabled?.6:1,background:c.disabled?"#f5f5f5":void 0},onClick:()=>!c.disabled&&g(c.title,c.rulePath),children:e.jsxs(ae,{align:"start",style:{width:"100%"},children:[e.jsx("div",{style:{padding:12,background:c.disabled?"#e8e8e8":c.recommended?"#e6f7f0":"#f0f5ff",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:c.icon}),e.jsxs("div",{children:[e.jsx(je,{strong:!0,style:{fontSize:16,display:"block",marginBottom:4},children:c.title}),e.jsx(je,{type:"secondary",style:{fontSize:13},children:c.desc})]})]})})})},o))}),e.jsx("div",{style:{marginTop:24,textAlign:"center"},children:e.jsx(z,{type:"link",icon:e.jsx(ke,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank"),children:"查看更多资产导入技巧与帮助"})})]})},{Header:gt}=le,{useToken:yt}=xe,jt=({collapsed:h,setCollapsed:v,activeTab:t,onTabChange:j,counts:g,isDarkMode:m,setIsDarkMode:c})=>{const[o,l]=ne.useState(null),[P,a]=ne.useState(!1),{token:C}=yt();return ne.useEffect(()=>{let u=!1;return fetch("/api/version").then(y=>y.ok?y.json():Promise.reject(new Error("Request failed"))).then(y=>{if(u)return;const E=typeof(y==null?void 0:y.version)=="string"?y.version:null;l(E)}).catch(()=>{u||l(null)}),()=>{u=!0}},[]),e.jsxs(gt,{style:{height:"48px",display:"flex",alignItems:"center",justifyContent:"space-between",background:C.colorBgContainer,padding:"0 16px",position:"sticky",top:0,zIndex:1e3,boxShadow:`0 2px 8px ${C.colorBorderSecondary}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:224},children:[t!=="media"&&e.jsx(z,{type:"text",icon:h?e.jsx(Ue,{}):e.jsx(_e,{}),onClick:()=>v(!h),style:{fontSize:"16px",height:40}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginLeft:t==="media"?0:void 0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:C.colorText},children:["Axhub ",e.jsx("span",{style:{color:"#008F5D"},children:"Make"})]}),e.jsx(Ve,{style:{margin:0},children:"资产管理"})]})]}),e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(We,{value:t,size:"small",shape:"round",style:{fontSize:"12px"},onChange:u=>j(u),options:[{label:`主题 (${g.themes})`,value:"themes",icon:e.jsx($e,{})},{label:`文档 (${g.docs})`,value:"docs",icon:e.jsx(Re,{})},{label:`前端库 (${g.libraries})`,value:"libraries",icon:e.jsx(ue,{})},{label:`数据 (${g.data})`,value:"data",icon:e.jsx(Pe,{})}]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(re,{title:"使用 AI 智能导入资产",children:e.jsx(z,{size:"small",icon:e.jsx(He,{}),onClick:()=>a(!0),children:"智能导入资产"})}),e.jsx(xt,{open:P,onCancel:()=>a(!1)}),e.jsx(re,{title:m?"切换到浅色模式":"切换到深色模式",children:e.jsx(z,{type:"text",icon:m?e.jsx(Je,{}):e.jsx(Ke,{}),onClick:()=>c(!m)})}),e.jsx(ge,{menu:{items:[{key:"help",label:"帮助中心",icon:e.jsx(qe,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/space/7585489740036606927","_blank")},{key:"training",label:"培训服务",icon:e.jsx(ke,{}),onClick:()=>window.open("https://axhub-work.feishu.cn/wiki/W8KDwcZ8eiB68Nkw4sFcGL4Wn6e","_blank")},{key:"site",label:"Axhub 官网",icon:e.jsx(Ee,{}),onClick:()=>window.open("https://axhub.im/","_blank")},{type:"divider"},{key:"version",label:"当前版本",icon:e.jsx(Ye,{}),extra:e.jsx("span",{style:{fontSize:12,color:C.colorTextSecondary},children:o?`v${o}`:"-"})}]},placement:"bottomRight",children:e.jsx(z,{type:"text",icon:e.jsx(Ge,{})})})]})]})},{Sider:wt}=le,{useToken:bt}=xe,Ct=({collapsed:h,loading:v,activeTab:t,themes:j,docs:g,libraries:m,dataTables:c,selectedTheme:o,selectedDoc:l,selectedLibrary:P,selectedDataTable:a,onThemeSelect:C,onDocSelect:u,onLibrarySelect:y,onDataTableSelect:E,onDeleteAsset:$,onRenameAsset:A,onCreateClick:F,searchText:p,setSearchText:T})=>{const{token:w}=bt(),{message:M}=ye.useApp(),B=ne.useMemo(()=>{if(!p)return j;const n=p.toLowerCase();return j.filter(d=>d.displayName.toLowerCase().includes(n)||d.name.toLowerCase().includes(n))},[j,p]),W=ne.useMemo(()=>{if(!p)return g;const n=p.toLowerCase();return g.filter(d=>d.displayName.toLowerCase().includes(n)||d.name.toLowerCase().includes(n))},[g,p]),_=ne.useMemo(()=>{if(!p)return m;const n=p.toLowerCase();return m.filter(d=>d.displayName.toLowerCase().includes(n)||d.name.toLowerCase().includes(n))},[m,p]),U=ne.useMemo(()=>{if(!p)return c;const n=p.toLowerCase();return c.filter(d=>d.tableName.toLowerCase().includes(n)||d.fileName.toLowerCase().includes(n))},[c,p]),i=async n=>{let d="",L="";const Z="tableName"in n?n.tableName:n.displayName,V="fileName"in n?n.fileName:n.name;if(t==="docs"?(d=`assets/docs/${V}`,L=`[${Z}](assets/docs/${V})`):t==="themes"?(d=`src/themes/${V}/index.tsx`,L=`[${Z}](src/themes/${V})`):t==="libraries"?(d=`assets/libraries/${V}.md`,L=`[${Z}](assets/libraries/${V}.md)`):t==="data"&&(d=`assets/database/${V}.json`,L=`[${Z}](assets/database/${V}.json)`),!d){M.warning("无法获取文件路径");return}const Q=["vscode","cursor"],X=M.loading("正在发送到 IDE...",0);try{L&&await navigator.clipboard.writeText(L);const q=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"handshake",payload:"prototype-admin",targetClientTypes:Q})}),te=await q.json().catch(()=>null);if(!q.ok||!(te!=null&&te.sent)){M.warning("编辑器未连接，已复制了文件标题，可前往使用");return}const s=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"open-file",payload:d,targetClientTypes:Q})}),I=await s.json().catch(()=>null);if(!s.ok||!(I!=null&&I.sent)){M.warning("编辑器未连接，已复制了文件标题，可前往使用");return}M.success("已在编辑器中打开，并复制了文件标题，可前往编辑")}catch(q){console.error("Failed to open in IDE:",q),M.error((q==null?void 0:q.message)||"发送失败")}finally{X()}},S=(n,d)=>{const L=t==="themes"&&"name"in n&&(o==null?void 0:o.name)===n.name||t==="docs"&&"name"in n&&(l==null?void 0:l.name)===n.name||t==="libraries"&&"name"in n&&(P==null?void 0:P.name)===n.name||t==="data"&&"fileName"in n&&(a==null?void 0:a.fileName)===n.fileName,Z=[{key:"open-in-ide",label:"在编辑器中打开",icon:e.jsx(ue,{})},{key:"delete",label:`删除${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`,icon:e.jsx(tt,{}),danger:!0}];t==="data"&&Z.unshift({key:"rename",label:"重命名",icon:e.jsx(Me,{}),danger:!1});const V="tableName"in n?n.tableName:n.displayName,Q="fileName"in n?n.fileName:n.name;return{key:Q,icon:d,label:e.jsxs("div",{className:`menu-item-wrapper ${L?"is-selected":""}`,style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:6,overflow:"hidden",flex:1},children:e.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:V})}),e.jsx(ge,{trigger:["click"],menu:{items:Z,onClick:({key:X})=>{if(X==="open-in-ide")i(n);else if(X==="rename")A==null||A(t,n);else if(X==="delete")if(t==="themes"){const q=`我希望删除主题 "${V}" (${Q})。
该主题位于项目中的相对路径为：\`apps/axhub-make/src/themes/${Q}\`

请帮我执行以下检查和操作：
1. 检查该主题是否被以下目录中的原型元素或页面原型引用（检查 index.tsx 中的注释或代码）：
   - \`apps/axhub-make/src/elements/\`
   - \`apps/axhub-make/src/pages/\`
2. 如果发现有原型正在引用该主题，请告知我具体的引用文件路径，并询问我是否确认继续删除。
3. 如果我确认继续删除，请协助我将该主题的相关配置（例如 \`designToken.json\` 中的内容）直接内联到引用它的原型文件中，并更新引用路径，从而使这些原型脱离对该主题目录的依赖。
4. 完成上述解耦操作后，再彻底删除主题目录 \`apps/axhub-make/src/themes/${Q}\`。`;navigator.clipboard.writeText(q).then(()=>{oe.success("由于删除主题需要处理关联文件，已为你复制 prompt，请返回编辑器让 AI 处理。")}).catch(te=>{console.error("Failed to copy: ",te),oe.error("复制失败，请手动处理")})}else $(t,Q,V)}},children:e.jsx(z,{type:"text",size:"small",className:"more-btn",icon:e.jsx(Te,{}),onClick:X=>{X.stopPropagation()}})})]})}},N=B.map(n=>S(n,e.jsx($e,{}))),r=W.map(n=>S(n,e.jsx(Re,{}))),k=_.map(n=>S(n,e.jsx(ue,{}))),x=U.map(n=>S(n,e.jsx(Pe,{}))),b=({key:n})=>{if(t==="themes"){const d=j.find(L=>L.name===n);d&&C(d)}else if(t==="docs"){const d=g.find(L=>L.name===n);d&&u(d)}else if(t==="libraries"){const d=m.find(L=>L.name===n);d&&y(d)}else if(t==="data"){const d=c.find(L=>L.fileName===n);d&&E(d)}},R=t==="themes"?N:t==="docs"?r:t==="data"?x:k,G=t==="themes"?o==null?void 0:o.name:t==="docs"?l==null?void 0:l.name:t==="data"?a==null?void 0:a.fileName:P==null?void 0:P.name;return e.jsx(wt,{trigger:null,collapsible:!0,collapsed:h||t==="media",width:240,collapsedWidth:0,style:{background:w.colorBgContainer,borderRight:`1px solid ${w.colorBorderSecondary}`,overflow:"hidden",height:"calc(100vh - 48px)",position:"sticky",top:48},children:t==="media"?null:e.jsxs("div",{style:{height:"100%",position:"relative"},children:[e.jsxs("div",{style:{height:"100%",overflowY:"auto"},children:[e.jsx("div",{style:{padding:"8px"},children:!h&&e.jsx(e.Fragment,{children:e.jsx("div",{style:{display:"flex",gap:8,marginTop:8},children:e.jsx(ee,{placeholder:"搜索...",prefix:e.jsx(Qe,{}),value:p,onChange:n=>T(n.target.value),allowClear:!0,style:{flex:1}})})})}),v?e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx(Ae,{tip:"加载中..."})}):e.jsxs(e.Fragment,{children:[R.length===0?e.jsx(J,{image:J.PRESENTED_IMAGE_SIMPLE,description:p?"无搜索结果":"暂无数据",style:{marginTop:40}}):e.jsx(Ze,{mode:"inline",selectedKeys:G?[G]:[],items:R,onClick:b,style:{borderRight:0}}),e.jsx("div",{style:{height:80}})]})]}),!h&&e.jsx(Xe,{icon:e.jsx(et,{}),type:"primary",style:{position:"absolute",left:24,bottom:24},onClick:F,tooltip:`新建${t==="themes"?"主题":t==="docs"?"文档":t==="data"?"数据表":"前端库"}`})]})})};function St({fileName:h,tableName:v,onImportComplete:t}){const[j,g]=f.useState(!1),[m,c]=f.useState(null),[o,l]=f.useState([]),[P,a]=f.useState([]),[C,u]=f.useState(!1),[y,E]=oe.useMessage(),$=()=>{g(!0),c(null),l([]),a([])},A=()=>{g(!1),c(null),l([]),a([])},F=T=>(c(T),he.parse(T,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:w=>{if(w.errors.length>0){y.error("CSV解析失败: "+w.errors[0].message);return}const M=w.data.slice(0,10);if(l(M),w.data.length>0){const B=w.data[0],W=Object.keys(B).map(_=>({title:_,dataIndex:_,key:_,ellipsis:!0,render:U=>U==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof U=="object"?JSON.stringify(U):String(U)}));a(W)}},error:w=>{y.error("CSV解析失败: "+w.message)}}),!1),p=async()=>{if(!m){y.error("请先选择CSV文件");return}u(!0);const T=y.loading("正在导入数据...",0);try{he.parse(m,{header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:async w=>{try{if(w.errors.length>0)throw new Error("CSV解析失败: "+w.errors[0].message);const M=he.unparse(w.data,{quotes:!0,header:!0}),B=await fetch(`/api/data/${encodeURIComponent(h)}/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvData:M})});if(!B.ok){const _=await B.json();throw new Error(_.error||"导入失败")}const W=await B.json();y.success(`导入成功！共导入 ${W.recordCount} 条记录`),g(!1),c(null),l([]),a([]),t()}catch(M){y.error(M.message||"导入失败")}finally{T(),u(!1)}},error:w=>{y.error("CSV解析失败: "+w.message),T(),u(!1)}})}catch(w){y.error(w.message||"导入失败"),T(),u(!1)}};return e.jsxs(e.Fragment,{children:[E,e.jsx(z,{icon:e.jsx(st,{}),onClick:$,size:"small",children:"导入CSV"}),e.jsx(ie,{title:`导入CSV到 "${v}"`,open:j,onCancel:A,onOk:p,okText:"确认导入",cancelText:"取消",width:800,confirmLoading:C,okButtonProps:{disabled:!m},children:e.jsxs(ae,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx("div",{children:e.jsx(me,{accept:".csv",beforeUpload:F,maxCount:1,fileList:m?[{uid:"-1",name:m.name,status:"done"}]:[],onRemove:()=>{c(null),l([]),a([])},children:e.jsx(z,{icon:e.jsx(Ne,{}),children:"选择CSV文件"})})}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"12px",background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"4px",marginBottom:16},children:[e.jsx("strong",{children:"⚠️ 导入模式：覆盖模式"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"导入将完全替换表中所有现有数据，请确保已备份重要数据"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("strong",{children:"数据预览（前10行）："})}),e.jsx(De,{columns:P,dataSource:o,pagination:!1,scroll:{x:"max-content"},size:"small",bordered:!0,rowKey:(T,w)=>(w==null?void 0:w.toString())||"0"}),o.length===10&&e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"仅显示前10行，实际将导入所有数据"})]})]})]})})]})}function kt({fileName:h}){const[v,t]=f.useState(!1),[j,g]=oe.useMessage(),m=async()=>{t(!0);const c=j.loading("正在导出数据...",0);try{const o=await fetch(`/api/data/${encodeURIComponent(h)}/export`);if(!o.ok){const u=await o.json();throw new Error(u.error||"导出失败")}const l=await o.text(),P=new Blob([l],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(P),C=document.createElement("a");C.href=a,C.download=`${h}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(a),j.success("导出成功")}catch(o){j.error(o.message||"导出失败")}finally{c(),t(!1)}};return e.jsxs(e.Fragment,{children:[g,e.jsx(z,{icon:e.jsx(nt,{}),onClick:m,loading:v,size:"small",children:"导出CSV"})]})}function It({fileName:h,tableName:v,onRefresh:t}){const[j,g]=f.useState(!1),[m,c]=f.useState([]),[o,l]=f.useState(null),[P,a]=f.useState(null),[C,u]=f.useState(null),[y,E]=f.useState({current:1,pageSize:20,total:0,showSizeChanger:!0,showTotal:r=>`共 ${r} 条记录`,size:"small"}),[$,A]=oe.useMessage(),[F]=de.useForm();f.useEffect(()=>{p()},[h]);const p=async()=>{g(!0);try{const r=await fetch(`/api/data/${encodeURIComponent(h)}`);if(!r.ok)throw new Error("Failed to fetch data");const k=await r.json();c(k),E(x=>({...x,total:k.length}))}catch(r){$.error("加载数据失败: "+r.message)}finally{g(!1)}},T=async r=>{const k=$.loading("正在删除...",0);try{const x=await fetch(`/api/data/${encodeURIComponent(h)}/${encodeURIComponent(String(r))}`,{method:"DELETE"});if(!x.ok){const b=await x.json();throw new Error(b.error||"删除失败")}$.success("删除成功"),p()}catch(x){$.error(x.message||"删除失败")}finally{k()}},w=r=>{l(r.id),a({...r}),u({...r}),F.setFieldsValue(r)},M=()=>{C&&o&&F.setFieldsValue(C),l(null),a(null),u(null),F.resetFields()},B=(r,k)=>r==="id"?"ID字段不可编辑":(k==null||typeof k=="string"&&k.trim()==="",null),W=async()=>{if(!(!o||!P))try{const r=F.getFieldsValue();for(const[x,b]of Object.entries(r)){const R=B(x,b);if(R){$.error(R);return}}const k=$.loading("正在保存...",0);try{const{id:x,...b}=r,R=await fetch(`/api/data/${encodeURIComponent(h)}/${encodeURIComponent(String(o))}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!R.ok){const G=await R.json();throw new Error(G.error||"保存失败")}$.success("保存成功"),l(null),a(null),u(null),F.resetFields(),p()}catch(x){$.error(x.message||"保存失败"),C&&(F.setFieldsValue(C),$.info("已恢复到原始数据"))}finally{k()}}catch(r){$.error("验证失败: "+r.message),C&&(F.setFieldsValue(C),$.info("已恢复到原始数据"))}},_=r=>{E(r)},U=()=>{p(),t&&t()},i=(r,k,x)=>o==k.id?x==="id"?e.jsx(ee,{value:r,disabled:!0,size:"small",style:{backgroundColor:"#f5f5f5"}}):typeof r==="number"?e.jsx(de.Item,{name:x,style:{margin:0},rules:[{validator:(G,n)=>{const d=B(x,n);return d?Promise.reject(d):Promise.resolve()}}],children:e.jsx(lt,{style:{width:"100%"},size:"small"})}):e.jsx(de.Item,{name:x,style:{margin:0},rules:[{validator:(G,n)=>{const d=B(x,n);return d?Promise.reject(d):Promise.resolve()}}],children:e.jsx(ee,{size:"small"})}):r==null?e.jsx("span",{style:{color:"#ccc"},children:"-"}):typeof r=="object"?JSON.stringify(r):String(r),N=(()=>{if(m.length===0)return[];const r=new Set;m.forEach(b=>{Object.keys(b).forEach(R=>r.add(R))});const x=Array.from(r).sort((b,R)=>b==="id"?-1:R==="id"?1:b.localeCompare(R)).map(b=>({title:b,dataIndex:b,key:b,ellipsis:!0,render:(R,G)=>i(R,G,b)}));return x.push({title:"操作",key:"action",fixed:"right",width:80,render:(b,R)=>o==R.id?e.jsxs(ae,{size:"small",children:[e.jsx(re,{title:"保存",children:e.jsx(z,{type:"link",size:"small",icon:e.jsx(rt,{}),onClick:W})}),e.jsx(re,{title:"取消",children:e.jsx(z,{type:"link",size:"small",icon:e.jsx(at,{}),onClick:M})})]}):e.jsxs(ae,{size:"small",children:[e.jsx(re,{title:"编辑",children:e.jsx(z,{type:"link",size:"small",icon:e.jsx(Me,{}),onClick:()=>w(R),disabled:o!==null})}),e.jsx(it,{title:"确定要删除这条记录吗？",onConfirm:()=>T(R.id),okText:"确定",cancelText:"取消",children:e.jsx(re,{title:"删除",children:e.jsx(z,{type:"link",danger:!0,size:"small",icon:e.jsx(Oe,{}),disabled:o!==null})})})]})}),x})();return e.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[A,e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:600},children:["数据表: ",v]}),e.jsxs(ae,{children:[e.jsx(St,{fileName:h,tableName:v,onImportComplete:U}),e.jsx(kt,{fileName:h,tableName:v}),e.jsx(z,{icon:e.jsx(ot,{}),onClick:U,disabled:o!==null,size:"small",children:"刷新"})]})]}),e.jsx(de,{form:F,component:!1,children:e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(De,{columns:N,dataSource:m,rowKey:r=>String(r.id),loading:j,pagination:y,onChange:_,scroll:{x:"max-content",y:"100%"},bordered:!0,size:"small",style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},className:"full-height-table",locale:{emptyText:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:e.jsx(J,{description:"暂无数据，请导入 CSV 或添加记录",image:J.PRESENTED_IMAGE_SIMPLE})})}})})}),e.jsx("style",{children:`
                .full-height-table {
                    display: flex;
                    flex-direction: column;
                }
                .full-height-table .ant-spin-nested-loading {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-spin-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
                .full-height-table .ant-table-content {
                    flex: 1;
                    overflow: auto !important;
                }
                .full-height-table .ant-table-body {
                    flex: 1;
                }
                .full-height-table .ant-table-placeholder {
                    flex: 1;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .full-height-table .ant-table-pagination.ant-pagination {
                    margin: 8px 0 0 0 !important;
                }
            `})]})}function Et({onRefresh:h}){const[v,t]=f.useState(!1),[j,g]=f.useState([]),[m,c]=f.useState(""),[o,l]=oe.useMessage(),[P,a]=ie.useModal(),[C,u]=f.useState(!1),[y,E]=f.useState(""),$=m==="";f.useEffect(()=>{A()},[m]);const A=async()=>{t(!0);try{const i=m?`/api/media?path=${encodeURIComponent(m)}`:"/api/media",S=await fetch(i);if(!S.ok)throw new Error("Failed to fetch media assets");const N=await S.json();g(Array.isArray(N)?N:[])}catch(i){o.error("加载素材失败: "+i.message),g([])}finally{t(!1)}},F=async i=>{const{file:S,onSuccess:N,onError:r}=i,k=new FormData;k.append("file",S),m&&k.append("path",m);try{const x=await fetch("/api/media/upload",{method:"POST",body:k});if(!x.ok){const b=await x.json();throw new Error(b.error||"上传失败")}o.success(`${S.name} 上传成功`),N(null,S),A(),h&&h()}catch(x){o.error(x.message||"上传失败"),r(x)}},p=i=>{P.confirm({title:`确定要删除 "${i.name}" 吗？`,content:i.type==="folder"?"删除文件夹将同时删除其中的所有内容，此操作无法恢复。":"此操作无法恢复。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const S=o.loading("正在删除...",0);try{const N=await fetch(`/api/media/${encodeURIComponent(i.path)}`,{method:"DELETE"});if(!N.ok){const r=await N.json();throw new Error(r.error||"删除失败")}o.success("删除成功"),A(),h&&h()}catch(N){o.error(N.message||"删除失败")}finally{S()}}})},T=i=>{i.type==="folder"&&c(i.path)},w=i=>{c(i)},M=()=>{u(!0),E("")},B=async()=>{if(!y.trim()){o.error("请输入文件夹名称");return}const i=o.loading("正在创建文件夹...",0);try{const S=await fetch("/api/media/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:y.trim(),parentPath:m||void 0})});if(!S.ok){const N=await S.json();throw new Error(N.error||"创建文件夹失败")}o.success("文件夹创建成功"),u(!1),A(),h&&h()}catch(S){o.error(S.message||"创建文件夹失败")}finally{i()}},W=()=>{const i=m?m.split("/"):[],S=[{title:e.jsxs("a",{onClick:()=>w(""),children:[e.jsx(ct,{})," 根目录"]})},...i.map((N,r)=>{const k=i.slice(0,r+1).join("/");return{title:e.jsx("a",{onClick:()=>w(k),children:N})}})];return e.jsx(dt,{items:S,style:{marginBottom:16}})},_=i=>i.type==="folder"?e.jsx(mt,{style:{fontSize:48,color:"#faad14"}}):i.type==="image"?e.jsx(ve,{style:{fontSize:48,color:"#52c41a"}}):e.jsx(ft,{style:{fontSize:48,color:"#1890ff"}}),U=i=>{const S=()=>[{key:"delete",label:"删除",icon:e.jsx(Oe,{}),danger:!0,onClick:()=>p(i)}];return e.jsx(pe,{hoverable:!0,style:{height:"100%"},cover:i.type==="image"?e.jsx("div",{style:{height:200,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5",cursor:"default"},onClick:()=>T(i),children:e.jsx("img",{src:`/api/media/file/${encodeURIComponent(i.path)}`,alt:i.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}):e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",cursor:i.type==="folder"?"pointer":"default"},onClick:()=>T(i),children:_(i)}),actions:[e.jsx(ge,{menu:{items:S()},trigger:["click"],children:e.jsx(z,{type:"text",icon:e.jsx(Te,{})})})],children:e.jsx(pe.Meta,{title:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name}),description:e.jsx("div",{style:{fontSize:12,color:"#999"},children:i.type==="folder"?"文件夹":i.size?`${(i.size/1024).toFixed(2)} KB`:"-"})})})};return e.jsxs("div",{style:{padding:24,height:"100%",overflow:"auto"},children:[l,a,e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"素材管理"}),e.jsxs(ae,{children:[e.jsx(z,{icon:e.jsx(Ie,{}),onClick:M,children:"新建文件夹"}),!$&&e.jsx(me,{customRequest:F,showUploadList:!1,multiple:!0,accept:"image/*,audio/*,.json",children:e.jsx(z,{type:"primary",icon:e.jsx(Ne,{}),children:"上传文件"})})]})]}),W(),v?e.jsx("div",{style:{textAlign:"center",padding:"100px 0"},children:e.jsx(Ae,{size:"large",tip:"加载中..."})}):j.length===0?e.jsx(J,{description:$?"暂无文件夹，请先创建文件夹":"暂无素材，请上传文件",style:{marginTop:100}}):e.jsx(Ce,{gutter:[16,16],children:j.map(i=>e.jsx(Se,{xs:12,sm:8,md:6,lg:4,xl:4,children:U(i)},i.id))}),e.jsx(ie,{title:"新建文件夹",open:C,onOk:B,onCancel:()=>u(!1),okText:"创建",cancelText:"取消",children:e.jsx(ee,{placeholder:"请输入文件夹名称",value:y,onChange:i=>E(i.target.value),onPressEnter:B})})]})}const{Content:vt}=le,{useToken:$t}=xe,Rt=({activeTab:h,selectedTheme:v,selectedDoc:t,selectedLibrary:j,selectedDataTable:g,onRefreshDataTables:m,onRefreshMedia:c})=>{const{token:o}=$t(),l=()=>{if(!v)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:o.colorBgContainer},children:e.jsx(J,{description:"请从左侧选择一个主题",image:J.PRESENTED_IMAGE_SIMPLE})});const E=`/themes/${encodeURIComponent(v.name)}/index.html`;return e.jsx("iframe",{src:E,style:{width:"100%",flex:1,border:"none",background:o.colorBgContainer},title:v.displayName})},P=()=>{if(!t)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:o.colorBgContainer},children:e.jsx(J,{description:"请从左侧选择一个文档",image:J.PRESENTED_IMAGE_SIMPLE})});const E=t.name.replace(/\.md$/i,""),$=`/assets/docs/${encodeURIComponent(E)}/spec.html`;return e.jsx("iframe",{src:$,style:{width:"100%",flex:1,border:"none",background:o.colorBgContainer},title:t.displayName})},a=()=>{if(!j)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:o.colorBgContainer},children:e.jsx(J,{description:"请从左侧选择一个前端库",image:J.PRESENTED_IMAGE_SIMPLE})});const E=`/assets/libraries/${j.name}/spec.html`;return e.jsx("iframe",{src:E,style:{width:"100%",flex:1,border:"none",background:o.colorBgContainer},title:j.displayName})},C=()=>g?e.jsx("div",{style:{padding:"16px",flex:1,overflow:"hidden",background:o.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(It,{fileName:g.fileName,tableName:g.tableName,onRefresh:m})}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flex:1,background:o.colorBgContainer},children:e.jsx(J,{description:"请从左侧选择一个数据表",image:J.PRESENTED_IMAGE_SIMPLE})}),u=()=>e.jsx("div",{style:{flex:1,overflow:"hidden",background:o.colorBgContainer,display:"flex",flexDirection:"column"},children:e.jsx(Et,{onRefresh:c})}),y=()=>{switch(h){case"themes":return l();case"docs":return P();case"libraries":return a();case"data":return C();case"media":return u();default:return null}};return e.jsx(vt,{style:{overflow:"hidden",height:"calc(100vh - 48px)",background:o.colorBgContainer,display:"flex",flexDirection:"column"},children:y()})},we="axhub-assets-active-tab",Pt="/api/themes",At="/api/docs",Tt="/api/libraries",be="axhub-make-dark-mode";function Mt({isDarkMode:h,setIsDarkMode:v}){const{message:t,modal:j}=ye.useApp(),[g,m]=f.useState(!0),[c,o]=f.useState(!1),[l,P]=f.useState(()=>{const s=localStorage.getItem(we);return s==="themes"||s==="docs"||s==="libraries"||s==="data"||s==="media"?s:"themes"}),[a,C]=f.useState({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]}),[u,y]=f.useState(null),[E,$]=f.useState(null),[A,F]=f.useState(null),[p,T]=f.useState(null),[w,M]=f.useState(""),[B,W]=f.useState(!1),[_,U]=f.useState([]),[i,S]=f.useState(!1),[N,r]=f.useState(!1),[k,x]=f.useState("");f.useEffect(()=>{localStorage.setItem(we,l)},[l]),f.useEffect(()=>{b()},[]),f.useEffect(()=>{!g&&a&&(l==="themes"&&a.themes.length>0&&!u?y(a.themes[0]):l==="docs"&&a.docs.length>0&&!E?$(a.docs[0]):l==="libraries"&&a.libraries.length>0&&!A?F(a.libraries[0]):l==="data"&&a.dataTables.length>0&&!p&&T(a.dataTables[0]))},[g,a,l,u,E,A,p]);const b=async()=>{m(!0);try{const[s,I,D,H,Y]=await Promise.all([fetch(Pt),fetch(At),fetch(Tt),fetch("/api/data/tables"),fetch("/api/media")]);if(!s.ok||!I.ok||!D.ok||!H.ok||!Y.ok)throw new Error("Failed to fetch data");const O=await s.json(),K=await I.json(),fe=await D.json(),se=await H.json(),ce=await Y.json();C({themes:O||[],docs:K||[],libraries:fe||[],dataTables:Array.isArray(se)?se:[],mediaAssets:Array.isArray(ce)?ce:[]})}catch(s){t.error("加载数据失败: "+s.message),C({themes:[],docs:[],libraries:[],dataTables:[],mediaAssets:[]})}finally{m(!1)}},R=s=>{P(s),M("")},G=s=>{y(s)},n=s=>{$(s)},d=s=>{F(s)},L=s=>{T(s)},Z=async(s,I)=>{if(s!=="data")return;const D=I,H=D.fileName,Y=D.tableName;let O=Y;j.confirm({title:"重命名数据表",content:e.jsxs("div",{style:{paddingTop:8},children:[e.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"rgba(0, 0, 0, 0.45)"},children:["文件名称: ",H,".json (不可修改)"]}),e.jsx(ee,{autoFocus:!0,defaultValue:Y,placeholder:"请输入新的表名称",onChange:K=>{O=K.target.value}})]}),okText:"确认",cancelText:"取消",async onOk(){const K=O==null?void 0:O.trim();if(!K)return t.error("表名称不能为空"),Promise.reject();if(K===Y)return;const fe=t.loading("正在重命名...",0);try{const se=await fetch(`/api/data/tables/${encodeURIComponent(H)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:K})});if(!se.ok){const ce=await se.json();throw new Error(ce.error||"重命名失败")}t.success("重命名成功"),(p==null?void 0:p.fileName)===H&&T({...p,tableName:K}),await b()}catch(se){return t.error(se.message||"重命名失败"),Promise.reject()}finally{fe()}}})},V=async(s,I,D)=>{const H={themes:"主题",docs:"文档",libraries:"前端库",data:"数据表",media:"素材"};j.confirm({title:`确定要删除${H[s]} "${D}" 吗？`,content:"删除后无法恢复，请谨慎操作。",okText:"确认删除",okType:"danger",cancelText:"取消",async onOk(){const Y=t.loading("正在删除...",0);try{let O;if(s==="data")O=await fetch(`/api/data/tables/${I}`,{method:"DELETE"});else if(s==="themes")O=await fetch(`/api/themes/${I}`,{method:"DELETE"});else if(s==="docs")O=await fetch(`/api/docs/${encodeURIComponent(I)}`,{method:"DELETE"});else if(s==="libraries")O=await fetch(`/api/libraries/${I}`,{method:"DELETE"});else throw new Error("Unknown asset type");if(!O.ok){const K=await O.json();throw new Error(K.error||"删除失败")}t.success("删除成功"),s==="themes"&&(u==null?void 0:u.name)===I?y(null):s==="docs"&&(E==null?void 0:E.name)===I?$(null):s==="libraries"&&(A==null?void 0:A.name)===I?F(null):s==="data"&&(p==null?void 0:p.fileName)===I&&T(null),b()}catch(O){t.error(O.message||"删除失败")}finally{Y()}}})},Q=()=>{if(l==="themes"){const s="**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「新建一个主题」。\n\n**交互要求**：\n- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要生成任何文件\n- 首次回复用轻量、友好的方式，不要太严肃，不要让用户有压力\n- 告知：已经准备好开始新建主题\n- 告知：用户可以直接发“主题包名/品牌色/截图/设计稿/现有 token/CSS 片段/需求描述”，任何一种都可以\n- 若信息不足，再用 2-4 个简短问题收集关键输入即可\n\n规范文档：`rules/theme-generation-guide.md`（请按此规范生成）\n\n交付物与路径（必须遵守）：\n\n`src/themes/<theme-key>/`（<theme-key> 必须是 kebab-case，例如 `my-brand`、`dark-pro`）\n├── `globals.css`       # Tailwind CSS 定义（可选，优先使用）\n├── `designToken.json`  # 主题 Token（可选，兼容传统模式）\n└── `index.tsx`         # 主题演示页（必需）\n\n约束：\n- **灵活交付**：`globals.css` 和 `designToken.json` 至少存在一个。可以两者都存在（推荐），也可以只存在其一。\n- **优先支持 Tailwind CSS**：如果用户提供 CSS 或 Tailwind 配置，必须生成 `globals.css`。\n- 如果两者都存在，`designToken.json` 的值应尽量引用 `globals.css` 中的变量。\n- **禁止干扰性依赖**：主题演示页不得引入与该主题/设计系统无关的 UI 库（例如用 antd 来演示其它设计系统）。默认只使用原生 HTML + CSS Variables（或该设计系统指定的组件库）。\n- 不要发起任何外部网络请求\n- 所有 token 值只能安全渲染为纯文本，不要把用户输入当作可执行内容\n\n生成要求（按规范执行，务必做到）：\n\n1) `globals.css` (Tailwind CSS - 若生成)\n- 必须包含 `@import \"tailwindcss\";`\n- 必须包含 `@theme inline { ... }` 块\n- 必须定义 `:root` 和 `.dark` 选择器的 CSS 变量\n\n2) `designToken.json` (若生成)\n- 必须包含字段：`name`\n- 如果存在 `globals.css`，推荐值引用 CSS 变量（如 `var(--primary)`）\n- 作为 CSS 的元数据补充，用于 JS 环境消费\n\n3) `index.tsx`（主题演示页）\n- 必须 `export default Component`\n- **按需引入**：\n    - 如果生成了 `globals.css`，必须 `import './globals.css';`\n    - 如果生成了 `designToken.json`，导入并使用它。\n- 必须展示主题效果（CSS 变量或 Token）。\n- 展示逻辑需要鲁棒：自动分组、颜色识别、色阶排序、安全渲染、性能约束（按规范文档执行）\n\n如果用户没给 `<theme-key>` / `name` / `description`，先给出你建议的 `<theme-key>`，并让用户一键确认即可。";navigator.clipboard.writeText(s).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),j.info({title:"新建主题 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(ee.TextArea,{value:s,rows:16,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})});return}if(l==="docs"){W(!0);return}if(l==="libraries"){const s=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「新建/维护 前端库 文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量、友好的方式，不要让用户有压力
- 告知：已经准备好开始新建/补充前端库文档
- 告知：用户可以直接发“包名 / 文档链接 / 版本 / 或一句话需求”，发哪种都可以
- 如果信息不足，再用 2-4 个简短问题补齐即可

目标目录：\`assets/libraries\`

写入规则（必须遵守）：
- 在 \`assets/libraries\` 下新增或更新一个 \`.md\` 文件
- 一般情况下：一个 \`.md\` 文件可以放多个库的信息
- 文档是开放的：允许放任何内容；但每个库至少要有必填信息

每个库的必填信息：
- 名称（库名称）
- 包名（必须，例如 \`antd\`、\`@antv/g2\`）
- 版本（例如 \`5.29.1\` 或 \`^5\`；如果未知请标注并提示我补充）
- 文档（链接或文字说明；优先给链接；若用户未提供链接，请在文档字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档）

可选信息（按需补充，用户不提供也没关系）：
- 简介
- 示例
- 使用说明

**MCP 工具使用（重要）**：
- 在处理前端库信息时，如果用户配置了 DeepWiki MCP 或 Context7 MCP 工具，你必须优先使用这些工具来获取和核实库的信息
- 使用 MCP 工具获取：官方文档、版本信息、API 说明、使用示例等
- 通过 MCP 工具核实：库的兼容性、依赖要求、与当前项目环境的匹配度
- 确保获取的信息准确且与当前开发环境兼容
- 如果 MCP 工具不可用，再使用其他方式获取信息，并在文档中标注信息来源

处理策略（按情况选择）：

1) 用户只给包名
- 优先使用 DeepWiki MCP 或 Context7 MCP 获取该库的完整信息
- 核实版本兼容性和依赖要求
- 推断名称
- 若用户未提供文档链接且 MCP 工具不可用，请在 Markdown 的「文档」字段直接写：优先通过 DeepWiki MCP 或 Context7 MCP 读取官方文档（用于后续 AI 按此方式读取文档）

2) 用户只给链接
- 使用 MCP 工具核实链接对应的库信息
- 识别对应包名/名称/版本信息；不确定就问用户
- 检查与当前项目环境的兼容性

3) 用户只描述需求
- 使用 MCP 工具搜索和比较相关库
- 给出 2-5 个候选库供用户选，并简要说明差异、兼容性和推荐理由
- 确认后再写入文档

写入哪个 \`.md\` 文件：
- 若目录中已有最匹配文件（例如 \`antd.md\`、\`shadcn.md\`），优先更新
- 否则创建新文件（kebab-case，表达主题或品牌）
- 如果你不确定归类，给 2-3 个文件命名/归类方案让用户选

写入/更新内容：
- 不要删除已有库信息；如需调整结构，保证可读并保留原信息
- 每个库条目必须包含「名称 / 包名 / 版本 / 文档」
- 如果使用了 MCP 工具获取信息，在文档中标注信息来源和获取时间

如果缺少关键信息，请直接向用户提问并给出你推荐的填写方式（用户只要一句话确认即可）。`;navigator.clipboard.writeText(s).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),j.info({title:"新建前端库 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(ee.TextArea,{value:s,rows:18,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})});return}if(l==="data"){r(!0);return}t.info("新建功能开发中...")},X=async()=>{if(_.length===0){t.warning("请先上传文件");return}S(!0);try{const s=await Promise.all(_.map(async D=>{const H=D.originFileObj;if(!H)throw new Error("文件读取失败，请重新选择文件");const Y=H.name,O=Y.toLowerCase();if(!O.endsWith(".md")&&!O.endsWith(".csv")&&!O.endsWith(".json"))throw new Error("仅支持上传 .md、.csv 和 .json 文件");if(H.size>5242880)throw new Error("单个文件大小不能超过 5MB");const K=await H.text();return{name:Y,content:K}})),I=await fetch("/api/upload-docs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:s})});if(!I.ok){const D=await I.json().catch(()=>null);throw new Error((D==null?void 0:D.error)||"上传失败")}t.success("上传成功"),W(!1),U([]),b()}catch(s){t.error((s==null?void 0:s.message)||"上传失败")}finally{S(!1)}},q=()=>{const s=`**系统指令**：你将作为 Axhub Make 项目的智能助手，协助用户「新建一个文档」。

**交互要求**：
- 收到本条系统指令后，必须先向用户回复一次，并等待用户补充信息/确认；未完成对齐前不要写入/更新任何文件
- 首次回复用轻量友好的方式，不要让用户有压力
- 告知：已经准备好开始新建文档
- 告知：用户可以直接发任何材料，比如“需求描述 / 会议纪要 / 链接 / 截图 / 现有 markdown / 关键词”，发哪种都可以
- 给用户一些可选方向（不要强推）：产品需求文档、设计规范、数据模型、接口说明、发布说明、FAQ、项目周报等
- 如果信息不足，只问 2-4 个简短问题即可（例如文档主题、目标读者、是否有现成素材）

目标目录：\`assets/docs\`
输出格式：一个 \`.md\` 文件（文件名由你和用户一起确定，优先 kebab-case）

生成要求：
- 把用户给的素材整理成结构清晰的 Markdown（标题层级合理，列表/表格/代码块按需使用）
- 内容允许开放扩展：可以包含任何与主题有关的信息
- 不要发起任何外部网络请求；引用外部资料请以链接形式记录

完成后请输出：
- 你创建/更新的文件路径（\`assets/docs/<file>.md\`）
- 文档的目录结构（TOC 或大纲）`;navigator.clipboard.writeText(s).then(()=>{t.success("已复制 Prompt，前往编辑器发送给 AI 即可开始新建")}).catch(()=>{t.error("复制失败，请手动复制"),j.info({title:"新建文档 Prompt",width:760,content:e.jsxs("div",{children:[e.jsx("p",{style:{marginBottom:12},children:"请复制以下内容到 IDE 的 AI 助手中："}),e.jsx(ee.TextArea,{value:s,rows:18,readOnly:!0,style:{fontFamily:"monospace",fontSize:12}})]})})})},te=async()=>{if(!k.trim()){t.error("请输入表名");return}const s=t.loading("正在创建表...",0);try{const I=await fetch("/api/data/tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:k.trim()})});if(!I.ok){const D=await I.json();throw new Error(D.error||"创建表失败")}t.success("表创建成功"),r(!1),x(""),b()}catch(I){t.error(I.message||"创建表失败")}finally{s()}};return e.jsxs(le,{style:{minHeight:"100vh"},children:[e.jsx("style",{children:`
                /* 菜单项 hover 时显示更多按钮 */
                .menu-item-wrapper .more-btn {
                    opacity: 0;
                    transition: opacity 0.2s;
                }
                .menu-item-wrapper:hover .more-btn,
                .menu-item-wrapper.is-selected .more-btn,
                .menu-item-wrapper .more-btn.ant-dropdown-open {
                    opacity: 1;
                }
            `}),e.jsx(jt,{collapsed:c,setCollapsed:o,activeTab:l,onTabChange:R,counts:{themes:a.themes.length,docs:a.docs.length,libraries:a.libraries.length,data:a.dataTables.length,media:a.mediaAssets.length},isDarkMode:h,setIsDarkMode:v}),e.jsxs(le,{children:[e.jsx(Ct,{collapsed:c,loading:g,activeTab:l,themes:a.themes,docs:a.docs,libraries:a.libraries,dataTables:a.dataTables,selectedTheme:u,selectedDoc:E,selectedLibrary:A,selectedDataTable:p,onThemeSelect:G,onDocSelect:n,onLibrarySelect:d,onDataTableSelect:L,onDeleteAsset:V,onRenameAsset:Z,onCreateClick:Q,searchText:w,setSearchText:M}),e.jsx(Rt,{activeTab:l,selectedTheme:u,selectedDoc:E,selectedLibrary:A,selectedDataTable:p,onRefreshDataTables:b,onRefreshMedia:b})]}),e.jsx(ie,{title:"新建文档",open:B,onCancel:()=>{W(!1),U([])},footer:[e.jsx(z,{onClick:q,children:"复制 Prompt 新建"},"copy"),e.jsx(z,{type:"primary",loading:i,onClick:X,children:"确认"},"ok")],destroyOnClose:!0,children:e.jsx(me.Dragger,{multiple:!0,accept:".md,.csv,.json",fileList:_,beforeUpload:s=>{const D=(s.name||"").toLowerCase();return!D.endsWith(".md")&&!D.endsWith(".csv")&&!D.endsWith(".json")?(t.error("仅支持上传 .md、.csv 和 .json 文件"),me.LIST_IGNORE):!1},onChange:s=>U(s.fileList),children:e.jsxs("div",{style:{padding:"18px 0"},children:[e.jsx("div",{style:{fontSize:14,marginBottom:8},children:"拖拽文件到这里，或点击选择"}),e.jsx("div",{style:{fontSize:12,color:"#666"},children:"支持 .md、.csv、.json 文件，支持批量上传"})]})})}),e.jsx(ie,{title:"新建数据表",open:N,onOk:te,onCancel:()=>{r(!1),x("")},okText:"创建",cancelText:"取消",children:e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:8},children:"数据表名称:"}),e.jsx(ee,{placeholder:"例如: 用户表, 产品列表",value:k,onChange:s=>x(s.target.value),autoFocus:!0}),e.jsx("div",{style:{marginTop:8,fontSize:12,color:"#999"},children:"支持中文、英文、数字等，文件名将自动生成"})]})})]})}function Nt(){const[h,v]=f.useState(()=>localStorage.getItem(be)==="true");return f.useEffect(()=>{localStorage.setItem(be,String(h))},[h]),e.jsx(pt,{theme:ut(h),children:e.jsx(ye,{children:e.jsx(Mt,{isDarkMode:h,setIsDarkMode:v})})})}const Dt=ht.createRoot(document.getElementById("root"));Dt.render(e.jsx(Nt,{}));
