import{s as p,t as J,r as S,j as h,D as F,h as A,am as V,aF as z,az as M,aO as Q,aP as H}from"./vendor.js";import{e as X}from"./execute.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const L={async deleteItem(t){const e=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const n=await e.json();throw new Error(n.error||"删除失败")}return e.json()},async unsetReference(t){const e=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const n=await e.json();throw new Error(n.error||"取消参考失败")}return e.json()},async getWsClients(){const t=await fetch("/api/ws/clients");return t.ok?(await t.json()).clients||[]:[]},async sendWsMessage(t){const e=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.text();throw new Error(n||"发送失败")}return e.json()},async fetchCode(t){const e=await fetch(t);if(!e.ok)throw new Error(`获取构建代码失败，请让 AI 修复: ${e.statusText}`);return e.text()},async fetchHackCss(t,e){const n=`${window.location.origin}/${t}/${e}/hack.css`;try{const a=await fetch(n);if(a.ok)return await a.text()}catch(a){console.warn("fetch hack.css failed",a)}return""},async fetchSpecMd(t,e){const n=`${window.location.origin}/${t}/${e}/spec.md`;try{const a=await fetch(n);if(a.ok)return await a.text()}catch(a){console.warn("Error fetching spec.md",a)}return""},async reviewCode(t){const e=await fetch("/api/code-review",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const n=await e.json();throw new Error(n.error||"代码检查失败")}return e.json()},async executePrompt(t){const e={scene:t.scene,client:t.client,prompt:t.prompt};return X(e)},async getConfig(){const t=await fetch("/api/config");if(!t.ok)throw new Error("加载配置失败");return t.json()},async getAssistantRuntime(t){const e=(t==null?void 0:t.autoStart)===!1?"?autoStart=false":"",n=await fetch(`/api/assistant/runtime${e}`);if(!n.ok)throw new Error("加载助手运行时配置失败");return n.json()},async bootstrapAssistant(t){const e=await fetch("/api/assistant/bootstrap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();if(!e.ok)throw new Error((n==null?void 0:n.error)||"启动 Axhub Genie 失败");return n},async openIDE(t){const e=await fetch("/api/ide/open",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();if(!e.ok)throw new Error((n==null?void 0:n.error)||"打开 IDE 失败");return n}},v={"genie:claude":"ClaudeCode","genie:cursor":"Cursor CLI","genie:codex":"Codex","local:cursor":"Cursor","local:qoder":"Qoder"},Z=["genie:claude","genie:cursor","genie:codex"],ee=["local:cursor","local:qoder"];function te(t){const e={key:"copy",label:"复制 Prompt"},n=Z.map(u=>({key:u,label:`用 ${v[u]} 执行`})),a=ee.map(u=>({key:u,label:`用 ${v[u]} 执行`})),r=[{key:"genie",label:"Axhub Genie",actions:n},{key:"local",label:"本地编辑器",actions:a}],s=[...n,...a];if(!t)return{mainAction:e,copyAction:e,actionGroups:r,includeCopyInMenu:!1};const f=s.find(u=>u.key===t)??e;return{mainAction:f,copyAction:e,actionGroups:r,includeCopyInMenu:f.key!=="copy"}}const ne=[{value:"cursor",label:"Cursor"},{value:"trae",label:"TRAE"},{value:"vscode",label:"Visual Studio Code"},{value:"trae_cn",label:"TRAE CN"},{value:"windsurf",label:"Windsurf"},{value:"kiro",label:"Kiro"},{value:"qoder",label:"Qoder"},{value:"antigravity",label:"Antigravity"}];ne.map(t=>t.value);const se={cursor:"Cursor",trae:"TRAE",vscode:"Visual Studio Code",trae_cn:"TRAE CN",windsurf:"Windsurf",kiro:"Kiro",qoder:"Qoder",antigravity:"Antigravity"},ye=["vscode","cursor"],oe=[/command failed/i,/start-process/i,/powershell/i,/system cannot find the file/i,/cannot find the file specified/i,/系统找不到指定的文件/,/no such file or directory/i,/enoent/i];function re(t,e,n){const a=typeof(t==null?void 0:t.message)=="string"?t.message.trim():"",r=e?se[e]:"编辑器",s=`未检测到 ${r}，请先安装后再试`,f=`打开${r}失败，请稍后重试`,u=a&&oe.some(w=>w.test(a))?s:f;return n?`${u}，已继续后续操作`:u}async function ae({preferredIDE:t,targetPath:e}){if(!t)return!1;try{return await L.openIDE({ide:t,targetPath:e&&e.trim()?e.trim():void 0}),!0}catch(n){return console.error("Failed to auto open IDE:",n),p.warning(re(n,t,!!e)),!1}}const ge="axhub-admin-active-tab",Ee="axhub-admin-create-mode",be="axhub-admin-generate-axure",Te="axhub-admin-create-reference",_e="axhub-make-dark-mode",Pe="axhub:assistant-panel-width",ie="axhub:open-assistant-url",Se=[{id:"desktop",name:"电脑",width:0,height:0,type:"desktop"},{id:"mobile",name:"手机",width:10,height:21.7,type:"mobile",ratio:"21.7:10"},{id:"tablet",name:"平板",width:10,height:14.3,type:"tablet",ratio:"10:14.3"}],ce={claude:"genie:claude",cursor:"genie:cursor",codex:"genie:codex"},C=new Set(["genie:claude","genie:cursor","genie:codex"]),j=new Set(["local:cursor","local:qoder"]);function ke(t){if(t==null||typeof t!="string")return null;const e=t.trim().toLowerCase();return e?C.has(e)||j.has(e)?e:ce[e]||null:null}function D(t){return typeof t=="string"&&C.has(t)}function le(t){return typeof t=="string"&&j.has(t)}function ue(t){if(!D(t))return null;const e=t.split(":")[1];return e==="claude"||e==="cursor"||e==="codex"?e:null}function de(t){const e=new URL("cursor://anysphere.cursor-deeplink/prompt");return e.searchParams.set("text",t),e.toString()}function pe(t){const e=new URL("qoder://aicoding.aicoding-deeplink/chat");return e.searchParams.set("text",t),e.searchParams.set("mode","agent"),e.toString()}function fe(t,e){if(!e)throw new Error("Prompt 不能为空");if(t==="local:cursor")return de(e);if(t==="local:qoder")return pe(e);throw new Error("不支持的本地编辑器类型")}const me={"genie:claude":H,"genie:cursor":M,"genie:codex":Q,"local:cursor":M,"local:qoder":z};function Oe({preferredClient:t,scene:e,buildPrompt:n,disabled:a,type:r="primary",onAfterCopy:s,copySuccessMessage:f="Prompt 已复制到剪贴板",executeSuccessMessage:u="已打开新会话",fallbackMessage:w="自动执行失败，已回退为复制 Prompt",preferredIDE:G=null,getIdeTargetPath:y,block:k=!1,className:$,copyLabel:g="复制 Prompt",style:O}){const{token:B}=J.useToken(),[E,R]=S.useState(!1),b=S.useRef(!1),{mainAction:T,copyAction:_,actionGroups:q,includeCopyInMenu:K}=S.useMemo(()=>{const o=te(t);if(g==="复制 Prompt")return o;const i=l=>l.key!=="copy"?l:{...l,label:g};return{mainAction:i(o.mainAction),copyAction:i(o.copyAction),includeCopyInMenu:o.includeCopyInMenu,actionGroups:o.actionGroups.map(l=>({...l,actions:l.actions.map(i)}))}},[t,g]),P=o=>{if(o==="copy")return h.jsx(V,{});const i=me[o];if(i)return h.jsx(i,{size:16,color:B.colorText})},U=(o,i)=>{try{const l=new CustomEvent(ie,{detail:{url:o,...i?{targetPath:i}:{}},cancelable:!0});return!window.dispatchEvent(l)}catch{return!1}},W=o=>{try{return window.open(o,"_blank","noopener,noreferrer")||(window.location.href=o),!0}catch{return!1}},x=async o=>{var i,l;if(!(E||b.current)){b.current=!0,R(!0);try{const d=await n();if(!d||!String(d).trim()){p.warning("没有可用的 Prompt");return}const m=o==="copy"?f:w;await navigator.clipboard.writeText(d);const I=(y==null?void 0:y())||void 0;if(o==="copy"){await ae({preferredIDE:G,targetPath:I}),p.success(m),s==null||s();return}if(le(o)){try{const c=fe(o,d);W(c)?p.success(u):p.success(m)}catch(c){c!=null&&c.message&&console.error("open deeplink failed:",c.message),p.success(m)}s==null||s();return}if(!D(o)){p.success(m),s==null||s();return}const N=ue(o);if(!N){p.success(m),s==null||s();return}try{const c=await L.executePrompt({scene:e,client:N,prompt:d});U(c.url,I)||window.open(c.url,"_blank"),p.success(u),s==null||s()}catch(c){(i=c==null?void 0:c.message)!=null&&i.includes("Axhub Genie")||(l=c==null?void 0:c.message)!=null&&l.includes("@axhub/genie")?p.warning("Genie 未就绪，已回退为复制 Prompt。请先安装/启动 Axhub Genie。"):p.success(m),s==null||s(),c!=null&&c.message&&console.error("execute prompt failed:",c.message)}}catch(d){p.error((d==null?void 0:d.message)||"操作失败")}finally{b.current=!1,R(!1)}}};return h.jsx(F.Button,{className:$,type:r,loading:E,disabled:a||E,style:k?{width:"100%",display:"flex",...O||{}}:{width:"auto",display:"inline-flex",...O||{}},buttonsRender:k?o=>{var d,m;const[i,l]=o;return[A.cloneElement(i,{style:{...((d=i.props)==null?void 0:d.style)||{},flex:1,minWidth:0}}),A.cloneElement(l,{style:{...((m=l.props)==null?void 0:m.style)||{},flex:"0 0 auto"}})]}:void 0,menu:{items:[...K?[{key:_.key,label:_.label,icon:P(_.key)}]:[],...q.map(o=>({type:"group",key:o.key,label:o.label,children:o.actions.map(i=>({key:i.key,label:i.label,icon:P(i.key)}))}))],onClick:({key:o})=>{x(o)}},onClick:()=>x(T.key),children:h.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[P(T.key),T.label]})})}export{ie as A,Se as D,ne as M,Oe as P,Pe as S,ye as W,L as a,Te as b,Ee as c,be as d,_e as e,ge as f,ke as n,ae as o,ue as t};
