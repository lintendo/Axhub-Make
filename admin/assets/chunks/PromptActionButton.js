import{s as d,t as C,r as A,j as h,D as v,h as k,am as B,aO as M,az as $,aP as L}from"./vendor.js";import{e as K}from"./execute.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const p of s.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();const R={async deleteItem(t){const e=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const n=await e.json();throw new Error(n.error||"删除失败")}return e.json()},async unsetReference(t){const e=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const n=await e.json();throw new Error(n.error||"取消参考失败")}return e.json()},async getWsClients(){const t=await fetch("/api/ws/clients");return t.ok?(await t.json()).clients||[]:[]},async sendWsMessage(t){const e=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.text();throw new Error(n||"发送失败")}return e.json()},async fetchCode(t){const e=await fetch(t);if(!e.ok)throw new Error(`获取构建代码失败，请让 AI 修复: ${e.statusText}`);return e.text()},async fetchHackCss(t,e){const n=`${window.location.origin}/${t}/${e}/hack.css`;try{const i=await fetch(n);if(i.ok)return await i.text()}catch(i){console.warn("fetch hack.css failed",i)}return""},async fetchSpecMd(t,e){const n=`${window.location.origin}/${t}/${e}/spec.md`;try{const i=await fetch(n);if(i.ok)return await i.text()}catch(i){console.warn("Error fetching spec.md",i)}return""},async reviewCode(t){const e=await fetch("/api/code-review",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const n=await e.json();throw new Error(n.error||"代码检查失败")}return e.json()},async executePrompt(t){const e={scene:t.scene,client:t.client,prompt:t.prompt};return K(e)},async getConfig(){const t=await fetch("/api/config");if(!t.ok)throw new Error("加载配置失败");return t.json()},async getAssistantRuntime(){const t=await fetch("/api/assistant/runtime");if(!t.ok)throw new Error("加载助手运行时配置失败");return t.json()},async bootstrapAssistant(t){const e=await fetch("/api/assistant/bootstrap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();if(!e.ok)throw new Error((n==null?void 0:n.error)||"启动 Axhub Genie 失败");return n},async openIDE(t){const e=await fetch("/api/ide/open",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();if(!e.ok)throw new Error((n==null?void 0:n.error)||"打开 IDE 失败");return n}},J={claude:"ClaudeCode",cursor:"Cursor",codex:"Codex"},Y=["claude","cursor","codex"];function V(t){const e={key:"copy",label:"复制 Prompt"},n=Y.map(s=>({key:s,label:`用 ${J[s]} 执行`}));if(!t)return{mainAction:e,menuActions:n};const i=n.find(s=>s.key===t)??e,a=[e,...n.filter(s=>s.key!==t)];return{mainAction:i,menuActions:a}}async function U({preferredIDE:t,targetPath:e}){if(t)try{await R.openIDE({ide:t,targetPath:e&&e.trim()?e.trim():void 0})}catch(n){console.error("Failed to auto open IDE:",n),d.warning((n==null?void 0:n.message)||"自动打开 IDE 失败，已继续后续操作")}}const X="axhub-admin-active-tab",Q="axhub-admin-create-mode",Z="axhub-admin-generate-axure",ee="axhub-admin-create-reference",te="axhub-make-dark-mode",ne="axhub:assistant-panel-width",W="axhub:open-assistant-url",se=[{id:"desktop",name:"电脑",width:0,height:0,type:"desktop"},{id:"mobile",name:"手机",width:10,height:21.7,type:"mobile",ratio:"21.7:10"},{id:"tablet",name:"平板",width:10,height:14.3,type:"tablet",ratio:"10:14.3"}],F={claude:L,cursor:$,codex:M};function oe({preferredClient:t,scene:e,buildPrompt:n,disabled:i,type:a="primary",onAfterCopy:s,copySuccessMessage:p="Prompt 已复制到剪贴板",executeSuccessMessage:_="已打开新会话",fallbackMessage:j="自动执行失败，已回退为复制 Prompt",preferredIDE:I=null,getIdeTargetPath:f,block:g=!1,className:P,copyLabel:w="复制 Prompt",style:b}){const{token:N}=C.useToken(),[y,x]=A.useState(!1),{mainAction:E,menuActions:D}=A.useMemo(()=>{const o=V(t);if(w==="复制 Prompt")return o;const r=l=>l.key!=="copy"?l:{...l,label:w};return{mainAction:r(o.mainAction),menuActions:o.menuActions.map(r)}},[t,w]),O=o=>{if(o==="copy")return h.jsx(B,{});const r=F[o];if(r)return h.jsx(r,{size:16,color:N.colorText})},G=(o,r)=>{try{const l=new CustomEvent(W,{detail:{url:o,...r?{targetPath:r}:{}},cancelable:!0});return!window.dispatchEvent(l)}catch{return!1}},S=async o=>{var r,l;if(!y){x(!0);try{const u=await n();if(!u||!String(u).trim()){d.warning("没有可用的 Prompt");return}const m=o==="copy"?p:j;await navigator.clipboard.writeText(u);const T=(f==null?void 0:f())||void 0;if(o==="copy"){await U({preferredIDE:I,targetPath:T}),d.success(m),s==null||s();return}try{const c=await R.executePrompt({scene:e,client:o,prompt:u});G(c.url,T)||window.open(c.url,"_blank"),d.success(_),s==null||s()}catch(c){(r=c==null?void 0:c.message)!=null&&r.includes("Axhub Genie")||(l=c==null?void 0:c.message)!=null&&l.includes("@axhub/genie")?d.warning("Genie 未就绪，已回退为复制 Prompt。请先安装/启动 Axhub Genie。"):d.success(m),s==null||s(),c!=null&&c.message&&console.error("execute prompt failed:",c.message)}}catch(u){d.error((u==null?void 0:u.message)||"操作失败")}finally{x(!1)}}};return h.jsx(v.Button,{className:P,type:a,loading:y,disabled:i||y,style:g?{width:"100%",display:"flex",...b||{}}:{width:"auto",display:"inline-flex",...b||{}},buttonsRender:g?o=>{var u,m;const[r,l]=o;return[k.cloneElement(r,{style:{...((u=r.props)==null?void 0:u.style)||{},flex:1,minWidth:0}}),k.cloneElement(l,{style:{...((m=l.props)==null?void 0:m.style)||{},flex:"0 0 auto"}})]}:void 0,menu:{items:[{type:"group",label:"更多执行方式",children:D.map(o=>({key:o.key,label:o.label,icon:O(o.key)}))}],onClick:({key:o})=>{S(o)}},onClick:()=>S(E.key),children:h.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[O(E.key),E.label]})})}export{W as A,se as D,oe as P,ne as S,R as a,ee as b,Q as c,Z as d,te as e,X as f,U as o};
