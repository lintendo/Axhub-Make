import{s as p,t as M,r as R,j as h,D,h as k,am as G,aO as $,az as B,aP as K}from"./vendor.js";import{e as L}from"./execute.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const N={async deleteItem(t){const e=await fetch("/api/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const s=await e.json();throw new Error(s.error||"删除失败")}return e.json()},async unsetReference(t){const e=await fetch("/api/unset-reference",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const s=await e.json();throw new Error(s.error||"取消参考失败")}return e.json()},async getWsClients(){const t=await fetch("/api/ws/clients");return t.ok?(await t.json()).clients||[]:[]},async sendWsMessage(t){const e=await fetch("/api/ws/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const s=await e.text();throw new Error(s||"发送失败")}return e.json()},async fetchCode(t){const e=await fetch(t);if(!e.ok)throw new Error(`获取构建代码失败，请让 AI 修复: ${e.statusText}`);return e.text()},async fetchHackCss(t,e){const s=`${window.location.origin}/${t}/${e}/hack.css`;try{const i=await fetch(s);if(i.ok)return await i.text()}catch(i){console.warn("fetch hack.css failed",i)}return""},async fetchSpecMd(t,e){const s=`${window.location.origin}/${t}/${e}/spec.md`;try{const i=await fetch(s);if(i.ok)return await i.text()}catch(i){console.warn("Error fetching spec.md",i)}return""},async reviewCode(t){const e=await fetch("/api/code-review",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})});if(!e.ok){const s=await e.json();throw new Error(s.error||"代码检查失败")}return e.json()},async executePrompt(t){const e={scene:t.scene,client:t.client,prompt:t.prompt};return L(e)},async getConfig(){const t=await fetch("/api/config");if(!t.ok)throw new Error("加载配置失败");return t.json()},async getAssistantRuntime(t){const e=(t==null?void 0:t.autoStart)===!1?"?autoStart=false":"",s=await fetch(`/api/assistant/runtime${e}`);if(!s.ok)throw new Error("加载助手运行时配置失败");return s.json()},async bootstrapAssistant(t){const e=await fetch("/api/assistant/bootstrap",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await e.json();if(!e.ok)throw new Error((s==null?void 0:s.error)||"启动 Axhub Genie 失败");return s},async openIDE(t){const e=await fetch("/api/ide/open",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await e.json();if(!e.ok)throw new Error((s==null?void 0:s.error)||"打开 IDE 失败");return s}},W={claude:"ClaudeCode",cursor:"Cursor",codex:"Codex"},V=["claude","cursor","codex"];function Y(t){const e={key:"copy",label:"复制 Prompt"},s=V.map(n=>({key:n,label:`用 ${W[n]} 执行`}));if(!t)return{mainAction:e,menuActions:s};const i=s.find(n=>n.key===t)??e,o=[e,...s.filter(n=>n.key!==t)];return{mainAction:i,menuActions:o}}const J=[{value:"cursor",label:"Cursor"},{value:"trae",label:"TRAE"},{value:"vscode",label:"Visual Studio Code"},{value:"trae_cn",label:"TRAE CN"},{value:"windsurf",label:"Windsurf"},{value:"kiro",label:"Kiro"},{value:"qoder",label:"Qoder"},{value:"antigravity",label:"Antigravity"}];J.map(t=>t.value);const U={cursor:"Cursor",trae:"TRAE",vscode:"Visual Studio Code",trae_cn:"TRAE CN",windsurf:"Windsurf",kiro:"Kiro",qoder:"Qoder",antigravity:"Antigravity"},te=["vscode","cursor"],q=[/command failed/i,/start-process/i,/powershell/i,/system cannot find the file/i,/cannot find the file specified/i,/系统找不到指定的文件/,/no such file or directory/i,/enoent/i];function F(t,e,s){const i=typeof(t==null?void 0:t.message)=="string"?t.message.trim():"",o=e?U[e]:"编辑器",n=`未检测到 ${o}，请先安装后再试`,d=`打开${o}失败，请稍后重试`,m=i&&q.some(w=>w.test(i))?n:d;return s?`${m}，已继续后续操作`:m}async function z({preferredIDE:t,targetPath:e}){if(!t)return!1;try{return await N.openIDE({ide:t,targetPath:e&&e.trim()?e.trim():void 0}),!0}catch(s){return console.error("Failed to auto open IDE:",s),p.warning(F(s,t,!!e)),!1}}const se="axhub-admin-active-tab",ne="axhub-admin-create-mode",oe="axhub-admin-generate-axure",ae="axhub-admin-create-reference",ie="axhub-make-dark-mode",re="axhub:assistant-panel-width",H="axhub:open-assistant-url",ce=[{id:"desktop",name:"电脑",width:0,height:0,type:"desktop"},{id:"mobile",name:"手机",width:10,height:21.7,type:"mobile",ratio:"21.7:10"},{id:"tablet",name:"平板",width:10,height:14.3,type:"tablet",ratio:"10:14.3"}],Q={claude:K,cursor:B,codex:$};function le({preferredClient:t,scene:e,buildPrompt:s,disabled:i,type:o="primary",onAfterCopy:n,copySuccessMessage:d="Prompt 已复制到剪贴板",executeSuccessMessage:m="已打开新会话",fallbackMessage:w="自动执行失败，已回退为复制 Prompt",preferredIDE:v=null,getIdeTargetPath:y,block:S=!1,className:I,copyLabel:E="复制 Prompt",style:T}){const{token:P}=M.useToken(),[g,A]=R.useState(!1),{mainAction:b,menuActions:j}=R.useMemo(()=>{const a=Y(t);if(E==="复制 Prompt")return a;const r=u=>u.key!=="copy"?u:{...u,label:E};return{mainAction:r(a.mainAction),menuActions:a.menuActions.map(r)}},[t,E]),_=a=>{if(a==="copy")return h.jsx(G,{});const r=Q[a];if(r)return h.jsx(r,{size:16,color:P.colorText})},C=(a,r)=>{try{const u=new CustomEvent(H,{detail:{url:a,...r?{targetPath:r}:{}},cancelable:!0});return!window.dispatchEvent(u)}catch{return!1}},O=async a=>{var r,u;if(!g){A(!0);try{const l=await s();if(!l||!String(l).trim()){p.warning("没有可用的 Prompt");return}const f=a==="copy"?d:w;await navigator.clipboard.writeText(l);const x=(y==null?void 0:y())||void 0;if(a==="copy"){await z({preferredIDE:v,targetPath:x}),p.success(f),n==null||n();return}try{const c=await N.executePrompt({scene:e,client:a,prompt:l});C(c.url,x)||window.open(c.url,"_blank"),p.success(m),n==null||n()}catch(c){(r=c==null?void 0:c.message)!=null&&r.includes("Axhub Genie")||(u=c==null?void 0:c.message)!=null&&u.includes("@axhub/genie")?p.warning("Genie 未就绪，已回退为复制 Prompt。请先安装/启动 Axhub Genie。"):p.success(f),n==null||n(),c!=null&&c.message&&console.error("execute prompt failed:",c.message)}}catch(l){p.error((l==null?void 0:l.message)||"操作失败")}finally{A(!1)}}};return h.jsx(D.Button,{className:I,type:o,loading:g,disabled:i||g,style:S?{width:"100%",display:"flex",...T||{}}:{width:"auto",display:"inline-flex",...T||{}},buttonsRender:S?a=>{var l,f;const[r,u]=a;return[k.cloneElement(r,{style:{...((l=r.props)==null?void 0:l.style)||{},flex:1,minWidth:0}}),k.cloneElement(u,{style:{...((f=u.props)==null?void 0:f.style)||{},flex:"0 0 auto"}})]}:void 0,menu:{items:[{type:"group",label:"更多执行方式",children:j.map(a=>({key:a.key,label:a.label,icon:_(a.key)}))}],onClick:({key:a})=>{O(a)}},onClick:()=>O(b.key),children:h.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[_(b.key),b.label]})})}export{H as A,ce as D,J as M,le as P,re as S,te as W,N as a,ae as b,ne as c,oe as d,ie as e,se as f,z as o};
